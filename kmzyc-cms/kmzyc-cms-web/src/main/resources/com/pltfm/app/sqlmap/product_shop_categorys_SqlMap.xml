<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="PRODUCT_SHOP_CATEGORYS" >
  <typeAlias alias="ShopCategory" type="com.kmzyc.supplier.model.ShopCategorys"/>
  
  <resultMap id="ibatorgenerated_BaseResultMap" class="ShopCategory" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Thu Nov 27 09:57:58 CST 2014.
    -->
    <result column="SHOP_CATEGORY_ID" property="shopCategoryId" jdbcType="DECIMAL" />
    <result column="SHOP_ID" property="shopId" jdbcType="DECIMAL" />
    <result column="PARENT_CATEGORY_ID" property="parentCategoryId" jdbcType="DECIMAL" />
    <result column="CATEGORY_CODE" property="categoryCode" jdbcType="VARCHAR" />
    <result column="CATEGORY_NAME" property="categoryName" jdbcType="VARCHAR" />
    <result column="CATEGORY_LEVEL" property="categoryLevel" jdbcType="DECIMAL" />
    <result column="STATUS" property="status" jdbcType="DECIMAL" />
    <result column="SORTNO" property="sortno" jdbcType="DECIMAL" />
    <result column="CREATE_TIME" property="createTime" jdbcType="DATE" />
    <result column="MODIF_TIME" property="modifTime" jdbcType="DATE" />
    <result column="MODIF_USER" property="modifUser" jdbcType="DECIMAL" />
    <result column="is_suggest" property="isSuggest" jdbcType="DECIMAL" />
    <result column="remark" property="remark" jdbcType="VARCHAR" />
    <result column="IS_EXPANDALL" property="isExpandAll" jdbcType="VARCHAR" />
    <result column="EXEC_SQL" property="execSql" jdbcType="VARCHAR" />
  </resultMap>
  <resultMap id="listWithChildMap" class="ShopCategory" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Thu Nov 27 09:57:58 CST 2014.
    -->
    <result column="SHOP_CATEGORY_ID" property="shopCategoryId" jdbcType="DECIMAL" />
     <result column="SHOP_CATEGORY_ID" property="shopCategoryChildrenList" select="PRODUCT_SHOP_CATEGORYS.queryChildrenByParentId" />
    <result column="SHOP_ID" property="shopId" jdbcType="DECIMAL" />
    <result column="PARENT_CATEGORY_ID" property="parentCategoryId" jdbcType="DECIMAL" />
    <result column="CATEGORY_CODE" property="categoryCode" jdbcType="VARCHAR" />
    <result column="CATEGORY_NAME" property="categoryName" jdbcType="VARCHAR" />
    <result column="CATEGORY_LEVEL" property="categoryLevel" jdbcType="DECIMAL" />
    <result column="STATUS" property="status" jdbcType="DECIMAL" />
    <result column="SORTNO" property="sortno" jdbcType="DECIMAL" />
    <result column="CREATE_TIME" property="createTime" jdbcType="DATE" />
    <result column="MODIF_TIME" property="modifTime" jdbcType="DATE" />
    <result column="MODIF_USER" property="modifUser" jdbcType="DECIMAL" />
    <result column="is_suggest" property="isSuggest" jdbcType="DECIMAL" />
    <result column="remark" property="remark" jdbcType="VARCHAR" />
    <result column="IS_EXPANDALL" property="isExpandAll" jdbcType="VARCHAR" />
    <result column="EXEC_SQL" property="execSql" jdbcType="VARCHAR" />
  </resultMap>


  <!-- 查询店铺类目 -->
   <select id="queryShopCategoryList" resultClass="com.kmzyc.supplier.model.ShopCategorys" parameterClass="com.kmzyc.supplier.model.ShopCategorys" >
 
   
   select shop_CATEGORY_ID as shopCategoryId, PARENT_category_ID as parentCategoryId, CATEGORY_NAME as categoryName,category_code as categoryCode
    from shop_categorys where STATUS = 1    and   SHOP_ID = #shopId:DECIMAL#
    
  </select>
  
  
  <!-- 根据绑定的类目获取店铺类目 -->
   <select id="queryBandShopCategoryList" resultClass="com.kmzyc.supplier.model.ShopCategorys" parameterClass="java.lang.String" >
 
   
   select shop_CATEGORY_ID as shopCategoryId, PARENT_category_ID as parentCategoryId, CATEGORY_NAME as categoryName,category_code as categoryCode
   , shop_Id as shopId 
    from shop_categorys where STATUS = 1    and    $value$ 
    
  </select>
  
  <select id="ibatorgenerated_selectByPrimaryKey" resultMap="ibatorgenerated_BaseResultMap" parameterClass="com.kmzyc.supplier.model.ShopCategorys" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Thu Nov 27 09:57:58 CST 2014.
    -->
    select SHOP_CATEGORY_ID, SHOP_ID, PARENT_CATEGORY_ID, CATEGORY_CODE, CATEGORY_NAME, CATEGORY_LEVEL,
      STATUS, SORTNO, CREATE_TIME, MODIF_TIME, MODIF_USER, EXEC_SQL,is_suggest,remark,IS_EXPANDALL
    from SHOP_CATEGORYS
    where SHOP_CATEGORY_ID = #shopCategoryId:DECIMAL#
  </select>
  <delete id="ibatorgenerated_deleteByPrimaryKey" parameterClass="com.kmzyc.supplier.model.ShopCategorys" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Thu Nov 27 09:57:58 CST 2014.
    -->
    delete from SHOP_CATEGORYS
    where SHOP_CATEGORY_ID = #shopCategoryId:DECIMAL#
  </delete>

  <insert id="ibatorgenerated_insert" parameterClass="com.kmzyc.supplier.model.ShopCategorys" >
    <selectKey resultClass="java.lang.Long" keyProperty="shopCategoryId" >
	      select SEQ_SHOP_CATEGORYS.nextval from dual
	</selectKey>
    insert into SHOP_CATEGORYS (SHOP_CATEGORY_ID, SHOP_ID, PARENT_CATEGORY_ID, CATEGORY_CODE, CATEGORY_NAME,
      CATEGORY_LEVEL, STATUS, SORTNO, CREATE_TIME, MODIF_TIME, MODIF_USER, EXEC_SQL,IS_EXPANDALL)
    values (#shopCategoryId:DECIMAL#, #shopId:DECIMAL#, #parentCategoryId:DECIMAL#, #categoryCode:VARCHAR#,
      #categoryName:VARCHAR#, #categoryLevel:DECIMAL#, #status:DECIMAL#, #sortno:DECIMAL#,
      #createTime:DATE#, #modifTime:DATE#, #modifUser:DECIMAL#, #execSql:VARCHAR#,#isExpandAll:VARCHAR#)
  </insert>
  <insert id="ibatorgenerated_insertSelective" parameterClass="com.kmzyc.supplier.model.ShopCategorys" >
    <selectKey resultClass="java.lang.Long" keyProperty="shopCategoryId" >
	      select SEQ_SHOP_CATEGORYS.nextval from dual
	</selectKey>
    insert into SHOP_CATEGORYS
    <dynamic prepend="(" >
      <isNotNull prepend="," property="shopCategoryId" >
        SHOP_CATEGORY_ID
      </isNotNull>
      <isNotNull prepend="," property="shopId" >
        SHOP_ID
      </isNotNull>
      <isNotNull prepend="," property="parentCategoryId" >
        PARENT_CATEGORY_ID
      </isNotNull>
      <isNotNull prepend="," property="categoryCode" >
        CATEGORY_CODE
      </isNotNull>
      <isNotNull prepend="," property="categoryName" >
        CATEGORY_NAME
      </isNotNull>
      <isNotNull prepend="," property="categoryLevel" >
        CATEGORY_LEVEL
      </isNotNull>
      <isNotNull prepend="," property="status" >
        STATUS
      </isNotNull>
      <isNotNull prepend="," property="sortno" >
        SORTNO
      </isNotNull>
      <isNotNull prepend="," property="createTime" >
        CREATE_TIME
      </isNotNull>
      <isNotNull prepend="," property="modifTime" >
        MODIF_TIME
      </isNotNull>
      <isNotNull prepend="," property="modifUser" >
        MODIF_USER
      </isNotNull>
      <isNotNull prepend="," property="execSql" >
        EXEC_SQL
      </isNotNull>
      <isNotNull prepend="," property="isSuggest" >
        is_suggest
      </isNotNull>
       <isNotNull prepend="," property="remark" >
        remark
      </isNotNull>
       <isNotNull prepend="," property="isExpandAll" >
        IS_EXPANDALL
      </isNotNull>
      )
    </dynamic>
    values
    <dynamic prepend="(" >
      <isNotNull prepend="," property="shopCategoryId" >
        #shopCategoryId:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="shopId" >
        #shopId:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="parentCategoryId" >
        #parentCategoryId:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="categoryCode" >
        #categoryCode:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="categoryName" >
        #categoryName:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="categoryLevel" >
        #categoryLevel:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="status" >
        #status:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="sortno" >
        #sortno:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="createTime" >
        #createTime#
      </isNotNull>
      <isNotNull prepend="," property="modifTime" >
        #modifTime#
      </isNotNull>
      <isNotNull prepend="," property="modifUser" >
        #modifUser:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="execSql" >
        #execSql:VARCHAR#
      </isNotNull>
       <isNotNull prepend="," property="isSuggest" >
        #isSuggest:DECIMAL#
      </isNotNull>
       <isNotNull prepend="," property="remark" >
        #remark:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="isExpandAll" >
        #isExpandAll:VARCHAR#
      </isNotNull>
      )
    </dynamic>
  </insert>
  
  
  
  <update id="ibatorgenerated_updateByPrimaryKeySelective" parameterClass="com.kmzyc.supplier.model.ShopCategorys" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Thu Nov 27 09:57:58 CST 2014.
    -->
    update SHOP_CATEGORYS
    <dynamic prepend="set" >
      <isNotNull prepend="," property="shopId" >
        SHOP_ID = #shopId:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="parentCategoryId" >
        PARENT_CATEGORY_ID = #parentCategoryId:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="categoryCode" >
        CATEGORY_CODE = #categoryCode:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="categoryName" >
        CATEGORY_NAME = #categoryName:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="categoryLevel" >
        CATEGORY_LEVEL = #categoryLevel:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="status" >
        STATUS = #status:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="sortno" >
        SORTNO = #sortno:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="createTime" >
        CREATE_TIME = #createTime:DATE#
      </isNotNull>
      <isNotNull prepend="," property="modifTime" >
        MODIF_TIME = #modifTime:DATE#
      </isNotNull>
      <isNotNull prepend="," property="modifUser" >
        MODIF_USER = #modifUser:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="execSql" >
        EXEC_SQL = #execSql:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="isSuggest" >
        is_suggest=#isSuggest:DECIMAL#
      </isNotNull>
       <isNotNull prepend="," property="remark" >
        remark=#remark:VARCHAR#
      </isNotNull>
       <isNotNull prepend="," property="isExpandAll" >
        IS_EXPANDALL=#isExpandAll:VARCHAR#
      </isNotNull>
    </dynamic>
    where SHOP_CATEGORY_ID = #shopCategoryId:DECIMAL#
  </update>
  <update id="ibatorgenerated_updateByPrimaryKey" parameterClass="com.kmzyc.supplier.model.ShopCategorys" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Thu Nov 27 09:57:58 CST 2014.
    -->
    update SHOP_CATEGORYS
    set SHOP_ID = #shopId:DECIMAL#,
      PARENT_CATEGORY_ID = #parentCategoryId:DECIMAL#,
      CATEGORY_CODE = #categoryCode:VARCHAR#,
      CATEGORY_NAME = #categoryName:VARCHAR#,
      CATEGORY_LEVEL = #categoryLevel:DECIMAL#,
      STATUS = #status:DECIMAL#,
      SORTNO = #sortno:DECIMAL#,
      CREATE_TIME = #createTime:DATE#,
      MODIF_TIME = #modifTime:DATE#,
      MODIF_USER = #modifUser:DECIMAL#,
      EXEC_SQL = #execSql:VARCHAR#,
      IS_EXPANDALL=#isExpandAll:VARCHAR#
    where SHOP_CATEGORY_ID = #shopCategoryId:DECIMAL#
  </update>
  
  	<!-- 查询该父节点下子节点的最大编码 -->
   <select id="queryMaxChildCodeByParentId" resultClass="java.lang.String" parameterClass="java.lang.Long" >
  		select max(t.category_code) from SHOP_CATEGORYS t where t.PARENT_CATEGORY_ID = #parentCategoryId#
  </select>
  
  <!-- 按父子级关系查询树结构 根据上级类目查询所有的子孙后代类目     start with id=para connect by id=parent_id 这个查找的是id为para的节点下的所有直属子类节点，包括子辈的和孙子辈的所有直属节点。-->
  <select id="queryListForTree" resultClass="ShopCategory" parameterClass="ShopCategory" >
  		select shop_category_id as shopCategoryId, shop_id as shopId, parent_category_id as parentCategoryId, category_code as categoryCode, category_name as categoryName, category_level as categoryLevel , status as status, sortno as sortno,is_suggest as isSuggest,IS_EXPANDALL as isExpandAll from shop_categorys
		where status=1 and shop_id=#shopId#		
		<isNotNull prepend="and" property="isSuggest" >
        	is_suggest=#isSuggest#
      	</isNotNull>
		start with 
		<isNotNull property="shopCategoryId">
			shop_category_id=#shopCategoryId#
		</isNotNull>
		<isNull property="shopCategoryId">
			parent_category_id=0
		</isNull>
		connect by prior shop_category_id=parent_category_id order by sortno asc
  </select>
  
  
   <!--依据父类ID查询其后代,不包含其子孙后代 -->
  <select id="queryListByParentId" resultClass="ShopCategory" parameterClass="ShopCategory">
  	select shop_category_id as shopCategoryId, shop_id as shopId, parent_category_id as parentCategoryId, category_code as categoryCode, category_name as categoryName, category_level as categoryLevel , status as status, sortno as sortno,is_suggest as isSuggest,IS_EXPANDALL as isExpandAll from shop_categorys
	where  status=1 and parent_category_id=#parentCategoryId#
  </select>
  
  <!-- 获得所有的一级类目 列表结构 -->
  <select id="queryForList" resultMap="listWithChildMap" parameterClass="ShopCategory">
  	select shop_category_id as shopCategoryId, shop_id as shopId, parent_category_id as parentCategoryId, category_code as categoryCode, category_name as categoryName, category_level as categoryLevel , status as status, sortno as sortno,is_suggest as isSuggest,IS_EXPANDALL as isExpandAll from shop_categorys
	where  status=1 and parent_category_id=#parentCategoryId#
	<isNotNull prepend="and" property="isSuggest" >
        	is_suggest=#is_suggest#
    </isNotNull>
  </select>
  
  <!-- 根据父类id查询所有的子类 立即加载出子类 -->
  <select id="queryChildrenByParentId" resultClass="ShopCategory" parameterClass="java.lang.Long">
  	select shop_category_id as shopCategoryId, shop_id as shopId, parent_category_id as parentCategoryId, category_code as categoryCode, category_name as categoryName, category_level as categoryLevel , status as status, sortno as sortno,is_suggest as isSuggest,IS_EXPANDALL as isExpandAll from shop_categorys
	where  status=1 and parent_category_id=#value#
  </select>
  
    <!-- 根据父类id查询所有的推荐的子类 立即加载出子类 -->
  <select id="querySuggestChildrenByParentId" resultClass="ShopCategory" parameterClass="java.lang.Long">
  	select shop_category_id as shopCategoryId, shop_id as shopId, parent_category_id as parentCategoryId, category_code as categoryCode, category_name as categoryName, category_level as categoryLevel , status as status, sortno as sortno,is_suggest as isSuggest,IS_EXPANDALL as isExpandAll from shop_categorys
	where  status=1 and is_suggest=1 and parent_category_id=#value#
  </select>
  
  <!-- 查询同一店铺 平级 类目是否存在 重复名称 -->
  <select id="queryExsistRepeatCategoryName" resultClass="java.lang.Integer" parameterClass="ShopCategory">
  	select count(shop_category_id) from shop_categorys where status=1 and category_name=#categoryName# and parent_category_id=#parentCategoryId# and shop_id=#shopId# 	
  </select>
  
  <!-- 查询店内分类在正式产品库当中有引用 -->
  <select id="queryRelationWithOfficial" resultClass="java.lang.Integer" parameterClass="ShopCategory">
  	select count(a.shop_category_id) from shop_categorys a,shop_product_category b,productmain c where a.shop_category_id=b.shop_category_id and b.product_id=c.product_id and c.shop_code=#supplierId# and a.shop_category_id in (select shop_category_id from shop_categorys start with shop_category_id=#shopCategoryId# connect by prior shop_category_id=parent_category_id)
  </select>
  
  <!-- 查询店内分类在正式产品草稿库当中有引用 -->
  <select id="queryRelationWithDraft" resultClass="java.lang.Integer" parameterClass="ShopCategory">
  	select count(a.shop_category_id) from shop_categorys a,shop_product_category b,product_draft c where a.shop_category_id=b.shop_category_id and b.product_id=c.product_id and c.shop_code=#supplierId# and a.shop_category_id in (select shop_category_id from shop_categorys start with shop_category_id=#shopCategoryId# connect by prior shop_category_id=parent_category_id)	
  </select>
  
  <!-- 删除类目,则将其底下的后代类目全部删除 -->
  <delete id="deleteShopCategory" parameterClass="com.kmzyc.supplier.model.ShopCategorys" >
    delete shop_categorys where shop_category_id in (select shop_category_id from shop_categorys start with shop_category_id=#shopCategoryId# connect by prior shop_category_id=parent_category_id)
  </delete>
  
  <!-- 按照父级类目的推荐情况统一其后代子级的推荐情况 -->
  <update id="updateIsSuggestByParent" parameterClass="ShopCategory" >
  		update shop_categorys set is_suggest=#isSuggest# where shop_category_id in (select shop_category_id from shop_categorys start with shop_category_id=#shopCategoryId# connect by prior shop_category_id=parent_category_id)
  </update>
  
  <!-- 更新排序号 -->
  <update id="updateSortNo" parameterClass="ShopCategory" >
  		update shop_categorys set sortno=#sortno# where shop_category_id=#shopCategoryId#
  </update>
  
  <!-- 批量更新 是否展开 -->
  <update id="updateIsExpandAllBatchById">
  		update shop_categorys set is_expandAll=1 where shop_category_id in
  		<iterate conjunction="," open="(" close=")">
        #[]#
    	</iterate>
  </update>
  
  <update id="updateIsSuggestBatchById">
  		update shop_categorys set is_suggest=1 where shop_category_id in
  		<iterate conjunction="," open="(" close=")">
        #[]#
    	</iterate>
  </update>
  
  <update id="updateSuggestByShopId" parameterClass="ShopCategory">
  		update shop_categorys set is_suggest=#isSuggest# where shop_id=#shopId#
  </update>
  
  <update id="updateExpandAllByShopId" parameterClass="ShopCategory">
  		update shop_categorys set is_expandAll=#isExpandAll# where shop_id=#shopId#
  </update>
</sqlMap>