<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="CMS_PROMOTION_TASK" >
  <resultMap id="abatorgenerated_CmsPromotionTaskResult" class="com.pltfm.cms.vobject.CmsPromotionTask" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Sat Oct 12 16:04:02 CST 2013.
    -->
    <result column="ID" property="id"  />
    <result column="IMAGE" property="image" />
    <result column="STATUS" property="status"  />
    <result column="OUTPUT" property="output" />
    <result column="BEGIN_TIME" property="beginTime"  />
    <result column="END_TIME" property="endTime"  />
    <result column="NAME" property="name" />
    <result column="MODIFY_DATE" property="modifyDate"  />
    <result column="MODIFIED" property="modified"  />
    <result column="P2" property="p2" />
    <result column="P3" property="p3" />
    <result column="IMAGES_FILE" property="imagesFile" />
    <result column="IMAGES_FILE2" property="imagesFile2" />
    <result column="IMAGES_FILE3" property="imagesFile3" />
    <result column="IMAGES_FILE4" property="imagesFile4" />
    <result column="PRODUCT_FILTER_TYPE" property="productFilterType" />
    <result column="PROMOTION_TYPE_ID" property="promotionTypeId" />
    <result column="SLOGAN" property="slogan" />
    <result column="SITE_ID" property="siteId"/>
    <result column="OPERATE_TYPE" property="operateType"/>
  </resultMap>
  <sql id="abatorgenerated_Example_Where_Clause" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Sat Oct 12 16:04:02 CST 2013.
    -->
    <iterate property="oredCriteria" conjunction="or" prepend="where" removeFirstPrepend="iterate" >
      <isEqual property="oredCriteria[].valid" compareValue="true" >
        (
        <iterate prepend="and" property="oredCriteria[].criteriaWithoutValue" conjunction="and" >
          $oredCriteria[].criteriaWithoutValue[]$
        </iterate>
        <iterate prepend="and" property="oredCriteria[].criteriaWithSingleValue" conjunction="and" >
          $oredCriteria[].criteriaWithSingleValue[].condition$
            #oredCriteria[].criteriaWithSingleValue[].value#
        </iterate>
        <iterate prepend="and" property="oredCriteria[].criteriaWithListValue" conjunction="and" >
          $oredCriteria[].criteriaWithListValue[].condition$
          <iterate property="oredCriteria[].criteriaWithListValue[].values" open="(" close=")" conjunction="," >
            #oredCriteria[].criteriaWithListValue[].values[]#
          </iterate>
        </iterate>
        <iterate prepend="and" property="oredCriteria[].criteriaWithBetweenValue" conjunction="and" >
          $oredCriteria[].criteriaWithBetweenValue[].condition$
          #oredCriteria[].criteriaWithBetweenValue[].values[0]# and
          #oredCriteria[].criteriaWithBetweenValue[].values[1]#
        </iterate>
        )
      </isEqual>
    </iterate>
  </sql>
  <select id="abatorgenerated_selectByExample" resultMap="abatorgenerated_CmsPromotionTaskResult" parameterClass="com.pltfm.cms.vobject.CmsPromotionTaskExample" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Sat Oct 12 16:04:02 CST 2013.
    -->
    select ID, IMAGE, STATUS, OUTPUT, BEGIN_TIME, END_TIME, NAME, MODIFY_DATE, MODIFIED, P2, P3,PRODUCT_FILTER_TYPE,PROMOTION_TYPE_ID,SLOGAN,SITE_ID,OPERATE_TYPE
    from CMS_PROMOTION_TASK
    <isParameterPresent >
      <include refid="CMS_PROMOTION_TASK.abatorgenerated_Example_Where_Clause" />
      <isNotNull property="orderByClause" >
        order by $orderByClause$
      </isNotNull>
    </isParameterPresent>
  </select>
  <delete id="abatorgenerated_deleteByExample" parameterClass="com.pltfm.cms.vobject.CmsPromotionTaskExample" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Sat Oct 12 16:04:02 CST 2013.
    -->
    delete from CMS_PROMOTION_TASK
    <include refid="CMS_PROMOTION_TASK.abatorgenerated_Example_Where_Clause" />
  </delete>
  <insert id="abatorgenerated_insert" parameterClass="com.pltfm.cms.vobject.CmsPromotionTask" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Sat Oct 12 16:04:02 CST 2013.
    -->

  
     
    
    
    insert into CMS_PROMOTION_TASK (ID, IMAGE, STATUS, OUTPUT, BEGIN_TIME, END_TIME, NAME,
      MODIFY_DATE, MODIFIED, P2, P3,IMAGES_FILE,IMAGES_FILE2,IMAGES_FILE3,IMAGES_FILE4,PRODUCT_FILTER_TYPE,PROMOTION_TYPE_ID,SLOGAN,SITE_ID,OPERATE_TYPE)
    values (#id#, #image#, #status#, #output#, #beginTime#,
      #endTime#, #name#, #modifyDate#, #modified#, #p2#,#p3#,#imagesFile#,#imagesFile2#,#imagesFile3#,#imagesFile4#,#productFilterType#,#promotionTypeId#,#slogan#,#siteId#,#operateType#)
  </insert>

<select id="abatorgenerated_getSeqId" resultClass="java.lang.Integer">
       select SEQ_APP_CMS.nextval from dual
</select>
  
  <update id="abatorgenerated_updateByExampleSelective" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Sat Oct 12 16:04:02 CST 2013.
    -->
    update CMS_PROMOTION_TASK
    <dynamic prepend="set" >
      <isNotNull prepend="," property="record.id" >
        ID = #record.id#
      </isNotNull>
      <isNotNull prepend="," property="record.image" >
        IMAGE = #record.image#
      </isNotNull>
      <isNotNull prepend="," property="record.status" >
        STATUS = #record.status#
      </isNotNull>
      <isNotNull prepend="," property="record.output" >
        OUTPUT = #record.output#
      </isNotNull>
      <isNotNull prepend="," property="record.beginTime" >
        BEGIN_TIME = #record.beginTime#
      </isNotNull>
      <isNotNull prepend="," property="record.endTime" >
        END_TIME = #record.endTime#
      </isNotNull>
      <isNotNull prepend="," property="record.name" >
        NAME = #record.name#
      </isNotNull>
      <isNotNull prepend="," property="record.modifyDate" >
        MODIFY_DATE = #record.modifyDate#
      </isNotNull>
      <isNotNull prepend="," property="record.modified" >
        MODIFIED = #record.modified#
      </isNotNull>
      <isNotNull prepend="," property="record.p2" >
        P2 = #record.p2#
      </isNotNull>
      <isNotNull prepend="," property="record.p3" >
        P3 = #record.p3#
      </isNotNull>
          <isNotNull prepend="," property="record.imagesFile" >
        IMAGES_FILE = #record.imagesFile#
      </isNotNull>
          <isNotNull prepend="," property="record.imagesFile2" >
        IMAGES_FILE2 = #record.imagesFile2#
      </isNotNull>
          <isNotNull prepend="," property="record.imagesFile3" >
        IMAGES_FILE3 = #record.imagesFile3#
      </isNotNull>
          <isNotNull prepend="," property="record.imagesFile4" >
        IMAGES_FILE4 = #record.imagesFile4#
      </isNotNull>
      <isNotNull prepend="," property="productFilterType">
      	PRODUCT_FILTER_TYPE = #record.productFilterType#
      </isNotNull>
      <isNotNull prepend="," property="promotionTypeId">
      	PROMOTION_TYPE_ID = #record.promotionTypeId#
      </isNotNull>
      <isNotNull prepend="," property="slogan">
      	SLOGAN= #record.slogan#
      </isNotNull>
      <isNotNull prepend="," property="record.siteId">
      	SITE_ID=#record.siteId#
      </isNotNull>
      <isNotNull prepend="," property="record.operateType">
      	OPERATE_TYPE=#record.operateType#
      </isNotNull>
    </dynamic>
    <isParameterPresent >
      <include refid="CMS_PROMOTION_TASK.abatorgenerated_Example_Where_Clause" />
    </isParameterPresent>
  </update>
  <update id="abatorgenerated_updateByExample" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Sat Oct 12 16:04:02 CST 2013.
    -->
    update CMS_PROMOTION_TASK
    set ID = #record.id#,
      IMAGE = #record.image#,
      STATUS = #record.status#,
      OUTPUT = #record.output#,
      BEGIN_TIME = #record.beginTime#,
      END_TIME = #record.endTime#,
      NAME = #record.name#,
      MODIFY_DATE = #record.modifyDate#,
      MODIFIED = #record.modified#,
      P2 = #record.p2#,
      P3 = #record.p3#,
      PRODUCT_FILTER_TYPE =#record.productFilterType#,
      PROMOTION_TYPE_ID = #record.promotionTypeId#,
      SLOGAN= #record.slogan#,
      SITE_ID = #record.siteId#,
      OPERATE_TYPE=#record.operateType#
    <isParameterPresent >
      <include refid="CMS_PROMOTION_TASK.abatorgenerated_Example_Where_Clause" />
    </isParameterPresent>
  </update>
  
    <select id="abatorgenerated_countByExample"  parameterClass="com.pltfm.cms.vobject.CmsPromotionTask" resultClass="java.lang.Integer" >
    select count(*) from CMS_PROMOTION_TASK
     <dynamic prepend="where">
	          <isNotNull property="name">
				     <isNotEmpty prepend="and" property="name">
				     NAME like '%$name$%'
				     </isNotEmpty>
			  </isNotNull>
			   <isNotNull property="output">
				     <isNotEmpty prepend="and" property="output">
				     OUTPUT like '%$output$%'
				      </isNotEmpty>
			       </isNotNull>
			       <isNotNull property="status">
				     <isNotEmpty prepend="and" property="status">
				     STATUS = '$status$'
				      </isNotEmpty>
			       </isNotNull>
			       <isNotNull property="promotionTypeId">
			       	<isNotEmpty prepend="and" property="promotionTypeId">
			       		PROMOTION_TYPE_ID = #promotionTypeId#
			       	</isNotEmpty>
			       </isNotNull>
			       <isNotNull property="siteId">
			       	<isNotEmpty prepend="and" property="siteId">
			       		SITE_ID=#siteId#
			       	</isNotEmpty>
			       </isNotNull>
			       	
			       
			       <isNotNull property="beginTime">
				     <isNotEmpty prepend="and" property="beginTime">
				   <![CDATA[  BEGIN_TIME >= #beginTime#]]>
				      </isNotEmpty>
			       </isNotNull>
			        <isNotNull property="endTime">
				     <isNotEmpty prepend="and" property="endTime">
				   <![CDATA[  END_TIME <= #endTime#]]>
				      </isNotEmpty>
			       </isNotNull>
			       
			        <isNotNull property="ids">
				     <isNotEmpty prepend="and" property="ids">
				      $ids$
				      </isNotEmpty>
				      </isNotNull>
		</dynamic>
  </select>
  
  
   <select id="countByExample"  parameterClass="com.pltfm.cms.vobject.CmsPromotionTask" resultClass="java.lang.Integer" >
    select count(*) from (
		select page.page_id cid,page.name cname,page.output_path coutput,page.site_id from cms_page page union
		select adc.adcolumn_id,adc.name,adc.output,adc.site_id from cms_adcolumn adc union
		select pro.id,pro.name,pro.output,pro.site_id from cms_promotion_task pro 
			<dynamic prepend="where">
				<isNotEmpty property="id">
					<isNotNull prepend="and" property="id">
						ID!=#id# and OUTPUT='$output$'
					</isNotNull>
				</isNotEmpty>
			</dynamic>
		union
		select infor.infor_id,infor.name,infor.content,infor.site_id from cms_information infor )t
		 <dynamic prepend="where">
	          <isNotNull property="name">
				     <isNotEmpty prepend="and" property="name">
				    	 t.cname = '$name$'
				     </isNotEmpty>
			  </isNotNull>
			  <isNotNull property="output">
				     <isNotEmpty prepend="and" property="output">
				     	t.coutput ='$output$'
				     </isNotEmpty>
			  </isNotNull>
			  <isNotNull property="siteId">
			  		<isNotEmpty prepend="and" property="siteId">
			  			t.site_id = #siteId#
			  		</isNotEmpty>
			  </isNotNull>
		</dynamic>
  </select>
  
  
     <!-- 分页查询活动数据列表信息 -->
     
    <select id="abatorgenerated_pageBy"  resultMap="abatorgenerated_CmsPromotionTaskResult"  parameterClass="com.pltfm.cms.vobject.CmsPromotionTask">
    select ID, IMAGE, STATUS, OUTPUT, BEGIN_TIME, END_TIME, NAME, MODIFY_DATE, MODIFIED, P2, P3 ,IMAGES_FILE,IMAGES_FILE2,IMAGES_FILE3,IMAGES_FILE4,PRODUCT_FILTER_TYPE,PROMOTION_TYPE_ID,SLOGAN,SITE_ID,OPERATE_TYPE
    from  (
                       select  ROW_NUMBER() OVER(order by ID desc) as view_row_number, t.* FROM  CMS_PROMOTION_TASK t
				     <dynamic prepend="where">
					<isNotNull property="name">
				     <isNotEmpty prepend="and" property="name">
				     NAME like '%$name$%'
				      </isNotEmpty>
			       </isNotNull>
			       <isNotNull property="output">
				     <isNotEmpty prepend="and" property="output">
				     OUTPUT like '%$output$%'
				      </isNotEmpty>
			       </isNotNull>
			       <isNotNull property="status">
				     <isNotEmpty prepend="and" property="status">
				     STATUS = '$status$'
				      </isNotEmpty>
			       </isNotNull>
			       <isNotNull property="promotionTypeId">
			       	<isNotEmpty prepend="and" property="promotionTypeId">
			       		PROMOTION_TYPE_ID = #promotionTypeId#
			       	</isNotEmpty>
			       </isNotNull>
			       <isNotNull property="siteId">
			       	<isNotEmpty prepend="and" property="siteId">
			       		SITE_ID=#siteId#
			       	</isNotEmpty>
			       </isNotNull>
			       
			       <isNotNull property="beginTime">
				     <isNotEmpty prepend="and" property="beginTime">
				   <![CDATA[  BEGIN_TIME >= #beginTime#]]>
				      </isNotEmpty>
			       </isNotNull>
			        <isNotNull property="endTime">
				     <isNotEmpty prepend="and" property="endTime">
				   <![CDATA[  END_TIME <= #endTime#]]>
				      </isNotEmpty>
			       </isNotNull>
			       
			        <isNotNull property="ids">
				     <isNotEmpty prepend="and" property="ids">
				   $ids$
				      </isNotEmpty>
				      </isNotNull>
					</dynamic>
              ) 
         <![CDATA[ where view_row_number <= #endIndex# and view_row_number > #startIndex# ]]>
    </select>
    
    <!-- 过期活动列表 -->
     <select id="abatorgenerated_expirePromotion"  resultMap="abatorgenerated_CmsPromotionTaskResult" >
    select ID, IMAGE, STATUS, OUTPUT, BEGIN_TIME, END_TIME, NAME, MODIFY_DATE, MODIFIED, P2, P3 ,IMAGES_FILE,IMAGES_FILE2,
    
    IMAGES_FILE3,IMAGES_FILE4,PRODUCT_FILTER_TYPE,PROMOTION_TYPE_ID,SLOGAN,SITE_ID,OPERATE_TYPE
    
    from  CMS_PROMOTION_TASK 

     where 
     

    <![CDATA[ to_char(end_time,'yyyy-mm-dd HH24:mm:ss')<to_char(sysdate,'yyyy-mm-dd HH24:mm:ss') ]]> and  5 > rownum
    
    </select>
    
   <select id="abatorgenerated_selectByPrimaryKey" resultMap="abatorgenerated_CmsPromotionTaskResult" parameterClass="com.pltfm.cms.vobject.CmsPromotionTask" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Tue Sep 03 16:15:27 CST 2013.
    -->
   select ID, IMAGE, STATUS, OUTPUT, BEGIN_TIME, END_TIME, NAME, MODIFY_DATE, MODIFIED, P2, P3,IMAGES_FILE,IMAGES_FILE2,IMAGES_FILE3,IMAGES_FILE4,PRODUCT_FILTER_TYPE,PROMOTION_TYPE_ID,SLOGAN,SITE_ID,OPERATE_TYPE
   from CMS_PROMOTION_TASK 
               <dynamic prepend="where">
               <isNotNull property="id">
			  		<isNotEmpty prepend="and" property="id">
			  			ID = #id#
			  		</isNotEmpty>
			  </isNotNull>
			  <isNotNull property="siteId">
			  		<isNotEmpty prepend="and" property="siteId">
			  			site_id = #siteId#
			  		</isNotEmpty>
			  </isNotNull>
			  <isNotNull property="operateType">
			  		<isNotEmpty prepend="and" property="operateType">
			  			OPERATE_TYPE = #operateType#
			  		</isNotEmpty>
			  </isNotNull>
			  
			  </dynamic>
	
  </select>
   <delete id="abatorgenerated_deleteByPrimaryKey" parameterClass="com.pltfm.cms.vobject.CmsPromotionTask" >
    delete from CMS_PROMOTION_TASK
    where ID = #id#
    <dynamic>
    	<isNotEmpty property="siteId">
    		<isNotNull prepend="and" property="siteId">
    			site_id = #siteId#
    		</isNotNull>
    	</isNotEmpty>
    </dynamic>
  </delete>
  
  <update id="abatorgenerated_updateByPrimaryKeySelective" parameterClass="com.pltfm.cms.vobject.CmsPromotionTask" >
      update CMS_PROMOTION_TASK
     <dynamic prepend="set" >
      <isNotNull prepend="," property="image" >
      IMAGE = #image#
      </isNotNull>
        <isNotNull prepend="," property="status" >
      STATUS = #status#
      </isNotNull>
        <isNotNull prepend="," property="output" >
      OUTPUT = #output#
      </isNotNull>
        <isNotNull prepend="," property="beginTime" >
      BEGIN_TIME = #beginTime#
      </isNotNull>
        <isNotNull prepend="," property="endTime" >
      END_TIME = #endTime#
      </isNotNull>
        <isNotNull prepend="," property="name" >
      NAME = #name#
      </isNotNull>
        <isNotNull prepend="," property="modifyDate" >
      MODIFY_DATE = #modifyDate#
      </isNotNull>
        <isNotNull prepend="," property="modified" >
      MODIFIED = #modified#
      </isNotNull>
        <isNotNull prepend="," property="p2" >
      P2 = #p2#
      </isNotNull>
        <isNotNull prepend="," property="p3" >
      P3 = #p3#
      </isNotNull>
       <isNotNull prepend="," property="imagesFile" >
        IMAGES_FILE = #imagesFile#
      </isNotNull>
           <isNotNull prepend="," property="imagesFile2" >
        IMAGES_FILE2 = #imagesFile2#
      </isNotNull>
            <isNotNull prepend="," property="imagesFile3" >
        IMAGES_FILE3 = #imagesFile3#
      </isNotNull>
            <isNotNull prepend="," property="imagesFile4" >
        IMAGES_FILE4 = #imagesFile4#
      </isNotNull>
      <isNotNull prepend="," property="productFilterType">
      	PRODUCT_FILTER_TYPE= #productFilterType#
      </isNotNull>
      <isNotNull prepend="," property="promotionTypeId" >
        PROMOTION_TYPE_ID = #promotionTypeId#
      </isNotNull>
      <isNotNull prepend="," property="slogan">
      	SLOGAN= #slogan#
      </isNotNull>
      <isNotNull prepend="," property="siteId">
      	SITE_ID=#siteId#
      </isNotNull>
      <isNotNull prepend="," property="operateType">
      	OPERATE_TYPE=#operateType#
      </isNotNull>
  </dynamic>
      where ID = #id#
      <isNotEmpty property="siteId">
      	<isNotNull prepend="and" property="siteId">
      		SITE_ID=#siteId#
      	</isNotNull>
      </isNotEmpty>
  </update>
  
    
  <select id="abatorgenerated_publishData"  resultMap="abatorgenerated_CmsPromotionTaskResult"  >
   select  * from(
  select * from cms_promotion_task where status=0  
  and 
 <![CDATA[  to_char(begin_time, 'yyyy-MM-dd HH24:mm:ss')<=to_char(sysdate, 'yyyy-MM-dd HH24:mm:ss') ]]>
  order by  begin_time  
) where rownum=1
   </select>
   
  <select id="abatorgenerated_closeData"  resultMap="abatorgenerated_CmsPromotionTaskResult"  >  
     select  * from(
  select * from cms_promotion_task where status=1  
  and 
   <![CDATA[ to_char(END_TIME, 'yyyy-MM-dd HH24:mm:ss')<=to_char(sysdate, 'yyyy-MM-dd HH24:mm:ss') ]]>
  order by  begin_time  
) where rownum=1
   
      </select>
  <select id="abatorgenerated_getAllPromotionTask" resultMap="abatorgenerated_CmsPromotionTaskResult" parameterClass="com.pltfm.cms.vobject.CmsPromotionTask">
  	select * from cms_promotion_task
  	<dynamic prepend="where">
  		<isNotNull property="siteId">
  			<isNotEmpty prepend="and" property="siteId">
  				SITE_ID = #siteId#
  			</isNotEmpty>
  		</isNotNull>
  	</dynamic>
  </select>
  
</sqlMap>