<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="CrowdSourcingUser">
	<resultMap id="ibatorgenerated_BaseResultMap" class="com.km.crowdsourcing.model.InstitutionUser">
		<!-- WARNING - This element is automatically generated by Apache iBATIS 
			ibator, do not modify. This element was generated on Mon Mar 14 14:51:25 
			CST 2016. -->
		<result column="ID" property="id" jdbcType="DECIMAL" />
		<result column="loginId" property="loginId" jdbcType="DECIMAL" />
		<result column="INSTITUTION_CODE" property="institutionCode"
			jdbcType="VARCHAR" />
		<result column="STATUS" property="status" jdbcType="DECIMAL" />
		<result column="CLEARING_STATUS" property="clearingStatus"
			jdbcType="DECIMAL" />
		<result column="CLEARING_AMOUNT" property="clearingAmount"
			jdbcType="DECIMAL" />
		<result column="CREATE_TIME" property="createTime" />
		<result column="LAST_MODIFY_DATE" property="lastModifyDate" />
		<result column="CLEARING_DATE" property="clearingDate" />
	</resultMap>
	<resultMap id="ibatorgenerated_BaseResultMap_Page" class="com.km.crowdsourcing.model.InstitutionUser"
		extends="ibatorgenerated_BaseResultMap">
		<result column="userName" property="userName" jdbcType="VARCHAR" />
		<result column="institutionPhoneNum" property="institutionPhoneNum"
			jdbcType="VARCHAR" />
		<result column="userPhoneNum" property="userPhoneNum" jdbcType="VARCHAR" />
		<result column="INSTITUTION_NAME" property="institutionName"
			jdbcType="VARCHAR" />
	</resultMap>
	<resultMap id="ibatorgenerated_BaseResultClearingMap" class="com.km.crowdsourcing.model.ClearingUser">
		<!-- WARNING - This element is automatically generated by Apache iBATIS 
			ibator, do not modify. This element was generated on Mon Mar 14 14:51:25 
			CST 2016. -->
		<result column="ID" property="Id" jdbcType="DECIMAL" />
		<result column="INSTITUTION_CODE" property="institutionCode"
			jdbcType="VARCHAR" />
		<result column="STATUS" property="status" jdbcType="DECIMAL" />
		<result column="CLEARING_STATUS" property="clearingStatus"
			jdbcType="DECIMAL" />
		<result column="CLEARING_AMOUNT" property="clearingAmount"
			jdbcType="DECIMAL" />
		<result column="AMOUNT_AVLIBAL" property="amountAvlibal"
			jdbcType="DECIMAL" />
		<result column="N_ACCOUNT_AMOUNT" property="accountAmount"
			jdbcType="DECIMAL" />
		<result column="N_LOGIN_ID" property="loginId" jdbcType="DECIMAL" />
		<result column="clearLoginId" property="clearLoginId" jdbcType="DECIMAL" />
		<result column="N_ACCOUNT_ID" property="accountId" jdbcType="DECIMAL" />

	</resultMap>
	<sql id="ibatorgenerated_Example_Where_Clause">
		<!-- WARNING - This element is automatically generated by Apache iBATIS 
			ibator, do not modify. This element was generated on Mon Mar 14 14:51:25 
			CST 2016. -->
		<iterate property="oredCriteria" conjunction="or" prepend="where"
			removeFirstPrepend="iterate">
			<isEqual property="oredCriteria[].valid" compareValue="true">
				(
				<iterate prepend="and" property="oredCriteria[].criteriaWithoutValue"
					conjunction="and">
					$oredCriteria[].criteriaWithoutValue[]$
				</iterate>
				<iterate prepend="and" property="oredCriteria[].criteriaWithSingleValue"
					conjunction="and">
					$oredCriteria[].criteriaWithSingleValue[].condition$
					#oredCriteria[].criteriaWithSingleValue[].value#
				</iterate>
				<iterate prepend="and" property="oredCriteria[].criteriaWithListValue"
					conjunction="and">
					$oredCriteria[].criteriaWithListValue[].condition$
					<iterate property="oredCriteria[].criteriaWithListValue[].values"
						open="(" close=")" conjunction=",">
						#oredCriteria[].criteriaWithListValue[].values[]#
					</iterate>
				</iterate>
				<iterate prepend="and" property="oredCriteria[].criteriaWithBetweenValue"
					conjunction="and">
					$oredCriteria[].criteriaWithBetweenValue[].condition$
					#oredCriteria[].criteriaWithBetweenValue[].values[0]# and
					#oredCriteria[].criteriaWithBetweenValue[].values[1]#
				</iterate>
				)
			</isEqual>
		</iterate>
	</sql>
	<select id="ibatorgenerated_selectByPrimaryKey" resultMap="ibatorgenerated_BaseResultMap"
		parameterClass="com.km.crowdsourcing.model.InstitutionUser">
		select ID, loginId, INSTITUTION_CODE, STATUS,
		CLEARING_STATUS,
		CLEARING_AMOUNT, CREATE_TIME,
		LAST_MODIFY_DATE,
		CLEARING_DATE
		from CROWD_INSTITUTION_USER
		where ID = #id:DECIMAL#
	</select>
	<select id="ibatorgenerated_selectClearingUser" resultMap="ibatorgenerated_BaseResultClearingMap"
		parameterClass="java.util.List">
		SELECT SU.ID,
		SU.INSTITUTION_CODE,
		SU.STATUS,
		SU.LOGINID CLEARLOGINID,
		SU.CLEARING_STATUS,
		SU.CLEARING_AMOUNT,
		AI.AMOUNT_AVLIBAL,
		AI.N_ACCOUNT_AMOUNT,
		AI.N_LOGIN_ID,
		AI.N_ACCOUNT_ID
		FROM
		CROWD_INSTITUTION_USER SU
		LEFT JOIN CROWD_INSTITUTION_INFO CII
		ON
		CII.INSTITUTION_CODE = SU.INSTITUTION_CODE
		LEFT JOIN ACCOUNT_INFO AI
		ON
		AI.N_LOGIN_ID = CII.LOGINID
		LEFT JOIN LOGIN_INFO li
		ON li.n_login_id =
		SU.Loginid
		LEFT JOIN LOGIN_INFO li1
		ON li1.n_login_id = CII.LOGINID
		WHERE SU.STATUS = 1
		AND li1.n_Status = 1
		AND li.n_Status = 1
		AND
		SU.CLEARING_STATUS = 0
		AND CII.STATUS = 1
		<iterate open="AND SU.ID in (" close=")" conjunction=",">
			#stuIds[]#
		</iterate>
	</select>
	<select id="selectIdsByIds" resultMap="ibatorgenerated_BaseResultClearingMap"
		parameterClass="java.util.List">
		SELECT SU.ID,
		SU.INSTITUTION_CODE,
		SU.STATUS,
		SU.LOGINID CLEARLOGINID,
		SU.CLEARING_STATUS,
		SU.CLEARING_AMOUNT,
		AI.AMOUNT_AVLIBAL,
		AI.N_ACCOUNT_AMOUNT,
		AI.N_LOGIN_ID,
		AI.N_ACCOUNT_ID
		FROM
		CROWD_INSTITUTION_USER SU
		LEFT JOIN CROWD_INSTITUTION_INFO CII
		ON
		CII.INSTITUTION_CODE = SU.INSTITUTION_CODE
		LEFT JOIN ACCOUNT_INFO AI
		ON
		AI.N_LOGIN_ID = CII.LOGINID
		LEFT JOIN LOGIN_INFO li
		ON li.n_login_id =
		SU.Loginid
		LEFT JOIN LOGIN_INFO li1
		ON li1.n_login_id = CII.LOGINID
		WHERE SU.STATUS = 1
		AND li1.n_Status = 1
		AND li.n_Status = 1
		AND
		CII.STATUS = 1

		<iterate open="AND SU.ID in (" close=")" conjunction=",">
			#stuIds[]#
		</iterate>
	</select>
	<select id="selectIdsByClearingUser" resultClass="java.lang.String"
		parameterClass="java.util.List">
    	<![CDATA[
	     SELECT SU.ID
	       FROM CROWD_INSTITUTION_USER SU
	       LEFT JOIN CROWD_INSTITUTION_INFO CII
	         ON CII.INSTITUTION_CODE = SU.INSTITUTION_CODE
	       LEFT JOIN ACCOUNT_INFO AI
	         ON AI.N_LOGIN_ID = CII.LOGINID
	      WHERE SU.STATUS = 1
	        AND SU.CLEARING_STATUS = 0
	        AND CII.STATUS = 1
	        AND ROWNUM < 100 ]]>
		<iterate open="AND SU.ID in (" close=")" conjunction=",">
			#stuIds[]#
		</iterate>
	</select>
	<select id="checkUserExists" resultClass="java.lang.Integer"
		parameterClass="java.lang.String">
		select count(1)
		from account_info ai
		where ai.mobile = #mobile:VARCHAR#
		or ai.ACCOUNT_LOGIN = 'm_'||#mobile:VARCHAR#
	</select>

	<delete id="ibatorgenerated_deleteByPrimaryKey" parameterClass="com.km.crowdsourcing.model.InstitutionUser">
		<!-- WARNING - This element is automatically generated by Apache iBATIS 
			ibator, do not modify. This element was generated on Mon Mar 14 14:51:25 
			CST 2016. -->
		delete from CROWD_INSTITUTION_USER
		where ID = #id:DECIMAL#
	</delete>
	<insert id="ibatorgenerated_insert" parameterClass="com.km.crowdsourcing.model.InstitutionUser">
		<selectKey resultClass="java.lang.Integer" keyProperty="id">
			select SEQ_CR_USER.nextval from dual
		</selectKey>
		insert into CROWD_INSTITUTION_USER (ID, loginId, INSTITUTION_CODE,
		STATUS, CLEARING_STATUS,
		CLEARING_AMOUNT, CREATE_TIME,
		LAST_MODIFY_DATE, CLEARING_DATE)
		values (#id:DECIMAL#,
		#loginId:DECIMAL#, #institutionCode:VARCHAR#,
		#status:DECIMAL#,
		#clearingStatus:DECIMAL#, #clearingAmount:DECIMAL#, #createTime:DATE#,
		#lastModifyDate:DATE#,
		#clearingDate:DATE#)
	</insert>
	<insert id="ibatorgenerated_insertSelective" parameterClass="com.km.crowdsourcing.model.InstitutionUser">
		<selectKey resultClass="java.lang.Integer" keyProperty="id">
			select SEQ_CR_USER.nextval from dual
		</selectKey>
		insert into CROWD_INSTITUTION_USER
		<dynamic prepend="(">
			<isNotNull prepend="," property="id">
				ID
			</isNotNull>
			<isNotNull prepend="," property="loginId">
				loginId
			</isNotNull>
			<isNotNull prepend="," property="institutionCode">
				INSTITUTION_CODE
			</isNotNull>
			<isNotNull prepend="," property="status">
				STATUS
			</isNotNull>
			<isNotNull prepend="," property="clearingStatus">
				CLEARING_STATUS
			</isNotNull>
			<isNotNull prepend="," property="clearingAmount">
				CLEARING_AMOUNT
			</isNotNull>
			<isNotNull prepend="," property="createTime">
				CREATE_TIME
			</isNotNull>
			<isNotNull prepend="," property="lastModifyDate">
				LAST_MODIFY_DATE
			</isNotNull>
			<isNotNull prepend="," property="clearingDate">
				CLEARING_DATE
			</isNotNull>
			)
		</dynamic>
		values
		<dynamic prepend="(">
			<isNotNull prepend="," property="id">
				#id:DECIMAL#
			</isNotNull>
			<isNotNull prepend="," property="loginId">
				#loginId:DECIMAL#
			</isNotNull>
			<isNotNull prepend="," property="institutionCode">
				#institutionCode:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="status">
				#status:DECIMAL#
			</isNotNull>
			<isNotNull prepend="," property="clearingStatus">
				#clearingStatus:DECIMAL#
			</isNotNull>
			<isNotNull prepend="," property="clearingAmount">
				#clearingAmount:DECIMAL#
			</isNotNull>
			<isNotNull prepend="," property="createTime">
				#createTime#
			</isNotNull>
			<isNotNull prepend="," property="lastModifyDate">
				#lastModifyDate#
			</isNotNull>
			<isNotNull prepend="," property="clearingDate">
				#clearingDate#
			</isNotNull>
			)
		</dynamic>
	</insert>
	<update id="ibatorgenerated_updateByPrimaryKeySelective"
		parameterClass="com.km.crowdsourcing.model.InstitutionUser">
		<!-- WARNING - This element is automatically generated by Apache iBATIS 
			ibator, do not modify. This element was generated on Mon Mar 14 14:51:25 
			CST 2016. -->
		update CROWD_INSTITUTION_USER
		<dynamic prepend="set">
			<isNotNull prepend="," property="loginId">
				loginId = #loginId:DECIMAL#
			</isNotNull>
			<isNotNull prepend="," property="institutionCode">
				INSTITUTION_CODE =
				#institutionCode:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="status">
				STATUS = #status:DECIMAL#
			</isNotNull>
			<isNotNull prepend="," property="clearingStatus">
				CLEARING_STATUS =
				#clearingStatus:DECIMAL#
			</isNotNull>
			<isNotNull prepend="," property="clearingAmount">
				CLEARING_AMOUNT =
				#clearingAmount:DECIMAL#
			</isNotNull>
			<isNotNull prepend="," property="createTime">
				CREATE_TIME =
				#createTime#
			</isNotNull>
			<isNotNull prepend="," property="lastModifyDate">
				LAST_MODIFY_DATE =
				#lastModifyDate#
			</isNotNull>
			<isNotNull prepend="," property="clearingDate">
				CLEARING_DATE =
				#clearingDate#
			</isNotNull>
		</dynamic>
		where ID = #id:DECIMAL#
	</update>
	<update id="ibatorgenerated_updateByPrimaryKey" parameterClass="com.km.crowdsourcing.model.InstitutionUser">
		<!-- WARNING - This element is automatically generated by Apache iBATIS 
			ibator, do not modify. This element was generated on Mon Mar 14 14:51:25 
			CST 2016. -->
		update CROWD_INSTITUTION_USER
		set loginId = #loginId:DECIMAL#,
		INSTITUTION_CODE = #institutionCode:VARCHAR#,
		STATUS =
		#status:DECIMAL#,
		CLEARING_STATUS = #clearingStatus:DECIMAL#,
		CLEARING_AMOUNT = #clearingAmount:DECIMAL#,
		CREATE_TIME =
		#createTime:DATE#,
		LAST_MODIFY_DATE = #lastModifyDate:DATE#,
		CLEARING_DATE = #clearingDate:DATE#
		where ID = #id:DECIMAL#
	</update>



	<select id="selectListByVo" resultMap="ibatorgenerated_BaseResultMap_Page"
		parameterClass="com.km.commons.general.model.Page">
		select * from (
		SELECT
		ROW_NUMBER()
		OVER(order by
		ciu.ID desc) as
		view_row_number,
		ciu.ID,
		ciu.INSTITUTION_CODE,
		ciu.LOGINID,
		ciu.STATUS,
		ciu.CLEARING_STATUS,
		ciu.CLEARING_AMOUNT,
		ciu.CREATE_TIME,
		ciu.LAST_MODIFY_DATE,
		ciu.CLEARING_DATE,
		li.LOGIN_ACCOUNT as userName,
		li.mobile as userPhoneNum,
		cii.INSTITUTION_NAME,
		(select mobile from
		login_info ll where ll.n_login_id=cii.loginid) as institutionPhoneNum

		from
		CROWD_INSTITUTION_USER ciu ,
		login_info li,crowd_institution_info
		cii
		where li.n_login_id=
		ciu.loginId and cii.INSTITUTION_CODE=
		ciu.INSTITUTION_CODE



		<isNotNull property="queryCondition.loginId">
			<isNotEmpty prepend="and" property="queryCondition.loginId">
				ciu.loginId =
				#queryCondition.loginId:DECIMAL#
			</isNotEmpty>
		</isNotNull>
		<isNotNull property="queryCondition.institutionCode">
			<isNotEmpty prepend="and" property="queryCondition.institutionCode">
				ciu.INSTITUTION_CODE =
				#queryCondition.institutionCode:VARCHAR#
			</isNotEmpty>
		</isNotNull>
		<isNotNull property="queryCondition.institutionName">
			<isNotEmpty prepend="and" property="queryCondition.institutionName">
				cii.INSTITUTION_Name
				like '%$queryCondition.institutionName$%'
			</isNotEmpty>
		</isNotNull>
		<isNotNull property="queryCondition.userName">
			<isNotEmpty prepend="and" property="queryCondition.userName">
				li.LOGIN_ACCOUNT
				like
				'%$queryCondition.userName$%'
			</isNotEmpty>
		</isNotNull>
		<isNotNull property="queryCondition.userPhoneNum">
			<isNotEmpty prepend="and" property="queryCondition.userPhoneNum">
				li.mobile =
				#queryCondition.userPhoneNum:VARCHAR#
			</isNotEmpty>
		</isNotNull>
		<isNotNull property="queryCondition.startDate">
			<isNotEmpty prepend="and" property="queryCondition.startDate">
			<![CDATA[  ciu.CREATE_TIME  >=#queryCondition.startDate#]]>

			</isNotEmpty>
		</isNotNull>
		<isNotNull property="queryCondition.endDate">
			<isNotEmpty prepend="and" property="queryCondition.endDate">
			<![CDATA[  ciu.CREATE_TIME <=#queryCondition.endDate#]]>

			</isNotEmpty>
		</isNotNull>
		<isNotNull property="queryCondition.institutionPhoneNum">
			<isNotEmpty prepend="and" property="queryCondition.institutionPhoneNum">
				ciu.INSTITUTION_CODE in
				(select c.institution_code from crowd_institution_info
				c,login_info
				lif where
				c.loginId=lif.n_login_id and
				lif.mobile=#queryCondition.institutionPhoneNum:VARCHAR#)

			</isNotEmpty>
		</isNotNull>
		<isNotNull property="queryCondition.status">
			<isNotEmpty prepend="and" property="queryCondition.status">
				ciu.STATUS =
				#queryCondition.status:DECIMAL#
			</isNotEmpty>
		</isNotNull>
		<isNotNull property="queryCondition.clearingStatus">
			<isNotEmpty prepend="and" property="queryCondition.clearingStatus">
				ciu.CLEARING_STATUS =
				#queryCondition.clearingStatus:DECIMAL#
			</isNotEmpty>
		</isNotNull>
		<isNotNull property="queryCondition.clearingAmount">
			<isNotEmpty prepend="and" property="queryCondition.clearingAmount">
				ciu.CLEARING_AMOUNT =
				#queryCondition.clearingAmount:DECIMAL#
			</isNotEmpty>
		</isNotNull>
		<isNotNull property="queryCondition.createTime">
			<isNotEmpty prepend="and" property="queryCondition.createTime">
				ciu.CREATE_TIME =
				#queryCondition.createTime:DATE#
			</isNotEmpty>
		</isNotNull>
		<isNotNull property="queryCondition.lastModifyDate">
			<isNotEmpty prepend="and" property="queryCondition.lastModifyDate">
				ciu.LAST_MODIFY_DATE =
				#queryCondition.lastModifyDate:DATE#
			</isNotEmpty>
		</isNotNull>
		<isNotNull property="queryCondition.clearingDate">
			<isNotEmpty prepend="and" property="queryCondition.clearingDate">
				ciu.CLEARING_DATE =
				#queryCondition.clearingDate:DATE#
			</isNotEmpty>
		</isNotNull>
		order by ID desc
		)
    <![CDATA[ where view_row_number <= #endIndex# and view_row_number >= #startIndex#  ]]>
	</select>
	<select id="selectCountByVo" resultClass="java.lang.Integer"
		parameterClass="com.km.commons.general.model.Page">

		SELECT
		count(1)
		from
		CROWD_INSTITUTION_USER ciu ,
		login_info
		li,crowd_institution_info
		cii
		where li.n_login_id=
		ciu.loginId and
		cii.INSTITUTION_CODE=
		ciu.INSTITUTION_CODE
		<isNotNull property="queryCondition.loginId">
			<isNotEmpty prepend="and" property="queryCondition.loginId">
				ciu.loginId =
				#queryCondition.loginId:DECIMAL#
			</isNotEmpty>
		</isNotNull>
		<isNotNull property="queryCondition.institutionCode">
			<isNotEmpty prepend="and" property="queryCondition.institutionCode">
				ciu.INSTITUTION_CODE =
				#queryCondition.institutionCode:VARCHAR#
			</isNotEmpty>
		</isNotNull>
		<isNotNull property="queryCondition.institutionName">
			<isNotEmpty prepend="and" property="queryCondition.institutionName">
				cii.INSTITUTION_Name
				like '%$queryCondition.institutionName$%'
			</isNotEmpty>
		</isNotNull>
		<isNotNull property="queryCondition.userName">
			<isNotEmpty prepend="and" property="queryCondition.userName">
				li.LOGIN_ACCOUNT
				like
				'%$queryCondition.userName$%'
			</isNotEmpty>
		</isNotNull>
		<isNotNull property="queryCondition.userPhoneNum">
			<isNotEmpty prepend="and" property="queryCondition.userPhoneNum">
				li.mobile =
				#queryCondition.userPhoneNum:VARCHAR#
			</isNotEmpty>
		</isNotNull>
		<isNotNull property="queryCondition.startDate">
			<isNotEmpty prepend="and" property="queryCondition.startDate">
			<![CDATA[  ciu.CREATE_TIME  >=#queryCondition.startDate#]]>

			</isNotEmpty>
		</isNotNull>
		<isNotNull property="queryCondition.endDate">
			<isNotEmpty prepend="and" property="queryCondition.endDate">
			<![CDATA[  ciu.CREATE_TIME <=#queryCondition.endDate#]]>

			</isNotEmpty>
		</isNotNull>
		<isNotNull property="queryCondition.institutionPhoneNum">
			<isNotEmpty prepend="and" property="queryCondition.institutionPhoneNum">
				ciu.INSTITUTION_CODE in
				(select c.institution_code from crowd_institution_info
				c,login_info
				lif where
				c.loginId=lif.n_login_id and
				lif.mobile=#queryCondition.institutionPhoneNum:VARCHAR#)

			</isNotEmpty>
		</isNotNull>
		<isNotNull property="queryCondition.status">
			<isNotEmpty prepend="and" property="queryCondition.status">
				ciu.STATUS =
				#queryCondition.status:DECIMAL#
			</isNotEmpty>
		</isNotNull>
		<isNotNull property="queryCondition.clearingStatus">
			<isNotEmpty prepend="and" property="queryCondition.clearingStatus">
				ciu.CLEARING_STATUS =
				#queryCondition.clearingStatus:DECIMAL#
			</isNotEmpty>
		</isNotNull>
		<isNotNull property="queryCondition.clearingAmount">
			<isNotEmpty prepend="and" property="queryCondition.clearingAmount">
				ciu.CLEARING_AMOUNT =
				#queryCondition.clearingAmount:DECIMAL#
			</isNotEmpty>
		</isNotNull>
		<isNotNull property="queryCondition.createTime">
			<isNotEmpty prepend="and" property="queryCondition.createTime">
				ciu.CREATE_TIME =
				#queryCondition.createTime:DATE#
			</isNotEmpty>
		</isNotNull>
		<isNotNull property="queryCondition.lastModifyDate">
			<isNotEmpty prepend="and" property="queryCondition.lastModifyDate">
				ciu.LAST_MODIFY_DATE =
				#queryCondition.lastModifyDate:DATE#
			</isNotEmpty>
		</isNotNull>
		<isNotNull property="queryCondition.clearingDate">
			<isNotEmpty prepend="and" property="queryCondition.clearingDate">
				ciu.CLEARING_DATE =
				#queryCondition.clearingDate:DATE#
			</isNotEmpty>
		</isNotNull>
	</select>
	<select id="getinstitutionUserIds" resultClass="java.lang.String"
		parameterClass="com.km.commons.general.model.Page">

		SELECT
		wm_concat(ciu.id)
		from
		CROWD_INSTITUTION_USER ciu ,
		login_info
		li,crowd_institution_info
		cii
		where li.n_login_id=
		ciu.loginId and
		cii.INSTITUTION_CODE=
		ciu.INSTITUTION_CODE
		<isNotNull property="queryCondition.loginId">
			<isNotEmpty prepend="and" property="queryCondition.loginId">
				ciu.loginId =
				#queryCondition.loginId:DECIMAL#
			</isNotEmpty>
		</isNotNull>
		<isNotNull property="queryCondition.institutionCode">
			<isNotEmpty prepend="and" property="queryCondition.institutionCode">
				ciu.INSTITUTION_CODE =
				#queryCondition.institutionCode:VARCHAR#
			</isNotEmpty>
		</isNotNull>
		<isNotNull property="queryCondition.institutionName">
			<isNotEmpty prepend="and" property="queryCondition.institutionName">
				cii.INSTITUTION_Name
				like '%$queryCondition.institutionName$%'
			</isNotEmpty>
		</isNotNull>
		<isNotNull property="queryCondition.userName">
			<isNotEmpty prepend="and" property="queryCondition.userName">
				li.LOGIN_ACCOUNT
				like
				'%$queryCondition.userName$%'
			</isNotEmpty>
		</isNotNull>
		<isNotNull property="queryCondition.userPhoneNum">
			<isNotEmpty prepend="and" property="queryCondition.userPhoneNum">
				li.mobile =
				#queryCondition.userPhoneNum:VARCHAR#
			</isNotEmpty>
		</isNotNull>
		<isNotNull property="queryCondition.startDate">
			<isNotEmpty prepend="and" property="queryCondition.startDate">
			<![CDATA[  ciu.CREATE_DATE  >=#startDate:DATE#]]>

			</isNotEmpty>
		</isNotNull>
		<isNotNull property="queryCondition.endDate">
			<isNotEmpty prepend="and" property="queryCondition.endDate">
			<![CDATA[  ciu.CREATE_DATE <=#endDate:DATE#]]>
			</isNotEmpty>
		</isNotNull>
		<isNotNull property="queryCondition.institutionPhoneNum">
			<isNotEmpty prepend="and" property="queryCondition.institutionPhoneNum">
				ciu.INSTITUTION_COD in
				(select c.institution_code from crowd_institution_info
				c,login_info
				lif where
				c.loginId=lif.n_login_id and
				lif.mobile=#queryCondition.institutionPhoneNum:VARCHAR#)

			</isNotEmpty>
		</isNotNull>
		<isNotNull property="queryCondition.status">
			<isNotEmpty prepend="and" property="queryCondition.status">
				ciu.STATUS =
				#queryCondition.status:DECIMAL#
			</isNotEmpty>
		</isNotNull>
		<isNotNull property="queryCondition.clearingStatus">
			<isNotEmpty prepend="and" property="queryCondition.clearingStatus">
				ciu.CLEARING_STATUS =
				#queryCondition.clearingStatus:DECIMAL#
			</isNotEmpty>
		</isNotNull>
		<isNotNull property="queryCondition.clearingAmount">
			<isNotEmpty prepend="and" property="queryCondition.clearingAmount">
				ciu.CLEARING_AMOUNT =
				#queryCondition.clearingAmount:DECIMAL#
			</isNotEmpty>
		</isNotNull>
		<isNotNull property="queryCondition.createTime">
			<isNotEmpty prepend="and" property="queryCondition.createTime">
				ciu.CREATE_TIME =
				#queryCondition.createTime:DATE#
			</isNotEmpty>
		</isNotNull>
		<isNotNull property="queryCondition.lastModifyDate">
			<isNotEmpty prepend="and" property="queryCondition.lastModifyDate">
				ciu.LAST_MODIFY_DATE =
				#queryCondition.lastModifyDate:DATE#
			</isNotEmpty>
		</isNotNull>
		<isNotNull property="queryCondition.clearingDate">
			<isNotEmpty prepend="and" property="queryCondition.clearingDate">
				ciu.CLEARING_DATE =
				#queryCondition.clearingDate:DATE#
			</isNotEmpty>
		</isNotNull>
	</select>
	<select id="selectIdsByUser" resultClass="java.lang.String"
		parameterClass="com.km.commons.general.model.Page">
		select id from (
		SELECT
		ROW_NUMBER()
		OVER(order by
		cii.ID desc) as
		view_row_number,
		ciu.ID

		from
		CROWD_INSTITUTION_USER ciu ,
		login_info
		li,crowd_institution_info
		cii
		where li.n_login_id=
		ciu.loginId and
		cii.INSTITUTION_CODE=
		ciu.INSTITUTION_CODE and ciu.STATUS = 1
		AND
		ciu.CLEARING_STATUS = 0
		AND cii.STATUS = 1



		<isNotNull property="queryCondition.loginId">
			<isNotEmpty prepend="and" property="queryCondition.loginId">
				ciu.loginId =
				#queryCondition.loginId:DECIMAL#
			</isNotEmpty>
		</isNotNull>
		<isNotNull property="queryCondition.institutionCode">
			<isNotEmpty prepend="and" property="queryCondition.institutionCode">
				ciu.INSTITUTION_CODE =
				#queryCondition.institutionCode:VARCHAR#
			</isNotEmpty>
		</isNotNull>
		<isNotNull property="queryCondition.institutionName">
			<isNotEmpty prepend="and" property="queryCondition.institutionName">
				cii.INSTITUTION_Name
				like '%$queryCondition.institutionName$%'

			</isNotEmpty>
		</isNotNull>
		<isNotNull property="queryCondition.userName">
			<isNotEmpty prepend="and" property="queryCondition.userName">
				li.LOGIN_ACCOUNT
				like
				'%$queryCondition.userName$%'
			</isNotEmpty>
		</isNotNull>
		<isNotNull property="queryCondition.userPhoneNum">
			<isNotEmpty prepend="and" property="queryCondition.userPhoneNum">
				li.mobile =
				#queryCondition.userPhoneNum:VARCHAR#
			</isNotEmpty>
		</isNotNull>
		<isNotNull property="queryCondition.startDate">
			<isNotEmpty prepend="and" property="queryCondition.startDate">
			<![CDATA[  ciu.CREATE_TIME  >=#queryCondition.startDate#]]>

			</isNotEmpty>
		</isNotNull>
		<isNotNull property="queryCondition.endDate">
			<isNotEmpty prepend="and" property="queryCondition.endDate">
			<![CDATA[  ciu.CREATE_TIME <=#queryCondition.endDate#]]>

			</isNotEmpty>
		</isNotNull>
		<isNotNull property="queryCondition.institutionPhoneNum">
			<isNotEmpty prepend="and" property="queryCondition.institutionPhoneNum">
				ciu.INSTITUTION_COD in
				(select c.institution_code from crowd_institution_info
				c,login_info
				lif where
				c.loginId=lif.n_login_id and
				lif.mobile=#queryCondition.institutionPhoneNum:VARCHAR#)

			</isNotEmpty>
		</isNotNull>
		<isNotNull property="queryCondition.status">
			<isNotEmpty prepend="and" property="queryCondition.status">
				ciu.STATUS =
				#queryCondition.status:DECIMAL#
			</isNotEmpty>
		</isNotNull>
		<isNotNull property="queryCondition.clearingStatus">
			<isNotEmpty prepend="and" property="queryCondition.clearingStatus">
				ciu.CLEARING_STATUS =
				#queryCondition.clearingStatus:DECIMAL#
			</isNotEmpty>
		</isNotNull>
		<isNotNull property="queryCondition.clearingAmount">
			<isNotEmpty prepend="and" property="queryCondition.clearingAmount">
				ciu.CLEARING_AMOUNT =
				#queryCondition.clearingAmount:DECIMAL#
			</isNotEmpty>
		</isNotNull>
		<isNotNull property="queryCondition.createTime">
			<isNotEmpty prepend="and" property="queryCondition.createTime">
				ciu.CREATE_TIME =
				#queryCondition.createTime:DATE#
			</isNotEmpty>
		</isNotNull>
		<isNotNull property="queryCondition.lastModifyDate">
			<isNotEmpty prepend="and" property="queryCondition.lastModifyDate">
				ciu.LAST_MODIFY_DATE =
				#queryCondition.lastModifyDate:DATE#
			</isNotEmpty>
		</isNotNull>
		<isNotNull property="queryCondition.clearingDate">
			<isNotEmpty prepend="and" property="queryCondition.clearingDate">
				ciu.CLEARING_DATE =
				#queryCondition.clearingDate:DATE#
			</isNotEmpty>
		</isNotNull>
		)
    <![CDATA[ where view_row_number < 100 ]]>
	</select>
	<update id="unClearByIds" parameterClass="java.lang.String">
		<!-- WARNING - This element is automatically generated by Apache iBATIS 
			ibator, do not modify. This element was generated on Mon Mar 14 14:51:25 
			CST 2016. -->
		update CROWD_INSTITUTION_USER
		set CLEARING_STATUS = 2 where id in
		($ids$) and  CLEARING_STATUS !=3

	</update>
</sqlMap>