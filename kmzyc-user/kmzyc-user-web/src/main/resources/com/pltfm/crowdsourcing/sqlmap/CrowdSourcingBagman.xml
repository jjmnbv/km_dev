<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="CrowdSourcingBagman" >
  <resultMap id="ibatorgenerated_BaseResultMap" class="com.km.crowdsourcing.model.Bagman" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Mon Mar 14 14:43:58 CST 2016.
    -->
    <result column="ID" property="id" jdbcType="DECIMAL" />
    <result column="NAME" property="name" jdbcType="VARCHAR" />
    <result column="MOBILE" property="mobile" jdbcType="VARCHAR" />
    <result column="PASSWORD" property="password" jdbcType="VARCHAR" />
    <result column="ORGANI_COUNT" property="organiCount" jdbcType="DECIMAL" />
    <result column="TYPE" property="type" jdbcType="DECIMAL" />
    <result column="CREATE_BY" property="createBy" jdbcType="VARCHAR" />
    <result column="CREATE_DATE" property="createDate"  />
    <result column="LAST_MODIFY_DATE" property="lastModifyDate" />
    <result column="LOGIN_ID" property="loginId" jdbcType="DECIMAL" />
    <result column="STATUS" property="status" jdbcType="DECIMAL" />
  </resultMap>
  
  
  <select id="ibatorgenerated_selectByPrimaryKey" resultMap="ibatorgenerated_BaseResultMap" parameterClass="com.km.crowdsourcing.model.Bagman" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Mon Mar 14 14:43:58 CST 2016.
    -->
    select ID, NAME, MOBILE, PASSWORD, NVL(ORGANI_COUNT,0) ORGANI_COUNT, TYPE, CREATE_BY, CREATE_DATE, LAST_MODIFY_DATE,
      LOGIN_ID, STATUS
    from CROWD_SOURCING_BAGMAN
    where ID = #id:DECIMAL#
  </select>
  <delete id="ibatorgenerated_deleteByPrimaryKey" parameterClass="com.km.crowdsourcing.model.Bagman" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Mon Mar 14 14:43:58 CST 2016.
    -->
    delete from CROWD_SOURCING_BAGMAN
    where ID = #id:DECIMAL#
  </delete>
  
  <insert id="ibatorgenerated_insert" parameterClass="com.km.crowdsourcing.model.Bagman" >
	   <selectKey resultClass="java.lang.Long" keyProperty="id">
	   		select SEQ_CR_BAGMAN.nextval from dual
	   </selectKey>
    insert into CROWD_SOURCING_BAGMAN (ID, NAME, MOBILE, PASSWORD, ORGANI_COUNT, TYPE, CREATE_BY,
      CREATE_DATE, LAST_MODIFY_DATE, LOGIN_ID, STATUS)
    values (#id:DECIMAL#, #name:VARCHAR#, #mobile:VARCHAR#, #password:VARCHAR#,
      #organiCount:DECIMAL#, #type:DECIMAL#, #createBy:VARCHAR#, #createDate#,
      #lastModifyDate#, #loginId:DECIMAL#, #status:DECIMAL#)
  </insert>
  <insert id="ibatorgenerated_insertSelective" parameterClass="com.km.crowdsourcing.model.Bagman" >
   <selectKey resultClass="java.lang.Integer" keyProperty="id">
	   		select SEQ_CR_BAGMAN.nextval from dual
	   </selectKey>
    insert into CROWD_SOURCING_BAGMAN
    <dynamic prepend="(" >
      <isNotNull prepend="," property="id" >
        ID
      </isNotNull>
      <isNotNull prepend="," property="name" >
        NAME
      </isNotNull>
      <isNotNull prepend="," property="mobile" >
        MOBILE
      </isNotNull>
      <isNotNull prepend="," property="password" >
        PASSWORD
      </isNotNull>
      <isNotNull prepend="," property="organiCount" >
        ORGANI_COUNT
      </isNotNull>
      <isNotNull prepend="," property="type" >
        TYPE
      </isNotNull>
      <isNotNull prepend="," property="createBy" >
        CREATE_BY
      </isNotNull>
      <isNotNull prepend="," property="createDate" >
        CREATE_DATE
      </isNotNull>
      <isNotNull prepend="," property="lastModifyDate" >
        LAST_MODIFY_DATE
      </isNotNull>
      <isNotNull prepend="," property="loginId" >
        LOGIN_ID
      </isNotNull>
      <isNotNull prepend="," property="status" >
        STATUS
      </isNotNull>
      )
    </dynamic>
    values
    <dynamic prepend="(" >
      <isNotNull prepend="," property="id" >
        #id:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="name" >
        #name:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="mobile" >
        #mobile:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="password" >
        #password:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="organiCount" >
        #organiCount:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="type" >
        #type:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="createBy" >
        #createBy:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="createDate" >
        #createDate:DATE#
      </isNotNull>
      <isNotNull prepend="," property="lastModifyDate" >
        #lastModifyDate:DATE#
      </isNotNull>
      <isNotNull prepend="," property="loginId" >
        #loginId:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="status" >
        #status:DECIMAL#
      </isNotNull>
      )
    </dynamic>
  </insert>
  
  
  
  <update id="ibatorgenerated_updateByPrimaryKeySelective" parameterClass="com.km.crowdsourcing.model.Bagman" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Mon Mar 14 14:43:58 CST 2016.
    -->
    update CROWD_SOURCING_BAGMAN
    <dynamic prepend="set" >
      <isNotNull prepend="," property="name" >
        NAME = #name:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="mobile" >
        MOBILE = #mobile:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="password" >
        PASSWORD = #password:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="organiCount" >
        ORGANI_COUNT = #organiCount:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="type" >
        TYPE = #type:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="createBy" >
        CREATE_BY = #createBy:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="createDate" >
        CREATE_DATE = #createDate:DATE#
      </isNotNull>
      <isNotNull prepend="," property="lastModifyDate" >
        LAST_MODIFY_DATE = #lastModifyDate:DATE#
      </isNotNull>
      <isNotNull prepend="," property="loginId" >
        LOGIN_ID = #loginId:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="status" >
        STATUS = #status:DECIMAL#
      </isNotNull>
    </dynamic>
    where ID = #id:DECIMAL#
  </update>
  <update id="ibatorgenerated_updateByPrimaryKey" parameterClass="com.km.crowdsourcing.model.Bagman" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Mon Mar 14 14:43:58 CST 2016.
    -->
    update CROWD_SOURCING_BAGMAN
    set NAME = #name:VARCHAR#,
      MOBILE = #mobile:VARCHAR#,
      PASSWORD = #password:VARCHAR#,
      ORGANI_COUNT = #organiCount:DECIMAL#,
      TYPE = #type:DECIMAL#,
      CREATE_BY = #createBy:VARCHAR#,
      CREATE_DATE = #createDate:DATE#,
      LAST_MODIFY_DATE = #lastModifyDate:DATE#,
      LOGIN_ID = #loginId:DECIMAL#,
      STATUS = #status:DECIMAL#
    where ID = #id:DECIMAL#
  </update>
  
   <update id="ibatorgenerated_updateByBagManId" parameterClass="java.lang.Long" >
    update CROWD_SOURCING_BAGMAN
    set  ORGANI_COUNT = nvl(ORGANI_COUNT,0) + 1
    where ID = #id:DECIMAL#
   </update>
  
  <select id="ibatorgenerated_existsBmans" parameterClass="com.km.crowdsourcing.model.Bagman" resultClass="java.util.HashMap">
  		<!--
  			查询与条件中的用户名、手机号相同的会员的个数
  		  -->
  		 SELECT COUNT(DECODE(NAME,#name:VARCHAR#,'姓名重复')) NAMECOUNT,
		       COUNT(DECODE(MOBILE,#mobile:VARCHAR#,'手机重复')) MOBILECOUNT
		 FROM CROWD_SOURCING_BAGMAN
  </select>
  
  <!-- 查询条件 -->
  <sql id="listCondition">
  		<isNotEmpty property="name" prepend="and">
			CSB.NAME LIKE '%' || #name:VARCHAR# || '%'
		</isNotEmpty>
		<isNotEmpty property="mobile" prepend="and">
			CSB.MOBILE LIKE '%' ||  #mobile: VARCHAR# || '%'
		</isNotEmpty>
		<isNotEmpty property="type" prepend="and">
			CSB.TYPE = #type:DECIMAL#
		</isNotEmpty>
		<isNotEmpty property="status" prepend="and">
			CSB.STATUS = #status:DECIMAL#
		</isNotEmpty>
		<isNotEmpty property="createStart" prepend="and">
			CSB.CREATE_DATE &gt; #createStart#
		</isNotEmpty>
		<isNotEmpty property="createEnd" prepend="and">
			CSB.CREATE_DATE &lt; #createEnd#
		</isNotEmpty>
  </sql>
  
  <select id="listBagMans" resultClass="com.km.crowdsourcing.model.Bagman" parameterClass="com.km.crowdsourcing.model.Bagman">
  		<!-- 
  			机构业务员列表
  		 -->
  		 
  		 SELECT * FROM(
  		 SELECT    ROW_NUMBER() OVER(ORDER BY CSB.ID DESC) AS RN,
  		 		   CSB.ID id,
  		 		   CSB.NAME name,
			       CSB.MOBILE mobile,
			       NVL(CSB.ORGANI_COUNT,0) organiCount,
			       CSB.TYPE type,
			       CSB.CREATE_BY createBy,
			       CSB.CREATE_DATE createDate,
			       CSB.STATUS status
		FROM CROWD_SOURCING_BAGMAN CSB
		WHERE 1=1
		<include refid="listCondition"/>
		)
		WHERE RN BETWEEN #startIndex:DECIMAL# AND #endIndex:DECIMAL#
  </select>
  
  <select id="countBagMans" resultClass="java.lang.Integer" parameterClass="com.km.crowdsourcing.model.Bagman">
  		<!-- 
  			机构业务员数
  		 -->
  		 SELECT count(1) FROM CROWD_SOURCING_BAGMAN CSB
  		 WHERE 1=1
		<include refid="listCondition"/>
  </select>
  
  <select id="ajaxBagManInfos" resultClass="java.util.HashMap">
  		<!-- 
  			异步获取所有的业务员信息（以id:name键值对形式）
  		 -->
  		 SELECT CSB.ID id,
  		 		CSB.NAME name
  		 FROM CROWD_SOURCING_BAGMAN CSB
  		 WHERE CSB.STATUS=1
  </select>
  
   
  <select id="selectByBagman" parameterClass="com.km.crowdsourcing.model.Bagman" resultClass="com.km.crowdsourcing.model.Bagman">
  	select 	ID              id ,
	   NAME                 name,
	   MOBILE               mobile,
	   PASSWORD             password,
	   ORGANI_COUNT         organiCount,
	   TYPE                 type,
	   CREATE_DATE          createDate,
	   LOGIN_ID             loginId,
	   STATUS               status from crowd_sourcing_bagman b
	   WHERE b.NAME  = #name:VARCHAR# 
	   <isNotEmpty property="password">
		   and b.PASSWORD = #password:VARCHAR#
	   </isNotEmpty>
  </select>
</sqlMap>