<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="EMAIL_INFO" >
  <resultMap id="abatorgenerated_EmailInfoResult" class="com.pltfm.app.vobject.EmailInfo" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Tue Jul 23 16:15:39 CST 2013.
    -->
    <result column="N_EMAIL_ID" property="n_EmailId" jdbcType="DECIMAL" />
    <result column="N_ACCOUNT_ID" property="n_AccountId" jdbcType="DECIMAL" />
    
    <result column="ACCOUNT_LOGIN" property="accountLogin" jdbcType="VARCHAR" />
    
    <result column="TATTED_CODE" property="tattedCode" jdbcType="VARCHAR" />
    <result column="LAST_SEND_TATTEDCODE_TIME" property="lastSendTattedcodeTime" jdbcType="VARCHAR" />
    <result column="N_FAILURE_TIME_VALUE" property="n_FailureTimeValue" jdbcType="DECIMAL" />
    <result column="N_EAILLINK_TIME_VALUE" property="n_EaillinkTimeValue" jdbcType="DECIMAL" />
    <result column="D_CREATE_DATE" property="d_CreateDate" />
    <result column="N_CREATED" property="n_Created" jdbcType="DECIMAL" />
    <result column="D_MODIFY_DATE" property="d_ModifyDate" jdbcType="DATE" />
    <result column="N_MODIFIED" property="n_Modified" jdbcType="DECIMAL" />
    <result column="URL_ADDRESS" property="urlAddress" jdbcType="VARCHAR" />
    <result column="IS_STATUS" property="is_Status"  />
      <result column="EMAIL" property="email"  />
  </resultMap>
  
  <resultMap id="abatorgenerated_EmailInfoResultOther" class="com.pltfm.app.vobject.EmailInfo" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Tue Jul 23 16:15:39 CST 2013.
    -->
    <result column="N_EMAIL_ID" property="n_EmailId" jdbcType="DECIMAL" />
    <result column="N_ACCOUNT_ID" property="n_AccountId" jdbcType="DECIMAL" />
    <result column="TATTED_CODE" property="tattedCode" jdbcType="VARCHAR" />
    <result column="LAST_SEND_TATTEDCODE_TIME" property="lastSendTattedcodeTime" jdbcType="VARCHAR" />
    <result column="N_FAILURE_TIME_VALUE" property="n_FailureTimeValue" jdbcType="DECIMAL" />
    <result column="N_EAILLINK_TIME_VALUE" property="n_EaillinkTimeValue" jdbcType="DECIMAL" />
    <result column="D_CREATE_DATE" property="d_CreateDate"  />
    <result column="N_CREATED" property="n_Created" jdbcType="DECIMAL" />
    <result column="D_MODIFY_DATE" property="d_ModifyDate" jdbcType="DATE" />
    <result column="N_MODIFIED" property="n_Modified" jdbcType="DECIMAL" />
    <result column="URL_ADDRESS" property="urlAddress" jdbcType="VARCHAR" />
  </resultMap>
  
  <resultMap id="ibatorgenerated_CountResult" class="com.pltfm.sys.model.SysModelUtil">
    <result column="the_count" property="theCount" jdbcType="DECIMAL" />
  </resultMap>
 
  <resultMap id="couponGrantDOResultMap" class="com.pltfm.app.vobject.Coupons" >
   <result property="custmoId" column="CUSTOM_ID" />
   <result property="custName" column="LOGIN_ACCOUNT" />
   <result property="couponName" column="COUPON_NAME" />
   <result property="couponGivetypeId" column="COUPON_GIVETYPE_ID" />
   <result property="couponMoney" column="COUPON_MONEY" />
   <result property="startTime" column="STARTTIME" />
   <result property="endTime" column="ENDTIME" />
   <result property="couponStatus" column="COUPON_STATUS" />
  </resultMap>
  
  
  <sql id="abatorgenerated_Example_Where_Clause" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Tue Jul 23 16:15:39 CST 2013.
    -->
    <iterate property="oredCriteria" conjunction="or" prepend="where" removeFirstPrepend="iterate" >
      <isEqual property="oredCriteria[].valid" compareValue="true" >
        (
        <iterate prepend="and" property="oredCriteria[].criteriaWithoutValue" conjunction="and" >
          $oredCriteria[].criteriaWithoutValue[]$
        </iterate>
        <iterate prepend="and" property="oredCriteria[].criteriaWithSingleValue" conjunction="and" >
          $oredCriteria[].criteriaWithSingleValue[].condition$
            #oredCriteria[].criteriaWithSingleValue[].value#
        </iterate>
        <iterate prepend="and" property="oredCriteria[].criteriaWithListValue" conjunction="and" >
          $oredCriteria[].criteriaWithListValue[].condition$
          <iterate property="oredCriteria[].criteriaWithListValue[].values" open="(" close=")" conjunction="," >
            #oredCriteria[].criteriaWithListValue[].values[]#
          </iterate>
        </iterate>
        <iterate prepend="and" property="oredCriteria[].criteriaWithBetweenValue" conjunction="and" >
          $oredCriteria[].criteriaWithBetweenValue[].condition$
          #oredCriteria[].criteriaWithBetweenValue[].values[0]# and
          #oredCriteria[].criteriaWithBetweenValue[].values[1]#
        </iterate>
        )
      </isEqual>
    </iterate>
  </sql>
  <select id="abatorgenerated_selectByPrimaryKey" resultMap="abatorgenerated_EmailInfoResult" parameterClass="com.pltfm.app.vobject.EmailInfo" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Tue Jul 23 16:15:39 CST 2013.
    -->
    select N_EMAIL_ID, N_ACCOUNT_ID, TATTED_CODE, LAST_SEND_TATTEDCODE_TIME, N_FAILURE_TIME_VALUE,
      N_EAILLINK_TIME_VALUE, D_CREATE_DATE, N_CREATED, D_MODIFY_DATE, N_MODIFIED, URL_ADDRESS
    from EMAIL_INFO
    where N_EMAIL_ID = #n_EmailId:DECIMAL#
  </select>
  <select id="abatorgenerated_selectByExample" resultMap="abatorgenerated_EmailInfoResult" parameterClass="com.pltfm.app.vobject.EmailInfoExample" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Tue Jul 23 16:15:39 CST 2013.
    -->
    select N_EMAIL_ID, N_ACCOUNT_ID, TATTED_CODE, LAST_SEND_TATTEDCODE_TIME, N_FAILURE_TIME_VALUE,
      N_EAILLINK_TIME_VALUE, D_CREATE_DATE, N_CREATED, D_MODIFY_DATE, N_MODIFIED, URL_ADDRESS
    from EMAIL_INFO
    <isParameterPresent >
      <include refid="EMAIL_INFO.abatorgenerated_Example_Where_Clause" />
      <isNotNull property="orderByClause" >
        order by $orderByClause$
      </isNotNull>
    </isParameterPresent>
  </select>
  <delete id="abatorgenerated_deleteByPrimaryKey" parameterClass="com.pltfm.app.vobject.EmailInfo" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Tue Jul 23 16:15:39 CST 2013.
    -->
    delete from EMAIL_INFO
    where N_EMAIL_ID = #n_EmailId:DECIMAL#
  </delete>
  <delete id="abatorgenerated_deleteByExample" parameterClass="com.pltfm.app.vobject.EmailInfoExample" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Tue Jul 23 16:15:39 CST 2013.
    -->
    delete from EMAIL_INFO
    <include refid="EMAIL_INFO.abatorgenerated_Example_Where_Clause" />
  </delete>
  <insert id="abatorgenerated_insert" parameterClass="com.pltfm.app.vobject.EmailInfo" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Tue Jul 23 16:15:39 CST 2013.
    -->
    
    <selectKey resultClass="java.lang.Integer" keyProperty="n_EmailId" >
           select  SEQ_APP_AUTHEN.nextval from dual
   </selectKey>
    
    insert into EMAIL_INFO (N_EMAIL_ID, N_ACCOUNT_ID, TATTED_CODE, LAST_SEND_TATTEDCODE_TIME,
      N_FAILURE_TIME_VALUE, N_EAILLINK_TIME_VALUE, D_CREATE_DATE, N_CREATED, D_MODIFY_DATE,
      N_MODIFIED, URL_ADDRESS,N_LOGIN_ID)
    values (#n_EmailId:DECIMAL#, #n_AccountId:DECIMAL#, #tattedCode:VARCHAR#,
      #lastSendTattedcodeTime:VARCHAR#, #n_FailureTimeValue:DECIMAL#, #n_EaillinkTimeValue:DECIMAL#,
      #d_CreateDate:DATE#, #n_Created:DECIMAL#, #d_ModifyDate:DATE#, #n_Modified:DECIMAL#,
      #urlAddress:VARCHAR#,#n_LoginId#)
  </insert>
  <update id="abatorgenerated_updateByPrimaryKey" parameterClass="com.pltfm.app.vobject.EmailInfo" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Tue Jul 23 16:15:39 CST 2013.
    -->
    update EMAIL_INFO
    set N_ACCOUNT_ID = #n_AccountId:DECIMAL#,
      TATTED_CODE = #tattedCode:VARCHAR#,
      LAST_SEND_TATTEDCODE_TIME = #lastSendTattedcodeTime:VARCHAR#,
      N_FAILURE_TIME_VALUE = #n_FailureTimeValue:DECIMAL#,
      N_EAILLINK_TIME_VALUE = #n_EaillinkTimeValue:DECIMAL#,
      D_CREATE_DATE = #d_CreateDate:DATE#,
      N_CREATED = #n_Created:DECIMAL#,
      D_MODIFY_DATE = #d_ModifyDate:DATE#,
      N_MODIFIED = #n_Modified:DECIMAL#,
      URL_ADDRESS = #urlAddress:VARCHAR#
    where N_EMAIL_ID = #n_EmailId:DECIMAL#
  </update>
  <update id="abatorgenerated_updateByPrimaryKeySelective" parameterClass="com.pltfm.app.vobject.EmailInfo" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Tue Jul 23 16:15:39 CST 2013.
    -->
    update EMAIL_INFO
    <dynamic prepend="set" >
      <isNotNull prepend="," property="n_AccountId" >
        N_ACCOUNT_ID = #n_AccountId:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="tattedCode" >
        TATTED_CODE = #tattedCode:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="lastSendTattedcodeTime" >
        LAST_SEND_TATTEDCODE_TIME = #lastSendTattedcodeTime:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="n_FailureTimeValue" >
        N_FAILURE_TIME_VALUE = #n_FailureTimeValue:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="n_EaillinkTimeValue" >
        N_EAILLINK_TIME_VALUE = #n_EaillinkTimeValue:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="d_CreateDate" >
        D_CREATE_DATE = #d_CreateDate:DATE#
      </isNotNull>
      <isNotNull prepend="," property="n_Created" >
        N_CREATED = #n_Created:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="d_ModifyDate" >
        D_MODIFY_DATE = #d_ModifyDate:DATE#
      </isNotNull>
      <isNotNull prepend="," property="n_Modified" >
        N_MODIFIED = #n_Modified:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="urlAddress" >
        URL_ADDRESS = #urlAddress:VARCHAR#
      </isNotNull>
       <isNotNull prepend="," property="is_Status" >
        IS_STATUS = #is_Status:DECIMAL#
      </isNotNull>
    </dynamic>
    where N_EMAIL_ID = #n_EmailId:DECIMAL#
  </update>
  <select id="abatorgenerated_countByExample" parameterClass="com.pltfm.app.vobject.EmailInfoExample" resultClass="java.lang.Integer" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Tue Jul 23 16:15:39 CST 2013.
    -->
    select count(*) from EMAIL_INFO
    <include refid="EMAIL_INFO.abatorgenerated_Example_Where_Clause" />
  </select>
  <update id="abatorgenerated_updateByExampleSelective" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Tue Jul 23 16:15:39 CST 2013.
    -->
    update EMAIL_INFO
    <dynamic prepend="set" >
      <isNotNull prepend="," property="record.n_EmailId" >
        N_EMAIL_ID = #record.n_EmailId:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="record.n_AccountId" >
        N_ACCOUNT_ID = #record.n_AccountId:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="record.tattedCode" >
        TATTED_CODE = #record.tattedCode:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.lastSendTattedcodeTime" >
        LAST_SEND_TATTEDCODE_TIME = #record.lastSendTattedcodeTime:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.n_FailureTimeValue" >
        N_FAILURE_TIME_VALUE = #record.n_FailureTimeValue:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="record.n_EaillinkTimeValue" >
        N_EAILLINK_TIME_VALUE = #record.n_EaillinkTimeValue:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="record.d_CreateDate" >
        D_CREATE_DATE = #record.d_CreateDate:DATE#
      </isNotNull>
      <isNotNull prepend="," property="record.n_Created" >
        N_CREATED = #record.n_Created:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="record.d_ModifyDate" >
        D_MODIFY_DATE = #record.d_ModifyDate:DATE#
      </isNotNull>
      <isNotNull prepend="," property="record.n_Modified" >
        N_MODIFIED = #record.n_Modified:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="record.urlAddress" >
        URL_ADDRESS = #record.urlAddress:VARCHAR#
      </isNotNull>
    </dynamic>
    <isParameterPresent >
      <include refid="EMAIL_INFO.abatorgenerated_Example_Where_Clause" />
    </isParameterPresent>
  </update>
  <update id="abatorgenerated_updateByExample" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Tue Jul 23 16:15:39 CST 2013.
    -->
    update EMAIL_INFO
    set N_EMAIL_ID = #record.n_EmailId:DECIMAL#,
      N_ACCOUNT_ID = #record.n_AccountId:DECIMAL#,
      TATTED_CODE = #record.tattedCode:VARCHAR#,
      LAST_SEND_TATTEDCODE_TIME = #record.lastSendTattedcodeTime:VARCHAR#,
      N_FAILURE_TIME_VALUE = #record.n_FailureTimeValue:DECIMAL#,
      N_EAILLINK_TIME_VALUE = #record.n_EaillinkTimeValue:DECIMAL#,
      D_CREATE_DATE = #record.d_CreateDate:DATE#,
      N_CREATED = #record.n_Created:DECIMAL#,
      D_MODIFY_DATE = #record.d_ModifyDate:DATE#,
      N_MODIFIED = #record.n_Modified:DECIMAL#,
      URL_ADDRESS = #record.urlAddress:VARCHAR#
    <isParameterPresent >
      <include refid="EMAIL_INFO.abatorgenerated_Example_Where_Clause" />
    </isParameterPresent>
  </update>
  
  <select id="selectByEmailInfo" resultMap="abatorgenerated_EmailInfoResultOther" parameterClass="com.pltfm.app.vobject.EmailInfo">
	SELECT *
	FROM  
     (SELECT ROW_NUMBER() OVER(ORDER BY last_send_tattedcode_time DESC) rk ,tt.*
      FROM EMAIL_INFO tt where tt.n_account_id = #n_AccountId:DECIMAL#
      and tt.TATTED_CODE = #tattedCode:VARCHAR#
      ) 
	WHERE  rk = 1 
	</select>
  
  <!--  ****************  search page by vo  ****************  -->
  <select id="searchPageByVo" resultMap="abatorgenerated_EmailInfoResult" parameterClass="com.pltfm.app.vobject.EmailInfo">
  select N_EMAIL_ID, N_ACCOUNT_ID, TATTED_CODE, LAST_SEND_TATTEDCODE_TIME, N_FAILURE_TIME_VALUE,
      N_EAILLINK_TIME_VALUE, D_CREATE_DATE, N_CREATED, D_MODIFY_DATE, N_MODIFIED, URL_ADDRESS,ACCOUNT_LOGIN,IS_STATUS,email
    FROM (
    select  ROW_NUMBER() OVER(order by N_EMAIL_ID desc) as view_row_number, tt.*,aa.ACCOUNT_LOGIN,l.email  from EMAIL_INFO tt,ACCOUNT_INFO aa,login_info l
    where tt.n_login_id =aa.n_login_id and aa.n_login_id=l.n_login_id
		  
		    <isNotNull property="lastSendTattedcodeTime">
			  <isNotEmpty prepend="and" property="lastSendTattedcodeTime">
				tt.LAST_SEND_TATTEDCODE_TIME like '%$lastSendTattedcodeTime$%'
			  </isNotEmpty>
		  </isNotNull> 
		  
		  <isNotNull property="urlAddress">
			  <isNotEmpty prepend="and" property="urlAddress">
				tt.URL_ADDRESS like '%$urlAddress$%'
			  </isNotEmpty>
		  </isNotNull>
		  
		  <isNotNull property="accountLogin">
			  <isNotEmpty prepend="and" property="accountLogin">
				aa.ACCOUNT_LOGIN like '%$accountLogin$%'
			  </isNotEmpty>
		  </isNotNull>
		  
		  
    )
    <![CDATA[ where view_row_number <= #max# and view_row_number > #skip# ]]>
	</select>
	
 <!-- **************** search user's roleList by vo  ****************  -->
  <select id="getEmailInfoCount" parameterClass="com.pltfm.app.vobject.EmailInfo" resultMap="ibatorgenerated_CountResult">
     select count(1) the_count from  EMAIL_INFO tt,ACCOUNT_INFO aa,login_info l
    where tt.n_login_id =aa.n_login_id and aa.n_login_id=l.n_login_id
    
	 
		  
		    <isNotNull property="lastSendTattedcodeTime">
			  <isNotEmpty prepend="and" property="lastSendTattedcodeTime">
				tt.LAST_SEND_TATTEDCODE_TIME like '%$lastSendTattedcodeTime$%'
			  </isNotEmpty>
		  </isNotNull> 
		  
		<isNotNull property="urlAddress">
			  <isNotEmpty prepend="and" property="urlAddress">
				tt.URL_ADDRESS like '%$urlAddress$%'
			  </isNotEmpty>
		  </isNotNull>
		  
		  <isNotNull property="accountLogin">
			  <isNotEmpty prepend="and" property="accountLogin">
				aa.ACCOUNT_LOGIN like '%$accountLogin$%'
			  </isNotEmpty>
		  </isNotNull>
		  
  </select>
  
  <select id="getCouponsCount" parameterClass="com.pltfm.app.vobject.Coupons" resultMap="ibatorgenerated_CountResult">
     SELECT COUNT(1) the_count
     FROM  COUPON_GRANT CG, LOGIN_INFO L,  COUPON C
    WHERE CG.CUSTOM_ID = L.N_LOGIN_ID(+)
      AND CG.COUPON_ID = C.COUPON_ID(+)
      <isNotNull property="custName">
			  <isNotEmpty prepend="and" property="custName">
				L.LOGIN_ACCOUNT like '%$custName$%'
			  </isNotEmpty>
		  </isNotNull>
  </select>
  <select id="searchPageByCoupons" resultMap="couponGrantDOResultMap" parameterClass="com.pltfm.app.vobject.Coupons">
  SELECT CUSTOM_ID,
         LOGIN_ACCOUNT,
         COUPON_NAME,
         COUPON_GIVETYPE_ID,
         COUPON_MONEY,
         STARTTIME,
         ENDTIME,
         COUPON_STATUS
    FROM (SELECT ROW_NUMBER() OVER(order by CG.COUPON_GRANT_ID desc) as view_row_number,
                 CG.CUSTOM_ID,
                 L.LOGIN_ACCOUNT,
                 C.COUPON_NAME,
                 C.COUPON_GIVETYPE_ID,
                 C.COUPON_MONEY,
                 C.STARTTIME,
                 C.ENDTIME,
                 CG.COUPON_STATUS
            FROM  COUPON_GRANT CG, LOGIN_INFO L,  COUPON C
           WHERE CG.CUSTOM_ID = L.N_LOGIN_ID(+)
             AND CG.COUPON_ID = C.COUPON_ID(+)
     <isNotNull property="custName">
	    <isNotEmpty prepend="and" property="custName">
		   L.LOGIN_ACCOUNT like '%$custName$%'
		</isNotEmpty>
    </isNotNull>
    )
     <![CDATA[ where view_row_number <= #max# and view_row_number > #skip# ]]>
  </select>
  
  
</sqlMap>