<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="ScoreInfo" >
  <resultMap id="ibatorgenerated_BaseResultMap" class="com.kmzyc.b2b.model.ScoreInfo" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Tue Oct 15 19:21:24 CST 2013.
    -->
    <result column="N_SCORE_INFO_ID" property="scoreInfoId" jdbcType="DECIMAL" />
    <result column="N_LOGIN_ID" property="loginId" jdbcType="DECIMAL" />
    <result column="SCORE_TYPE" property="scoreType" jdbcType="VARCHAR" />
    <result column="SCORE_NUMBER" property="scoreNumber" jdbcType="DECIMAL" />
    <result column="DISCRIBE" property="discribe" jdbcType="VARCHAR" />
    <result column="D_CREATE_DATE" property="createDate" jdbcType="Date" />
    <result column="N_CREATED" property="created" jdbcType="DECIMAL" />
    <result column="D_MODIFY_DATE" property="modifyDate" jdbcType="Date" />
    <result column="N_MODIFIED" property="modified" jdbcType="DECIMAL" />
    <result column="REMARK" jdbcType="VARCHAR" property="remark" />
    <result column="COUPON_VALUE" jdbcType="DECIMAL" property="couponValue" />
    <result column="CONSUME_TYPE" jdbcType="DECIMAL" property="consumeType" />
    <result column="IS_STAUTS" jdbcType="DECIMAL" property="isStauts" />
  </resultMap>
  
  <sql id="byPageCondition">
  	<isNotEmpty property="objCondition.consumeType" prepend="and">
  		<![CDATA[
  			CONSUME_TYPE = #objCondition.consumeType:DECIMAL# 
  		]]>
  	</isNotEmpty>
	<isNotEmpty property="objCondition.dateBegin" prepend="and">
		<![CDATA[
		D_CREATE_DATE >= to_date(#objCondition.dateBegin:Date#,'yyyy-MM-dd HH24:mi:ss')
		]]>
	</isNotEmpty>
	<isNotEmpty property="objCondition.dateEnd" prepend="and">
		<![CDATA[
		D_CREATE_DATE <= to_date(#objCondition.dateEnd:Date#,'yyyy-MM-dd HH24:mi:ss')
		]]>
	</isNotEmpty>
  </sql>
  <select id="searchPage" resultMap="ibatorgenerated_BaseResultMap" parameterClass="pagination" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Tue Oct 15 19:21:24 CST 2013.
    -->
    <![CDATA[
    SELECT * FROM (SELECT C.*, ROWNUM RN FROM (
    select N_SCORE_INFO_ID, N_LOGIN_ID, SCORE_TYPE, SCORE_NUMBER, DISCRIBE, D_CREATE_DATE,
      N_CREATED, D_MODIFY_DATE, N_MODIFIED, REMARK, COUPON_VALUE, CONSUME_TYPE, IS_STAUTS
    from SCORE_INFO where SCORE_NUMBER != 0 AND N_LOGIN_ID = #objCondition.loginId:DECIMAL# 
    ]]>
    <include refid="byPageCondition"/>
    order by D_CREATE_DATE desc
    <![CDATA[
		) C WHERE ROWNUM <= #endindex#)WHERE RN >= #startindex#
	]]>
  </select>
  
  <select id="searchCountPage" parameterClass="pagination" resultClass="java.lang.Integer">
	<![CDATA[
		SELECT count(1) FROM SCORE_INFO where SCORE_NUMBER != 0 AND N_LOGIN_ID = #objCondition.loginId:DECIMAL# 
	]]>
	<include refid="byPageCondition"/>
  </select>
  
  <!--<select id="findSumListByQueryList" parameterClass="com.pltfm.app.vobject.BnesAcctTransactionQuery" resultClass="java.lang.Integer">
     SELECT SUM(B.AMOUNT) the_count FROM BNES_ACCT_TRANSACTION B
      <dynamic prepend="where">
      B.TYPE=3
		   <isNotNull property="accountId">
			  <isNotEmpty  property="accountId">
				AND B.ACCOUNT_ID = #accountId#  
			  </isNotEmpty>
		  </isNotNull>
	  </dynamic>
  </select>
  
  -->
  <select id="findSumListByQueryList" parameterClass="java.lang.Integer" resultClass="java.lang.Double">
     select t.amount_consume from PERSONALITY_INFO t where 
				t.n_login_id  = #loginId#  
  </select>
  
   <select id="findLastYearSumListByQueryList" parameterClass="java.lang.Integer" resultClass="java.lang.Double">
     select t.LASTYEAR_AMOUNT from PERSONALITY_INFO t where 
				t.n_login_id  = #loginId#  
  </select>
  
  <!-- 添加积分明细信息 -->
  <insert id="abatorgenerated_insert" parameterClass="com.kmzyc.b2b.model.ScoreInfo" >
    insert into SCORE_INFO (N_SCORE_INFO_ID, N_LOGIN_ID, SCORE_TYPE, SCORE_NUMBER, DISCRIBE,
      D_CREATE_DATE, N_CREATED, D_MODIFY_DATE, N_MODIFIED,REMARK,COUPON_VALUE,CONSUME_TYPE,IS_STAUTS,N_SCORE_RULE_ID)
    values (seq_app_business.nextval, #loginId:INTEGER#, #scoreType:INTEGER#, #scoreNumber:DOUBLE#,
      #discribe:VARCHAR#, sysdate, #created:INTEGER#, sysdate,
      #modified:INTEGER#,#remark#,#couponValue#,#consumeType#,#isStauts#,#nScoreRuleId#)
  </insert>
  
</sqlMap>