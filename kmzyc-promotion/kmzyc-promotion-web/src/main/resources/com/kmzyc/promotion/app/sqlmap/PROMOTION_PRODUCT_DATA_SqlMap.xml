<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="PROMOTION_PRODUCT_DATA">
	<resultMap id="ibatorgenerated_BaseResultMap"
		class="com.kmzyc.promotion.optimization.vo.PromotionProductData">
		<!-- WARNING - This element is automatically generated by Apache iBATIS 
			ibator, do not modify. This element was generated on Wed Nov 18 14:01:26 
			CST 2015. -->
		<result column="PROMOTION_PRODUCT_DATA_ID" property="promotionProductDataId"
			jdbcType="DECIMAL" />
		<result column="PROMOTION_PRODUCT_ID" property="promotionProductId"
			jdbcType="DECIMAL" />
		<result column="PROMOTION_ID" property="promotionId" jdbcType="DECIMAL" />
		<result column="PRODUCT_SKU_ID" property="productSkuId"
			jdbcType="DECIMAL" />
		<result column="NUM" property="num" jdbcType="DECIMAL" />
		<result column="PRARENT_SKU_ID" property="prarentSkuId"
			jdbcType="DECIMAL" />
	</resultMap>
	<sql id="ibatorgenerated_Example_Where_Clause">
		<!-- WARNING - This element is automatically generated by Apache iBATIS 
			ibator, do not modify. This element was generated on Wed Nov 18 14:01:26 
			CST 2015. -->
		<iterate property="oredCriteria" conjunction="or" prepend="where"
			removeFirstPrepend="iterate">
			<isEqual property="oredCriteria[].valid" compareValue="true">
				(
				<iterate prepend="and" property="oredCriteria[].criteriaWithoutValue"
					conjunction="and">
					$oredCriteria[].criteriaWithoutValue[]$
				</iterate>
				<iterate prepend="and" property="oredCriteria[].criteriaWithSingleValue"
					conjunction="and">
					$oredCriteria[].criteriaWithSingleValue[].condition$
					#oredCriteria[].criteriaWithSingleValue[].value#
				</iterate>
				<iterate prepend="and" property="oredCriteria[].criteriaWithListValue"
					conjunction="and">
					$oredCriteria[].criteriaWithListValue[].condition$
					<iterate property="oredCriteria[].criteriaWithListValue[].values"
						open="(" close=")" conjunction=",">
						#oredCriteria[].criteriaWithListValue[].values[]#
					</iterate>
				</iterate>
				<iterate prepend="and" property="oredCriteria[].criteriaWithBetweenValue"
					conjunction="and">
					$oredCriteria[].criteriaWithBetweenValue[].condition$
					#oredCriteria[].criteriaWithBetweenValue[].values[0]# and
					#oredCriteria[].criteriaWithBetweenValue[].values[1]#
				</iterate>
				)
			</isEqual>
		</iterate>
	</sql>
	<insert id="ibatorgenerated_insertSelective" parameterClass="com.kmzyc.promotion.optimization.vo.PromotionProductData">
		<!-- WARNING - This element is automatically generated by Apache iBATIS 
			ibator, do not modify. This element was generated on Wed Nov 18 14:01:26 
			CST 2015. -->
		<selectKey resultClass="java.lang.Long" keyProperty="promotionProductDataId">
			select
			SEQ_APP_PROMOTION_PRODUCT_DATA.nextval from dual
		</selectKey>
		insert into PROMOTION_PRODUCT_DATA
		<dynamic prepend="(">
			<isNotNull prepend="," property="promotionProductDataId">
				PROMOTION_PRODUCT_DATA_ID
			</isNotNull>
			<isNotNull prepend="," property="promotionProductId">
				PROMOTION_PRODUCT_ID
			</isNotNull>
			<isNotNull prepend="," property="promotionId">
				PROMOTION_ID
			</isNotNull>
			<isNotNull prepend="," property="productSkuId">
				PRODUCT_SKU_ID
			</isNotNull>
			<isNotNull prepend="," property="num">
				NUM
			</isNotNull>
			<isNotNull prepend="," property="prarentSkuId">
				PRARENT_SKU_ID
			</isNotNull>
			<isNotNull prepend="," property="status">
				status
			</isNotNull>
			)
		</dynamic>
		values
		<dynamic prepend="(">
			<isNotNull prepend="," property="promotionProductDataId">
				#promotionProductDataId:DECIMAL#
			</isNotNull>
			<isNotNull prepend="," property="promotionProductId">
				#promotionProductId:DECIMAL#
			</isNotNull>
			<isNotNull prepend="," property="promotionId">
				#promotionId:DECIMAL#
			</isNotNull>
			<isNotNull prepend="," property="productSkuId">
				#productSkuId:DECIMAL#
			</isNotNull>
			<isNotNull prepend="," property="num">
				#num:DECIMAL#
			</isNotNull>
			<isNotNull prepend="," property="prarentSkuId">
				#prarentSkuId:DECIMAL#
			</isNotNull>
			<isNotNull prepend="," property="status">
				#status:DECIMAL#
			</isNotNull>
			)
		</dynamic>
	</insert>
	<select id="queryGantProductListByMap" parameterClass="java.util.Map"
		resultClass="com.kmzyc.promotion.optimization.vo.PromotionProductData">
		SELECT
		ppd.promotion_product_data_id promotionProductDataId,
		ppd.PRARENT_SKU_ID prarentSkuId,
		ppd.PROMOTION_PRODUCT_ID
		promotionProductId,
		ppd.PROMOTION_ID promotionId,
		ppd.PRODUCT_SKU_ID
		productSkuId,
		ppd.NUM num
		from
		PROMOTION_PRODUCT_Data ppd
		WHERE
		ppd.PROMOTION_ID =#promotionId#
		<isNotEmpty property="productSkuId">
			and ppd.PRODUCT_SKU_ID =
			#productSkuId#
		</isNotEmpty>
	</select>
	<select id="queryGantProductListByPromotionProductId"
		parameterClass="java.util.Map" resultClass="com.kmzyc.promotion.optimization.vo.PromotionProductData">
		SELECT
		ppd.promotion_product_data_id promotionProductDataId,
		ppd.PRARENT_SKU_ID prarentSkuId,
		ppd.PROMOTION_PRODUCT_ID
		promotionProductId,
		ppd.PROMOTION_ID promotionId,
		ppd.PRODUCT_SKU_ID
		productSkuId,
		ppd.NUM num,
		p.PRODUCT_TITLE productTitle
		from
		PROMOTION_PRODUCT_Data ppd,PRODUCT_SKU s,productmain p
		WHERE
		ppd.promotion_product_id =#promotionProductId# and s.PRODUCT_SKU_ID =
		ppd.PRODUCT_SKU_ID and s.product_id=p.product_id
		<isNotEmpty property="productSkuId">
			and ppd.PRODUCT_SKU_ID =
			#productSkuId#
		</isNotEmpty>
	</select>
	<update id="ibatorgenerated_updateByPrimaryKeySelective"
		parameterClass="com.kmzyc.promotion.optimization.vo.PromotionProductData">
		<!-- WARNING - This element is automatically generated by Apache iBATIS 
			ibator, do not modify. This element was generated on Wed Nov 18 14:01:26 
			CST 2015. -->
		update PROMOTION_PRODUCT_DATA
		<dynamic prepend="set">
			<isNotNull prepend="," property="promotionProductId">
				PROMOTION_PRODUCT_ID =
				#promotionProductId:DECIMAL#
			</isNotNull>
			<isNotNull prepend="," property="promotionId">
				PROMOTION_ID =
				#promotionId:DECIMAL#
			</isNotNull>
			<isNotNull prepend="," property="productSkuId">
				PRODUCT_SKU_ID =
				#productSkuId:DECIMAL#
			</isNotNull>
			<isNotNull prepend="," property="num">
				NUM = #num:DECIMAL#
			</isNotNull>
			<isNotNull prepend="," property="prarentSkuId">
				PRARENT_SKU_ID =
				#prarentSkuId:DECIMAL#
			</isNotNull>
		</dynamic>
		where PROMOTION_PRODUCT_DATA_ID = #promotionProductDataId:DECIMAL#
	</update>
	
	<update id="ibatorgenerated_updateByPPd"
		parameterClass="com.kmzyc.promotion.app.vobject.PromotionProduct">
		<!-- WARNING - This element is automatically generated by Apache iBATIS 
			ibator, do not modify. This element was generated on Wed Nov 18 14:01:26 
			CST 2015. -->
		update PROMOTION_PRODUCT_DATA
		<dynamic prepend="set">
			<isNotNull prepend="," property="promotionProductId">
				status =
				#status:DECIMAL#
			</isNotNull>
			
		</dynamic>
		where PROMOTION_PRODUCT_ID = #promotionProductId:DECIMAL#
	</update>
	<delete id="ibatorgenerated_deleteByPrimaryKey" parameterClass="com.kmzyc.promotion.optimization.vo.PromotionProductData">
		<!-- WARNING - This element is automatically generated by Apache iBATIS 
			ibator, do not modify. This element was generated on Wed Nov 18 14:01:26 
			CST 2015. -->
		delete from PROMOTION_PRODUCT_DATA
		where PROMOTION_PRODUCT_DATA_ID =
		#promotionProductDataId:DECIMAL#
	</delete>
    <delete id="ibatorgenerated_deleteByPromotionId" parameterClass="com.kmzyc.promotion.optimization.vo.PromotionProductData">
		<!-- WARNING - This element is automatically generated by Apache iBATIS 
			ibator, do not modify. This element was generated on Wed Nov 18 14:01:26 
			CST 2015. -->
		delete from PROMOTION_PRODUCT_DATA
		where PROMOTION_ID =
		#promotionId:DECIMAL#
	</delete>
	<select id="getPromotionProductDataCount" parameterClass="java.lang.Long"
		resultClass="java.lang.Integer">
		select count(p.PROMOTION_PRODUCT_DATA_ID) from (select
		max(PROMOTION_PRODUCT_DATA_ID) PROMOTION_PRODUCT_DATA_ID from
		PROMOTION_PRODUCT_DATA where PROMOTION_ID=
		#promotionId:DECIMAL# group
		by PROMOTION_PRODUCT_ID) p
	</select>
	<insert id="copyPromotionProductData" parameterClass="java.util.HashMap">
		Insert into promotion_product_data 
		            
		(promotion_product_data_id,PROMOTION_PRODUCT_ID, PROMOTION_ID,
		PRODUCT_SKU_ID,NUM,PRARENT_SKU_ID,status)

		select
		SEQ_APP_PROMOTION_PRODUCT_DATA.nextval,
		#promotionProductId:DECIMAL#, #newPromotionId:DECIMAL#,
		pp.PRODUCT_SKU_ID, pp.NUM ,pp.PRARENT_SKU_ID,pp.status
		from promotion_product_data pp  , dual d where
		pp.promotion_id = #oldPromotionId:DECIMAL# and  pp.PRARENT_SKU_ID=#productSkuId:DECIMAL# and  pp.status not in (1,3)
		

	</insert>
	<insert id="copyPromotionProductDataByPromotionId" parameterClass="java.util.HashMap">
		Insert into promotion_product_data 
		            
		(promotion_product_data_id, PROMOTION_ID,
		PRODUCT_SKU_ID,NUM,PRARENT_SKU_ID)

		select
		SEQ_APP_PROMOTION_PRODUCT_DATA.nextval,
		 #newPromotionId:DECIMAL#,
		pp.PRODUCT_SKU_ID, pp.NUM ,pp.PRARENT_SKU_ID
		from promotion_product_data pp  , dual d where
		pp.promotion_id = #oldPromotionId:DECIMAL#  
		

	</insert>
	 <delete id="ibatorgenerated_deleteByExample" parameterClass="com.kmzyc.promotion.app.vobject.PromotionProductDataExample" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Wed Nov 18 14:01:26 CST 2015.
    -->
    delete from PROMOTION_PRODUCT_DATA
    <include refid="PROMOTION_PRODUCT_DATA.ibatorgenerated_Example_Where_Clause" />
  </delete>
</sqlMap>