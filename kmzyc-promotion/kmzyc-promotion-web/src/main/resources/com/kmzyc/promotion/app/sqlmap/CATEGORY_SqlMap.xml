<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="CATEGORY" >
  <resultMap id="ibatorgenerated_BaseResultMap" class="com.kmzyc.promotion.app.vobject.Category" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Wed Jul 17 17:51:35 CST 2013.
    --> 
    <result column="CATEGORY_ID" property="categoryId" jdbcType="DECIMAL" />
    <result column="PARENT_ID" property="parentId" jdbcType="DECIMAL" />
    <result column="CATEGORY_CODE" property="categoryCode" jdbcType="DECIMAL" />
    <result column="CATEGORY_NAME" property="categoryName" jdbcType="VARCHAR" />
    <result column="STATUS" property="status" jdbcType="DECIMAL" />
    <result column="SORTNO" property="sortno" jdbcType="DECIMAL" />
    <result column="CATEGORY_DESC" property="categoryDesc" jdbcType="VARCHAR" />
    <result column="CREATE_TIME" property="createTime" jdbcType="DATE" />
    <result column="MODIF_TIME" property="modifTime" jdbcType="DATE" />
    <result column="MODIF_USER" property="modifUser" jdbcType="DECIMAL" />
    <result column="EXEC_SQL" property="execSql" jdbcType="VARCHAR" />
    <result column="IS_PHY" property="isPhy" jdbcType="DECIMAL" />
    <result column="SQL_STRING" property="sqlString" jdbcType="DECIMAL" />
  </resultMap>
   <resultMap id="ibatorgenerated_BaseResultMap_up" class="com.kmzyc.promotion.app.vobject.Category" >
      <result column="categoryId" property="categoryId" jdbcType="DECIMAL" />
    <result column="parentId" property="parentId" jdbcType="DECIMAL" />
    <result column="CATEGORY_NAME" property="categoryName" jdbcType="DECIMAL" />
     </resultMap>
  <resultMap id="ibatorgenerated_BaseResultMap3" class="com.kmzyc.promotion.app.vobject.Category">
		<result column="CATEGORY_ID" property="categoryId" jdbcType="DECIMAL" />
		<result column="CATEGORY_NAME" property="categoryName" jdbcType="VARCHAR" />
	</resultMap>
  <sql id="ibatorgenerated_Example_Where_Clause" >
    <iterate property="oredCriteria" conjunction="or" prepend="where" removeFirstPrepend="iterate" >
      <isEqual property="oredCriteria[].valid" compareValue="true" >
        (
        <iterate prepend="and" property="oredCriteria[].criteriaWithoutValue" conjunction="and" >
          $oredCriteria[].criteriaWithoutValue[]$
        </iterate>
        <iterate prepend="and" property="oredCriteria[].criteriaWithSingleValue" conjunction="and" >
          $oredCriteria[].criteriaWithSingleValue[].condition$
            #oredCriteria[].criteriaWithSingleValue[].value#
        </iterate>
        <iterate prepend="and" property="oredCriteria[].criteriaWithListValue" conjunction="and" >
          $oredCriteria[].criteriaWithListValue[].condition$
          <iterate property="oredCriteria[].criteriaWithListValue[].values" open="(" close=")" conjunction="," >
            #oredCriteria[].criteriaWithListValue[].values[]#
          </iterate>
        </iterate>
        <iterate prepend="and" property="oredCriteria[].criteriaWithBetweenValue" conjunction="and" >
          $oredCriteria[].criteriaWithBetweenValue[].condition$
          #oredCriteria[].criteriaWithBetweenValue[].values[0]# and
          #oredCriteria[].criteriaWithBetweenValue[].values[1]#
        </iterate>
        )
      </isEqual>
    </iterate>
  </sql>
  <select id="ibatorgenerated_selectByExample" resultMap="ibatorgenerated_BaseResultMap" parameterClass="com.kmzyc.promotion.app.vobject.CategoryExample" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Wed Jul 17 17:51:35 CST 2013.
    -->
    select CATEGORY_ID, PARENT_ID, CATEGORY_CODE, CATEGORY_NAME, STATUS, SORTNO, CATEGORY_DESC,
      CREATE_TIME, MODIF_TIME, MODIF_USER, EXEC_SQL, IS_PHY, SQL_STRING
    from CATEGORYS
    <isParameterPresent >
      <include refid="CATEGORY.ibatorgenerated_Example_Where_Clause" />
      <isNotNull property="orderByClause" >
        order by $orderByClause$
      </isNotNull>
    </isParameterPresent>
  </select>
  <select id="ibatorgenerated_selectByPrimaryKey" resultMap="ibatorgenerated_BaseResultMap" parameterClass="com.kmzyc.promotion.app.vobject.Category" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Wed Jul 17 17:51:35 CST 2013.
    -->
    select CATEGORY_ID, PARENT_ID, CATEGORY_CODE, CATEGORY_NAME, STATUS, SORTNO, CATEGORY_DESC,
      CREATE_TIME, MODIF_TIME, MODIF_USER, EXEC_SQL, IS_PHY, SQL_STRING
    from CATEGORYS
    where CATEGORY_ID = #categoryId:DECIMAL#
  </select>
  <delete id="ibatorgenerated_deleteByPrimaryKey" parameterClass="com.kmzyc.promotion.app.vobject.Category" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Wed Jul 17 17:51:35 CST 2013.
    -->
    delete from CATEGORYS
    where CATEGORY_ID = #categoryId:DECIMAL#
  </delete>
  <delete id="ibatorgenerated_deleteByExample" parameterClass="com.kmzyc.promotion.app.vobject.CategoryExample" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Wed Jul 17 17:51:35 CST 2013.
    -->
    delete from CATEGORYS
    <include refid="CATEGORY.ibatorgenerated_Example_Where_Clause" />
  </delete>
  <insert id="ibatorgenerated_insert" parameterClass="com.kmzyc.promotion.app.vobject.Category" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Wed Jul 17 17:51:35 CST 2013.
    -->
     <selectKey resultClass="java.lang.Long" keyProperty="categoryId" >
           select SEQ_CATEGORY.nextval from dual
      </selectKey>
    insert into CATEGORYS (CATEGORY_ID, PARENT_ID, CATEGORY_CODE, CATEGORY_NAME, STATUS, SORTNO,
      CATEGORY_DESC, CREATE_TIME, EXEC_SQL, IS_PHY)
    values (#categoryId:DECIMAL#, #parentId:DECIMAL#, #categoryCode:VARCHAR#,
      #categoryName:VARCHAR#, 1, #sortno:DECIMAL#, #categoryDesc:VARCHAR#,
      sysdate, #execSql:VARCHAR#, #isPhy:DECIMAL#)
  </insert>
  <insert id="ibatorgenerated_insertSelective" parameterClass="com.kmzyc.promotion.app.vobject.Category" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Wed Jul 17 17:51:35 CST 2013.
    -->
    insert into CATEGORYS
    <dynamic prepend="(" >
      <isNotNull prepend="," property="categoryId" >
        CATEGORY_ID
      </isNotNull>
      <isNotNull prepend="," property="parentId" >
        PARENT_ID
      </isNotNull>
      <isNotNull prepend="," property="categoryCode" >
        CATEGORY_CODE
      </isNotNull>
      <isNotNull prepend="," property="categoryName" >
        CATEGORY_NAME
      </isNotNull>
      <isNotNull prepend="," property="status" >
        STATUS
      </isNotNull>
      <isNotNull prepend="," property="sortno" >
        SORTNO
      </isNotNull>
      <isNotNull prepend="," property="categoryDesc" >
        CATEGORY_DESC
      </isNotNull>
      <isNotNull prepend="," property="createTime" >
        CREATE_TIME
      </isNotNull>
      <isNotNull prepend="," property="modifTime" >
        MODIF_TIME
      </isNotNull>
      <isNotNull prepend="," property="modifUser" >
        MODIF_USER
      </isNotNull>
      <isNotNull prepend="," property="execSql" >
        EXEC_SQL
      </isNotNull>
      <isNotNull prepend="," property="isPhy" >
        IS_PHY
      </isNotNull>
      )
    </dynamic>
    values
    <dynamic prepend="(" >
      <isNotNull prepend="," property="categoryId" >
        #categoryId:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="parentId" >
        #parentId:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="categoryCode" >
        #categoryCode:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="categoryName" >
        #categoryName:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="status" >
        #status:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="sortno" >
        #sortno:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="categoryDesc" >
        #categoryDesc:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="createTime" >
        #createTime:DATE#
      </isNotNull>
      <isNotNull prepend="," property="modifTime" >
        #modifTime:DATE#
      </isNotNull>
      <isNotNull prepend="," property="modifUser" >
        #modifUser:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="execSql" >
        #execSql:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="isPhy" >
        #isPhy:DECIMAL#
      </isNotNull>
      )
    </dynamic>
  </insert>
  <select id="ibatorgenerated_countByExample" parameterClass="com.kmzyc.promotion.app.vobject.CategoryExample" resultClass="java.lang.Integer" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Wed Jul 17 17:51:35 CST 2013.
    -->
    select count(*) from CATEGORYS
    <include refid="CATEGORY.ibatorgenerated_Example_Where_Clause" />
  </select>
  <update id="ibatorgenerated_updateByExampleSelective" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Wed Jul 17 17:51:35 CST 2013.
    -->
    update CATEGORYS
    <dynamic prepend="set" >
      <isNotNull prepend="," property="record.categoryId" >
        CATEGORY_ID = #record.categoryId:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="record.parentId" >
        PARENT_ID = #record.parentId:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="record.categoryCode" >
        CATEGORY_CODE = #record.categoryCode:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.categoryName" >
        CATEGORY_NAME = #record.categoryName:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.status" >
        STATUS = #record.status:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="record.sortno" >
        SORTNO = #record.sortno:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="record.categoryDesc" >
        CATEGORY_DESC = #record.categoryDesc:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.createTime" >
        CREATE_TIME = #record.createTime:DATE#
      </isNotNull>
      <isNotNull prepend="," property="record.modifTime" >
        MODIF_TIME = #record.modifTime:DATE#
      </isNotNull>
      <isNotNull prepend="," property="record.modifUser" >
        MODIF_USER = #record.modifUser:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="record.execSql" >
        EXEC_SQL = #record.execSql:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.isPhy" >
        IS_PHY = #record.isPhy:DECIMAL#
      </isNotNull>
    </dynamic>
    <isParameterPresent >
      <include refid="CATEGORY.ibatorgenerated_Example_Where_Clause" />
    </isParameterPresent>
  </update>
  <update id="ibatorgenerated_updateByExample" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Wed Jul 17 17:51:35 CST 2013.
    -->
    update CATEGORYS
    set CATEGORY_ID = #record.categoryId:DECIMAL#,
      PARENT_ID = #record.parentId:DECIMAL#,
      CATEGORY_CODE = #record.categoryCode:VARCHAR#,
      CATEGORY_NAME = #record.categoryName:VARCHAR#,
      STATUS = #record.status:DECIMAL#,
      SORTNO = #record.sortno:DECIMAL#,
      CATEGORY_DESC = #record.categoryDesc:VARCHAR#,
      CREATE_TIME = #record.createTime:DATE#,
      MODIF_TIME = #record.modifTime:DATE#,
      MODIF_USER = #record.modifUser:DECIMAL#,
      EXEC_SQL = #record.execSql:VARCHAR#,
      IS_PHY = #record.isPhy:DECIMAL#,
      SQL_STRING = #record.sqlString:VARCHAR#
    <isParameterPresent >
      <include refid="CATEGORY.ibatorgenerated_Example_Where_Clause" />
    </isParameterPresent>
  </update>
  <update id="ibatorgenerated_updateByPrimaryKeySelective" parameterClass="com.kmzyc.promotion.app.vobject.Category" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Wed Jul 17 17:51:35 CST 2013.
    -->
    update CATEGORYS
    <dynamic prepend="set" >
      <isNotNull prepend="," property="parentId" >
        PARENT_ID = #parentId:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="categoryCode" >
        CATEGORY_CODE = #categoryCode:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="categoryName" >
        CATEGORY_NAME = #categoryName:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="status" >
        STATUS = #status:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="sortno" >
        SORTNO = #sortno:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="categoryDesc" >
        CATEGORY_DESC = #categoryDesc:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="createTime" >
        CREATE_TIME = #createTime:DATE#
      </isNotNull>
      <isNotNull prepend="," property="modifTime" >
        MODIF_TIME = #modifTime:DATE#
      </isNotNull>
      <isNotNull prepend="," property="modifUser" >
        MODIF_USER = #modifUser:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="execSql" >
        EXEC_SQL = #execSql:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="isPhy" >
        IS_PHY = #isPhy:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="sqlString" >
        SQL_STRING = #sqlString:VARCHAR#
      </isNotNull>
    </dynamic>
    where CATEGORY_ID = #categoryId:DECIMAL#
  </update>
  <update id="deleteCategory" parameterClass="com.kmzyc.promotion.app.vobject.Category" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Wed Jul 17 17:51:35 CST 2013.
    -->
    update CATEGORYS
    set STATUS = #status:DECIMAL#
    where CATEGORY_ID in ($categoryIds$)
  </update>
  <select id="queryCategoryList" resultClass="com.kmzyc.promotion.app.vobject.Category" parameterClass="com.kmzyc.promotion.app.vobject.Category" >
    select CATEGORY_ID as categoryId, PARENT_ID as parentId, CATEGORY_NAME as categoryName,category_code as categoryCode,
    IS_PHY as isPhy 
    from CATEGORYS where STATUS = 1
     <isNotNull property="isPhy" prepend="and" >
      IS_PHY = #isPhy#
    </isNotNull>
     start with 
     <isNotNull property="categoryId" >
      category_id = #categoryId#
    </isNotNull>
     <isNull property="categoryId" >
      parent_id = 0
    </isNull>
      connect by  prior  category_id=parent_id
  </select>
  
  <select id="queryCategoryListOrderByParent" resultClass="com.kmzyc.promotion.app.vobject.Category" parameterClass="com.kmzyc.promotion.app.vobject.Category" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Wed Jul 17 17:51:35 CST 2013.
    -->
    select CATEGORY_ID as categoryId, PARENT_ID as parentId, CATEGORY_NAME as categoryName,category_code as categoryCode,
    IS_PHY as isPhy 
    from CATEGORYS where STATUS = 1
     <isNotNull property="isPhy" prepend="and" >
      IS_PHY = #isPhy#
    </isNotNull>
     start with 
     <isNotNull property="categoryId" >
      category_id = #categoryId#
    </isNotNull>
     <isNull property="categoryId" >
      parent_id = 0
    </isNull>
      connect by  prior  category_id=parent_id 
         order by parent_id
  </select>
  
  <select id="queryCategoryParentList" resultClass="com.kmzyc.promotion.app.vobject.Category" parameterClass="com.kmzyc.promotion.app.vobject.Category" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Wed Jul 17 17:51:35 CST 2013.
    -->
    select CATEGORY_ID as categoryId , CATEGORY_NAME as categoryName  
    from CATEGORYS where STATUS = 1 start with 
     <isNotNull property="categoryId" >
      category_id = #categoryId#
    </isNotNull>
      connect by prior parent_id = category_id
  </select>
  
  <select id="queryCanUpShelfCategoryList" resultClass="com.kmzyc.promotion.app.vobject.Category" parameterClass="com.kmzyc.promotion.app.vobject.Category"
      resultMap="ibatorgenerated_BaseResultMap_up" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Wed Jul 17 17:51:35 CST 2013.
    -->
    select CATEGORY_ID as categoryId, PARENT_ID as parentId, CATEGORY_NAME as categoryName
    from CATEGORYS where STATUS = 1 start with 
     <isNotNull property="categoryId" >
      category_id = #categoryId#
    </isNotNull>
     <isNull property="categoryId" >
      parent_id = 0
    </isNull>
      connect by  prior  category_id=parent_id
  </select>
  
  <select id="queryMaxCategoryNoByParentId" resultClass="java.lang.String" parameterClass="java.lang.Long" >
  	select max(t.category_code) from CATEGORYS t where t.parent_id = #parentId#
  </select>
  
  <select id="queryRepeatName" resultClass="java.lang.Integer" parameterClass="com.kmzyc.promotion.app.vobject.Category" >
  	select count(a.category_id) from Categorys a where a.category_name = #categoryName# and a.parent_id = #parentId# and a.is_phy = #isPhy# and a.status = 1
  	<isNotNull prepend="and" property="categoryId" >
  		category_id != #categoryId#
  	</isNotNull>
  </select>
  
  <select id="isRelationCateId" resultClass="java.lang.String" parameterClass="java.lang.Long" >
  	select distinct b.category_name from Categorys a,productmain b  where a.category_id = b.category_id and  b.category_id in
		(
		 select CATEGORY_ID
		                         from CATEGORYS
		                         where STATUS = 1
		                         start with
		                         CATEGORY_ID = #categoryId#
		                        connect by prior category_id = parent_id
		)
  </select>
  
  <delete id="relationDelete" parameterClass="java.lang.Long" >
  	delete Categorys a where a.category_id in (
  		select CATEGORY_ID
		                         from CATEGORYS
		                         where STATUS = 1
		                         start with
		                         CATEGORY_ID = #categoryId#
		                        connect by prior category_id = parent_id
  	)
  </delete>
  
  <select id="findSomePhyCategorys" resultMap="ibatorgenerated_BaseResultMap" >
  	select t.* from CATEGORYS t where t.is_phy = 1 and t.status = 1 start with t.category_id in (
       select t.category_id from CATEGORYS t where t.is_phy = 1 and parent_id = 0 and t.category_name not in (
			select t.category_name from CATEGORYS t where t.is_phy = 2 and parent_id = 0
		)
	)connect by  prior  category_id =   parent_id
  </select>
  
  <select id="ibatorgenerated_selectByCategoryId" resultMap="ibatorgenerated_BaseResultMap" parameterClass="java.lang.Long" >
    select CATEGORY_ID, PARENT_ID, CATEGORY_CODE, CATEGORY_NAME, STATUS, SORTNO, CATEGORY_DESC,
      CREATE_TIME, MODIF_TIME, MODIF_USER, EXEC_SQL, IS_PHY, SQL_STRING from categorys c1
       where c1.category_id=(select c2.parent_id from categorys c2 where c2.category_id=(select c3.parent_id from  categorys c3  
       where c3.category_id=#categoryId#))
  </select>
  
  <select id="applySuppliersCategorys" resultMap="ibatorgenerated_BaseResultMap3" parameterClass="java.lang.Long">
	select cat.category_id,cat.category_name from suppliers_available_categorys sac,categorys cat where sac.category_id=cat.category_id and sac.supplier_id = #supplierId#
	</select>
	<select id="applySuppliersCategorysAll" resultMap="ibatorgenerated_BaseResultMap3" parameterClass="com.kmzyc.promotion.app.vobject.Category">
	select cat.category_id,cat.category_name from suppliers_categorys_scope sc,categorys cat where sc.category_id=cat.category_id  
	</select>
	
	<!-- 批量查询类目 -->
	<select id="SQL_QUERY_BATCH_CATEGORY_NAME_BY_ID" parameterClass="java.util.List" resultClass="com.kmzyc.promotion.app.vobject.Category">
	<![CDATA[
		select c.category_id categoryId,
		       c.parent_id parentId,
		       c.category_code categoryCode,
		       c.category_name categoryName,
		       c.status status,
		       c.sortno sortno,
		       c.category_desc categoryDesc,
		       c.create_time createTime,
		       c.modif_time modifTime,
		       c.modif_user modifUser,
		       c.exec_sql execSql,
		       c.is_phy isPhy,
		       c.sql_string sqlString
		  from categorys c
		where c.category_id in
	]]>
	<iterate open="(" close=")" conjunction=",">  
		<![CDATA[#[]#]]>
	</iterate>	
	</select>
</sqlMap>