<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="PROMOTION_RULE" >
  <resultMap id="ibatorgenerated_BaseResultMap" class="com.kmzyc.promotion.app.vobject.PromotionRule" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Mon Aug 26 11:15:08 CST 2013.
    -->
    <result column="PROMOTION_RULE_ID" property="promotionRuleId" jdbcType="DECIMAL" />
    <result column="PROMOTION_TYPE_ID" property="promotionTypeId" jdbcType="DECIMAL" />
    <result column="PROMOTION_RULE_RULE_NAME" property="promotionRuleRuleName" jdbcType="VARCHAR" />
    <result column="PROMOTION_RULE_EXPRESSION" property="promotionRuleExpression" jdbcType="VARCHAR" />
    <result column="PROMOTION_RULE_EXPLAIN" property="promotionRuleExplain" jdbcType="VARCHAR" />
    <result column="PROMOTION_RULE_TYPE" property="promotionRuleType" jdbcType="DECIMAL" />
    <result column="PROMOTION_RULE_COUPON_ID" property="promotionRuleCouponId" jdbcType="DECIMAL"/>
    <result column="PROMOTION_RULE_COUPON_NAME" property="promotionRuleCouponName" jdbcType="VARCHAR"/>
    <result column="PROMOTION_RULE_PRIORITY" property="promotionRulePriority" jdbcType="DECIMAL"/>
  </resultMap>
  <sql id="ibatorgenerated_Example_Where_Clause" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Mon Aug 26 11:15:08 CST 2013.
    -->
    <iterate property="oredCriteria" conjunction="or" prepend="where" removeFirstPrepend="iterate" >
      <isEqual property="oredCriteria[].valid" compareValue="true" >
        (
        <iterate prepend="and" property="oredCriteria[].criteriaWithoutValue" conjunction="and" >
          $oredCriteria[].criteriaWithoutValue[]$
        </iterate>
        <iterate prepend="and" property="oredCriteria[].criteriaWithSingleValue" conjunction="and" >
          $oredCriteria[].criteriaWithSingleValue[].condition$
            #oredCriteria[].criteriaWithSingleValue[].value#
        </iterate>
        <iterate prepend="and" property="oredCriteria[].criteriaWithListValue" conjunction="and" >
          $oredCriteria[].criteriaWithListValue[].condition$
          <iterate property="oredCriteria[].criteriaWithListValue[].values" open="(" close=")" conjunction="," >
            #oredCriteria[].criteriaWithListValue[].values[]#
          </iterate>
        </iterate>
        <iterate prepend="and" property="oredCriteria[].criteriaWithBetweenValue" conjunction="and" >
          $oredCriteria[].criteriaWithBetweenValue[].condition$
          #oredCriteria[].criteriaWithBetweenValue[].values[0]# and
          #oredCriteria[].criteriaWithBetweenValue[].values[1]#
        </iterate>
        )
      </isEqual>
    </iterate>
  </sql>
  <select id="ibatorgenerated_selectByExample" resultMap="ibatorgenerated_BaseResultMap" parameterClass="com.kmzyc.promotion.app.vobject.PromotionRuleExample" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Mon Aug 26 11:15:08 CST 2013.
    -->
    select PROMOTION_RULE_ID, PROMOTION_TYPE_ID, PROMOTION_RULE_RULE_NAME,
      PROMOTION_RULE_EXPRESSION, PROMOTION_RULE_EXPLAIN, PROMOTION_RULE_TYPE,PROMOTION_RULE_COUPON_ID
      ,COUPON_NAME as PROMOTION_RULE_COUPON_NAME,PROMOTION_RULE_PRIORITY
    from PROMOTION_RULE
    left join COUPON on PROMOTION_RULE_COUPON_ID = COUPON_ID
    <isParameterPresent >
      <include refid="PROMOTION_RULE.ibatorgenerated_Example_Where_Clause" />
      <isNotNull property="orderByClause" >
        order by $orderByClause$
      </isNotNull>
    </isParameterPresent>
  </select>
  <select id="ibatorgenerated_selectByPrimaryKey" resultMap="ibatorgenerated_BaseResultMap" parameterClass="com.kmzyc.promotion.app.vobject.PromotionRule" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Mon Aug 26 11:15:08 CST 2013.
    -->
    select PROMOTION_RULE_ID, PROMOTION_TYPE_ID, PROMOTION_RULE_RULE_NAME,
      PROMOTION_RULE_EXPRESSION, PROMOTION_RULE_EXPLAIN, PROMOTION_RULE_TYPE,PROMOTION_RULE_COUPON_ID
   ,COUPON_NAME as PROMOTION_RULE_COUPON_NAME,PROMOTION_RULE_PRIORITY
    from PROMOTION_RULE
    left join COUPON on PROMOTION_RULE_COUPON_ID = COUPON_ID
    where PROMOTION_RULE_ID = #promotionRuleId:DECIMAL#
  </select>
  <delete id="ibatorgenerated_deleteByPrimaryKey" parameterClass="com.kmzyc.promotion.app.vobject.PromotionRule" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Mon Aug 26 11:15:08 CST 2013.
    -->
    delete from PROMOTION_RULE
    where PROMOTION_RULE_ID = #promotionRuleId:DECIMAL#
  </delete>
  <delete id="ibatorgenerated_deleteByExample" parameterClass="com.kmzyc.promotion.app.vobject.PromotionRuleExample" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Mon Aug 26 11:15:08 CST 2013.
    -->
    delete from PROMOTION_RULE
    <include refid="PROMOTION_RULE.ibatorgenerated_Example_Where_Clause" />
  </delete>
  <insert id="ibatorgenerated_insert" parameterClass="com.kmzyc.promotion.app.vobject.PromotionRule" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Mon Aug 26 11:15:08 CST 2013.
    -->
    <selectKey resultClass="java.lang.Long" keyProperty="promotionRuleId" >
    	select SEQ_APP_PROMOTION_RULE.nextval from dual
   	</selectKey>
    insert into PROMOTION_RULE (PROMOTION_RULE_ID, PROMOTION_TYPE_ID, PROMOTION_RULE_RULE_NAME,
      PROMOTION_RULE_EXPRESSION, PROMOTION_RULE_EXPLAIN, PROMOTION_RULE_TYPE,PROMOTION_RULE_COUPON_ID,PROMOTION_RULE_PRIORITY)
    values (#promotionRuleId:DECIMAL#, #promotionTypeId:DECIMAL#, #promotionRuleRuleName:VARCHAR#,
      #promotionRuleExpression:VARCHAR#, #promotionRuleExplain:VARCHAR#,
      #promotionRuleType:DECIMAL#,#promotionRuleCouponId:DECIMAL#,#promotionRulePriority:DECIMAL#)
  </insert>
  <insert id="ibatorgenerated_insertSelective" parameterClass="com.kmzyc.promotion.app.vobject.PromotionRule" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Mon Aug 26 11:15:08 CST 2013.
    -->
   	<selectKey resultClass="java.lang.Long" keyProperty="promotionRuleId" >
    	select SEQ_APP_PROMOTION_RULE.nextval from dual
   	</selectKey>
    insert into PROMOTION_RULE
    <dynamic prepend="(" >
      <isNotNull prepend="," property="promotionRuleId" >
        PROMOTION_RULE_ID
      </isNotNull>
      <isNotNull prepend="," property="promotionTypeId" >
        PROMOTION_TYPE_ID
      </isNotNull>
      <isNotNull prepend="," property="promotionRuleRuleName" >
        PROMOTION_RULE_RULE_NAME
      </isNotNull>
      <isNotNull prepend="," property="promotionRuleExpression" >
        PROMOTION_RULE_EXPRESSION
      </isNotNull>
      <isNotNull prepend="," property="promotionRuleExplain" >
        PROMOTION_RULE_EXPLAIN
      </isNotNull>
      <isNotNull prepend="," property="promotionRuleType" >
        PROMOTION_RULE_TYPE
      </isNotNull>
      <isNotNull prepend="," property="promotionRuleCouponId" >
        PROMOTION_RULE_COUPON_ID
      </isNotNull>
       <isNotNull prepend="," property="promotionRulePriority" >
        PROMOTION_RULE_PRIORITY
      </isNotNull>
      )
    </dynamic>
    values
    <dynamic prepend="(" >
      <isNotNull prepend="," property="promotionRuleId" >
        #promotionRuleId:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="promotionTypeId" >
        #promotionTypeId:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="promotionRuleRuleName" >
        #promotionRuleRuleName:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="promotionRuleExpression" >
        #promotionRuleExpression:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="promotionRuleExplain" >
        #promotionRuleExplain:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="promotionRuleType" >
        #promotionRuleType:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="promotionRuleCouponId" >
        #promotionRuleCouponId:DECIMAL#
      </isNotNull>
       <isNotNull prepend="," property="promotionRulePriority" >
        #promotionRulePriority:DECIMAL#
      </isNotNull>
      )
    </dynamic>
  </insert>
  <select id="ibatorgenerated_countByExample" parameterClass="com.kmzyc.promotion.app.vobject.PromotionRuleExample" resultClass="java.lang.Integer" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Mon Aug 26 11:15:08 CST 2013.
    -->
    select count(*) from PROMOTION_RULE
    <include refid="PROMOTION_RULE.ibatorgenerated_Example_Where_Clause" />
  </select>
  <update id="ibatorgenerated_updateByExampleSelective" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Mon Aug 26 11:15:08 CST 2013.
    -->
    update PROMOTION_RULE
    <dynamic prepend="set" >
      <isNotNull prepend="," property="record.promotionRuleId" >
        PROMOTION_RULE_ID = #record.promotionRuleId:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="record.promotionTypeId" >
        PROMOTION_TYPE_ID = #record.promotionTypeId:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="record.promotionRuleRuleName" >
        PROMOTION_RULE_RULE_NAME = #record.promotionRuleRuleName:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.promotionRuleExpression" >
        PROMOTION_RULE_EXPRESSION = #record.promotionRuleExpression:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.promotionRuleExplain" >
        PROMOTION_RULE_EXPLAIN = #record.promotionRuleExplain:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.promotionRuleType" >
        PROMOTION_RULE_TYPE = #record.promotionRuleType:DECIMAL#
      </isNotNull>
       <isNotNull prepend="," property="record.promotionRuleCouponId" >
        PROMOTION_RULE_COUPON_ID = #record.promotionRuleCouponId:DECIMAL#
      </isNotNull>
       <isNotNull prepend="," property="record.promotionRulePriority" >
        PROMOTION_RULE_PRIORITY = #record.promotionRulePriority:DECIMAL#
      </isNotNull>
    </dynamic>
    <isParameterPresent >
      <include refid="PROMOTION_RULE.ibatorgenerated_Example_Where_Clause" />
    </isParameterPresent>
  </update>
  <update id="ibatorgenerated_updateByExample" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Mon Aug 26 11:15:08 CST 2013.
    -->
    update PROMOTION_RULE
    set PROMOTION_RULE_ID = #record.promotionRuleId:DECIMAL#,
      PROMOTION_TYPE_ID = #record.promotionTypeId:DECIMAL#,
      PROMOTION_RULE_RULE_NAME = #record.promotionRuleRuleName:VARCHAR#,
      PROMOTION_RULE_EXPRESSION = #record.promotionRuleExpression:VARCHAR#,
      PROMOTION_RULE_EXPLAIN = #record.promotionRuleExplain:VARCHAR#,
      PROMOTION_RULE_TYPE = #record.promotionRuleType:DECIMAL#
      PROMOTION_RULE_COUPON_ID = #record.promotionRuleCouponId:DECIMAL#
      PROMOTION_RULE_PRIORITY = #promotionRulePriority:DECIMAL# 
    <isParameterPresent >
      <include refid="PROMOTION_RULE.ibatorgenerated_Example_Where_Clause" />
    </isParameterPresent>
  </update>
  <update id="ibatorgenerated_updateByPrimaryKeySelective" parameterClass="com.kmzyc.promotion.app.vobject.PromotionRule" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Mon Aug 26 11:15:08 CST 2013.
    -->
    update PROMOTION_RULE
    <dynamic prepend="set" >
      <isNotNull prepend="," property="promotionTypeId" >
        PROMOTION_TYPE_ID = #promotionTypeId:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="promotionRuleRuleName" >
        PROMOTION_RULE_RULE_NAME = #promotionRuleRuleName:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="promotionRuleExpression" >
        PROMOTION_RULE_EXPRESSION = #promotionRuleExpression:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="promotionRuleExplain" >
        PROMOTION_RULE_EXPLAIN = #promotionRuleExplain:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="promotionRuleType" >
        PROMOTION_RULE_TYPE = #promotionRuleType:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="promotionRuleCouponId" >
        PROMOTION_RULE_COUPON_ID = #promotionRuleCouponId:DECIMAL#
      </isNotNull>
       <isNotNull prepend="," property="promotionRulePriority" >
        PROMOTION_RULE_PRIORITY = #promotionRulePriority:DECIMAL#
      </isNotNull>
    </dynamic>
    where PROMOTION_RULE_ID = #promotionRuleId:DECIMAL#
  </update>
  <update id="ibatorgenerated_updateByPrimaryKey" parameterClass="com.kmzyc.promotion.app.vobject.PromotionRule" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Mon Aug 26 11:15:08 CST 2013.
    -->
    update PROMOTION_RULE
    set PROMOTION_TYPE_ID = #promotionTypeId:DECIMAL#,
      PROMOTION_RULE_RULE_NAME = #promotionRuleRuleName:VARCHAR#,
      PROMOTION_RULE_EXPRESSION = #promotionRuleExpression:VARCHAR#,
      PROMOTION_RULE_EXPLAIN = #promotionRuleExplain:VARCHAR#,
      PROMOTION_RULE_TYPE = #promotionRuleType:DECIMAL#
      PROMOTION_RULE_COUPON_ID = #promotionRuleCouponId:DECIMAL#
      PROMOTION_RULE_PRIORITY = #promotionRulePriority:DECIMAL#
    where PROMOTION_RULE_ID = #promotionRuleId:DECIMAL#
  </update>
  
  
  <!-- **************** search user's roleList by vo  ****************  -->
 <select id="searchPageByVo" resultMap="ibatorgenerated_BaseResultMap"  parameterClass="com.kmzyc.promotion.app.vobject.PromotionRule" >
  	 select PROMOTION_RULE_ID, PROMOTION_TYPE_ID, PROMOTION_RULE_RULE_NAME,
      PROMOTION_RULE_EXPRESSION, PROMOTION_RULE_EXPLAIN, PROMOTION_RULE_TYPE,PROMOTION_RULE_COUPON_ID
      ,PROMOTION_RULE_COUPON_NAME,PROMOTION_RULE_PRIORITY
    from (
      select ROW_NUMBER() OVER(order by PROMOTION_RULE_ID desc) as view_row_number,PROMOTION_RULE_ID, PROMOTION_TYPE_ID, PROMOTION_RULE_RULE_NAME,
      PROMOTION_RULE_EXPRESSION, PROMOTION_RULE_EXPLAIN, PROMOTION_RULE_TYPE,PROMOTION_RULE_COUPON_ID
    	,COUPON_NAME as PROMOTION_RULE_COUPON_NAME,PROMOTION_RULE_PRIORITY
    from PROMOTION_RULE
    left join COUPON on PROMOTION_RULE_COUPON_ID = COUPON_ID
    <dynamic prepend="where" >
      <isNotEmpty prepend="and" property="promotionRuleId" >
        PROMOTION_RULE_ID = #promotionRuleId:DECIMAL#
      </isNotEmpty>
      <isNotEmpty prepend="and" property="promotionRuleRuleName" >
        PROMOTION_RULE_RULE_NAME = #promotionRuleRuleName:VARCHAR#
      </isNotEmpty>
       <isNotEmpty prepend="and" property="promotionTypeId" >
        PROMOTION_TYPE_ID = #promotionTypeId:DECIMAL#
      </isNotEmpty>
      <isNotEmpty prepend="and" property="promotionRuleType" >
        PROMOTION_RULE_TYPE = #promotionRuleType:DECIMAL#
      </isNotEmpty>
      <isNotEmpty prepend="and" property="promotionRuleCouponId" >
        PROMOTION_RULE_COUPON_ID = #promotionRuleCouponId:DECIMAL#
      </isNotEmpty>
      <isNotEmpty prepend="and" property="promotionRulePriority" >
        PROMOTION_RULE_PRIORITY = #promotionRulePriority:DECIMAL#
      </isNotEmpty>
    </dynamic>
    )
    WHERE view_row_number between #skip# and #max#
    
  </select>
  <select id="getPromotionRuleCount"  parameterClass="com.kmzyc.promotion.app.vobject.PromotionRule"  resultClass="java.lang.Integer" >
     select count(1) the_count from PROMOTION_RULE 
   <dynamic prepend="where" >
      <isNotEmpty prepend="and" property="promotionRuleId" >
        PROMOTION_RULE_ID = #promotionRuleId:DECIMAL#
      </isNotEmpty>
      <isNotEmpty prepend="and" property="promotionRuleRuleName" >
        PROMOTION_RULE_RULE_NAME = #promotionRuleRuleName:VARCHAR#
      </isNotEmpty>
       <isNotEmpty prepend="and" property="promotionTypeId" >
        PROMOTION_TYPE_ID = #promotionTypeId:DECIMAL#
      </isNotEmpty>
      <isNotEmpty prepend="and" property="promotionRuleType" >
        PROMOTION_RULE_TYPE = #promotionRuleType:DECIMAL#
      </isNotEmpty>
      <isNotEmpty prepend="and" property="promotionRuleCouponId" >
        PROMOTION_RULE_COUPON_ID = #promotionRuleCouponId:DECIMAL#
      </isNotEmpty>
      <isNotEmpty prepend="and" property="promotionRulePriority" >
        PROMOTION_RULE_PRIORITY = #promotionRulePriority:DECIMAL#
      </isNotEmpty>
    </dynamic>
  </select>
  <select id="getPromotionRuleCount2"  parameterClass="com.kmzyc.promotion.app.vobject.PromotionRule"  resultClass="java.lang.Integer" >
     select count(1) the_count from PROMOTION_RULE 
   <dynamic prepend="where" >
      <isNotEmpty prepend="and" property="promotionRuleId" >
        PROMOTION_RULE_ID != #promotionRuleId:DECIMAL#
      </isNotEmpty>
      <isNotEmpty prepend="and" property="promotionRuleRuleName" >
        PROMOTION_RULE_RULE_NAME = #promotionRuleRuleName:VARCHAR#
      </isNotEmpty>
       <isNotEmpty prepend="and" property="promotionTypeId" >
        PROMOTION_TYPE_ID = #promotionTypeId:DECIMAL#
      </isNotEmpty>
      <isNotEmpty prepend="and" property="promotionRuleType" >
        PROMOTION_RULE_TYPE = #promotionRuleType:DECIMAL#
      </isNotEmpty>
      <isNotEmpty prepend="and" property="promotionRuleCouponId" >
        PROMOTION_RULE_COUPON_ID = #promotionRuleCouponId:DECIMAL#
      </isNotEmpty>
       <isNotEmpty prepend="and" property="promotionRulePriority" >
        PROMOTION_RULE_PRIORITY = #promotionRulePriority:DECIMAL#
      </isNotEmpty>
    </dynamic>
  </select>
  <select id="getCouponid" parameterClass="java.lang.Long" resultClass="java.lang.Long">
  		select prize_data from PROMOTION_RULE_DATA where promotion_rule_id = #promotionRuleId:DECIMAL#
  </select>
   <select id="getIncreasePromotionRuleId" parameterClass="java.lang.Long" resultClass="java.lang.Long">
  		select pr.promotion_rule_id from PROMOTION_RULE pr
		left join PROMOTION_RULE_DATA d on d.promotion_rule_id = pr.promotion_rule_id 
		 where pr.promotion_type_id = 10 
		 and d.prize_data is null
		 and rownum = 1
  </select>
  
	
</sqlMap>