<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="PRODUCT_RELATION">

<typeAlias alias="Product" type="com.kmzyc.promotion.app.vobject.Product"/>
<resultMap id="ProductResultMap" class="Product" >
    <result column="PRODUCT_ID" property="id" jdbcType="DECIMAL" />
  </resultMap>


	<resultMap id="ibatorgenerated_BaseResultMap" class="com.kmzyc.promotion.app.vobject.ProductRelation">
		<!-- WARNING - This element is automatically generated by Apache iBATIS 
			ibator, do not modify. This element was generated on Mon Nov 11 12:20:08 
			CST 2013. -->
		<result column="RELATION_ID" property="relationId" jdbcType="DECIMAL" />
		<result column="RELATION_NAME" property="relationName"
			jdbcType="VARCHAR" />
		<result column="MAIN_SKU_ID" property="mainSkuId" jdbcType="DECIMAL" />
		<result column="MAIN_SKU_PRICE" property="mainSkuPrice"
			jdbcType="DECIMAL" />
		<result column="TOTAL_RELATION_PRICE" property="totalRelationPrice"
			jdbcType="DECIMAL" />
		<result column="RELATION_TYPE" property="relationType"
			jdbcType="DECIMAL" />
		<result column="REMARK" property="remark" jdbcType="VARCHAR" />
		<result column="STATUS" property="status" jdbcType="DECIMAL" />
		<result column="DEL_STATUS" property="delStatus" jdbcType="DECIMAL" />
		<result column="CREATE_DATE" property="createDate" jdbcType="DATE" />
		<result column="EDITABLE" property="editable" jdbcType="DECIMAL" />
	</resultMap>



	<resultMap id="selectProductAndDeatail"
		class="com.kmzyc.promotion.app.vobject.ProductRelationAndDetail">
		<result column="RELATION_ID" property="relationId" jdbcType="LONG" />
		<result column="RELATION_NAME" property="relationName"
			jdbcType="VARCHAR" />
		<result column="MAIN_SKU_ID" property="mainSkuId" jdbcType="LONG" />
		<result column="MAIN_SKU_PRICE" property="mainSkuPrice"
			jdbcType="DECIMAL" />
		<result column="TOTAL_RELATION_PRICE" property="totalRelationPrice"
			jdbcType="DECIMAL" />
		<result column="RELATION_TYPE" property="relationType"
			jdbcType="DECIMAL" />
		<result column="REMARK" property="remark" jdbcType="VARCHAR" />
		<result column="RELATION_DETAIL_ID" property="relationDetailId"
			jdbcType="LONG" />
		<result column="RELATION_SKU_ID" property="relationSkuId"
			jdbcType="LONG" />
		<result column="RELATION_SKU_PRICE" property="relationSkuPrice"
			jdbcType="DECIMAL" />
		<result column="RELATION_DETAIL_TYPE" property="relationDetailType"
			jdbcType="DECIMAL" />
	</resultMap>



	<sql id="ibatorgenerated_Example_Where_Clause">
		<!-- WARNING - This element is automatically generated by Apache iBATIS 
			ibator, do not modify. This element was generated on Mon Nov 11 12:20:08 
			CST 2013. -->
		<iterate property="oredCriteria" conjunction="or" prepend="where"
			removeFirstPrepend="iterate">
			<isEqual property="oredCriteria[].valid" compareValue="true">
				(
				<iterate prepend="and" property="oredCriteria[].criteriaWithoutValue"
					conjunction="and">
					$oredCriteria[].criteriaWithoutValue[]$
				</iterate>
				<iterate prepend="and" property="oredCriteria[].criteriaWithSingleValue"
					conjunction="and">
					$oredCriteria[].criteriaWithSingleValue[].condition$
					#oredCriteria[].criteriaWithSingleValue[].value#
				</iterate>
				<iterate prepend="and" property="oredCriteria[].criteriaWithListValue"
					conjunction="and">
					$oredCriteria[].criteriaWithListValue[].condition$
					<iterate property="oredCriteria[].criteriaWithListValue[].values"
						open="(" close=")" conjunction=",">
						#oredCriteria[].criteriaWithListValue[].values[]#
					</iterate>
				</iterate>
				<iterate prepend="and" property="oredCriteria[].criteriaWithBetweenValue"
					conjunction="and">
					$oredCriteria[].criteriaWithBetweenValue[].condition$
					#oredCriteria[].criteriaWithBetweenValue[].values[0]# and
					#oredCriteria[].criteriaWithBetweenValue[].values[1]#
				</iterate>
				)
			</isEqual>
		</iterate>
	</sql>
	<select id="ibatorgenerated_selectByExample" resultMap="ibatorgenerated_BaseResultMap"
		parameterClass="com.kmzyc.promotion.app.vobject.ProductRelationExample">
		<!-- WARNING - This element is automatically generated by Apache iBATIS 
			ibator, do not modify. This element was generated on Mon Nov 11 12:20:08 
			CST 2013. -->
		select RELATION_ID, RELATION_NAME, MAIN_SKU_ID,MAIN_SKU_PRICE,
		TOTAL_RELATION_PRICE, RELATION_TYPE,REMARK,STATUS,
		DEL_STATUS, CREATE_DATE,EDITABLE
		from PRODUCT_RELATION
		<isParameterPresent>
			<include refid="PRODUCT_RELATION.ibatorgenerated_Example_Where_Clause" />
			<isNotNull property="orderByClause">
				order by $orderByClause$
			</isNotNull>
		</isParameterPresent>
	</select>
	<select id="ibatorgenerated_selectByPrimaryKey" resultMap="ibatorgenerated_BaseResultMap"
		parameterClass="com.kmzyc.promotion.app.vobject.ProductRelation">
		<!-- WARNING - This element is automatically generated by Apache iBATIS 
			ibator, do not modify. This element was generated on Mon Nov 11 12:20:08 
			CST 2013. -->
		select RELATION_ID, RELATION_NAME, MAIN_SKU_ID,MAIN_SKU_PRICE,
		TOTAL_RELATION_PRICE, RELATION_TYPE,REMARK,STATUS,
		DEL_STATUS, CREATE_DATE,EDITABLE
		from PRODUCT_RELATION
		where RELATION_ID = #relationId:DECIMAL#
	</select>
	<delete id="ibatorgenerated_deleteByPrimaryKey" parameterClass="com.kmzyc.promotion.app.vobject.ProductRelation">
		<!-- WARNING - This element is automatically generated by Apache iBATIS 
			ibator, do not modify. This element was generated on Mon Nov 11 12:20:08 
			CST 2013. -->
		delete from PRODUCT_RELATION
		where RELATION_ID = #relationId:DECIMAL#
	</delete>
	<delete id="ibatorgenerated_deleteByExample" parameterClass="com.kmzyc.promotion.app.vobject.ProductRelationExample">
		<!-- WARNING - This element is automatically generated by Apache iBATIS 
			ibator, do not modify. This element was generated on Mon Nov 11 12:20:08 
			CST 2013. -->
		delete from PRODUCT_RELATION
		<include refid="PRODUCT_RELATION.ibatorgenerated_Example_Where_Clause" />
	</delete>
	<insert id="ibatorgenerated_insert" parameterClass="com.kmzyc.promotion.app.vobject.ProductRelation">

		<selectKey keyProperty="relationId" resultClass="java.lang.Long">
			select
			SEQ_PRODUCT_RELATION.nextval from dual
		</selectKey>


		insert into PRODUCT_RELATION (RELATION_ID, RELATION_NAME, MAIN_SKU_ID,
		MAIN_SKU_PRICE,
		TOTAL_RELATION_PRICE, RELATION_TYPE, REMARK, STATUS, DEL_STATUS, CREATE_DATE, EDITABLE)
		values (#relationId:DECIMAL#, #relationName:VARCHAR#,
		#mainSkuId:DECIMAL#,
		#mainSkuPrice:DECIMAL#, #totalRelationPrice:DECIMAL#, #relationType:DECIMAL#,
		#remark:VARCHAR#, #status:DECIMAL#, #delStatus:DECIMAL#,
		#createDate:timestamp#,
		#editable:DECIMAL#)
	</insert>
	<insert id="ibatorgenerated_insertSelective" parameterClass="com.kmzyc.promotion.app.vobject.ProductRelation">

		<selectKey keyProperty="relationId" resultClass="java.lang.Long">
			select
			SEQ_PRODUCT_RELATION.nextval from dual
		</selectKey>
		insert into PRODUCT_RELATION
		<dynamic prepend="(">
			<isNotNull prepend="," property="relationId">
				RELATION_ID
			</isNotNull>
			<isNotNull prepend="," property="relationName">
				RELATION_NAME
			</isNotNull>
			<isNotNull prepend="," property="mainSkuId">
				MAIN_SKU_ID
			</isNotNull>
			<isNotNull prepend="," property="mainSkuPrice">
				MAIN_SKU_PRICE
			</isNotNull>
			<isNotNull prepend="," property="totalRelationPrice">
				TOTAL_RELATION_PRICE
			</isNotNull>
			<isNotNull prepend="," property="relationType">
				RELATION_TYPE
			</isNotNull>
			<isNotNull prepend="," property="remark">
				REMARK
			</isNotNull>
			<isNotNull prepend="," property="status">
				STATUS
			</isNotNull>
			<isNotNull prepend="," property="delStatus">
				DEL_STATUS
			</isNotNull>
			<isNotNull prepend="," property="createDate">
				CREATE_DATE
			</isNotNull>
			<isNotNull prepend="," property="editable">
				EDITABLE
			</isNotNull>
			)
		</dynamic>
		values
		<dynamic prepend="(">
			<isNotNull prepend="," property="relationId">
				#relationId:DECIMAL#
			</isNotNull>
			<isNotNull prepend="," property="relationName">
				#relationName:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="mainSkuId">
				#mainSkuId:DECIMAL#
			</isNotNull>
			<isNotNull prepend="," property="mainSkuPrice">
				#mainSkuPrice:DECIMAL#
			</isNotNull>
			<isNotNull prepend="," property="totalRelationPrice">
				#totalRelationPrice:DECIMAL#
			</isNotNull>
			<isNotNull prepend="," property="relationType">
				#relationType:DECIMAL#
			</isNotNull>
			<isNotNull prepend="," property="remark">
				#remark:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="status">
				#status:DECIMAL#
			</isNotNull>
			<isNotNull prepend="," property="delStatus">
				#delStatus:DECIMAL#
			</isNotNull>
			<isNotNull prepend="," property="createDate">
				#createDate:timestamp#
			</isNotNull>
			<isNotNull prepend="," property="editable">
				#editable:DECIMAL#
			</isNotNull>
			)
		</dynamic>
	</insert>
	<select id="ibatorgenerated_countByExample" parameterClass="com.kmzyc.promotion.app.vobject.ProductRelationExample"
		resultClass="java.lang.Integer">
		<!-- WARNING - This element is automatically generated by Apache iBATIS 
			ibator, do not modify. This element was generated on Mon Nov 11 12:20:08 
			CST 2013. -->
		select count(*) from PRODUCT_RELATION
		<include refid="PRODUCT_RELATION.ibatorgenerated_Example_Where_Clause" />
	</select>
	<update id="ibatorgenerated_updateByExampleSelective">
		<!-- WARNING - This element is automatically generated by Apache iBATIS 
			ibator, do not modify. This element was generated on Mon Nov 11 12:20:08 
			CST 2013. -->
		update PRODUCT_RELATION
		<dynamic prepend="set">
			<isNotNull prepend="," property="record.relationId">
				RELATION_ID = #record.relationId:DECIMAL#
			</isNotNull>
			<isNotNull prepend="," property="record.relationName">
				RELATION_NAME = #record.relationName:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="record.mainSkuId">
				MAIN_SKU_ID = #record.mainSkuId:DECIMAL#
			</isNotNull>
			<isNotNull prepend="," property="record.mainSkuPrice">
				MAIN_SKU_PRICE = #record.mainSkuPrice:DECIMAL#
			</isNotNull>
			<isNotNull prepend="," property="record.totalRelationPrice">
				TOTAL_RELATION_PRICE = #record.totalRelationPrice:DECIMAL#
			</isNotNull>
			<isNotNull prepend="," property="record.relationType">
				RELATION_TYPE = #record.relationType:DECIMAL#
			</isNotNull>
			<isNotNull prepend="," property="record.remark">
				REMARK = #record.remark:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="record.status">
				STATUS = #record.status:DECIMAL#
			</isNotNull>
			<isNotNull prepend="," property="record.delStatus">
				DEL_STATUS = #record.delStatus:DECIMAL#
			</isNotNull>
			<isNotNull prepend="," property="record.createDate">
				CREATE_DATE = #record.createDate:timestamp#
			</isNotNull>
			<isNotNull prepend="," property="record.editable">
				EDITABLE = #record.editable:DECIMAL#
			</isNotNull>
		</dynamic>
		<isParameterPresent>
			<include refid="PRODUCT_RELATION.ibatorgenerated_Example_Where_Clause" />
		</isParameterPresent>
	</update>
	<update id="ibatorgenerated_updateByExample">
		<!-- WARNING - This element is automatically generated by Apache iBATIS 
			ibator, do not modify. This element was generated on Mon Nov 11 12:20:08 
			CST 2013. -->
		update PRODUCT_RELATION
		set RELATION_ID = #record.relationId:DECIMAL#,
		RELATION_NAME = #record.relationName:VARCHAR#,
		MAIN_SKU_ID = #record.mainSkuId:DECIMAL#,
		MAIN_SKU_PRICE = #record.mainSkuPrice:DECIMAL#,
		TOTAL_RELATION_PRICE = #record.totalRelationPrice:DECIMAL#,
		RELATION_TYPE = #record.relationType:DECIMAL#,
		REMARK = #record.remark:VARCHAR#,
		STATUS = #record.status:DECIMAL#,
		DEL_STATUS = #record.delStatus:DECIMAL#,
		CREATE_DATE = #record.createDate:timestamp#,
		EDITABLE = #record.editable:DECIMAL#
		<isParameterPresent>
			<include refid="PRODUCT_RELATION.ibatorgenerated_Example_Where_Clause" />
		</isParameterPresent>
	</update>
	<update id="ibatorgenerated_updateByPrimaryKeySelective"
		parameterClass="com.kmzyc.promotion.app.vobject.ProductRelation">
		<!-- WARNING - This element is automatically generated by Apache iBATIS 
			ibator, do not modify. This element was generated on Mon Nov 11 12:20:08 
			CST 2013. -->
		update PRODUCT_RELATION
		<dynamic prepend="set">
			<isNotNull prepend="," property="relationName">
				RELATION_NAME = #relationName:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="mainSkuId">
				MAIN_SKU_ID = #mainSkuId:DECIMAL#
			</isNotNull>
			<isNotNull prepend="," property="mainSkuPrice">
				MAIN_SKU_PRICE = #mainSkuPrice:DECIMAL#
			</isNotNull>
			<isNotNull prepend="," property="totalRelationPrice">
				TOTAL_RELATION_PRICE = #totalRelationPrice:DECIMAL#
			</isNotNull>
			<isNotNull prepend="," property="relationType">
				RELATION_TYPE = #relationType:DECIMAL#
			</isNotNull>
			<isNotNull prepend="," property="remark">
				REMARK = #remark:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="status">
				STATUS = #status:DECIMAL#
			</isNotNull>
			<isNotNull prepend="," property="delStatus">
				DEL_STATUS = #delStatus:DECIMAL#
			</isNotNull>
			<isNotNull prepend="," property="createDate">
				CREATE_DATE = #createDate:timestamp#
			</isNotNull>
			<isNotNull prepend="," property="editable">
				EDITABLE = #editable:DECIMAL#
			</isNotNull>
		</dynamic>
		where RELATION_ID = #relationId:DECIMAL#
	</update>
	<update id="ibatorgenerated_updateByPrimaryKey" parameterClass="com.kmzyc.promotion.app.vobject.ProductRelation">
		<!-- WARNING - This element is automatically generated by Apache iBATIS 
			ibator, do not modify. This element was generated on Mon Nov 11 12:20:08 
			CST 2013. -->
		update PRODUCT_RELATION
		set RELATION_NAME = #relationName:VARCHAR#,
		MAIN_SKU_ID = #mainSkuId:DECIMAL#,
		MAIN_SKU_PRICE = #mainSkuPrice:DECIMAL#,
		TOTAL_RELATION_PRICE = #totalRelationPrice:DECIMAL#,
		RELATION_TYPE = #relationType:DECIMAL#,
		REMARK = #remark:VARCHAR#,
		STATUS = #status:DECIMAL#,
		DEL_STATUS = #delStatus:DECIMAL#,
		CREATE_DATE = #createDate:timestamp#,
		EDITABLE = #editable:DECIMAL#
		where RELATION_ID = #relationId:DECIMAL#
	</update>



	<delete id="deleteProductRelationByDeatilId" parameterClass="java.lang.Long">
		DELETE FROM PRODUCT_RELATION WHERE relation_id=#id#
	</delete>


	<select id="selectProductAndDetailPackage" parameterClass="java.lang.Long"
		resultMap="selectProductAndDeatail">
		select p.RELATION_ID, p.RELATION_NAME, p.MAIN_SKU_ID, p.MAIN_SKU_PRICE,
		p.TOTAL_RELATION_PRICE,
		p.RELATION_TYPE,p.REMARK , d.RELATION_DETAIL_ID, d.RELATION_ID, d.RELATION_SKU_ID,
		d.RELATION_SKU_PRICE,d.RELATION_DETAIL_TYPE from PRODUCT_RELATION p
		,PRODUCT_RELATION_DETAIL d where
		p.relation_id=d.relation_id and p.main_sku_id=#id# and p.RELATION_TYPE=0
	</select>




	<select id="selectProductAndDetailRecommend" parameterClass="java.lang.Long"
		resultMap="selectProductAndDeatail">
		select p.RELATION_ID, p.RELATION_NAME, p.MAIN_SKU_ID, p.MAIN_SKU_PRICE,
		p.TOTAL_RELATION_PRICE,
		p.RELATION_TYPE,p.REMARK , d.RELATION_DETAIL_ID, d.RELATION_ID, d.RELATION_SKU_ID,
		d.RELATION_SKU_PRICE ,d.RELATION_DETAIL_TYPE from PRODUCT_RELATION p
		,PRODUCT_RELATION_DETAIL d where
		p.relation_id=d.relation_id and p.main_sku_id=#id# and p.RELATION_TYPE=1
	</select>


	<select id="selectProductDetailPackageBySkuId" parameterClass="java.lang.Long"
		resultMap="ibatorgenerated_BaseResultMap">
		select RELATION_ID, RELATION_NAME, MAIN_SKU_ID,MAIN_SKU_PRICE,
		TOTAL_RELATION_PRICE, RELATION_TYPE,REMARK,STATUS,
		DEL_STATUS, CREATE_DATE,EDITABLE
		from PRODUCT_RELATION where RELATION_TYPE=0 and status=3 and del_status=0
		 and MAIN_SKU_ID=#skuId#

	</select>



	<select id="selectProductDetailRecommendBySkuId" parameterClass="java.lang.Long"
		resultMap="ibatorgenerated_BaseResultMap">
		select RELATION_ID, RELATION_NAME, MAIN_SKU_ID,MAIN_SKU_PRICE,
		TOTAL_RELATION_PRICE, RELATION_TYPE,REMARK,STATUS,
		DEL_STATUS, CREATE_DATE,EDITABLE
		from PRODUCT_RELATION where RELATION_TYPE=1 and status=1 and del_status=0
		and editable=1 and MAIN_SKU_ID=#skuId#
	</select>



	<select id="selectProductDetailGlanceBySkuId" parameterClass="java.lang.Long"
		resultMap="ibatorgenerated_BaseResultMap">
		select RELATION_ID, RELATION_NAME, MAIN_SKU_ID,MAIN_SKU_PRICE,
		TOTAL_RELATION_PRICE, RELATION_TYPE,REMARK,STATUS,
		DEL_STATUS, CREATE_DATE,EDITABLE
		from PRODUCT_RELATION where RELATION_TYPE=2 and MAIN_SKU_ID=#skuId#
	</select>



	<select id="selectProductDetailPurchaseBySkuId" parameterClass="java.lang.Long"
		resultMap="ibatorgenerated_BaseResultMap">
		select RELATION_ID, RELATION_NAME, MAIN_SKU_ID,MAIN_SKU_PRICE,
		TOTAL_RELATION_PRICE, RELATION_TYPE,REMARK,STATUS,
		DEL_STATUS, CREATE_DATE,EDITABLE
		from PRODUCT_RELATION where RELATION_TYPE=3 and MAIN_SKU_ID=#skuId#
	</select>

	<select id="selectProductRelationAndDetailBySkuId"
		parameterClass="java.lang.Long" resultMap="selectProductAndDeatail">
		select * from PRODUCT_RELATION pr,PRODUCT_RELATION_DETAIL pd where
		pr.RELATION_ID = pd.RELATION_ID
		and (pr.MAIN_SKU_ID=#skuId# or pd.RELATION_SKU_ID=#skuId#)
	</select>
	
	
	<select id="selectProductRelationAndDetailByRelationSkuId"
		parameterClass="java.lang.Long" resultMap="selectProductAndDeatail">
		select * from PRODUCT_RELATION pr,PRODUCT_RELATION_DETAIL pd where
		pr.RELATION_ID = pd.RELATION_ID
		and  pd.RELATION_SKU_ID=#skuId#  and pr.del_status=0 and pr.editable=1
	</select>
	
	

	<update id="batchUpdateStatus" parameterClass="java.lang.Long">
		update PRODUCT_RELATION set DEL_STATUS=1 where relation_id=#id:LONG#
	</update>

	<update id="updateProductRelationStatus" parameterClass="java.lang.Long">
		update PRODUCT_RELATION set status=1 where relation_id=#id:LONG#
	</update>

<update id="updateProductRelationUnStatus" parameterClass="java.lang.Long">
		update PRODUCT_RELATION set status=0 where relation_id=#id:LONG#
	</update>
	<update id="updateProductRelationEdible" parameterClass="com.kmzyc.promotion.app.vobject.ProductRelation">
		update Product_Relation set editable=1 where relation_id=#relationId#
	</update>

   <select id="selectProductRelationAndDetailByProductId" parameterClass="java.util.List" resultMap="ProductResultMap">
  	select pm.PRODUCT_ID from PRODUCT_RELATION pr,PRODUCT_RELATION_DETAIL pd,PRODUCTMAIN pm,PRODUCT_SKU ps where pr.RELATION_ID = pd.RELATION_ID 
  	and pm.PRODUCT_ID=ps.PRODUCT_ID and (ps.PRODUCT_SKU_ID=pr.MAIN_SKU_ID or pd.RELATION_SKU_ID=ps.PRODUCT_SKU_ID) 
  	<dynamic prepend="AND">
   		<iterate open="(" close=")" conjunction=" OR ">
   			pm.PRODUCT_ID = #productIdList[]# 
   		</iterate>
   	</dynamic>
  </select>
  
  <update id="updateEditableByRelationId"  parameterClass="java.lang.Long"  >
   update product_relation set editable=1  where relation_id=#realtionId#
  
  </update>
  <update id="updateUnEditableByRelationId"  parameterClass="java.lang.Long"  >
   update product_relation set editable=0 where relation_id=#realtionId#
  
  </update>



</sqlMap>