<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="PRODUCT_STOCK" >
	<typeAlias alias="ProductStock" type="com.kmzyc.promotion.app.vobject.ProductStock"/>
	<typeAlias alias="Product" type="com.kmzyc.promotion.app.vobject.Product"/>

  <resultMap id="ProductResultMap" class="Product" >
    <result column="PRODUCT_ID" property="id" jdbcType="DECIMAL" />
    <result column="PRODUCT_TITLE" property="productTitle" jdbcType="VARCHAR" />
  </resultMap>

  <resultMap id="ibatorgenerated_BaseResultMap" class="com.kmzyc.promotion.app.vobject.ProductStock" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Mon Jul 29 10:50:35 CST 2013.
    -->
    <result column="STOCK_ID" property="stockId" jdbcType="DECIMAL" />
    <result column="WAREHOUSE_ID" property="warehouseId" jdbcType="DECIMAL" />
    <result column="PRODUCT_ID" property="productId" jdbcType="DECIMAL" />
    <result column="PRODUCT_NAME" property="productName" jdbcType="VARCHAR" />
    <result column="PRODUCT_NO" property="productNo" jdbcType="VARCHAR" />
    <result column="SKU_ATTRIBUTE_ID" property="skuAttributeId" jdbcType="DECIMAL" />
    <result column="SKU_ATT_VALUE" property="skuAttValue" jdbcType="VARCHAR" />
    <result column="STOCK_QUALITY" property="stockQuality" jdbcType="DECIMAL" />
    <result column="ORDER_QUALITY" property="orderQuality" jdbcType="DECIMAL" />
    <result column="IN_TRANSIT_QUALITY" property="inTransitQuality" jdbcType="DECIMAL" />
    <result column="ALARM_QUALITY" property="alarmQuality" jdbcType="DECIMAL" />
    <result column="TOTAL_SALES" property="totalSales" jdbcType="DECIMAL" />
    <result column="PRICE" property="price" jdbcType="BIGDECIMAL" />
    <result column="MIN_DAY" property="minDay" jdbcType="DECIMAL" />
    <result column="MAX_DAY" property="maxDay" jdbcType="DECIMAL" />
    <result column="ADJUST" property="adjust" jdbcType="DECIMAL" />
    <result column="REMARK" property="remark" jdbcType="VARCHAR" />
  </resultMap>
  <resultMap id="ibatorgenerated_BaseResultMap3" class="com.kmzyc.promotion.app.vobject.ProductStock" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Mon Jul 29 10:50:35 CST 2013.
    -->
    <result column="STOCK_ID" property="stockId" jdbcType="DECIMAL" />
    <result column="WAREHOUSE_ID" property="warehouseId" jdbcType="DECIMAL" />
    <result column="PRODUCT_ID" property="product" select="PRODUCT_STOCK.getProductListById"/>
    <result column="PRODUCT_NAME" property="productName" jdbcType="VARCHAR" />
    <result column="PRODUCT_NO" property="productNo" jdbcType="VARCHAR" />
    <result column="SKU_ATTRIBUTE_ID" property="skuAttributeId" jdbcType="DECIMAL" />
    <result column="SKU_ATT_VALUE" property="skuAttValue" jdbcType="VARCHAR" />
    <result column="STOCK_QUALITY" property="stockQuality" jdbcType="DECIMAL" />
    <result column="ORDER_QUALITY" property="orderQuality" jdbcType="DECIMAL" />
    <result column="IN_TRANSIT_QUALITY" property="inTransitQuality" jdbcType="DECIMAL" />
    <result column="ALARM_QUALITY" property="alarmQuality" jdbcType="DECIMAL" />
    <result column="TOTAL_SALES" property="totalSales" jdbcType="DECIMAL" />
    <result column="PRICE" property="price" jdbcType="BIGDECIMAL" />
    <result column="MIN_DAY" property="minDay" jdbcType="DECIMAL" />
    <result column="MAX_DAY" property="maxDay" jdbcType="DECIMAL" />
    <result column="ADJUST" property="adjust" jdbcType="DECIMAL" />
    <result column="REMARK" property="remark" jdbcType="VARCHAR" />
  </resultMap>
  <resultMap id="ibatorgenerated_BaseResultMap2" class="com.kmzyc.promotion.app.vobject.ProductStock" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Mon Jul 29 10:50:35 CST 2013.
    -->
    <result column="STOCK_ID" property="stockId" jdbcType="DECIMAL" />
    <result column="WAREHOUSE_ID" property="warehouseId" jdbcType="DECIMAL" />
    <result column="SKU_ATTRIBUTE_ID" property="skuAttributeId" jdbcType="DECIMAL" />
    <result column="SKU_ATT_VALUE" property="skuAttValue" jdbcType="VARCHAR" />
    <result column="STOCK_QUALITY" property="stockQuality" jdbcType="DECIMAL" />
    <result column="ORDER_QUALITY" property="orderQuality" jdbcType="DECIMAL" />
  </resultMap>
  
    <resultMap id="stockOutdetail_resultMap" class="com.kmzyc.promotion.app.vobject.StockOutAndDetail" >
	<result column="STOCK_OUT_ID" property="stockOutId" jdbcType="DECIMAL" />
	<result column="STOCK_OUT_NO" property="stockOutNo" jdbcType="VARCHAR" />
	<result column="WAREHOUSE_ID" property="warehouseId" jdbcType="DECIMAL" />
	<result column="STATUS" property="status" jdbcType="DECIMAL" />
	<result column="type" property="type" jdbcType="DECIMAL" />
	    
    <result column="DETAIL_ID" property="detailId" jdbcType="DECIMAL" />
    <result column="STOCK_ID" property="stockId" jdbcType="DECIMAL" />
    <result column="PRODUCT_SKU_ID" property="productSkuId" jdbcType="DECIMAL" />
 	<result column="PRODUCT_SKU_VALUE" property="productSkuValue" jdbcType="VARCHAR" />
 	<result column="QUANTITY" property="quantity" jdbcType="DECIMAL" />
  </resultMap>
  
  <sql id="ibatorgenerated_Example_Where_Clause" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Mon Jul 29 10:50:35 CST 2013.
    -->
    <iterate property="oredCriteria" conjunction="or" prepend="where" removeFirstPrepend="iterate" >
      <isEqual property="oredCriteria[].valid" compareValue="true" >
        (
        <iterate prepend="and" property="oredCriteria[].criteriaWithoutValue" conjunction="and" >
          $oredCriteria[].criteriaWithoutValue[]$
        </iterate>
        <iterate prepend="and" property="oredCriteria[].criteriaWithSingleValue" conjunction="and" >
          $oredCriteria[].criteriaWithSingleValue[].condition$
            #oredCriteria[].criteriaWithSingleValue[].value#
        </iterate>
        <iterate prepend="and" property="oredCriteria[].criteriaWithListValue" conjunction="and" >
          $oredCriteria[].criteriaWithListValue[].condition$
          <iterate property="oredCriteria[].criteriaWithListValue[].values" open="(" close=")" conjunction="," >
            #oredCriteria[].criteriaWithListValue[].values[]#
          </iterate>
        </iterate>
        <iterate prepend="and" property="oredCriteria[].criteriaWithBetweenValue" conjunction="and" >
          $oredCriteria[].criteriaWithBetweenValue[].condition$
          #oredCriteria[].criteriaWithBetweenValue[].values[0]# and
          #oredCriteria[].criteriaWithBetweenValue[].values[1]#
        </iterate>
        )
      </isEqual>
    </iterate>
  </sql>
  
  <sql id="ibatorgenerated_Example_Where_Clause2" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Mon Jul 29 10:50:35 CST 2013.
    -->
    <iterate property="oredCriteria" conjunction="or" prepend="and" removeFirstPrepend="iterate" >
      <isEqual property="oredCriteria[].valid" compareValue="true" >
        (
        <iterate prepend="and" property="oredCriteria[].criteriaWithoutValue" conjunction="and" >
          $oredCriteria[].criteriaWithoutValue[]$
        </iterate>
        <iterate prepend="and" property="oredCriteria[].criteriaWithSingleValue" conjunction="and" >
          $oredCriteria[].criteriaWithSingleValue[].condition$
            #oredCriteria[].criteriaWithSingleValue[].value#
        </iterate>
        <iterate prepend="and" property="oredCriteria[].criteriaWithListValue" conjunction="and" >
          $oredCriteria[].criteriaWithListValue[].condition$
          <iterate property="oredCriteria[].criteriaWithListValue[].values" open="(" close=")" conjunction="," >
            #oredCriteria[].criteriaWithListValue[].values[]#
          </iterate>
        </iterate>
        <iterate prepend="and" property="oredCriteria[].criteriaWithBetweenValue" conjunction="and" >
          $oredCriteria[].criteriaWithBetweenValue[].condition$
          #oredCriteria[].criteriaWithBetweenValue[].values[0]# and
          #oredCriteria[].criteriaWithBetweenValue[].values[1]#
        </iterate>
        )
      </isEqual>
    </iterate>
  </sql>
  
  <sql id="ibatorgenerated_Example_Where_ClauseByUser" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Mon Jul 29 10:50:35 CST 2013.
    -->
    <iterate property="oredCriteria" conjunction="or" prepend="and" removeFirstPrepend="iterate" >
      <isEqual property="oredCriteria[].valid" compareValue="true" >
        (
        <iterate prepend="and" property="oredCriteria[].criteriaWithoutValue" conjunction="and" >
          $oredCriteria[].criteriaWithoutValue[]$
        </iterate>
        <iterate prepend="and" property="oredCriteria[].criteriaWithSingleValue" conjunction="and" >
          $oredCriteria[].criteriaWithSingleValue[].condition$
            #oredCriteria[].criteriaWithSingleValue[].value#
        </iterate>
        <iterate prepend="and" property="oredCriteria[].criteriaWithListValue" conjunction="and" >
          $oredCriteria[].criteriaWithListValue[].condition$
          <iterate property="oredCriteria[].criteriaWithListValue[].values" open="(" close=")" conjunction="," >
            #oredCriteria[].criteriaWithListValue[].values[]#
          </iterate>
        </iterate>
        <iterate prepend="and" property="oredCriteria[].criteriaWithBetweenValue" conjunction="and" >
          $oredCriteria[].criteriaWithBetweenValue[].condition$
          #oredCriteria[].criteriaWithBetweenValue[].values[0]# and
          #oredCriteria[].criteriaWithBetweenValue[].values[1]#
        </iterate>
        )
      </isEqual>
    </iterate>
  </sql>
  
  <select id="ibatorgenerated_selectByExample" resultMap="ibatorgenerated_BaseResultMap3" parameterClass="com.kmzyc.promotion.app.vobject.ProductStockExample" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Mon Jul 29 10:50:35 CST 2013.
    -->
    select STOCK_ID, WAREHOUSE_ID, PRODUCT_ID, PRODUCT_NAME, PRODUCT_NO, SKU_ATTRIBUTE_ID,
      SKU_ATT_VALUE, STOCK_QUALITY, ORDER_QUALITY, IN_TRANSIT_QUALITY, ALARM_QUALITY, TOTAL_SALES,
      PRICE, MIN_DAY, MAX_DAY, ADJUST, REMARK  
    from PRODUCT_STOCK 
    <isParameterPresent >
      <include refid="PRODUCT_STOCK.ibatorgenerated_Example_Where_Clause" />
      <isNotNull property="orderByClause" >
        order by $orderByClause$
      </isNotNull>
    </isParameterPresent>
  </select>
  
  <select id="ibatorgenerated_countByExampleByProductTitle" parameterClass="com.kmzyc.promotion.app.vobject.ProductStockExample" resultClass="java.lang.Integer" >
    select count(STOCK_ID) from PRODUCT_STOCK PS, PRODUCTMAIN P WHERE PS.PRODUCT_ID=P.PRODUCT_ID 
    <isNotEmpty property="product.productTitle" prepend="and">
            P.PRODUCT_TITLE like '%'||#product.productTitle#||'%'
    </isNotEmpty>
    <isNotEmpty property="productNo" prepend="and">
            PS.PRODUCT_NO like '%'||#productNo#||'%'
    </isNotEmpty>
    <include refid="PRODUCT_STOCK.ibatorgenerated_Example_Where_Clause2" />
  </select>
  
  <select id="ibatorgenerated_selectByExampleByProductTitle" resultMap="ibatorgenerated_BaseResultMap3" parameterClass="com.kmzyc.promotion.app.vobject.ProductStockExample" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Mon Jul 29 10:50:35 CST 2013.
    -->
    select PS.STOCK_ID, PS.WAREHOUSE_ID, PS.PRODUCT_ID, PS.PRODUCT_NAME, PS.PRODUCT_NO, PS.SKU_ATTRIBUTE_ID,
      PS.SKU_ATT_VALUE, PS.STOCK_QUALITY, PS.ORDER_QUALITY, PS.IN_TRANSIT_QUALITY, PS.ALARM_QUALITY, PS.TOTAL_SALES,
      PS.PRICE, PS.MIN_DAY, PS.MAX_DAY, PS.ADJUST, PS.REMARK  
    from PRODUCT_STOCK PS , PRODUCTMAIN P WHERE PS.PRODUCT_ID=P.PRODUCT_ID 
    <isNotEmpty property="product.productTitle" prepend="and">
            P.PRODUCT_TITLE like '%'||#product.productTitle#||'%'
    </isNotEmpty>
    <isNotEmpty property="productNo" prepend="and">
            PS.PRODUCT_NO like '%'||#productNo#||'%'
    </isNotEmpty>
    <isParameterPresent >
      <include refid="PRODUCT_STOCK.ibatorgenerated_Example_Where_Clause2" />
      <isNotNull property="orderByClause" >
        order by $orderByClause$
      </isNotNull>
    </isParameterPresent>
  </select>
  
  <select id="ibatorgenerated_selectByExample2" resultMap="ibatorgenerated_BaseResultMap3" parameterClass="com.kmzyc.promotion.app.vobject.ProductStockExample" >
    
    select PS.STOCK_ID, PS.WAREHOUSE_ID, PS.PRODUCT_ID, PS.PRODUCT_NAME, PS.PRODUCT_NO, PS.SKU_ATTRIBUTE_ID,
      PS.SKU_ATT_VALUE, PS.STOCK_QUALITY, PS.ORDER_QUALITY, PS.IN_TRANSIT_QUALITY, PS.ALARM_QUALITY, PS.TOTAL_SALES,
      PS.PRICE, PS.MIN_DAY, PS.MAX_DAY, PS.ADJUST, PS.REMARK  
    from PRODUCT_STOCK PS,PRODUCTMAIN P  WHERE (PS.STOCK_QUALITY between PS.STOCK_QUALITY and PS.ALARM_QUALITY and PS.ALARM_QUALITY>0 or <![CDATA[PS.ORDER_QUALITY<0]]>) 
    and PS.PRODUCT_ID=P.PRODUCT_ID 
    <isNotEmpty property="product.productTitle" prepend="and">
            P.PRODUCT_TITLE like '%'||#product.productTitle#||'%'
    </isNotEmpty>
    <isNotEmpty property="productNo" prepend="and">
            PS.PRODUCT_NO like '%'||#productNo#||'%'
    </isNotEmpty>
    <isParameterPresent >
      <include refid="PRODUCT_STOCK.ibatorgenerated_Example_Where_Clause2" />
      <isNotNull property="orderByClause" >
        order by $orderByClause$
      </isNotNull>
    </isParameterPresent>
  </select>
  
   <select id="ibatorgenerated_selectByExampleByUser" resultMap="ibatorgenerated_BaseResultMap3" parameterClass="com.kmzyc.promotion.app.vobject.ProductStockExample" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Mon Jul 29 10:50:35 CST 2013.
    -->
    select STOCK_ID, WAREHOUSE_ID, PRODUCT_ID, PRODUCT_NAME, PRODUCT_NO, SKU_ATTRIBUTE_ID,
      SKU_ATT_VALUE, STOCK_QUALITY, ORDER_QUALITY, IN_TRANSIT_QUALITY, ALARM_QUALITY, TOTAL_SALES,
      PRICE, MIN_DAY, MAX_DAY, ADJUST, REMARK  
    from PRODUCT_STOCK  where 1 = 1
    <isParameterPresent >
      <include refid="PRODUCT_STOCK.ibatorgenerated_Example_Where_ClauseByUser" />
      <isNotNull property="orderByClause" >
        order by $orderByClause$
      </isNotNull>
    </isParameterPresent>
  </select>
  
  <select id="getProductListById" parameterClass="java.lang.Long" resultMap="ProductResultMap">
	 <![CDATA[
	 select PRODUCT_ID,PRODUCT_TITLE from PRODUCTMAIN where PRODUCT_ID = #value# 
	 ]]>
  	</select> 
  
  <select id="ibatorgenerated_selectByPrimaryKey" resultMap="ibatorgenerated_BaseResultMap" parameterClass="com.kmzyc.promotion.app.vobject.ProductStock" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Mon Jul 29 10:50:35 CST 2013.
    -->
    select STOCK_ID, WAREHOUSE_ID, PRODUCT_ID, PRODUCT_NAME, PRODUCT_NO, SKU_ATTRIBUTE_ID,
      SKU_ATT_VALUE, STOCK_QUALITY, ORDER_QUALITY, IN_TRANSIT_QUALITY, ALARM_QUALITY, TOTAL_SALES,
      PRICE, MIN_DAY, MAX_DAY, ADJUST, REMARK  
    from PRODUCT_STOCK
    where STOCK_ID = #stockId:DECIMAL#
  </select>
  <select id="ibatorgenerated_selectStockByStockId" resultMap="ibatorgenerated_BaseResultMap2" parameterClass="com.kmzyc.promotion.app.vobject.ProductStock" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Mon Jul 29 10:50:35 CST 2013.
    -->
    select ps.STOCK_ID,ps.WAREHOUSE_ID,ps.SKU_ATTRIBUTE_ID ,ps.SKU_ATT_VALUE,ps.STOCK_QUALITY,ps.ORDER_QUALITY  
    from PRODUCT_STOCK ps , PRODUCT_SKU sku 
    where ps.PRODUCT_ID = #productId:DECIMAL#  and ps.SKU_ATTRIBUTE_ID = sku.PRODUCT_SKU_ID and sku.STATUS = '1' 
  </select>
  <delete id="ibatorgenerated_deleteByPrimaryKey" parameterClass="com.kmzyc.promotion.app.vobject.ProductStock" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Mon Jul 29 10:50:35 CST 2013.
    -->
    delete from PRODUCT_STOCK
    where STOCK_ID = #stockId:DECIMAL#
  </delete>
  <delete id="ibatorgenerated_deleteByExample" parameterClass="com.kmzyc.promotion.app.vobject.ProductStockExample" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Mon Jul 29 10:50:35 CST 2013.
    -->
    delete from PRODUCT_STOCK
    <include refid="PRODUCT_STOCK.ibatorgenerated_Example_Where_Clause" />
  </delete>
  <insert id="ibatorgenerated_insert" parameterClass="com.kmzyc.promotion.app.vobject.ProductStock" >
    <selectKey resultClass="java.lang.Long" keyProperty="stockId" >
	      select SEQ_APP_PRODUCTSTOCK.nextval from dual
	</selectKey>
    insert into PRODUCT_STOCK
    <dynamic prepend="(" >
      <isNotNull prepend="," property="stockId" >
        STOCK_ID
      </isNotNull>
      <isNotNull prepend="," property="warehouseId" >
        WAREHOUSE_ID
      </isNotNull>
      <isNotNull prepend="," property="productId" >
        PRODUCT_ID
      </isNotNull>
      <isNotNull prepend="," property="productName" >
        PRODUCT_NAME
      </isNotNull>
      <isNotNull prepend="," property="productNo" >
        PRODUCT_NO
      </isNotNull>
      <isNotNull prepend="," property="skuAttributeId" >
        SKU_ATTRIBUTE_ID
      </isNotNull>
      <isNotNull prepend="," property="skuAttValue" >
        SKU_ATT_VALUE
      </isNotNull>
      <isNotNull prepend="," property="stockQuality" >
        STOCK_QUALITY
      </isNotNull>
      <isNotNull prepend="," property="orderQuality" >
        ORDER_QUALITY
      </isNotNull>
      <isNotNull prepend="," property="inTransitQuality" >
        IN_TRANSIT_QUALITY
      </isNotNull>
      <isNotNull prepend="," property="alarmQuality" >
        ALARM_QUALITY
      </isNotNull>
      <isNotNull prepend="," property="totalSales" >
        TOTAL_SALES
      </isNotNull>
      <isNotNull prepend="," property="price" >
        PRICE
      </isNotNull>
      <isNotNull prepend="," property="minDay" >
        MIN_DAY
      </isNotNull>
      <isNotNull prepend="," property="maxDay" >
        MAX_DAY
      </isNotNull>
      <isNotNull prepend="," property="adjust" >
        ADJUST
      </isNotNull>
      <isNotNull prepend="," property="remark" >
        REMARK
      </isNotNull>
      )
    </dynamic>
    values
    <dynamic prepend="(" >
      <isNotNull prepend="," property="stockId" >
        #stockId:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="warehouseId" >
        #warehouseId:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="productId" >
        #productId:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="productName" >
        #productName:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="productNo" >
        #productNo:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="skuAttributeId" >
        #skuAttributeId:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="skuAttValue" >
        #skuAttValue:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="stockQuality" >
        #stockQuality:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="orderQuality" >
        #orderQuality:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="inTransitQuality" >
        #inTransitQuality:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="alarmQuality" >
        #alarmQuality:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="totalSales" >
        #totalSales:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="price" >
        #price:BIGDECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="minDay" >
        #minDay:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="maxDay" >
        #maxDay:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="adjust" >
        #adjust:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="remark" >
        #remark:VARCHAR#
      </isNotNull>
      )
    </dynamic>
  </insert>
  <insert id="ibatorgenerated_insertSelective" parameterClass="com.kmzyc.promotion.app.vobject.ProductStock" >
   
    <selectKey resultClass="java.lang.Long" keyProperty="stockId" >
	      select SEQ_APP_PRODUCTSTOCK.nextval from dual
	</selectKey>
   
   
   
   
   
    insert into PRODUCT_STOCK
    <dynamic prepend="(" >
      <isNotNull prepend="," property="stockId" >
        STOCK_ID
      </isNotNull>
      <isNotNull prepend="," property="warehouseId" >
        WAREHOUSE_ID
      </isNotNull>
      <isNotNull prepend="," property="productId" >
        PRODUCT_ID
      </isNotNull>
      <isNotNull prepend="," property="productName" >
        PRODUCT_NAME
      </isNotNull>
      <isNotNull prepend="," property="productNo" >
        PRODUCT_NO
      </isNotNull>
      <isNotNull prepend="," property="skuAttributeId" >
        SKU_ATTRIBUTE_ID
      </isNotNull>
      <isNotNull prepend="," property="skuAttValue" >
        SKU_ATT_VALUE
      </isNotNull>
      <isNotNull prepend="," property="stockQuality" >
        STOCK_QUALITY
      </isNotNull>
      <isNotNull prepend="," property="orderQuality" >
        ORDER_QUALITY
      </isNotNull>
      <isNotNull prepend="," property="inTransitQuality" >
        IN_TRANSIT_QUALITY
      </isNotNull>
      <isNotNull prepend="," property="alarmQuality" >
        ALARM_QUALITY
      </isNotNull>
      <isNotNull prepend="," property="totalSales" >
        TOTAL_SALES
      </isNotNull>
      <isNotNull prepend="," property="price" >
        PRICE
      </isNotNull>
      <isNotNull prepend="," property="minDay" >
        MIN_DAY
      </isNotNull>
      <isNotNull prepend="," property="maxDay" >
        MAX_DAY
      </isNotNull>
      <isNotNull prepend="," property="adjust" >
        ADJUST
      </isNotNull>
      <isNotNull prepend="," property="remark" >
        REMARK
      </isNotNull>
      )
    </dynamic>
    values
    <dynamic prepend="(" >
      <isNotNull prepend="," property="stockId" >
        #stockId:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="warehouseId" >
        #warehouseId:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="productId" >
        #productId:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="productName" >
        #productName:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="productNo" >
        #productNo:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="skuAttributeId" >
        #skuAttributeId:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="skuAttValue" >
        #skuAttValue:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="stockQuality" >
        #stockQuality:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="orderQuality" >
        #orderQuality:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="inTransitQuality" >
        #inTransitQuality:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="alarmQuality" >
        #alarmQuality:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="totalSales" >
        #totalSales:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="price" >
        #price:BIGDECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="minDay" >
        #minDay:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="maxDay" >
        #maxDay:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="adjust" >
        #adjust:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="remark" >
        #remark:VARCHAR#
      </isNotNull>
      )
    </dynamic>
  </insert>
  <select id="ibatorgenerated_countByExample" parameterClass="com.kmzyc.promotion.app.vobject.ProductStockExample" resultClass="java.lang.Integer" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Mon Jul 29 10:50:35 CST 2013.
    -->
    select count(STOCK_ID) from PRODUCT_STOCK
    <include refid="PRODUCT_STOCK.ibatorgenerated_Example_Where_Clause" />
  </select>
  
  <select id="ibatorgenerated_countByExample2" parameterClass="com.kmzyc.promotion.app.vobject.ProductStockExample" resultClass="java.lang.Integer" >
    select count(PS.STOCK_ID) from PRODUCT_STOCK PS,PRODUCTMAIN P WHERE (PS.STOCK_QUALITY between PS.STOCK_QUALITY and PS.ALARM_QUALITY and PS.ALARM_QUALITY>0 or <![CDATA[PS.ORDER_QUALITY<0]]>) 
    and PS.PRODUCT_ID=P.PRODUCT_ID 
    <isNotEmpty property="product.productTitle" prepend="and">
            P.PRODUCT_TITLE like '%'||#product.productTitle#||'%'
    </isNotEmpty>
    <isNotEmpty property="productNo" prepend="and">
            PS.PRODUCT_NO like '%'||#productNo#||'%'
    </isNotEmpty>
    <include refid="PRODUCT_STOCK.ibatorgenerated_Example_Where_Clause2" />
  </select>
  
  <select id="ibatorgenerated_countByExampleByUser" parameterClass="com.kmzyc.promotion.app.vobject.ProductStockExample" resultClass="java.lang.Integer" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Mon Jul 29 10:50:35 CST 2013.
    -->
    select count(STOCK_ID) from PRODUCT_STOCK where product_id in (select p.PRODUCT_ID from PRODUCTMAIN p where 1 = 1
    <include refid="PRODUCT_STOCK.ibatorgenerated_Example_Where_ClauseByUser" />
  </select>
  <update id="ibatorgenerated_updateByExampleSelective" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Mon Jul 29 10:50:35 CST 2013.
    -->
    update PRODUCT_STOCK
    <dynamic prepend="set" >
      <isNotNull prepend="," property="record.stockId" >
        STOCK_ID = #record.stockId:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="record.warehouseId" >
        WAREHOUSE_ID = #record.warehouseId:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="record.productId" >
        PRODUCT_ID = #record.productId:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="record.productName" >
        PRODUCT_NAME = #record.productName:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.productNo" >
        PRODUCT_NO = #record.productNo:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.skuAttributeId" >
        SKU_ATTRIBUTE_ID = #record.skuAttributeId:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="record.skuAttValue" >
        SKU_ATT_VALUE = #record.skuAttValue:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.stockQuality" >
        STOCK_QUALITY = #record.stockQuality:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="record.orderQuality" >
        ORDER_QUALITY = #record.orderQuality:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="record.inTransitQuality" >
        IN_TRANSIT_QUALITY = #record.inTransitQuality:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="record.alarmQuality" >
        ALARM_QUALITY = #record.alarmQuality:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="record.totalSales" >
        TOTAL_SALES = #record.totalSales:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="record.price" >
        PRICE = #record.price:BIGDECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="record.minDay" >
        MIN_DAY = #record.minDay:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="record.maxDay" >
        MAX_DAY = #record.maxDay:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="record.adjust" >
        ADJUST = #record.adjust:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="record.remark" >
        REMARK = #record.remark:VARCHAR#
      </isNotNull>
    </dynamic>
    <isParameterPresent >
      <include refid="PRODUCT_STOCK.ibatorgenerated_Example_Where_Clause" />
    </isParameterPresent>
  </update>
  <update id="ibatorgenerated_updateByExample" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Mon Jul 29 10:50:35 CST 2013.
    -->
    update PRODUCT_STOCK
    set STOCK_ID = #record.stockId:DECIMAL#,
      WAREHOUSE_ID = #record.warehouseId:DECIMAL#,
      PRODUCT_ID = #record.productId:DECIMAL#,
      PRODUCT_NAME = #record.productName:VARCHAR#,
      PRODUCT_NO = #record.productNo:VARCHAR#,
      SKU_ATTRIBUTE_ID = #record.skuAttributeId:DECIMAL#,
      SKU_ATT_VALUE = #record.skuAttValue:VARCHAR#,
      STOCK_QUALITY = #record.stockQuality:DECIMAL#,
      ORDER_QUALITY = #record.orderQuality:DECIMAL#,
      IN_TRANSIT_QUALITY = #record.inTransitQuality:DECIMAL#,
      ALARM_QUALITY = #record.alarmQuality:DECIMAL#,
      TOTAL_SALES = #record.totalSales:DECIMAL#,
      PRICE = #record.price:BIGDECIMAL#,
      MIN_DAY = #record.minDay:DECIMAL#,
      MAX_DAY = #record.maxDay:DECIMAL#,
      ADJUST = #record.adjust:DECIMAL#,
      REMARK = #record.remark:VARCHAR# 
    <isParameterPresent >
      <include refid="PRODUCT_STOCK.ibatorgenerated_Example_Where_Clause" />
    </isParameterPresent>
  </update>
  
  <update id="increaseProductStock" parameterClass="com.kmzyc.promotion.app.vobject.ProductStock" >
  	update PRODUCT_STOCK set STOCK_QUALITY=STOCK_QUALITY+#stockQuality:DECIMAL# 
  	<dynamic prepend="where">
        <isNotNull property="warehouseId" prepend="and">
            WAREHOUSE_ID= #warehouseId:DECIMAL#
        </isNotNull>
        <isNotNull property="stockId" prepend="and">
            STOCK_ID = #stockId:DECIMAL#
        </isNotNull>              
        <isNotNull property="skuAttributeId" prepend="and">
            SKU_ATTRIBUTE_ID = #skuAttributeId:DECIMAL#
        </isNotNull>              
    </dynamic> 
  </update>
  
  
  <!-- 检查订单出库、换货出库是否符合出库条件 -->
  <select id="checkStockOutForOrder" parameterClass="java.util.ArrayList" resultMap="ibatorgenerated_BaseResultMap2">
  	select * from PRODUCT_STOCK where 1=1 
  	<dynamic prepend="AND">
   		<iterate open="(" close=")" conjunction=" OR ">
   			WAREHOUSE_ID = #stockList[].warehouseId# AND SKU_ATT_VALUE = #stockList[].skuAttValue# 
   			AND (#stockList[].stockQuality#>STOCK_QUALITY or #stockList[].stockQuality#>ORDER_QUALITY) 
   		</iterate>
   	</dynamic>
  </select>
  
  <!-- 检查其它出库是否符合出库条件 -->
  <select id="checkStockOutForOther" parameterClass="java.util.ArrayList" resultMap="ibatorgenerated_BaseResultMap2">
  	select * from PRODUCT_STOCK where 1=1 
  	<dynamic prepend="AND">
   		<iterate open="(" close=")" conjunction=" OR ">
   			WAREHOUSE_ID = #stockList[].warehouseId# AND SKU_ATT_VALUE = #stockList[].skuAttValue# 
   			AND (#stockList[].stockQuality#>STOCK_QUALITY or #stockList[].stockQuality#>(STOCK_QUALITY - ORDER_QUALITY)) 
   		</iterate>
   	</dynamic>
  </select>
  
  <update id="decreaseProductStockForOrder" parameterClass="com.kmzyc.promotion.app.vobject.ProductStock" >
  	update PRODUCT_STOCK set STOCK_QUALITY=STOCK_QUALITY-#stockQuality:DECIMAL#, ORDER_QUALITY = ORDER_QUALITY-#stockQuality:DECIMAL#
  	<dynamic prepend="where">
        <isNotNull property="warehouseId" prepend="and">
            WAREHOUSE_ID= #warehouseId:DECIMAL#
        </isNotNull>
        <isNotNull property="stockId" prepend="and">
            STOCK_ID = #stockId:DECIMAL#
        </isNotNull>              
        <isNotNull property="skuAttributeId" prepend="and">
            SKU_ATTRIBUTE_ID = #skuAttributeId:DECIMAL#
        </isNotNull>   
        <isNotNull property="stockQuality" prepend="and">
            (STOCK_QUALITY-#stockQuality:DECIMAL#)>=0 and (ORDER_QUALITY-#stockQuality:DECIMAL#)>=0 
        </isNotNull>   
    </dynamic> 
  </update>
  
  <update id="decreaseProductStockForOrder2" parameterClass="com.kmzyc.promotion.app.vobject.ProductStock" >
  	update PRODUCT_STOCK set STOCK_QUALITY=STOCK_QUALITY-#stockQuality:DECIMAL#, ORDER_QUALITY = ORDER_QUALITY-#stockQuality:DECIMAL#
  	<dynamic prepend="where">
        <isNotNull property="warehouseId" prepend="and">
            WAREHOUSE_ID= #warehouseId:DECIMAL#
        </isNotNull>
        <isNotNull property="stockId" prepend="and">
            STOCK_ID = #stockId:DECIMAL#
        </isNotNull>              
        <isNotNull property="skuAttributeId" prepend="and">
            SKU_ATTRIBUTE_ID = #skuAttributeId:DECIMAL#
        </isNotNull>   
    </dynamic> 
  </update>
  
  <update id="decreaseProductStock" parameterClass="com.kmzyc.promotion.app.vobject.ProductStock" >
  	update PRODUCT_STOCK set STOCK_QUALITY=STOCK_QUALITY-#stockQuality:DECIMAL# 
  	<dynamic prepend="where">
        <isNotNull property="warehouseId" prepend="and">
            WAREHOUSE_ID= #warehouseId:DECIMAL#
        </isNotNull>
        <isNotNull property="stockId" prepend="and">
            STOCK_ID = #stockId:DECIMAL#
        </isNotNull>              
        <isNotNull property="skuAttributeId" prepend="and">
            SKU_ATTRIBUTE_ID = #skuAttributeId:DECIMAL#
        </isNotNull>   
        <isNotNull property="stockQuality" prepend="and">
            (STOCK_QUALITY-#stockQuality:DECIMAL#) >= 0 and (STOCK_QUALITY - ORDER_QUALITY) >= #stockQuality:DECIMAL# 
        </isNotNull>   
    </dynamic> 
  </update>
  
  <update id="increaseInTransitQuantity" parameterClass="com.kmzyc.promotion.app.vobject.ProductStock" >
  	update PRODUCT_STOCK set IN_TRANSIT_QUALITY=IN_TRANSIT_QUALITY+#inTransitQuality:DECIMAL# 
  	<dynamic prepend="where">
        <isNotNull property="warehouseId" prepend="and">
            WAREHOUSE_ID= #warehouseId:DECIMAL#
        </isNotNull>
        <isNotNull property="stockId" prepend="and">
            STOCK_ID = #stockId:DECIMAL#
        </isNotNull>              
        <isNotNull property="skuAttributeId" prepend="and">
            SKU_ATTRIBUTE_ID = #skuAttributeId:DECIMAL#
        </isNotNull>              
    </dynamic> 
  </update>
  
  <update id="decreaseInTransitQuantity" parameterClass="com.kmzyc.promotion.app.vobject.ProductStock" >
  	update PRODUCT_STOCK set IN_TRANSIT_QUALITY=IN_TRANSIT_QUALITY-#inTransitQuality:DECIMAL# 
  	<dynamic prepend="where">
        <isNotNull property="warehouseId" prepend="and">
            WAREHOUSE_ID= #warehouseId:DECIMAL#
        </isNotNull>
        <isNotNull property="stockId" prepend="and">
            STOCK_ID = #stockId:DECIMAL#
        </isNotNull>              
        <isNotNull property="skuAttributeId" prepend="and">
            SKU_ATTRIBUTE_ID = #skuAttributeId:DECIMAL#
        </isNotNull>              
        <isNotNull property="inTransitQuality" prepend="and">
            (IN_TRANSIT_QUALITY-#inTransitQuality:DECIMAL#)>=0
        </isNotNull>              
    </dynamic> 
  </update>
  
  <update id="increaseOrderQuantity" parameterClass="com.kmzyc.promotion.app.vobject.ProductStock" >
  	update PRODUCT_STOCK set ORDER_QUALITY=ORDER_QUALITY+#orderQuality:DECIMAL# 
  	<dynamic prepend="where">
        <isNotNull property="warehouseId" prepend="and">
            WAREHOUSE_ID= #warehouseId:DECIMAL#
        </isNotNull>
        <isNotNull property="stockId" prepend="and">
            STOCK_ID = #stockId:DECIMAL#
        </isNotNull>              
        <isNotNull property="skuAttributeId" prepend="and">
            SKU_ATTRIBUTE_ID = #skuAttributeId:DECIMAL#
        </isNotNull>              
        <isNotNull property="orderQuality" prepend="and">
            STOCK_QUALITY>=ORDER_QUALITY+#orderQuality:DECIMAL# 
        </isNotNull>              
    </dynamic> 
  </update>
  
  <update id="batchIncreaseOrderQuantity" parameterClass="com.kmzyc.promotion.app.vobject.ProductStock" >
  	update PRODUCT_STOCK set ORDER_QUALITY=ORDER_QUALITY+#lockCount:DECIMAL# 
  	<dynamic prepend="where">
        <isNotNull property="warehouseId" prepend="and">
            WAREHOUSE_ID= #warehouseId:DECIMAL#
        </isNotNull>
        <isNotNull property="skuAttValue" prepend="and">
            SKU_ATT_VALUE = #skuAttValue:DECIMAL#
        </isNotNull>              
        <isNotNull property="lockCount" prepend="and">
            STOCK_QUALITY>=ORDER_QUALITY+#lockCount:DECIMAL# 
        </isNotNull>              
    </dynamic> 
  </update>
  
  <update id="batchIncreaseOrderQuantityForAfter" parameterClass="com.kmzyc.promotion.app.vobject.ProductStock" >
  	update PRODUCT_STOCK set ORDER_QUALITY=ORDER_QUALITY+#lockCount:DECIMAL# 
  	<dynamic prepend="where">
        <isNotNull property="warehouseId" prepend="and">
            WAREHOUSE_ID= #warehouseId:DECIMAL#
        </isNotNull>
        <isNotNull property="skuAttValue" prepend="and">
            SKU_ATT_VALUE = #skuAttValue:DECIMAL#
        </isNotNull>              
        <isNotNull property="lockCount" prepend="and">
            STOCK_QUALITY>=ORDER_QUALITY+#lockCount:DECIMAL# and STOCK_QUALITY>0 and ORDER_QUALITY>=0
        </isNotNull>              
    </dynamic> 
  </update>
  
  <update id="batchUpdatePromotionSell" parameterClass="com.kmzyc.promotion.app.vobject.ProductStock">
	update promotion_product pp
	set pp.promotion_sell = nvl(pp.promotion_sell,0) + #lockCount:DECIMAL# 
	where pp.PROMOTION_STOCK is not null
	and pp.PROMOTION_STOCK > 0
	and exists (select 1
		from promotion p
		where p.status = 2
		and sysdate between p.start_time and p.end_time
		and pp.promotion_id = p.promotion_id)
	and exists (select 1
		from product_sku ps
		where pp.product_sku_id = ps.product_sku_id  
		<isNotNull property="skuAttValue" prepend="and">
			ps.product_sku_code = #skuAttValue:DECIMAL#
		</isNotNull>  
		)
  </update>
  
   <update id="batchUnlockUpdatePromotionSell" parameterClass="com.kmzyc.promotion.app.vobject.ProductStock">
	update promotion_product pp
	set pp.promotion_sell = nvl(pp.promotion_sell,0) - #unLockCount:DECIMAL# 
	where pp.PROMOTION_STOCK is not null
	and pp.PROMOTION_STOCK > 0
	and nvl(pp.promotion_sell,0) - #unLockCount:DECIMAL# >= 0
	and exists (select 1
		from promotion p
		where p.status = 2
		and sysdate between p.start_time and p.end_time
		and pp.promotion_id = p.promotion_id)
	and exists (select 1
		from product_sku ps
		where pp.product_sku_id = ps.product_sku_id  
		<isNotNull property="skuAttValue" prepend="and">
			ps.product_sku_code = #skuAttValue:DECIMAL#
		</isNotNull>  
		)
  </update>
  
  <update id="batchDecreaseOrderQuantity" parameterClass="com.kmzyc.promotion.app.vobject.ProductStock" >
  	update PRODUCT_STOCK set ORDER_QUALITY=ORDER_QUALITY-#unLockCount:DECIMAL# 
  	<dynamic prepend="where">
        <isNotNull property="warehouseId" prepend="and">
            WAREHOUSE_ID= #warehouseId:DECIMAL#
        </isNotNull>
        <isNotNull property="skuAttValue" prepend="and">
            SKU_ATT_VALUE = #skuAttValue:DECIMAL#
        </isNotNull>              
        <isNotNull property="unLockCount" prepend="and">
            ORDER_QUALITY-#unLockCount:DECIMAL#>=0 
        </isNotNull>              
    </dynamic> 
  </update>
  
  <update id="decreaseOrderQuantity" parameterClass="com.kmzyc.promotion.app.vobject.ProductStock" >
  	update PRODUCT_STOCK set ORDER_QUALITY=ORDER_QUALITY-#orderQuality:DECIMAL# 
  	<dynamic prepend="where">
        <isNotNull property="warehouseId" prepend="and">
            WAREHOUSE_ID= #warehouseId:DECIMAL#
        </isNotNull>
        <isNotNull property="stockId" prepend="and">
            STOCK_ID = #stockId:DECIMAL#
        </isNotNull>              
        <isNotNull property="skuAttributeId" prepend="and">
            SKU_ATTRIBUTE_ID = #skuAttributeId:DECIMAL#
        </isNotNull>              
        <isNotNull property="orderQuality" prepend="and">
            (ORDER_QUALITY-#orderQuality:DECIMAL#)>=0
        </isNotNull>              
    </dynamic> 
  </update>
  
  <update id="ibatorgenerated_updateByPrimaryKeySelective" parameterClass="com.kmzyc.promotion.app.vobject.ProductStock" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Mon Jul 29 10:50:35 CST 2013.
    -->
    update PRODUCT_STOCK
    <dynamic prepend="set" >
      <isNotNull prepend="," property="warehouseId" >
        WAREHOUSE_ID = #warehouseId:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="productId" >
        PRODUCT_ID = #productId:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="productName" >
        PRODUCT_NAME = #productName:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="productNo" >
        PRODUCT_NO = #productNo:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="skuAttributeId" >
        SKU_ATTRIBUTE_ID = #skuAttributeId:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="skuAttValue" >
        SKU_ATT_VALUE = #skuAttValue:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="stockQuality" >
        STOCK_QUALITY = #stockQuality:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="orderQuality" >
        ORDER_QUALITY = #orderQuality:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="inTransitQuality" >
        IN_TRANSIT_QUALITY = #inTransitQuality:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="alarmQuality" >
        ALARM_QUALITY = #alarmQuality:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="totalSales" >
        TOTAL_SALES = #totalSales:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="price" >
        PRICE = #price:BIGDECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="minDay" >
        MIN_DAY = #minDay:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="maxDay" >
        MAX_DAY = #maxDay:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="adjust" >
        ADJUST = #adjust:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="remark" >
        REMARK = #remark:VARCHAR#
      </isNotNull>
    </dynamic>
    where STOCK_ID = #stockId:DECIMAL#  
  </update>
  <update id="ibatorgenerated_updateByPrimaryKeySelective2" parameterClass="com.kmzyc.promotion.app.vobject.ProductStock" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Mon Jul 29 10:50:35 CST 2013.
    -->
    update PRODUCT_STOCK
    <dynamic prepend="set" >
      <isNotNull prepend="," property="warehouseId" >
        WAREHOUSE_ID = #warehouseId:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="productId" >
        PRODUCT_ID = #productId:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="productName" >
        PRODUCT_NAME = #productName:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="productNo" >
        PRODUCT_NO = #productNo:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="skuAttributeId" >
        SKU_ATTRIBUTE_ID = #skuAttributeId:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="skuAttValue" >
        SKU_ATT_VALUE = #skuAttValue:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="stockQuality" >
        STOCK_QUALITY = #stockQuality:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="changeOrderQuatity" >
        ORDER_QUALITY = ORDER_QUALITY + #changeOrderQuatity:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="inTransitQuality" >
        IN_TRANSIT_QUALITY = #inTransitQuality:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="alarmQuality" >
        ALARM_QUALITY = #alarmQuality:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="totalSales" >
        TOTAL_SALES = #totalSales:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="price" >
        PRICE = #price:BIGDECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="minDay" >
        MIN_DAY = #minDay:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="maxDay" >
        MAX_DAY = #maxDay:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="adjust" >
        ADJUST = #adjust:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="remark" >
        REMARK = #remark:VARCHAR#
      </isNotNull>
    </dynamic>
    where STOCK_ID = #stockId:DECIMAL#  
  </update>
  <update id="ibatorgenerated_updateByPrimaryKey" parameterClass="com.kmzyc.promotion.app.vobject.ProductStock" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Mon Jul 29 10:50:35 CST 2013.
    -->
    update PRODUCT_STOCK
    set WAREHOUSE_ID = #warehouseId:DECIMAL#,
      PRODUCT_ID = #productId:DECIMAL#,
      PRODUCT_NAME = #productName:VARCHAR#,
      PRODUCT_NO = #productNo:VARCHAR#,
      SKU_ATTRIBUTE_ID = #skuAttributeId:DECIMAL#,
      SKU_ATT_VALUE = #skuAttValue:VARCHAR#,
      STOCK_QUALITY = #stockQuality:DECIMAL#,
      ORDER_QUALITY = #orderQuality:DECIMAL#,
      IN_TRANSIT_QUALITY = #inTransitQuality:DECIMAL#,
      ALARM_QUALITY = #alarmQuality:DECIMAL#,
      TOTAL_SALES = #totalSales:DECIMAL#,
      PRICE = #price:BIGDECIMAL#,
      MIN_DAY = #minDay:DECIMAL#,
      MAX_DAY = #maxDay:DECIMAL#,
      ADJUST = #adjust:DECIMAL#,
      REMARK = #remark:VARCHAR#  
    where STOCK_ID = #stockId:DECIMAL#
  </update>
  
  <!-- 远程接口，根据skuId,warehouseId查询库存数量 -->
  <select id="remoteSelectStockQuantity" resultMap="ibatorgenerated_BaseResultMap2"  parameterClass="java.util.ArrayList" >
    select STOCK_ID,WAREHOUSE_ID,SKU_ATTRIBUTE_ID,SKU_ATT_VALUE,STOCK_QUALITY,ORDER_QUALITY from PRODUCT_STOCK 
    	where 1=1 
    	<dynamic prepend="AND">
    		<iterate open="(" close=")" conjunction=" OR ">
    			WAREHOUSE_ID = #stockList[].warehouseId# AND SKU_ATT_VALUE = #stockList[].skuAttValue# 
    		</iterate>
    	</dynamic>
  </select>
  
  
  <select  id="selectProductStockList"      resultMap="ibatorgenerated_BaseResultMap2"    parameterClass="java.util.ArrayList" >
  select STOCK_ID,WAREHOUSE_ID,SKU_ATTRIBUTE_ID,SKU_ATT_VALUE,STOCK_QUALITY,ORDER_QUALITY from PRODUCT_STOCK 
    	where 1=1 
    	<dynamic prepend="AND">
    		<iterate open="(" close=")" conjunction=" OR ">
    			WAREHOUSE_ID = #stockList[].warehouseId# AND SKU_ATTRIBUTE_ID = #stockList[].skuAttributeId# 
    		</iterate>
    	</dynamic>
  </select>
  
  <!-- 根据仓库ID和产品skuCode查找库存信息 -->
  <select  id="findListByWareIdSkuCode" parameterClass="java.util.ArrayList" resultMap="ibatorgenerated_BaseResultMap" >
    SELECT STOCK_ID, WAREHOUSE_ID, PRODUCT_ID, PRODUCT_NAME, PRODUCT_NO, SKU_ATTRIBUTE_ID,
      SKU_ATT_VALUE, STOCK_QUALITY, ORDER_QUALITY, IN_TRANSIT_QUALITY, ALARM_QUALITY, TOTAL_SALES,
      PRICE, MIN_DAY, MAX_DAY, ADJUST, REMARK     
   FROM PRODUCT_STOCK 
    	<dynamic prepend="where">
    		<iterate open="(" close=")" conjunction=" OR ">
    			WAREHOUSE_ID = #caOutDetailVOs[].warehouseId# AND SKU_ATT_VALUE = #caOutDetailVOs[].skuCode# 
    		</iterate>
    	</dynamic>
  </select>
  
  <select  id="selectProdcutStockListByStockList" resultMap="ibatorgenerated_BaseResultMap"    parameterClass="java.util.ArrayList" >
  select * from PRODUCT_STOCK 
    	where 1=1 
    	<dynamic prepend="AND">
    		<iterate open="(" close=")" conjunction=" OR ">
    			WAREHOUSE_ID = #stockList[].warehouseId:DECIMAL# AND SKU_ATTRIBUTE_ID = #stockList[].skuAttributeId:DECIMAL# 
    		</iterate>
    	</dynamic>
  </select>
  
  <select  id="findStockIdMapByWarehouseAndSkuId" resultMap="stockOutdetail_resultMap"    parameterClass="java.util.ArrayList" >
  select so.STOCK_OUT_ID,so.STOCK_OUT_NO,so.WAREHOUSE_ID,so.STATUS,so.type,sod.DETAIL_ID,ps.STOCK_ID,sod.PRODUCT_SKU_ID,sod.PRODUCT_SKU_VALUE,sod.QUANTITY from product_stock ps,STOCK_OUT so,Stock_Out_Detail sod 
  where so.STOCK_OUT_ID=sod.STOCK_OUT_ID and ps.warehouse_id = so.warehouse_id and ps.sku_attribute_id = sod.PRODUCT_SKU_ID
    	<dynamic prepend="AND">
    		<iterate open="(" close=")" conjunction=" OR ">
    			ps.WAREHOUSE_ID = #detailList[].warehouseId:DECIMAL# AND ps.SKU_ATTRIBUTE_ID = #detailList[].productSkuId:DECIMAL# 
    		</iterate>
    	</dynamic>
  </select>
  
  <select id="findProductStockByWareAndSkuId" resultClass="com.kmzyc.promotion.app.vobject.ProductStock"  parameterClass="java.util.Map" >
      SELECT STOCK_ID stockId, WAREHOUSE_ID warehouseId, PRODUCT_ID productId, PRODUCT_NAME productName
      , PRODUCT_NO productNo, SKU_ATTRIBUTE_ID skuAttributeId
      ,	SKU_ATT_VALUE skuAttValue, STOCK_QUALITY stockQuality, ORDER_QUALITY orderQuality
      	, IN_TRANSIT_QUALITY inTransitQuality , ALARM_QUALITY alarmQuality, TOTAL_SALES totalSales
      	,PRICE, MIN_DAY minDay, MAX_DAY maxDay, ADJUST, REMARK 
    FROM PRODUCT_STOCK
    	WHERE  
		WAREHOUSE_ID = #warehouseId:DECIMAL# AND SKU_ATTRIBUTE_ID = #productSkuId:DECIMAL#  
  </select>
  
  <!-- 根据仓库id集合查找库存集合(检测停用仓库是否已经关联库存) -->
  <select id="checkStockByWarehouseList" resultClass="java.lang.Long" parameterClass="java.util.ArrayList">
  	 select count(STOCK_ID) from PRODUCT_STOCK 
    	where 1=1 
    	<dynamic prepend="AND">
    		<iterate open="(" close=")" conjunction=" OR ">
    			WAREHOUSE_ID = #stockList[].warehouseId# 
    		</iterate>
    	</dynamic>
  </select>
  
  
  
   <update id="increaseProductStockAndDecreaseIntransitQuantity" parameterClass="com.kmzyc.promotion.app.vobject.ProductStock" >
  	update PRODUCT_STOCK set STOCK_QUALITY=STOCK_QUALITY+#stockQuality:DECIMAL# , in_transit_quality=in_transit_quality-#stockQuality:DECIMAL#
  	<dynamic prepend="where">
        <isNotNull property="warehouseId" prepend="and">
            WAREHOUSE_ID= #warehouseId:DECIMAL#
        </isNotNull>
        <isNotNull property="stockId" prepend="and">
            STOCK_ID = #stockId:DECIMAL#
        </isNotNull>              
        <isNotNull property="skuAttributeId" prepend="and">
            SKU_ATTRIBUTE_ID = #skuAttributeId:DECIMAL#
        </isNotNull>              
    </dynamic> 
  </update>
  
  
     <update id="increaseProductStockAndAddIntransitQuantity" parameterClass="com.kmzyc.promotion.app.vobject.ProductStockPurchase" >
  	update PRODUCT_STOCK set STOCK_QUALITY=STOCK_QUALITY+#stockQuality:DECIMAL# , in_transit_quality=in_transit_quality+#inTransitQuality:DECIMAL#
  	<dynamic prepend="where">
        <isNotNull property="warehouseId" prepend="and">
            WAREHOUSE_ID= #warehouseId:DECIMAL#
        </isNotNull>
        <isNotNull property="stockId" prepend="and">
            STOCK_ID = #stockId:DECIMAL#
        </isNotNull>              
        <isNotNull property="skuAttributeId" prepend="and">
            SKU_ATTRIBUTE_ID = #skuAttributeId:DECIMAL#
        </isNotNull>              
    </dynamic> 
  </update>
  
  
    <!-- 根据skuId 查询出对应的剩余数量 -->
  <select id="selectRemainQuantity" resultClass="java.lang.Integer" parameterClass="java.lang.Long">
  	 select  sum(p.stock_quality-order_quality)    from product_stock   p where  p.sku_attribute_id=#skuId:LONG#
  </select>
  
  <select id="selectStockListBySkuId" resultMap="ibatorgenerated_BaseResultMap2" parameterClass="java.lang.Long">
  	select * from PRODUCT_STOCK where SKU_ATTRIBUTE_ID=#skuId# 
  </select>
  
  <!-- 查看锁库存的sku是否符合条件（不符合条件的：锁库存数量>可用库存量） -->
  <select id="checkAvailableStockForLock" parameterClass="java.util.List" resultMap="ibatorgenerated_BaseResultMap2">
  	select * from PRODUCT_STOCK where 1=1 
  	<dynamic prepend="AND">
   		<iterate open="(" close=")" conjunction=" OR ">
   			WAREHOUSE_ID = #stockList[].warehouseId# AND SKU_ATT_VALUE = #stockList[].skuAttValue# 
   			AND #stockList[].lockCount#>(STOCK_QUALITY-ORDER_QUALITY) 
   		</iterate>
   	</dynamic>
  	
  </select>
  
  <!-- 售后查看锁库存的sku是否符合条件（不符合条件的：锁库存数量>可用库存量） -->
  <select id="checkAvailableStockForLockForAfter" parameterClass="java.util.List" resultMap="ibatorgenerated_BaseResultMap2">
  	
  	select * from PRODUCT_STOCK where 1=1 
  	<dynamic prepend="AND">
   		<iterate open="(" close=")" conjunction=" OR ">
   			 <![CDATA[ WAREHOUSE_ID = #stockList[].warehouseId# AND SKU_ATT_VALUE = #stockList[].skuAttValue# 
   			AND (#stockList[].lockCount#>(STOCK_QUALITY-ORDER_QUALITY) or STOCK_QUALITY<=0 or ORDER_QUALITY<0)  ]]>
   		</iterate>
   	</dynamic>
  	
  </select>
  
  <!-- 查看解锁库存的sku是否符合条件（不符合条件的：订购数量-解锁库存数量<0） -->
  <select id="checkAvailableStockForUnLock" parameterClass="java.util.List" resultMap="ibatorgenerated_BaseResultMap2">
  	select * from PRODUCT_STOCK where 1=1 
  	<dynamic prepend="AND">
   		<iterate open="(" close=")" conjunction=" OR ">
   			WAREHOUSE_ID = #stockList[].warehouseId# AND SKU_ATT_VALUE = #stockList[].skuAttValue# 
   			AND #stockList[].unLockCount#>ORDER_QUALITY  
   		</iterate>
   	</dynamic>
  </select>
  
  <select id="queryRealStockBySkuId" parameterClass="java.lang.Long" resultClass="java.lang.Long">
	select WAREHOUSE_ID from ( select
		WAREHOUSE_ID,sum(STOCK_QUALITY)
		stock_quality from product_stock
		where
		SKU_ATTRIBUTE_ID=#productSkuId# group by WAREHOUSE_ID order by
		stock_quality desc
		) where rownum =1
  </select>
  
  <!-- 查看同一仓库中是否已存在相同SKU的库存数据 -->
  <select  id="getProductStockCount"  resultClass="java.lang.Integer"    parameterClass="java.util.ArrayList" >
  select COUNT(STOCK_ID) from PRODUCT_STOCK 
    	where 1=1 
    	<dynamic prepend="AND">
    		<iterate open="(" close=")" conjunction=" OR ">
    			WAREHOUSE_ID = #stockList[].warehouseId# AND SKU_ATTRIBUTE_ID = #stockList[].skuAttributeId# 
    		</iterate>
    	</dynamic>
  </select>
  
    <!-- 获取库存列表 -->
  <select id="getProductStockList" parameterClass="java.util.List" resultMap="ibatorgenerated_BaseResultMap2">
  	select * from PRODUCT_STOCK where 1=1 
  	<dynamic prepend="AND">
   		<iterate open="(" close=")" conjunction=" OR ">
   			WAREHOUSE_ID = #stockList[].warehouseId# AND SKU_ATT_VALUE = #stockList[].skuAttValue# 
   		</iterate>
   	</dynamic>
  	
  </select>
  
</sqlMap>