<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="PRODUCT_SKU_DRAFT" >
	<typeAlias alias="Product" type="com.pltfm.app.vobject.Product"/>
	<typeAlias alias="ProductSku" type="com.pltfm.app.vobject.ProductSku"/>
  <resultMap id="searchPageByVoMap" class="com.pltfm.app.vobject.ProductSku" >
    <!-- 
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Thu Aug 01 14:37:11 CST 2013.
    -->
    <result column="PRODUCT_SKU_ID" property="productSkuId" jdbcType="DECIMAL" />
    <result column="PRODUCT_SKU_CODE" property="productSkuCode" jdbcType="VARCHAR" />
    <result column="PROCUCT_NAME" property="productName" jdbcType="VARCHAR"/>
    <result column="STATUS" property="status" jdbcType="CHAR" />
    <result column="UNIT_WEIGHT" property="unitWeight" jdbcType="DECIMAL" />
    <result column="MARK_PRICE" property="markPrice" jdbcType="DECIMAL" />
  </resultMap>
  
   <resultMap id="skuIdAndCode" class="com.pltfm.app.vobject.ProductSku" >
    <result column="PRODUCT_SKU_ID" property="productSkuId" jdbcType="LONG" />
        <result column="PRODUCT_ID" property="productId" jdbcType="DECIMAL"/>
    <result column="PRODUCT_SKU_CODE" property="productSkuCode" jdbcType="VARCHAR" />
  </resultMap>
  
  <resultMap id="ibatorgenerated_BaseResultMap_NewAttr" class="com.pltfm.app.vobject.ProductSkuAttrDraft">
    <result column="NEW_ATTR" property="newAttr" jdbcType="VARCHAR" />
    <result column="CATEGORY_ATTR_ID" property="categoryAttrId" jdbcType="DECIMAL" />
  </resultMap>
  
  
  <resultMap id="ibatorgenerated_BaseResultMap" class="com.pltfm.app.vobject.ProductSkuDraft" >
    <!-- 
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Thu Aug 01 14:37:11 CST 2013.
    -->
    <result column="PRODUCT_SKU_ID" property="productSkuId" jdbcType="DECIMAL" />
    <result column="PRODUCT_ID" property="productId" jdbcType="DECIMAL"/>
    <result column="PRICE" property="price" jdbcType="DOUBLE" />
    <result column="PRODUCT_SKU_CODE" property="productSkuCode" jdbcType="VARCHAR" />
    <result column="STATUS" property="status" jdbcType="CHAR" />
    <result column="UNIT_WEIGHT" property="unitWeight" jdbcType="DECIMAL" />
	<result column="MARK_PRICE" property="markPrice" jdbcType="DECIMAL" />
  </resultMap>
  
  <!-- SKU查找产品信息 -->
  <resultMap id="ProductResultMap" class="com.pltfm.app.vobject.Product" >
    <result column="PRODUCT_ID" property="id" jdbcType="DECIMAL" />
    <result column="CATEGORY_ID" property="categoryId" jdbcType="DECIMAL" />
    <result column="PROCUCT_NAME" property="name" jdbcType="VARCHAR" />
    <result column="PRODUCT_DESC" property="productDesc" jdbcType="VARCHAR" />
    <result column="PACK_LISTING" property="packListing" jdbcType="VARCHAR" />
    <result column="PRODUCT_TITLE" property="productTitle" jdbcType="VARCHAR" />
    <result column="KEYWORD" property="keyword" jdbcType="VARCHAR" />
    <result column="STATUS" property="status" jdbcType="VARCHAR" />
    <result column="CREATE_USER" property="createUser" jdbcType="INTEGER" />
    <result column="CREATE_USER_NAME" property="createUserName" jdbcType="VARCHAR" />
    <result column="CREATE_TIME" property="createTime" jdbcType="Date" />
    <result column="PRODUCTHOT" property="productHot" jdbcType="DECIMAL" />
    <result column="ARCHIVE_TIME" property="archiveTime" jdbcType="Date" />
    <result column="CHECK_USER" property="checkUser" jdbcType="INTEGER" />
    <result column="CHECK_USER_NAME" property="checkUserName" jdbcType="VARCHAR" />
    <result column="CHECK_TIME" property="checkTime" jdbcType="Date" />
    <result column="MODIF_TIME" property="modifTime" jdbcType="Date" />
    <result column="SHOP_CODE" property="shopCode" jdbcType="VARCHAR" />
    <result column="MODIF_USER" property="modifUser" jdbcType="INTEGER" />
    <result column="UP_TIME" property="upTime" jdbcType="Date" />
    <result column="MARKET_PRICE"  property="marketPrice" jdbcType="BigDecimal"/>
    <result column="COST_PRICE"  property="costPrice" jdbcType="BigDecimal"/>
    <result column="PRODUCT_NO" property="productNo" jdbcType="VARCHAR" />
    <result column="BRAND_ID" property="brandId" jdbcType="DECIMAL" />
    <result column="BRAND_NAME" property="brandName" jdbcType="VARCHAR" />
    <result column="APPROVAL_TYPE" property="approvalType" jdbcType="VARCHAR" />
    <result column="APPROVAL_NO" property="approvalNo" jdbcType="VARCHAR" />
    <result column="CATEGORY_NAME" property="categoryName" jdbcType="VARCHAR" />
  </resultMap>
  
  <resultMap id="ibatorgenerated_BaseResultMap_SKUATTR" class="com.pltfm.app.vobject.ViewProductSku" >
    <result column="PRODUCT_ID" property="productId" jdbcType="DECIMAL" />
    <result column="PRODUCT_NAME" property="procuctName" jdbcType="VARCHAR" />
    <result column="PRODUCT_NO" property="productNo" jdbcType="VARCHAR" />
    <result column="STATUS" property="status" jdbcType="VARCHAR" />
    <result column="PRODUCT_SKU_ID" property="productSkuId" jdbcType="DECIMAL" />
    <result column="PRODUCT_SKU_CODE" property="productSkuCode" jdbcType="VARCHAR" />
 	<result column="PRODUCT_SKU_ID" property="viewSkuAttrs" select="PRODUCT_SKU_DRAFT.querySKUAttr" />
  	<result column="PRICE" property="price" jdbcType="DOUBLE" />
  	<result column="unit_weight" property="unitWeight" jdbcType="DOUBLE" />
  	<result column="MARK_PRICE" property="markPrice" jdbcType="DOUBLE" />
  </resultMap>
  
  <resultMap id="skuAttrValue" class="com.pltfm.app.vobject.ViewSkuAttr" >
    <result column="CATEGORY_ATTR_NAME" property="categoryAttrName" jdbcType="VARCHAR" />
    <result column="CATEGORY_ATTR_VALUE" property="categoryAttrValue" jdbcType="VARCHAR" />
  </resultMap>
  
    <resultMap id="productSkuMap" class="com.pltfm.app.vobject.ProductSkuDraft" groupBy="productSkuId" >
	    <result column="PRODUCT_SKU_ID" property="productSkuId" jdbcType="DECIMAL" />
	    <result column="PRODUCT_ID" property="productId" jdbcType="DECIMAL" />
	    <result column="PRODUCT_NO" property="productNo" jdbcType="VARCHAR" />
	    <result column="PRODUCT_TITLE" property="productTitle" jdbcType="VARCHAR" />
	    <result column="PRODUCT_SKU_CODE" property="productSkuCode" jdbcType="VARCHAR" />
	    <result column="STATUS" property="status" jdbcType="CHAR" />
	    <result column="OP_TYPE" property="opType" jdbcType="DECIMAL" />
	    <result column="SKU_INTRODUCE" property="skuIntroduce" jdbcType="VARCHAR" />
    	<result column="SKU_INTRODUCELAZY" property="skuIntroduceLazy" jdbcType="VARCHAR" />
	    <result property="attributeValues" resultMap="PRODUCT_SKU_DRAFT.attributeValue" />
   </resultMap>
   
  <resultMap id="attributeValue" class="com.kmzyc.supplier.vo.AttributeValue">
    <result column="CATEGORY_ATTR_NAME" property="attribute" jdbcType="VARCHAR" />
    <result column="CATEGORY_ATTR_VALUE" property="value" jdbcType="VARCHAR" />
  </resultMap>
  
  <sql id="ibatorgenerated_Example_Where_Clause" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Thu Aug 01 14:37:11 CST 2013.
    -->
    <iterate property="oredCriteria" conjunction="or" prepend="where" removeFirstPrepend="iterate" >
      <isEqual property="oredCriteria[].valid" compareValue="true" >
        (
        <iterate prepend="and" property="oredCriteria[].criteriaWithoutValue" conjunction="and" >
          $oredCriteria[].criteriaWithoutValue[]$
        </iterate>
        <iterate prepend="and" property="oredCriteria[].criteriaWithSingleValue" conjunction="and" >
          $oredCriteria[].criteriaWithSingleValue[].condition$
            #oredCriteria[].criteriaWithSingleValue[].value#
        </iterate>
        <iterate prepend="and" property="oredCriteria[].criteriaWithListValue" conjunction="and" >
          $oredCriteria[].criteriaWithListValue[].condition$
          <iterate property="oredCriteria[].criteriaWithListValue[].values" open="(" close=")" conjunction="," >
            #oredCriteria[].criteriaWithListValue[].values[]#
          </iterate>
        </iterate>
        <iterate prepend="and" property="oredCriteria[].criteriaWithBetweenValue" conjunction="and" >
          $oredCriteria[].criteriaWithBetweenValue[].condition$
          #oredCriteria[].criteriaWithBetweenValue[].values[0]# and
          #oredCriteria[].criteriaWithBetweenValue[].values[1]#
        </iterate>
        )
      </isEqual>
    </iterate>
  </sql>
  <select id="ibatorgenerated_selectByExample" resultMap="ibatorgenerated_BaseResultMap" parameterClass="com.pltfm.app.vobject.ProductSkuExample" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Thu Aug 01 14:37:11 CST 2013.
    -->
    select PRODUCT_SKU_ID, PRODUCT_ID, PRICE, PRODUCT_SKU_CODE,STATUS,UNIT_WEIGHT,MARK_PRICE

    from PRODUCT_SKU_DRAFT
    <isParameterPresent >
      <include refid="PRODUCT_SKU.ibatorgenerated_Example_Where_Clause" />
      <isNotNull property="orderByClause" >
        order by $orderByClause$
      </isNotNull>
    </isParameterPresent>
  </select>
  
    <select id="ibatorgenerated_selectByExample2" resultMap="ibatorgenerated_BaseResultMap" parameterClass="com.pltfm.app.vobject.ProductSkuDraftExample" >
	    select PRODUCT_SKU_ID, PRODUCT_ID, PRODUCT_SKU_CODE, MARK_PRICE, PRICE, UNIT_WEIGHT, STATUS,
	      OP_TYPE, REASONS
	    from PRODUCT_SKU_DRAFT
	    <isParameterPresent >
	      <include refid="PRODUCT_SKU_DRAFT.ibatorgenerated_Example_Where_Clause" />
	      <isNotNull property="orderByClause" >
	        order by $orderByClause$
	      </isNotNull>
	    </isParameterPresent>
  </select>
  
  <!-- 商品发布SKU列表记录数 -->
	<select id="selectCountForProductSkuByMerchantId" resultClass="java.lang.Integer" parameterClass="pagination">
           <![CDATA[
          SELECT COUNT(PRODUCT_SKU_ID) FROM (SELECT t.*, ROWNUM RN FROM (select * from (select a.product_id,a.product_name,a.product_no,a.status,a.category_id,a.category_name,a.shop_code,
       b.product_sku_id,b.product_sku_code,b.price,b.status as sku_status,b.unit_weight,b.mark_price
from product_draft a ,product_sku_draft b where a.product_id = b.product_id)  
		]]>
		<dynamic prepend="WHERE">
			 <![CDATA[
					  SHOP_CODE = #objCondition.supplierId:VARCHAR# 
				]]>
		</dynamic>
		<dynamic prepend="AND">
			<isNotEmpty property="objCondition.productName">
            <![CDATA[
					PRODUCT_NAME like '%'||#objCondition.productName:VARCHAR#||'%' 
				]]>
			</isNotEmpty>
		</dynamic>
		<dynamic prepend="AND">
			<isNotEmpty property="objCondition.productNo">
            <![CDATA[
					PRODUCT_NO like '%'||#objCondition.productNo:VARCHAR#||'%' 
				]]>
			</isNotEmpty>
		</dynamic>
		<dynamic prepend="AND">
			<isNotEmpty property="objCondition.productSkuCode">
            <![CDATA[
					PRODUCT_SKU_CODE like '%'||#objCondition.productSkuCode:VARCHAR#||'%' 
				]]>
			</isNotEmpty>
		</dynamic>
		<dynamic prepend="AND">
			<isNotEmpty property="objCondition.status">
            <![CDATA[
					STATUS = #objCondition.status:VARCHAR# 
				]]>
			</isNotEmpty>
		</dynamic>
		<dynamic prepend="AND">
			<isNotEmpty property="objCondition.skuStatus">
            <![CDATA[
					sku_status = #objCondition.skuStatus:VARCHAR# 
				]]>
			</isNotEmpty>
		</dynamic>
		<![CDATA[
		) t )  
		]]>
	</select>
	
	<!-- 商品发布SKU列表 -->
	<select id="selectProductSkuListByMerchantId" resultMap="ibatorgenerated_BaseResultMap_SKUATTR" parameterClass="pagination">
           <![CDATA[
          SELECT * FROM (SELECT t.*, ROWNUM RN FROM (select * from (select a.product_id,a.product_name,a.product_no,a.status,a.category_id,a.category_name,a.shop_code,
       b.product_sku_id,b.product_sku_code,b.price,b.status as sku_status,b.unit_weight,b.mark_price
from product_draft a ,product_sku_draft b where a.product_id = b.product_id)  WHERE 1=1
		]]>
		<dynamic prepend="AND">
			 <![CDATA[
					  SHOP_CODE = #objCondition.supplierId:VARCHAR#
				]]>
		</dynamic>
		<dynamic prepend="AND">
			<isNotEmpty property="objCondition.productName">
            <![CDATA[
					PRODUCT_NAME like '%'||#objCondition.productName:VARCHAR#||'%' 
				]]>
			</isNotEmpty>
		</dynamic>
		<dynamic prepend="AND">
			<isNotEmpty property="objCondition.productNo">
            <![CDATA[
					PRODUCT_NO like '%'||#objCondition.productNo:VARCHAR#||'%' 
				]]>
			</isNotEmpty>
		</dynamic>
		<dynamic prepend="AND">
			<isNotEmpty property="objCondition.productSkuCode">
            <![CDATA[
					PRODUCT_SKU_CODE like '%'||#objCondition.productSkuCode:VARCHAR#||'%' 
				]]>
			</isNotEmpty>
		</dynamic>
		<dynamic prepend="AND">
			<isNotEmpty property="objCondition.status">
            <![CDATA[
					STATUS = #objCondition.status:VARCHAR# 
				]]>
			</isNotEmpty>
		</dynamic>
		<dynamic prepend="AND">
			<isNotEmpty property="objCondition.skuStatus">
            <![CDATA[
					sku_status = #objCondition.skuStatus:VARCHAR# 
				]]>
			</isNotEmpty>
		</dynamic>
		<![CDATA[
		ORDER BY PRODUCT_ID,PRODUCT_SKU_ID DESC ) t 
		WHERE  ROWNUM <= $endindex$ ) WHERE RN >= #startindex# 
		]]>
	</select>
  
  <select id="querySKUAttr" parameterClass="int" resultMap="skuAttrValue">  
    select ca.category_attr_name,cav.category_attr_value from PRODUCT_SKU_ATTR_DRAFT t,category_attr ca,category_attr_value cav where t.category_attr_id = ca.category_attr_id and t.category_attr_value_id = cav.category_attr_value_id
 	and PRODUCT_SKU_ID = #productSkuId#
  </select> 
  
  <select id="findSingleSkuAndAttrValue" resultMap="productSkuMap" parameterClass="java.lang.Long" >
	select pd.product_id,
	       pd.product_title,
	       pd.product_no,
	       psd.product_sku_id,
	       psd.product_sku_code,
	       psd.SKU_INTRODUCE,
	       psd.SKU_INTRODUCELAZY,
	       psd.status,
	       psd.op_type,
	       ca.category_attr_name,
	       nvl(cav.category_attr_value,psa.new_attr) category_attr_value
	  from product_draft          pd,
	       product_sku_draft      psd,
	       product_sku_attr_draft psa,
	       category_attr          ca,
	       category_attr_value    cav
	 where pd.product_id = psd.product_id(+)
	   and psd.product_sku_id = psa.product_sku_id(+)
	   and psa.category_attr_id = ca.category_attr_id(+)
	   and psa.category_attr_value_id = cav.category_attr_value_id(+)
	   and psd.product_sku_id = #productSkuId#
	   order by cav.category_attr_id
  </select>
  
  <select id="findSkuNewAttr" parameterClass="java.lang.Long" resultMap="ibatorgenerated_BaseResultMap_NewAttr" >
  	select PSAD.NEW_ATTR,PSAD.CATEGORY_ATTR_ID
    from PRODUCT_SKU_ATTR_DRAFT PSAD,PRODUCT_SKU_DRAFT PS 
      where PSAD.PRODUCT_SKU_ID = PS.PRODUCT_SKU_ID
      	and PSAD.NEW_ATTR IS NOT NULL 
        and PS.PRODUCT_ID = #productId:DECIMAL#         
        order by PSAD.CATEGORY_ATTR_ID,PSAD.PRODUCT_SKU_ATTR_ID
  </select>
  
</sqlMap>