<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="KMORDER_ORDER_MAIN" >
  <resultMap id="ibatorgenerated_BaseResultMap" class="com.pltfm.app.entities.OrderMain" >
    <result column="ORDER_ID" property="orderId" jdbcType="DECIMAL" />
    <result column="CUSTOMER_ACCOUNT" property="customerAccount" jdbcType="VARCHAR" />
    <result column="CUSTOMER_NAME" property="customerName" jdbcType="VARCHAR" />
    <result column="CUSTOMER_MOBILE" property="customerMobile" jdbcType="VARCHAR" />
    <result column="ORDER_PURCHASER_NAME" property="orderPurchaserName" jdbcType="VARCHAR" />
    <result column="ORDER_PURCHASER_MOBILE" property="orderPurchaserMobile" jdbcType="VARCHAR" />
    <result column="ORDER_PURCHASER_TEL" property="orderPurchaserTel" jdbcType="VARCHAR" />
    <result column="ORDER_PURCHASER_ADDR" property="orderPurchaserAddr" jdbcType="VARCHAR" />
    <result column="ORDER_PURCHASER_TYPE" property="orderPurchaserType" jdbcType="DECIMAL" />
    <result column="CONSIGNEE_NAME" property="consigneeName" jdbcType="VARCHAR" />
    <result column="CONSIGNEE_MOBILE" property="consigneeMobile" jdbcType="VARCHAR" />
    <result column="CONSIGNEE_TEL" property="consigneeTel" jdbcType="VARCHAR" />
    <result column="CONSIGNEE_ADDR" property="consigneeAddr" jdbcType="VARCHAR" />
    <result column="PAY_METHOD" property="payMethod" jdbcType="DECIMAL" />
    <result column="FARE" property="fare" jdbcType="DECIMAL" />
    <result column="DELIVERY_DATE_TYPE" property="deliveryDateType" jdbcType="DECIMAL" />
    <result column="COMMODITY_SUM" property="commoditySum" jdbcType="DECIMAL" />
    <result column="DISCOUNT_AMOUNT" property="discountAmount" jdbcType="DECIMAL" />
    <result column="ACCOUNT_BALANCE" property="accountBalance" jdbcType="DECIMAL" />
    <result column="AMOUNT_PAYABLE" property="amountPayable" jdbcType="DECIMAL" />
    <result column="PAY_DATE" property="payDate" jdbcType="date" />
    <result column="CREATE_DATE" property="createDate" jdbcType="date" />
    <result column="AGENCY_NUMBER" property="agencyNumber" jdbcType="VARCHAR" />
    <result column="SETTLEMENT_NO" property="settlementNo" jdbcType="DECIMAL" />
    <result column="STOCK_OUT_ID" property="stockOutId" jdbcType="DECIMAL" />
    <result column="DISTRIBUTION_ID" property="distributionId" jdbcType="DECIMAL" />
    <result column="LOGISTICS_ORDER_NO" property="logisticsOrderNo" jdbcType="VARCHAR" />
    <result column="ORDER_SOURCE" property="orderSource" jdbcType="VARCHAR" />
    <result column="INVOICE_ID" property="invoiceId" jdbcType="DECIMAL" />
    <result column="PARENT_ORDER_CODE" property="parentOrderCode" jdbcType="VARCHAR" />
    <result column="SON_ORDER_CODE" property="sonOrderCode" jdbcType="VARCHAR" />
    <result column="ORDER_DESCRIPTION" property="orderDescription" jdbcType="VARCHAR" />
    <result column="ORDER_STATUS" property="orderStatus" jdbcType="DECIMAL" />
    <result column="ORDER_CODE" property="orderCode" jdbcType="VARCHAR" />
    <result column="CUSTOMER_ID" property="customerId" jdbcType="DECIMAL" />
    <result column="ORDER_CHANNEL" property="orderChannel" jdbcType="VARCHAR" />
    <result column="DISABLED" property="disabled" jdbcType="DECIMAL" />
    <result column="CONFIRM_DELIVERY" property="confirmDelivery" jdbcType="DECIMAL" />
    <result column="LOGISTICS_CODE" property="logisticsCode" jdbcType="VARCHAR" />
    <result column="ADDRESS_ID" property="addressId" jdbcType="DECIMAL" />
    <result column="EMAIL" property="email" jdbcType="VARCHAR" />
    <result column="WEIGHT" property="weight" jdbcType="DECIMAL" />
    <result column="ASSESS_STATUS" property="assessStatus" jdbcType="DECIMAL" />
    <result column="FINISH_DATE" property="finishDate" jdbcType="date" />
    <result column="INVOICE_INFO_TYPE" property="invoiceInfoType" jdbcType="VARCHAR" />
    <result column="INVOICE_INFO_TITLE" property="invoiceInfoTitle" jdbcType="VARCHAR" />
    <result column="INVOICE_INFO_CONTENT" property="invoiceInfoContent" jdbcType="VARCHAR" />  
    <result column="TOTAL_CREDIT" property="totalCredit" jdbcType="DECIMAL" />  
    <result column="LOGISTICS_NAME" property="logisticsName" jdbcType="VARCHAR" />
    <result column="ORIGINAL_ORDER_SUM" property="originalOrderSum" jdbcType="DECIMAL" />  
    <result column="PROVINCE" jdbcType="VARCHAR" property="province" />
    <result column="CITY" jdbcType="VARCHAR" property="city" />
    <result column="AREA" jdbcType="VARCHAR" property="area" />
    <result column="ZIPCODE" jdbcType="DECIMAL" property="zipcode" />
    <result column="ORDER_TYPE" property="orderType" jdbcType="DECIMAL" />
    <result column="ORDER_OPERATION_REMARK" property="orderOperationRemark" jdbcType="VARCHAR" />
    <result column="COMMERCE_ID" property="commerceId" jdbcType="VARCHAR" />
    <result column="PRIZE_NUMBERS" property="prizeNumbers" jdbcType="VARCHAR" />
    <result column="PRESCRIPTION_ATTACHMENT" property="prescriptionAttachment" jdbcType="VARCHAR" />
        <result column="CHECK_FLAG" property="checkFlag" jdbcType="DECIMAL" />
    <result column="MEDIC_FLAG" property="medicFlag" jdbcType="DECIMAL" />
  </resultMap>
  
  <resultMap class="com.pltfm.app.vobject.MerchantVo" id="ibatorgenerated_MerchantResultMap">
    <result column="merchantId" property="merchantId" jdbcType="VARCHAR"/>
    <result column="merchantName" property="merchantName" jdbcType="VARCHAR"/>
  </resultMap>
  

  
  <!-- 加载orderItems -->
  <resultMap class="com.pltfm.app.vobject.OrderMainVo" id="ibatorgenerated_ListItemsResultMap"
  		  extends="ibatorgenerated_BaseResultMap">
      <result property="orderItems" column="ORDER_CODE" select="KMORDER_ORDER_ITEM.selectByOrderCode"/>
  </resultMap>
   <!-- 订单结转 -->
  <resultMap  class="com.pltfm.app.entities.OrderMain" id="ibatorgenerated_ListOrderExecute"
  		  extends="ibatorgenerated_BaseResultMap">
	<result column="HAS_INVOICE"  jdbcType="VARCHAR" property="hasInvoice" />
    <result column="INVOICE_MONEY"  jdbcType="DECIMAL" property="invoiceMoney" />
    <result column="COMMERCE_ID"  jdbcType="DECIMAL" property="commerceId" />
  </resultMap>
  <resultMap class="com.pltfm.app.vobject.OrderMainVo" id="ibatorgenerated_JoinItemsResultMap"
  		  extends="ibatorgenerated_BaseResultMap">
  	  <result property="orderItems" resultMap="KMORDER_ORDER_ITEM.ibatorgenerated_BaseResultMap"/>
  </resultMap>
  <resultMap class="com.pltfm.app.vobject.OrderMainVo" id="ibatorgenerated_ExtendsResultMap"
  		  extends="ibatorgenerated_BaseResultMap">
  	<!-- 附加 -->
    <result column="PAYMETHODSTR" jdbcType="VARCHAR" property="payMethodStr" />
    <result column="DELIVERYDATETYPESTR" jdbcType="VARCHAR" property="deliveryDateTypeStr" />
    <result column="ORDERSTATUSSTR" jdbcType="VARCHAR" property="orderStatusStr" />
    <result column="HANDLESTATE" jdbcType="VARCHAR" property="handleState" />
    <result column="COMMERCE_NAME" jdbcType="VARCHAR" property="commerceName" />
    <result column="HANDLEACCOUNT" jdbcType="VARCHAR" property="handleAccount" />
    <!--  -->
  </resultMap>
  
  <resultMap class="com.pltfm.app.vobject.OrderMainVo" id="ibatorgenerated_ExtendsResultMapForAlter"
  		  extends="ibatorgenerated_ExtendsResultMap">
  	<!-- 附加 -->
    <result column="DEPOSIT_SUM"  property="depositSum" jdbcType="DECIMAL" />
    <result column="FINALPAYMENT" property="finalPayment" jdbcType="DECIMAL" />
  </resultMap>
  
  <resultMap class="com.pltfm.app.vobject.OrderMainVo" id="ibatorgenerated_ExtendsOrderSource"
  		  extends="ibatorgenerated_BaseResultMap">
    <result column="PAYMETHODSTR" jdbcType="VARCHAR" property="payMethodStr" />
    <result column="DELIVERYDATETYPESTR" jdbcType="VARCHAR" property="deliveryDateTypeStr" />
    <result column="ORDERSTATUSSTR" jdbcType="VARCHAR" property="orderStatusStr" />
    <result column="HANDLESTATE" jdbcType="VARCHAR" property="handleState" />
    <result column="HANDLEACCOUNT" jdbcType="VARCHAR" property="handleAccount" />
    <result column="COMMERCE_NAME" jdbcType="VARCHAR" property="commerceName" />
    <result property="orderSourceStr" column="orderSourceStr"/>
  </resultMap>
  
  <!-- 附加预售定金 -->
   <resultMap class="com.pltfm.app.vobject.OrderMainVo" id="ibatorgenerated_ExtendsOrderSource_ys"
  		  extends="ibatorgenerated_ExtendsOrderSource">
    <result column="DEPOSIT_SUM" property="depositSum" jdbcType="DECIMAL" />
    <result column="PAIDDEPOSIT" property="paidDeposit" jdbcType="DECIMAL" />
    <result column="FINALPAYMENT" property="finalPayment" jdbcType="DECIMAL" />
    <result column="NOFINALPAYMENT" property="noFinalPayment" jdbcType="DECIMAL" />
  </resultMap>
  
  
    <resultMap class="com.pltfm.app.vobject.OrderMainVo" id="ibatorgenerated_ExtendsBaseResultMap"
  		  extends="ibatorgenerated_BaseResultMap">
    <result column="PAYMETHODSTR" jdbcType="VARCHAR" property="payMethodStr" />
    <result column="DELIVERYDATETYPESTR" jdbcType="VARCHAR" property="deliveryDateTypeStr" />
    <result column="ORDERSTATUSSTR" jdbcType="VARCHAR" property="orderStatusStr" />
    <result column="HANDLESTATE" jdbcType="VARCHAR" property="handleState" />
    <result column="HANDLEACCOUNT" jdbcType="VARCHAR" property="handleAccount" />
    <result column="COMMERCE_NAME" jdbcType="VARCHAR" property="commerceName" />
    <result column="ORDER_DISCOUNT" jdbcType="DECIMAL" property="orderDiscount" />
    <result column="estimateContent" jdbcType="DECIMAL" property="estimateContent" />
  </resultMap>
  
  <resultMap class="com.pltfm.app.vobject.OrderMainVo" id="WithDeposit_ResultMap"
  		  extends="ibatorgenerated_ExtendsBaseResultMap">
	<result column="DEPOSIT_SUM" jdbcType="DECIMAL" property="depositSum" />
	<result column="INFORMPAY_TEL" jdbcType="VARCHAR" property="informPayTel" />
  </resultMap>
  
  <resultMap class="com.pltfm.app.vobject.OrderMainVo" id="WithRoot_ResultMap"
  		  extends="ibatorgenerated_ExtendsResultMap">
	<result property="rootOrderCode" column="ROOT_ORDER_CODE"/>   
  </resultMap>
  <resultMap class="com.pltfm.app.vobject.OrderMainVo" id="WITHROOT_RESULTMAP_FOR_FUZZY"
  		  extends="ibatorgenerated_ExtendsResultMap">
	<result property="rootOrderCode" column="ROOT_ORDER_CODE"/>
	<result property="orderSourceStr" column="orderSourceStr"/>
  </resultMap>
  
  <!-- 附加预售定金 -->
   <resultMap class="com.pltfm.app.vobject.OrderMainVo" id="WITHROOT_RESULTMAP_FOR_FUZZY_ys"
  		  extends="WITHROOT_RESULTMAP_FOR_FUZZY">
	 <result column="DEPOSIT_SUM" property="depositSum" jdbcType="DECIMAL" />
	  <result column="PAIDDEPOSIT" property="paidDeposit" jdbcType="DECIMAL" />
	  <result column="FINALPAYMENT" property="finalPayment" jdbcType="DECIMAL" />
	  <result column="NOFINALPAYMENT" property="noFinalPayment" jdbcType="DECIMAL" />
	  <result column="FINALPAY_END_TIME" property="finalpayEndTime" jdbcType="date" />
  </resultMap>
  <!-- 尾款支付通知 -->
  <resultMap class="com.pltfm.app.vobject.OrderPayInformForPressellVo" id="ORDER_PAY_INFORM_FOR_PRESSELL">
    <result column="ORDER_CODE" property="orderCode" jdbcType="VARCHAR" />
    <result column="ORDER_ITEM_ID" property="orderItemId" jdbcType="DECIMAL"/>
    <result column="INFORMPAY_TEL" jdbcType="VARCHAR" property="informPayTel" />	
	<result column="FINALPAY_END_TIME" property="finalpayEndTime" jdbcType="date" />
	<result column="DEPOSIT_PAY_FINISH_TIME" property="depositPayFinishTime" jdbcType="date" />	
	<result column="PRODUCT_SKU_CODE" property="productSkuCode" jdbcType="VARCHAR" />	
	<result column="ORDER_STATUS" property="orderStatus" jdbcType="DECIMAL" /> 
	<result column="AMOUNT_PAYABLE" property="amountPayable" jdbcType="DECIMAL" /> 
  </resultMap>
  
  <resultMap class="com.pltfm.app.vobject.OrderMainVo" id="WITHROOT_RESULTMAP_FOR_OUT_FUZZY">
	<result column="ORDER_ID" property="orderId" jdbcType="DECIMAL" />
	<result column="ORDER_CODE" property="orderCode" jdbcType="VARCHAR" />
	<result column="ORDER_SOURCE" property="orderSource" jdbcType="VARCHAR" />
	<result column="CUSTOMER_ACCOUNT" property="customerAccount"		jdbcType="VARCHAR" />
	<result column="CUSTOMER_NAME" property="customerName" jdbcType="VARCHAR" />
	<result column="CUSTOMER_MOBILE" property="customerMobile"		jdbcType="VARCHAR" />
	<result column="COMMERCE_ID" property="commerceId" jdbcType="VARCHAR" />
	<result column="ORDER_STATUS" property="orderStatus" jdbcType="DECIMAL" />
    <result column="CONSIGNEE_NAME" property="consigneeName" jdbcType="VARCHAR" />
	<result column="CREATE_DATE" property="createDate" jdbcType="date" />
    <result column="PAY_DATE" property="payDate" jdbcType="date" />
	<result column="AMOUNT_PAYABLE" property="amountPayable"		jdbcType="DECIMAL" />
	<result column="ORDERSTATUSSTR" jdbcType="VARCHAR" property="orderStatusStr" />
	<result property="orderSourceStr" column="orderSourceStr" />
	<result property="orderCommissionl" column="ORDER_COMMISSION" />
  </resultMap>
  <resultMap class="com.pltfm.app.vobject.OrderMainVo" id="ibatorgenerated_ExtendsResultMap1"
  		  extends="ibatorgenerated_ExtendsResultMap">
    <result column="ASSESSCOUNT" jdbcType="VARCHAR" property="assessCount"></result>
  </resultMap>
  <resultMap class="java.util.HashMap" id="skuMap">
	  <result property="skuCode" column="skuCode"/>
	  <result property="skuCount" column="skuCount"/>
  </resultMap>
   <resultMap class="java.util.HashMap" id="skuIdMap">
	  <result property="skuId" column="skuId"/>
	  <result property="skuCount" column="skuCount"/>
  </resultMap>
  
    <resultMap class="java.util.HashMap" id="orderPayMoneyMap">
	  <result property="pay" column="pay"/>
	  <result property="return" column="return"/>
  </resultMap>
  
  <!-- 订单导出 -->
  <resultMap id="qrySellerExportOrder" class="com.pltfm.app.entities.OrderMain" groupBy="orderCode">
  	<result column="ORDER_ID" property="orderId" jdbcType="DECIMAL" />
    <result column="ORDER_CODE" property="orderCode" jdbcType="VARCHAR" />
    <result column="CUSTOMER_ACCOUNT" property="customerAccount" jdbcType="VARCHAR" />
    <result column="CONSIGNEE_NAME" property="consigneeName" jdbcType="VARCHAR" />
    <result column="CONSIGNEE_MOBILE" property="consigneeMobile" jdbcType="VARCHAR" />
    <result column="CONSIGNEE_ADDR" property="consigneeAddr" jdbcType="VARCHAR" />
    <result column="CREATE_DATE" property="createDate" jdbcType="date" />
    <result column="FINISH_DATE" property="finishDate" jdbcType="date" />
    <result column="ORDER_STATUS" property="orderStatus" jdbcType="DECIMAL" />
    <result column="LOGISTICS_ORDER_NO" property="logisticsOrderNo" jdbcType="VARCHAR" />
    <result column="LOGISTICS_NAME" property="logisticsName" jdbcType="VARCHAR" />
    <result column="PROMOTION_NAME"     property="promotionName"         jdbcType="VARCHAR"/>
	<result column="FARE" property="fare" jdbcType="DECIMAL" />
	<result column="AMOUNT_PAYABLE" property="amountPayable" jdbcType="DECIMAL" />	
	<result property="orderItems" resultMap="KMORDER_ORDER_ITEM.qrySellerExportOrderItem"/>
	<result column="Order_Description" property="orderDescription" jdbcType="VARCHAR" />
	<result column="Order_Operation_Remark" property="orderOperationRemark" jdbcType="VARCHAR" />
	<result column="ORDER_PV" property="orderPv" jdbcType="DECIMAL" />	
  </resultMap>
  
  <!-- 订单同步-->
  <resultMap id="syncOrderInfoResultMap" class="com.pltfm.app.entities.OrderMain" groupBy="orderCode">
    <result column="CARD_NUM" property="cardNum" jdbcType="VARCHAR" />
    <result column="ORDER_CODE" property="orderCode" jdbcType="VARCHAR" />
    <result column="ORDER_STATUS" property="orderStatus" jdbcType="DECIMAL" />
    <result column="CONSIGNEE_NAME" property="consigneeName" jdbcType="VARCHAR" />
    <result column="CONSIGNEE_ADDR" property="consigneeAddr" jdbcType="VARCHAR" />
    <result column="CONSIGNEE_TEL" property="consigneeTel" jdbcType="VARCHAR" />
    <result column="CONSIGNEE_MOBILE" property="consigneeMobile" jdbcType="VARCHAR" />
    <result column="EMAIL" property="email" jdbcType="VARCHAR" />
    <result column="PAY_METHOD" property="payMethod" jdbcType="DECIMAL" />
    <result column="FARE" property="fare" jdbcType="DECIMAL" />
    <result column="CREATE_DATE" property="createDate" jdbcType="date" />
    <result column="PAY_DATE" property="payDate" jdbcType="date" />
    <result column="ORDER_DESCRIPTION" property="orderDescription" jdbcType="VARCHAR" />
    <result column="ORIGINAL_ORDER_SUM" property="originalOrderSum" jdbcType="DECIMAL" /> 
    <result column="AMOUNT_PAYABLE" property="amountPayable" jdbcType="DECIMAL" />
	<result property="orderItems" resultMap="KMORDER_ORDER_ITEM.syncOrderItemInfo2Base"/>
  </resultMap>
 <!-- 收退款报表 -->
    <resultMap class="com.pltfm.app.entities.OrderPayInfo" id="orderPayInfoRe">
  		<result column="platformCode" property="platformCode" jdbcType="VARCHAR"/>
  		<result column="flag" property="flag" jdbcType="VARCHAR"/>
  		<result column="orderCode" property="orderCode" jdbcType="VARCHAR"/>
  		<result column="outsidePayStatementNo" property="outsidePayStatementNo" jdbcType="VARCHAR"/>
  		<result column="customerAccount" property="customerAccount" jdbcType="VARCHAR"/>
  		<result column="orderMoney" property="orderMoney" jdbcType="DECIMAL"/>
  		<result column="operateDate" property="operateDate" jdbcType="VARCHAR"/>
  	</resultMap> 
  	
  <sql id="ibatorgenerated_Example_Where_Clause" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Tue Nov 05 20:06:33 CST 2013.
    -->
    <iterate property="oredCriteria" conjunction="or" prepend="where" removeFirstPrepend="iterate" >
      <isEqual property="oredCriteria[].valid" compareValue="true" >
        (
        <iterate prepend="and" property="oredCriteria[].criteriaWithoutValue" conjunction="and" >
          $oredCriteria[].criteriaWithoutValue[]$
        </iterate>
        <iterate prepend="and" property="oredCriteria[].criteriaWithSingleValue" conjunction="and" >
          $oredCriteria[].criteriaWithSingleValue[].condition$
            #oredCriteria[].criteriaWithSingleValue[].value#
        </iterate>
        <iterate prepend="and" property="oredCriteria[].criteriaWithListValue" conjunction="and" >
          $oredCriteria[].criteriaWithListValue[].condition$
          <iterate property="oredCriteria[].criteriaWithListValue[].values" open="(" close=")" conjunction="," >
            #oredCriteria[].criteriaWithListValue[].values[]#
          </iterate>
        </iterate>
        <iterate prepend="and" property="oredCriteria[].criteriaWithBetweenValue" conjunction="and" >
          $oredCriteria[].criteriaWithBetweenValue[].condition$
          #oredCriteria[].criteriaWithBetweenValue[].values[0]# and
          #oredCriteria[].criteriaWithBetweenValue[].values[1]#
        </iterate>
        )
      </isEqual>
    </iterate>
  </sql>
  <select id="ibatorgenerated_selectByExample" resultMap="ibatorgenerated_BaseResultMap" parameterClass="com.pltfm.app.entities.OrderMainExample" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Tue Nov 05 20:06:33 CST 2013.
    -->
    select ORDER_ID, CUSTOMER_ACCOUNT, CUSTOMER_NAME, CUSTOMER_MOBILE, ORDER_PURCHASER_NAME,
      ORDER_PURCHASER_MOBILE, ORDER_PURCHASER_TEL, ORDER_PURCHASER_ADDR, ORDER_PURCHASER_TYPE,
      CONSIGNEE_NAME, CONSIGNEE_MOBILE, CONSIGNEE_TEL, CONSIGNEE_ADDR, PAY_METHOD, FARE,
      DELIVERY_DATE_TYPE, COMMODITY_SUM, DISCOUNT_AMOUNT, ACCOUNT_BALANCE, AMOUNT_PAYABLE, PAY_DATE,
      CREATE_DATE, AGENCY_NUMBER, SETTLEMENT_NO, STOCK_OUT_ID, DISTRIBUTION_ID, LOGISTICS_ORDER_NO,
      ORDER_SOURCE, INVOICE_ID, PARENT_ORDER_CODE, SON_ORDER_CODE, ORDER_DESCRIPTION, ORDER_STATUS,
      ORDER_CODE, CUSTOMER_ID, ORDER_CHANNEL, DISABLED, CONFIRM_DELIVERY, LOGISTICS_CODE,
      ADDRESS_ID, EMAIL, WEIGHT, ASSESS_STATUS, FINISH_DATE,INVOICE_INFO_TYPE,INVOICE_INFO_TITLE,INVOICE_INFO_CONTENT,
      TOTAL_CREDIT,LOGISTICS_NAME,ORIGINAL_ORDER_SUM, PROVINCE, CITY, AREA,
      ZIPCODE,ORDER_TYPE,ORDER_OPERATION_REMARK,COMMERCE_ID,PRIZE_NUMBERS,PRESCRIPTION_ATTACHMENT,
      CHECK_FLAG,MEDIC_FLAG
    from  ORDER_MAIN
    <isParameterPresent >
      <include refid="KMORDER_ORDER_MAIN.ibatorgenerated_Example_Where_Clause" />
      <isNotNull property="orderByClause" >
        order by $orderByClause$
      </isNotNull>
    </isParameterPresent>
  </select>
  <select id="ibatorgenerated_selectByPrimaryKey" resultMap="ibatorgenerated_BaseResultMap" parameterClass="com.pltfm.app.entities.OrderMain" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Tue Nov 05 20:06:33 CST 2013.
    -->
    select ORDER_ID, CUSTOMER_ACCOUNT, CUSTOMER_NAME, CUSTOMER_MOBILE, ORDER_PURCHASER_NAME,
      ORDER_PURCHASER_MOBILE, ORDER_PURCHASER_TEL, ORDER_PURCHASER_ADDR, ORDER_PURCHASER_TYPE,
      CONSIGNEE_NAME, CONSIGNEE_MOBILE, CONSIGNEE_TEL, CONSIGNEE_ADDR, PAY_METHOD, FARE,
      DELIVERY_DATE_TYPE, COMMODITY_SUM, DISCOUNT_AMOUNT, ACCOUNT_BALANCE, AMOUNT_PAYABLE, PAY_DATE,
      CREATE_DATE, AGENCY_NUMBER, SETTLEMENT_NO, STOCK_OUT_ID, DISTRIBUTION_ID, LOGISTICS_ORDER_NO,
      ORDER_SOURCE, INVOICE_ID, PARENT_ORDER_CODE, SON_ORDER_CODE, ORDER_DESCRIPTION, ORDER_STATUS,
      ORDER_CODE, CUSTOMER_ID, ORDER_CHANNEL, DISABLED, CONFIRM_DELIVERY, LOGISTICS_CODE,
      ADDRESS_ID, EMAIL, WEIGHT, ASSESS_STATUS, FINISH_DATE,INVOICE_INFO_TYPE,INVOICE_INFO_TITLE,INVOICE_INFO_CONTENT,
      TOTAL_CREDIT,LOGISTICS_NAME,ORIGINAL_ORDER_SUM, PROVINCE, CITY, AREA,
      ZIPCODE,ORDER_TYPE,ORDER_OPERATION_REMARK,COMMERCE_ID,PRIZE_NUMBERS,PRESCRIPTION_ATTACHMENT,
      CHECK_FLAG,MEDIC_FLAG
    from  ORDER_MAIN
    where ORDER_ID = #orderId:DECIMAL#
  </select>
  <!-- 根据order_code查询 -->
  <select id="ibatorgenerated_selectByOrderCode" parameterClass="String" resultMap="WithDeposit_ResultMap">
    select T.ORDER_ID, T.CUSTOMER_ACCOUNT, T.CUSTOMER_NAME, T.CUSTOMER_MOBILE, T.ORDER_PURCHASER_NAME,
      T.ORDER_PURCHASER_MOBILE, T.ORDER_PURCHASER_TEL, T.ORDER_PURCHASER_ADDR, T.ORDER_PURCHASER_TYPE,
      T.CONSIGNEE_NAME, T.CONSIGNEE_MOBILE, T.CONSIGNEE_TEL, T.CONSIGNEE_ADDR, T.PAY_METHOD, T.FARE,nvl(T.ORDER_DISCOUNT,0) ORDER_DISCOUNT,
      T.DELIVERY_DATE_TYPE, T.COMMODITY_SUM, T.DISCOUNT_AMOUNT, T.ACCOUNT_BALANCE, T.AMOUNT_PAYABLE, T.PAY_DATE,
      T.CREATE_DATE, T.AGENCY_NUMBER, T.SETTLEMENT_NO, T.STOCK_OUT_ID, T.DISTRIBUTION_ID, T.LOGISTICS_ORDER_NO,
      T.ORDER_SOURCE, T.INVOICE_ID, T.PARENT_ORDER_CODE, T.SON_ORDER_CODE, T.ORDER_DESCRIPTION,T.ORDER_STATUS, T.ORDER_CODE,
      T.CUSTOMER_ID,T.ORDER_CHANNEL,T.DISABLED,T.CONFIRM_DELIVERY,T.LOGISTICS_CODE,T.ADDRESS_ID,T.EMAIL, T.WEIGHT, T.ASSESS_STATUS, T.FINISH_DATE,
      T.INVOICE_INFO_TYPE,T.INVOICE_INFO_TITLE,T.INVOICE_INFO_CONTENT,T.TOTAL_CREDIT,T.LOGISTICS_NAME,T.ORIGINAL_ORDER_SUM, T.PROVINCE, T.CITY, T.AREA,
      T.ZIPCODE,T.ORDER_TYPE,T.ORDER_OPERATION_REMARK,COMMERCE_ID,PRIZE_NUMBERS,PRESCRIPTION_ATTACHMENT,CHECK_FLAG,MEDIC_FLAG
      ,(SELECT D.ORDER_DICTIONARY_VALUE FROM ORDER_DICTIONARY D WHERE D.ORDER_DICTIONARY_TYPE = 'Pay_Method' AND D.ORDER_DICTIONARY_KEY = T.PAY_METHOD) payMethodStr
      ,(SELECT D.ORDER_DICTIONARY_VALUE FROM ORDER_DICTIONARY D WHERE D.ORDER_DICTIONARY_TYPE = 'Delivery_Date_Type' AND D.ORDER_DICTIONARY_KEY = T.DELIVERY_DATE_TYPE) deliveryDateTypeStr
      ,(SELECT D.ORDER_DICTIONARY_VALUE FROM ORDER_DICTIONARY D WHERE D.ORDER_DICTIONARY_TYPE = 'Order_Status' AND D.ORDER_DICTIONARY_KEY = T.ORDER_STATUS) orderStatusStr
      ,(SELECT HANDLE_STATE FROM ORDER_HANDLE WHERE ORDER_CODE = T.ORDER_CODE) HANDLESTATE
	  ,(SELECT HANDLE_ACCOUNT FROM ORDER_HANDLE WHERE ORDER_CODE = T.ORDER_CODE) HANDLEACCOUNT	 
	  ,T.COMMERCE_NAME,T.ESTIMATE_CONTENT estimateContent,T.DEPOSIT_SUM,T.INFORMPAY_TEL       
    from  ORDER_MAIN T
    where ORDER_CODE = #orderCode:VARCHAR#
  </select> 
  <select id="ibatorgenerated_selectOrderMoneyByOrderCode" parameterClass="String"  resultClass="java.math.BigDecimal">
      select ops.order_money
		  from  order_pay_statement ops
		 where ops.order_code = #orderCode:VARCHAR#
		   and ops.state = 1
		   and ops.ysflage = 2
  </select>
  <select id="ibatorgenerated_selectOrderPaidDepositByOrderCode" parameterClass="String"  resultClass="java.math.BigDecimal">
      select ops.order_money
		  from  order_pay_statement ops
		 where ops.order_code = #orderCode:VARCHAR#
		   and ops.state = 1
		   and ops.ysflage = 1
  </select>
   	<sql id="Map_Where_OrderClause">
    from  order_main om 
		<dynamic prepend="WHERE">
		<!-- <isNotEmpty prepend="and" property="sysuser.userId">
   			 exists (select 1 from user_channel uc where uc.user_id = #sysuser.userId# and uc.channel_name = om.order_channel)
   		</isNotEmpty> -->
   		<isNotEmpty prepend="and" property="orderStatus">
			 om.order_status in 
			<iterate open="(" close=")" conjunction="," property="orderStatus">
		    	#orderStatus[]#
			</iterate>
		</isNotEmpty>
   		<isNotEmpty prepend="and" property="orderChannel">
   			 om.order_channel = #orderChannel# 
   		</isNotEmpty>
		<isNotEmpty prepend="and" property="commerceId">
		<![CDATA[  om.commerce_id = #commerceId#]]>
		</isNotEmpty>
		<isEmpty prepend="and" property="commerceId">
		<![CDATA[  om.commerce_id is null]]>    
		</isEmpty>
		<isNotEmpty prepend="and" property="StartDate">
		<![CDATA[  om.pay_date >= #StartDate#]]>
		</isNotEmpty>
		<isNotEmpty prepend="and" property="endDate">
		<![CDATA[  om.pay_date <= #endDate#]]>
		</isNotEmpty>
		<isNotEmpty prepend="and" property="checkFlag">
		 	 om.check_flag = #checkFlag#
		</isNotEmpty>
		<isNotEmpty prepend="and" property="execOrderCode">
		 	 om.order_code = #execOrderCode:VARCHAR#
		</isNotEmpty>
		<isNotEmpty prepend="and" property="limit">
		 <![CDATA[	 rownum <= 60]]>
		</isNotEmpty>
		</dynamic>
  	</sql>
 
  <!-- 订单结转查询 -->
   <select id="ibatorgenerated_selectByOrderExecute" parameterClass="java.util.Map"  resultMap="ibatorgenerated_ListOrderExecute">
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Mon Jul 29 11:23:58 CST 2013.
    -->
    select ORDER_ID, CUSTOMER_ACCOUNT, CUSTOMER_NAME, CUSTOMER_MOBILE, ORDER_PURCHASER_NAME,
      ORDER_PURCHASER_MOBILE, ORDER_PURCHASER_TEL, ORDER_PURCHASER_ADDR, ORDER_PURCHASER_TYPE,
      CONSIGNEE_NAME, CONSIGNEE_MOBILE, CONSIGNEE_TEL, CONSIGNEE_ADDR, PAY_METHOD, FARE,
      DELIVERY_DATE_TYPE, COMMODITY_SUM, DISCOUNT_AMOUNT, ACCOUNT_BALANCE, AMOUNT_PAYABLE, PAY_DATE,
      CREATE_DATE, AGENCY_NUMBER, SETTLEMENT_NO, STOCK_OUT_ID, DISTRIBUTION_ID, LOGISTICS_ORDER_NO,
      ORDER_SOURCE, INVOICE_ID, PARENT_ORDER_CODE, SON_ORDER_CODE, ORDER_DESCRIPTION,ORDER_STATUS, ORDER_CODE,
      CUSTOMER_ID,ORDER_CHANNEL,DISABLED,CONFIRM_DELIVERY,LOGISTICS_CODE,ADDRESS_ID,EMAIL, WEIGHT, ASSESS_STATUS, FINISH_DATE,
      INVOICE_INFO_TYPE,INVOICE_INFO_TITLE,INVOICE_INFO_CONTENT,TOTAL_CREDIT,LOGISTICS_NAME,ORIGINAL_ORDER_SUM, PROVINCE, CITY, AREA,
      ZIPCODE,ORDER_TYPE,ORDER_OPERATION_REMARK,COMMERCE_ID,PRIZE_NUMBERS,PRESCRIPTION_ATTACHMENT,
      CHECK_FLAG,MEDIC_FLAG,decode(om.invoice_info_type, null, 'N', 'Y') HAS_INVOICE,
      <![CDATA[
      (select nvl(sum(ops.order_money), 0)
           from order_pay_statement ops
          where ops.payment_way <> 2
            and ops.state = 1
            and ops.order_code = om.order_code) INVOICE_MONEY
	  ]]>
    <include refid="Map_Where_OrderClause"/>
    order by PAY_DATE
  </select>
  <delete id="ibatorgenerated_deleteByOrderCode" parameterClass="com.pltfm.app.entities.OrderMain">
  	delete from  ORDER_MAIN
    where ORDER_CODE = #orderCode:VARCHAR#
  </delete>
  <delete id="ibatorgenerated_deleteByPrimaryKey" parameterClass="com.pltfm.app.entities.OrderMain" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Tue Nov 05 20:06:33 CST 2013.
    -->
    delete from  ORDER_MAIN
    where ORDER_ID = #orderId:DECIMAL#
  </delete>
  <delete id="ibatorgenerated_deleteByExample" parameterClass="com.pltfm.app.entities.OrderMainExample" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Tue Nov 05 20:06:33 CST 2013.
    -->
    delete from  ORDER_MAIN
    <include refid="KMORDER_ORDER_MAIN.ibatorgenerated_Example_Where_Clause" />
  </delete>
  <insert id="ibatorgenerated_insert" parameterClass="com.pltfm.app.entities.OrderMain" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Tue Nov 05 20:06:33 CST 2013.
    -->
    <selectKey resultClass="java.lang.Long" keyProperty="orderId" >
      select SEQ_ORDER_MAIN.NEXTVAL from dual
    </selectKey>
    insert into  ORDER_MAIN (ORDER_ID, CUSTOMER_ACCOUNT, CUSTOMER_NAME, CUSTOMER_MOBILE,
      ORDER_PURCHASER_NAME, ORDER_PURCHASER_MOBILE, ORDER_PURCHASER_TEL, ORDER_PURCHASER_ADDR,
      ORDER_PURCHASER_TYPE, CONSIGNEE_NAME, CONSIGNEE_MOBILE, CONSIGNEE_TEL, CONSIGNEE_ADDR,
      PAY_METHOD, FARE, DELIVERY_DATE_TYPE, COMMODITY_SUM, DISCOUNT_AMOUNT, ACCOUNT_BALANCE,
      AMOUNT_PAYABLE, PAY_DATE, CREATE_DATE, AGENCY_NUMBER, SETTLEMENT_NO, STOCK_OUT_ID,
      DISTRIBUTION_ID, LOGISTICS_ORDER_NO, ORDER_SOURCE, INVOICE_ID, PARENT_ORDER_CODE,
      SON_ORDER_CODE, ORDER_DESCRIPTION, ORDER_STATUS, ORDER_CODE, CUSTOMER_ID, ORDER_CHANNEL,
      DISABLED, CONFIRM_DELIVERY, LOGISTICS_CODE, ADDRESS_ID, EMAIL, WEIGHT, ASSESS_STATUS,
      FINISH_DATE,INVOICE_INFO_TYPE,INVOICE_INFO_TITLE,INVOICE_INFO_CONTENT,TOTAL_CREDIT,
      LOGISTICS_NAME,ORIGINAL_ORDER_SUM, PROVINCE, CITY, AREA,ZIPCODE,ORDER_TYPE,
      ORDER_OPERATION_REMARK,COMMERCE_ID,PRIZE_NUMBERS, PRESCRIPTION_ATTACHMENT,CHECK_FLAG,MEDIC_FLAG,ORDER_PV)
    values (#orderId:DECIMAL#, #customerAccount:VARCHAR#, #customerName:VARCHAR#,
      #customerMobile:VARCHAR#, #orderPurchaserName:VARCHAR#, #orderPurchaserMobile:VARCHAR#,
      #orderPurchaserTel:VARCHAR#, #orderPurchaserAddr:VARCHAR#, #orderPurchaserType:DECIMAL#,
      #consigneeName:VARCHAR#, #consigneeMobile:VARCHAR#, #consigneeTel:VARCHAR#,
      #consigneeAddr:VARCHAR#, #payMethod:DECIMAL#, #fare:DECIMAL#, #deliveryDateType:DECIMAL#,
      #commoditySum:DECIMAL#, #discountAmount:DECIMAL#, #accountBalance:DECIMAL#,
      #amountPayable:DECIMAL#, #payDate#, #createDate#, #agencyNumber:VARCHAR#,
      #settlementNo:DECIMAL#, #stockOutId:DECIMAL#, #distributionId:DECIMAL#,
      #logisticsOrderNo:VARCHAR#, #orderSource:VARCHAR#, #invoiceId:DECIMAL#,
      #parentOrderCode:VARCHAR#, #sonOrderCode:VARCHAR#, #orderDescription:VARCHAR#,
      #orderStatus:DECIMAL#, #orderCode:VARCHAR#, #customerId:DECIMAL#, #orderChannel:VARCHAR#,
      #disabled:DECIMAL#, #confirmDelivery:DECIMAL#, #logisticsCode:DECIMAL#, #addressId:DECIMAL#,
      #email:VARCHAR#, #weight:DECIMAL#, #assessStatus:DECIMAL#, #finishDate#,
      #invoiceInfoType:VARCHAR#,#invoiceInfoTitle:VARCHAR#,#invoiceInfoContent:VARCHAR#,
      #totalCredit:DECIMAL#,#logisticsName:VARCHAR#,#originalOrderSum:DECIMAL#,
      #province:VARCHAR#, #city:VARCHAR#, #area:VARCHAR#, #zipcode:DECIMAL#,#orderType:DECIMAL#,
      #orderOperationRemark:VARCHAR#,#commerceId:VARCHAR#,#prizeNumbers:VARCHAR#,
      #prescriptionAttachment:VARCHAR#,#checkFlag:DECIMAL#,#medicFlag:DECIMAL#,#orderPv:DECIMAL#)
  </insert>
  <insert id="ibatorgenerated_insertSelective" parameterClass="com.pltfm.app.entities.OrderMain" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Tue Nov 05 20:06:33 CST 2013.
    -->
    <selectKey resultClass="java.lang.Long" keyProperty="orderId" >
      select SEQ_ORDER_MAIN.NEXTVAL from dual
    </selectKey>
    insert into  ORDER_MAIN
    <dynamic prepend="(" >
      <isNotNull prepend="," property="orderId" >
        ORDER_ID
      </isNotNull>
      <isNotNull prepend="," property="customerAccount" >
        CUSTOMER_ACCOUNT
      </isNotNull>
      <isNotNull prepend="," property="customerName" >
        CUSTOMER_NAME
      </isNotNull>
      <isNotNull prepend="," property="customerMobile" >
        CUSTOMER_MOBILE
      </isNotNull>
      <isNotNull prepend="," property="orderPurchaserName" >
        ORDER_PURCHASER_NAME
      </isNotNull>
      <isNotNull prepend="," property="orderPurchaserMobile" >
        ORDER_PURCHASER_MOBILE
      </isNotNull>
      <isNotNull prepend="," property="orderPurchaserTel" >
        ORDER_PURCHASER_TEL
      </isNotNull>
      <isNotNull prepend="," property="orderPurchaserAddr" >
        ORDER_PURCHASER_ADDR
      </isNotNull>
      <isNotNull prepend="," property="orderPurchaserType" >
        ORDER_PURCHASER_TYPE
      </isNotNull>
      <isNotNull prepend="," property="consigneeName" >
        CONSIGNEE_NAME
      </isNotNull>
      <isNotNull prepend="," property="consigneeMobile" >
        CONSIGNEE_MOBILE
      </isNotNull>
      <isNotNull prepend="," property="consigneeTel" >
        CONSIGNEE_TEL
      </isNotNull>
      <isNotNull prepend="," property="consigneeAddr" >
        CONSIGNEE_ADDR
      </isNotNull>
      <isNotNull prepend="," property="payMethod" >
        PAY_METHOD
      </isNotNull>
      <isNotNull prepend="," property="fare" >
        FARE
      </isNotNull>
      <isNotNull prepend="," property="deliveryDateType" >
        DELIVERY_DATE_TYPE
      </isNotNull>
      <isNotNull prepend="," property="commoditySum" >
        COMMODITY_SUM
      </isNotNull>
      <isNotNull prepend="," property="discountAmount" >
        DISCOUNT_AMOUNT
      </isNotNull>
      <isNotNull prepend="," property="accountBalance" >
        ACCOUNT_BALANCE
      </isNotNull>
      <isNotNull prepend="," property="amountPayable" >
        AMOUNT_PAYABLE
      </isNotNull>
      <isNotNull prepend="," property="payDate" >
        PAY_DATE
      </isNotNull>
      <isNotNull prepend="," property="createDate" >
        CREATE_DATE
      </isNotNull>
      <isNotNull prepend="," property="agencyNumber" >
        AGENCY_NUMBER
      </isNotNull>
      <isNotNull prepend="," property="settlementNo" >
        SETTLEMENT_NO
      </isNotNull>
      <isNotNull prepend="," property="stockOutId" >
        STOCK_OUT_ID
      </isNotNull>
      <isNotNull prepend="," property="distributionId" >
        DISTRIBUTION_ID
      </isNotNull>
      <isNotNull prepend="," property="logisticsOrderNo" >
        LOGISTICS_ORDER_NO
      </isNotNull>
      <isNotNull prepend="," property="orderSource" >
        ORDER_SOURCE
      </isNotNull>
      <isNotNull prepend="," property="invoiceId" >
        INVOICE_ID
      </isNotNull>
      <isNotNull prepend="," property="parentOrderCode" >
        PARENT_ORDER_CODE
      </isNotNull>
      <isNotNull prepend="," property="sonOrderCode" >
        SON_ORDER_CODE
      </isNotNull>
      <isNotNull prepend="," property="orderDescription" >
        ORDER_DESCRIPTION
      </isNotNull>
      <isNotNull prepend="," property="orderStatus" >
        ORDER_STATUS
      </isNotNull>
      <isNotNull prepend="," property="orderCode" >
        ORDER_CODE
      </isNotNull>
      <isNotNull prepend="," property="customerId" >
        CUSTOMER_ID
      </isNotNull>
      <isNotNull prepend="," property="orderChannel" >
        ORDER_CHANNEL
      </isNotNull>
      <isNotNull prepend="," property="disabled" >
        DISABLED
      </isNotNull>
      <isNotNull prepend="," property="confirmDelivery" >
        CONFIRM_DELIVERY
      </isNotNull>
      <isNotNull prepend="," property="logisticsCode" >
        LOGISTICS_CODE
      </isNotNull>
      <isNotNull prepend="," property="addressId" >
        ADDRESS_ID
      </isNotNull>
      <isNotNull prepend="," property="email" >
        EMAIL
      </isNotNull>
      <isNotNull prepend="," property="weight" >
        WEIGHT
      </isNotNull>
      <isNotNull prepend="," property="assessStatus" >
        ASSESS_STATUS
      </isNotNull>
      <isNotNull prepend="," property="finishDate" >
        FINISH_DATE
      </isNotNull>
      <isNotNull prepend="," property="invoiceInfoType" >
        INVOICE_INFO_TYPE
      </isNotNull>
      <isNotNull prepend="," property="invoiceInfoTitle" >
        INVOICE_INFO_TITLE
      </isNotNull>
      <isNotNull prepend="," property="invoiceInfoContent" >
        INVOICE_INFO_CONTENT
      </isNotNull>
      <isNotNull prepend="," property="totalCredit" >
        TOTAL_CREDIT
      </isNotNull>
      <isNotNull prepend="," property="logisticsName" >
        LOGISTICS_NAME
      </isNotNull>
      <isNotNull prepend="," property="originalOrderSum" >
        ORIGINAL_ORDER_SUM
      </isNotNull>      
      <isNotNull prepend="," property="province">
        PROVINCE
      </isNotNull>
      <isNotNull prepend="," property="city">
        CITY
      </isNotNull>
      <isNotNull prepend="," property="area">
        AREA
      </isNotNull>
      <isNotNull prepend="," property="zipcode">
        ZIPCODE
      </isNotNull>
      <isNotNull prepend="," property="orderType" >
        ORDER_TYPE
      </isNotNull>  
      <isNotNull prepend="," property="orderOperationRemark" >
        ORDER_OPERATION_REMARK
      </isNotNull>    
      <isNotNull prepend="," property="commerceId" >
        COMMERCE_ID
      </isNotNull>    
      <isNotNull prepend="," property="prizeNumbers" >
        PRIZE_NUMBERS
      </isNotNull>    
      <isNotNull prepend="," property="prescriptionAttachment" >
        PRESCRIPTION_ATTACHMENT
      </isNotNull>    
      <isNotNull prepend="," property="checkFlag" >
        CHECK_FLAG
      </isNotNull>    
      <isNotNull prepend="," property="medicFlag" >
        MEDIC_FLAG
      </isNotNull>
      <isNotNull prepend="," property="commerceName" >
        COMMERCE_NAME
      </isNotNull>
      <isNotNull prepend="," property="orderPv" >
        ORDER_PV
      </isNotNull>
      <isNotNull prepend="," property="orderDiscount" >
        ORDER_DISCOUNT
      </isNotNull>
      <isNotNull prepend="," property="depositSum" >
       	DEPOSIT_SUM  
      </isNotNull>
       <isNotNull prepend="," property="informPayTel" >
        INFORMPAY_TEL 
      </isNotNull>
      )
    </dynamic>
    values
    <dynamic prepend="(" >
      <isNotNull prepend="," property="orderId" >
        #orderId:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="customerAccount" >
        #customerAccount:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="customerName" >
        #customerName:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="customerMobile" >
        #customerMobile:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="orderPurchaserName" >
        #orderPurchaserName:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="orderPurchaserMobile" >
        #orderPurchaserMobile:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="orderPurchaserTel" >
        #orderPurchaserTel:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="orderPurchaserAddr" >
        #orderPurchaserAddr:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="orderPurchaserType" >
        #orderPurchaserType:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="consigneeName" >
        #consigneeName:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="consigneeMobile" >
        #consigneeMobile:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="consigneeTel" >
        #consigneeTel:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="consigneeAddr" >
        #consigneeAddr:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="payMethod" >
        #payMethod:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="fare" >
        #fare:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="deliveryDateType" >
        #deliveryDateType:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="commoditySum" >
        #commoditySum:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="discountAmount" >
        #discountAmount:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="accountBalance" >
        #accountBalance:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="amountPayable" >
        #amountPayable:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="payDate" >
        #payDate#
      </isNotNull>
      <isNotNull prepend="," property="createDate" >
        #createDate#
      </isNotNull>
      <isNotNull prepend="," property="agencyNumber" >
        #agencyNumber:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="settlementNo" >
        #settlementNo:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="stockOutId" >
        #stockOutId:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="distributionId" >
        #distributionId:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="logisticsOrderNo" >
        #logisticsOrderNo:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="orderSource" >
        #orderSource:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="invoiceId" >
        #invoiceId:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="parentOrderCode" >
        #parentOrderCode:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="sonOrderCode" >
        #sonOrderCode:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="orderDescription" >
        #orderDescription:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="orderStatus" >
        #orderStatus:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="orderCode" >
        #orderCode:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="customerId" >
        #customerId:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="orderChannel" >
        #orderChannel:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="disabled" >
        #disabled:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="confirmDelivery" >
        #confirmDelivery:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="logisticsCode" >
        #logisticsCode:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="addressId" >
        #addressId:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="email" >
        #email:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="weight" >
        #weight:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="assessStatus" >
        #assessStatus:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="finishDate" >
        #finishDate#
      </isNotNull>
      <isNotNull prepend="," property="invoiceInfoType" >
        #invoiceInfoType:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="invoiceInfoTitle" >
        #invoiceInfoTitle:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="invoiceInfoContent" >
        #invoiceInfoContent:VARCHAR#
      </isNotNull>      
      <isNotNull prepend="," property="totalCredit" >
        #totalCredit:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="logisticsName" >
        #logisticsName:VARCHAR#
      </isNotNull>       
      <isNotNull prepend="," property="originalOrderSum" >
        #originalOrderSum:DECIMAL#
      </isNotNull>      
      <isNotNull prepend="," property="province">
        #province:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="city">
        #city:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="area">
        #area:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="zipcode">
        #zipcode:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="orderType" >
        #orderType:DECIMAL#
      </isNotNull>    
      <isNotNull prepend="," property="orderOperationRemark" >
        #orderOperationRemark:VARCHAR#
      </isNotNull>  
      <isNotNull prepend="," property="commerceId" >
        #commerceId:VARCHAR#
      </isNotNull>  
      <isNotNull prepend="," property="prizeNumbers" >
        #prizeNumbers:VARCHAR#
      </isNotNull>        
      <isNotNull prepend="," property="prescriptionAttachment" >
        #prescriptionAttachment:VARCHAR#
      </isNotNull>  
      <isNotNull prepend="," property="checkFlag" >
        #checkFlag:DECIMAL#
      </isNotNull>  
      <isNotNull prepend="," property="medicFlag" >
        #medicFlag:DECIMAL#
      </isNotNull>
       <isNotNull prepend="," property="commerceName" >
        #commerceName:VARCHAR#
      </isNotNull> 
      <isNotNull prepend="," property="orderPv" >
        #orderPv:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="orderDiscount" >
        #orderDiscount:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="depositSum" >
        #depositSum:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="informPayTel" >
        #informPayTel:VARCHAR#
      </isNotNull>
      )
    </dynamic>
  </insert>
  <select id="ibatorgenerated_countByExample" parameterClass="com.pltfm.app.entities.OrderMainExample" resultClass="java.lang.Integer" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Tue Nov 05 20:06:33 CST 2013.
    -->
    select count(*) from  ORDER_MAIN
    <include refid="KMORDER_ORDER_MAIN.ibatorgenerated_Example_Where_Clause" />
  </select>
  <update id="ibatorgenerated_updateByExampleSelective" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Tue Nov 05 20:06:33 CST 2013.
    -->
    update  ORDER_MAIN
    <dynamic prepend="set" >
      <isNotNull prepend="," property="record.orderId" >
        ORDER_ID = #record.orderId:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="record.customerAccount" >
        CUSTOMER_ACCOUNT = #record.customerAccount:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.customerName" >
        CUSTOMER_NAME = #record.customerName:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.customerMobile" >
        CUSTOMER_MOBILE = #record.customerMobile:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.orderPurchaserName" >
        ORDER_PURCHASER_NAME = #record.orderPurchaserName:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.orderPurchaserMobile" >
        ORDER_PURCHASER_MOBILE = #record.orderPurchaserMobile:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.orderPurchaserTel" >
        ORDER_PURCHASER_TEL = #record.orderPurchaserTel:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.orderPurchaserAddr" >
        ORDER_PURCHASER_ADDR = #record.orderPurchaserAddr:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.orderPurchaserType" >
        ORDER_PURCHASER_TYPE = #record.orderPurchaserType:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="record.consigneeName" >
        CONSIGNEE_NAME = #record.consigneeName:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.consigneeMobile" >
        CONSIGNEE_MOBILE = #record.consigneeMobile:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.consigneeTel" >
        CONSIGNEE_TEL = #record.consigneeTel:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.consigneeAddr" >
        CONSIGNEE_ADDR = #record.consigneeAddr:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.payMethod" >
        PAY_METHOD = #record.payMethod:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="record.fare" >
        FARE = #record.fare:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="record.deliveryDateType" >
        DELIVERY_DATE_TYPE = #record.deliveryDateType:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="record.commoditySum" >
        COMMODITY_SUM = #record.commoditySum:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="record.discountAmount" >
        DISCOUNT_AMOUNT = #record.discountAmount:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="record.accountBalance" >
        ACCOUNT_BALANCE = #record.accountBalance:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="record.amountPayable" >
        AMOUNT_PAYABLE = #record.amountPayable:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="record.payDate" >
        PAY_DATE = #record.payDate#
      </isNotNull>
      <isNotNull prepend="," property="record.createDate" >
        CREATE_DATE = #record.createDate#
      </isNotNull>
      <isNotNull prepend="," property="record.agencyNumber" >
        AGENCY_NUMBER = #record.agencyNumber:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.settlementNo" >
        SETTLEMENT_NO = #record.settlementNo:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="record.stockOutId" >
        STOCK_OUT_ID = #record.stockOutId:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="record.distributionId" >
        DISTRIBUTION_ID = #record.distributionId:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="record.logisticsOrderNo" >
        LOGISTICS_ORDER_NO = #record.logisticsOrderNo:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.orderSource" >
        ORDER_SOURCE = #record.orderSource:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.invoiceId" >
        INVOICE_ID = #record.invoiceId:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="record.parentOrderCode" >
        PARENT_ORDER_CODE = #record.parentOrderCode:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.sonOrderCode" >
        SON_ORDER_CODE = #record.sonOrderCode:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.orderDescription" >
        ORDER_DESCRIPTION = #record.orderDescription:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.orderStatus" >
        ORDER_STATUS = #record.orderStatus:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="record.orderCode" >
        ORDER_CODE = #record.orderCode:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.customerId" >
        CUSTOMER_ID = #record.customerId:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="record.orderChannel" >
        ORDER_CHANNEL = #record.orderChannel:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.disabled" >
        DISABLED = #record.disabled:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="record.confirmDelivery" >
        CONFIRM_DELIVERY = #record.confirmDelivery:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="record.logisticsCode" >
        LOGISTICS_CODE = #record.logisticsCode:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.addressId" >
        ADDRESS_ID = #record.addressId:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="record.email" >
        EMAIL = #record.email:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.weight" >
        WEIGHT = #record.weight:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="record.assessStatus" >
        ASSESS_STATUS = #record.assessStatus:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="record.finishDate" >
        FINISH_DATE = #record.finishDate#
      </isNotNull>
      <isNotNull prepend="," property="record.invoiceInfoType" >
        INVOICE_INFO_TYPE = #record.invoiceInfoType:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.invoiceInfoTitle" >
        INVOICE_INFO_TITLE = #record.invoiceInfoTitle:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.invoiceInfoContent" >
        INVOICE_INFO_CONTENT = #record.invoiceInfoContent:VARCHAR#
      </isNotNull>     
      <isNotNull prepend="," property="record.totalCredit" >
        TOTAL_CREDIT = #record.totalCredit:DECIMAL#
      </isNotNull> 
      <isNotNull prepend="," property="record.logisticsName" >
        LOGISTICS_NAME = #record.logisticsName:VARCHAR#
      </isNotNull>      
      <isNotNull prepend="," property="record.originalOrderSum" >
        ORIGINAL_ORDER_SUM = #record.originalOrderSum:DECIMAL#
      </isNotNull>   
            <isNotNull prepend="," property="record.province">
        PROVINCE = #record.province:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.city">
        CITY = #record.city:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.area">
        AREA = #record.area:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.zipcode">
        ZIPCODE = #record.zipcode:DECIMAL#
      </isNotNull>  
      <isNotNull prepend="," property="record.orderType" >
        ORDER_TYPE = #record.orderType:DECIMAL#
      </isNotNull>   
      <isNotNull prepend="," property="record.orderOperationRemark" >
        ORDER_OPERATION_REMARK = #record.orderOperationRemark:VARCHAR#
      </isNotNull>   
      <isNotNull prepend="," property="record.commerceId" >
        COMMERCE_ID = #record.commerceId:VARCHAR#
      </isNotNull>   
      <isNotNull prepend="," property="record.prizeNumbers" >
        PRIZE_NUMBERS = #record.prizeNumbers:VARCHAR#
      </isNotNull>   
      <isNotNull prepend="," property="record.prescriptionAttachment" >
        PRESCRIPTION_ATTACHMENT = #record.prescriptionAttachment:VARCHAR#
      </isNotNull>   
      <isNotNull prepend="," property="record.checkFlag" >
        CHECK_FLAG = #record.checkFlag:DECIMAL#
      </isNotNull>   
      <isNotNull prepend="," property="record.medicFlag" >
        MEDIC_FLAG = #record.medicFlag:DECIMAL#
      </isNotNull>   
    </dynamic>
    <isParameterPresent >
      <include refid="KMORDER_ORDER_MAIN.ibatorgenerated_Example_Where_Clause" />
    </isParameterPresent>
  </update>
  <update id="ibatorgenerated_updateByExample" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Tue Nov 05 20:06:33 CST 2013.
    -->
    update  ORDER_MAIN
    set ORDER_ID = #record.orderId:DECIMAL#,
      CUSTOMER_ACCOUNT = #record.customerAccount:VARCHAR#,
      CUSTOMER_NAME = #record.customerName:VARCHAR#,
      CUSTOMER_MOBILE = #record.customerMobile:VARCHAR#,
      ORDER_PURCHASER_NAME = #record.orderPurchaserName:VARCHAR#,
      ORDER_PURCHASER_MOBILE = #record.orderPurchaserMobile:VARCHAR#,
      ORDER_PURCHASER_TEL = #record.orderPurchaserTel:VARCHAR#,
      ORDER_PURCHASER_ADDR = #record.orderPurchaserAddr:VARCHAR#,
      ORDER_PURCHASER_TYPE = #record.orderPurchaserType:DECIMAL#,
      CONSIGNEE_NAME = #record.consigneeName:VARCHAR#,
      CONSIGNEE_MOBILE = #record.consigneeMobile:VARCHAR#,
      CONSIGNEE_TEL = #record.consigneeTel:VARCHAR#,
      CONSIGNEE_ADDR = #record.consigneeAddr:VARCHAR#,
      PAY_METHOD = #record.payMethod:DECIMAL#,
      FARE = #record.fare:DECIMAL#,
      DELIVERY_DATE_TYPE = #record.deliveryDateType:DECIMAL#,
      COMMODITY_SUM = #record.commoditySum:DECIMAL#,
      DISCOUNT_AMOUNT = #record.discountAmount:DECIMAL#,
      ACCOUNT_BALANCE = #record.accountBalance:DECIMAL#,
      AMOUNT_PAYABLE = #record.amountPayable:DECIMAL#,
      PAY_DATE = #record.payDate#,
      CREATE_DATE = #record.createDate#,
      AGENCY_NUMBER = #record.agencyNumber:VARCHAR#,
      SETTLEMENT_NO = #record.settlementNo:DECIMAL#,
      STOCK_OUT_ID = #record.stockOutId:DECIMAL#,
      DISTRIBUTION_ID = #record.distributionId:DECIMAL#,
      LOGISTICS_ORDER_NO = #record.logisticsOrderNo:VARCHAR#,
      ORDER_SOURCE = #record.orderSource:VARCHAR#,
      INVOICE_ID = #record.invoiceId:DECIMAL#,
      PARENT_ORDER_CODE = #record.parentOrderCode:VARCHAR#,
      SON_ORDER_CODE = #record.sonOrderCode:VARCHAR#,
      ORDER_DESCRIPTION = #record.orderDescription:VARCHAR#,
      ORDER_STATUS = #record.orderStatus:DECIMAL#,
      ORDER_CODE = #record.orderCode:VARCHAR#,
      CUSTOMER_ID = #record.customerId:DECIMAL#,
      ORDER_CHANNEL = #record.orderChannel:VARCHAR#,
      DISABLED = #record.disabled:DECIMAL#,
      CONFIRM_DELIVERY = #record.confirmDelivery:DECIMAL#,
      LOGISTICS_CODE = #record.logisticsCode:VARCHAR#,
      ADDRESS_ID = #record.addressId:DECIMAL#,
      EMAIL = #record.email:VARCHAR#,
      WEIGHT = #record.weight:DECIMAL#,
      ASSESS_STATUS = #record.assessStatus:DECIMAL#,
      FINISH_DATE = #record.finishDate#,
      INVOICE_INFO_TYPE = #record.invoiceInfoType:VARCHAR#,
      INVOICE_INFO_TITLE = #record.invoiceInfoTitle:VARCHAR#,
      INVOICE_INFO_CONTENT = #record.invoiceInfoContent:VARCHAR#,
      TOTAL_CREDIT = #record.totalCredit:DECIMAL#,
      LOGISTICS_NAME = #record.logisticsName:VARCHAR#,
      ORIGINAL_ORDER_SUM = #record.originalOrderSum:DECIMAL#,
      PROVINCE = #record.province:VARCHAR#,
      CITY = #record.city:VARCHAR#,
      AREA = #record.area:VARCHAR#,
      ZIPCODE = #record.zipcode:DECIMAL#,
      ORDER_TYPE = #record.orderType:DECIMAL#,
      ORDER_OPERATION_REMARK = #record.orderOperationRemark:VARCHAR#,
      COMMERCE_ID = #record.commerceId:VARCHAR#,
      PRIZE_NUMBERS = #record.prizeNumbers:VARCHAR#,
      PRESCRIPTION_ATTACHMENT = #record.prescriptionAttachment:VARCHAR#,
      CHECK_FLAG = #record.checkFlag:DECIMAL#,
      MEDIC_FLAG = #record.medicFlag:DECIMAL#
    <isParameterPresent >
      <include refid="KMORDER_ORDER_MAIN.ibatorgenerated_Example_Where_Clause" />
    </isParameterPresent>
  </update>
  <update id="ibatorgenerated_updateByPrimaryKeySelective" parameterClass="com.pltfm.app.entities.OrderMain" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Tue Nov 05 20:06:33 CST 2013.
    -->
    update  ORDER_MAIN
    <dynamic prepend="set" >
      <isNotNull prepend="," property="customerAccount" >
        CUSTOMER_ACCOUNT = #customerAccount:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="customerName" >
        CUSTOMER_NAME = #customerName:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="customerMobile" >
        CUSTOMER_MOBILE = #customerMobile:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="orderPurchaserName" >
        ORDER_PURCHASER_NAME = #orderPurchaserName:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="orderPurchaserMobile" >
        ORDER_PURCHASER_MOBILE = #orderPurchaserMobile:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="orderPurchaserTel" >
        ORDER_PURCHASER_TEL = #orderPurchaserTel:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="orderPurchaserAddr" >
        ORDER_PURCHASER_ADDR = #orderPurchaserAddr:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="orderPurchaserType" >
        ORDER_PURCHASER_TYPE = #orderPurchaserType:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="consigneeName" >
        CONSIGNEE_NAME = #consigneeName:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="consigneeMobile" >
        CONSIGNEE_MOBILE = #consigneeMobile:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="consigneeTel" >
        CONSIGNEE_TEL = #consigneeTel:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="consigneeAddr" >
        CONSIGNEE_ADDR = #consigneeAddr:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="payMethod" >
        PAY_METHOD = #payMethod:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="fare" >
        FARE = #fare:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="deliveryDateType" >
        DELIVERY_DATE_TYPE = #deliveryDateType:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="commoditySum" >
        COMMODITY_SUM = #commoditySum:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="discountAmount" >
        DISCOUNT_AMOUNT = #discountAmount:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="accountBalance" >
        ACCOUNT_BALANCE = #accountBalance:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="amountPayable" >
        AMOUNT_PAYABLE = #amountPayable:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="payDate" >
        PAY_DATE = #payDate#
      </isNotNull>
      <isNotNull prepend="," property="createDate" >
        CREATE_DATE = #createDate#
      </isNotNull>
      <isNotNull prepend="," property="agencyNumber" >
        AGENCY_NUMBER = #agencyNumber:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="settlementNo" >
        SETTLEMENT_NO = #settlementNo:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="stockOutId" >
        STOCK_OUT_ID = #stockOutId:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="distributionId" >
        DISTRIBUTION_ID = #distributionId:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="logisticsOrderNo" >
        LOGISTICS_ORDER_NO = #logisticsOrderNo:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="orderSource" >
        ORDER_SOURCE = #orderSource:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="invoiceId" >
        INVOICE_ID = #invoiceId:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="parentOrderCode" >
        PARENT_ORDER_CODE = #parentOrderCode:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="sonOrderCode" >
        SON_ORDER_CODE = #sonOrderCode:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="orderDescription" >
        ORDER_DESCRIPTION = #orderDescription:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="orderStatus" >
        ORDER_STATUS = #orderStatus:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="orderCode" >
        ORDER_CODE = #orderCode:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="customerId" >
        CUSTOMER_ID = #customerId:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="orderChannel" >
        ORDER_CHANNEL = #orderChannel:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="disabled" >
        DISABLED = #disabled:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="confirmDelivery" >
        CONFIRM_DELIVERY = #confirmDelivery:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="logisticsCode" >
        LOGISTICS_CODE = #logisticsCode:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="addressId" >
        ADDRESS_ID = #addressId:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="email" >
        EMAIL = #email:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="weight" >
        WEIGHT = #weight:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="assessStatus" >
        ASSESS_STATUS = #assessStatus:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="finishDate" >
        FINISH_DATE = #finishDate#
      </isNotNull>
      <isNotNull prepend="," property="invoiceInfoType" >
        INVOICE_INFO_TYPE = #invoiceInfoType:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="invoiceInfoTitle" >
        INVOICE_INFO_TITLE = #invoiceInfoTitle:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="invoiceInfoContent" >
        INVOICE_INFO_CONTENT = #invoiceInfoContent:VARCHAR#
      </isNotNull>     
      <isNotNull prepend="," property="totalCredit" >
        TOTAL_CREDIT = #totalCredit:DECIMAL#
      </isNotNull> 
      <isNotNull prepend="," property="logisticsName" >
        LOGISTICS_NAME = #logisticsName:VARCHAR#
      </isNotNull>      
      <isNotNull prepend="," property="originalOrderSum" >
        ORIGINAL_ORDER_SUM = #originalOrderSum:DECIMAL#
      </isNotNull> 
            <isNotNull prepend="," property="province">
        PROVINCE = #province:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="city">
        CITY = #city:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="area">
        AREA = #area:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="zipcode">
        ZIPCODE = #zipcode:DECIMAL#
      </isNotNull>   
      <isNotNull prepend="," property="orderType" >
        ORDER_TYPE= #orderType:DECIMAL#
      </isNotNull>   
      <isNotNull prepend="," property="orderOperationRemark" >
        ORDER_OPERATION_REMARK = #orderOperationRemark:VARCHAR#
      </isNotNull>   
      <isNotNull prepend="," property="commerceId" >
        COMMERCE_ID = #commerceId:VARCHAR#
      </isNotNull>   
      <isNotNull prepend="," property="prizeNumbers" >
        PRIZE_NUMBERS = #prizeNumbers:VARCHAR#
      </isNotNull>   
      <isNotNull prepend="," property="prescriptionAttachment" >
        PRESCRIPTION_ATTACHMENT = #prescriptionAttachment:VARCHAR#
      </isNotNull>   
      <isNotNull prepend="," property="checkFlag" >
        CHECK_FLAG = #checkFlag:DECIMAL#
      </isNotNull>   
      <isNotNull prepend="," property="medicFlag" >
        MEDIC_FLAG = #medicFlag:DECIMAL#
      </isNotNull>   
    </dynamic>
    where ORDER_ID = #orderId:DECIMAL#
  </update>
   <update id="ibatorgenerated_updateByOrderCodeSelective" parameterClass="com.pltfm.app.entities.OrderMain">
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Mon Jul 29 11:23:58 CST 2013.
    -->
    update  ORDER_MAIN
    <dynamic prepend="set">
      <isNotNull prepend="," property="customerAccount">
        CUSTOMER_ACCOUNT = #customerAccount:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="customerName">
        CUSTOMER_NAME = #customerName:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="customerMobile">
        CUSTOMER_MOBILE = #customerMobile:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="orderPurchaserName">
        ORDER_PURCHASER_NAME = #orderPurchaserName:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="orderPurchaserMobile">
        ORDER_PURCHASER_MOBILE = #orderPurchaserMobile:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="orderPurchaserTel">
        ORDER_PURCHASER_TEL = #orderPurchaserTel:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="orderPurchaserAddr">
        ORDER_PURCHASER_ADDR = #orderPurchaserAddr:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="orderPurchaserType">
        ORDER_PURCHASER_TYPE = #orderPurchaserType:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="consigneeName">
        CONSIGNEE_NAME = #consigneeName:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="consigneeMobile">
        CONSIGNEE_MOBILE = #consigneeMobile:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="consigneeTel">
        CONSIGNEE_TEL = #consigneeTel:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="consigneeAddr">
        CONSIGNEE_ADDR = #consigneeAddr:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="payMethod">
        PAY_METHOD = #payMethod:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="fare">
        FARE = #fare:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="deliveryDateType">
        DELIVERY_DATE_TYPE = #deliveryDateType:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="commoditySum">
        COMMODITY_SUM = #commoditySum:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="discountAmount">
        DISCOUNT_AMOUNT = #discountAmount:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="accountBalance">
        ACCOUNT_BALANCE = #accountBalance:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="amountPayable">
        AMOUNT_PAYABLE = #amountPayable:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="payDate">
        PAY_DATE = #payDate#
      </isNotNull>
      <isNotNull prepend="," property="createDate">
        CREATE_DATE = #createDate#
      </isNotNull>
      <isNotNull prepend="," property="agencyNumber">
        AGENCY_NUMBER = #agencyNumber:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="settlementNo">
        SETTLEMENT_NO = #settlementNo:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="stockOutId">
        STOCK_OUT_ID = #stockOutId:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="distributionId">
        DISTRIBUTION_ID = #distributionId:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="logisticsOrderNo">
        LOGISTICS_ORDER_NO = #logisticsOrderNo:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="orderSource">
        ORDER_SOURCE = #orderSource:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="invoiceId">
        INVOICE_ID = #invoiceId:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="parentOrderCode">
        PARENT_ORDER_CODE = #parentOrderCode:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="sonOrderCode">
        SON_ORDER_CODE = #sonOrderCode:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="orderDescription">
        ORDER_DESCRIPTION = #orderDescription:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="orderStatus">
        ORDER_STATUS = #orderStatus:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="customerId">
        CUSTOMER_ID = #customerId:DECIMAL#
      </isNotNull>            
      <isNotNull prepend="," property="orderChannel">
        ORDER_CHANNEL = #orderChannel:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="disabled">
        DISABLED = #disabled:DECIMAL#
      </isNotNull>       
      <isNotNull prepend="," property="confirmDelivery">
        CONFIRM_DELIVERY = #confirmDelivery:DECIMAL#
      </isNotNull> 
      <isNotNull prepend="," property="logisticsCode">
        LOGISTICS_CODE = #logisticsCode:VARCHAR#
      </isNotNull>    
      <isNotNull prepend="," property="addressId">
        ADDRESS_ID = #addressId:DECIMAL#
      </isNotNull>       
      <isNotNull prepend="," property="email">
        EMAIL = #email:VARCHAR#
      </isNotNull>                 
      <isNotNull prepend="," property="weight">
        WEIGHT = #weight:DECIMAL#
      </isNotNull>  
      <isNotNull prepend="," property="assessStatus">
        ASSESS_STATUS = #assessStatus:DECIMAL#
      </isNotNull>                 
      <isNotNull prepend="," property="finishDate">
        FINISH_DATE = #finishDate#
      </isNotNull>       
      <isNotNull prepend="," property="invoiceInfoType" >
        INVOICE_INFO_TYPE = #invoiceInfoType:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="invoiceInfoTitle" >
        INVOICE_INFO_TITLE = #invoiceInfoTitle:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="invoiceInfoContent" >
        INVOICE_INFO_CONTENT = #invoiceInfoContent:VARCHAR#
      </isNotNull>      
      <isNotNull prepend="," property="totalCredit">
        TOTAL_CREDIT = #totalCredit:DECIMAL#
      </isNotNull>        
      <isNotNull prepend="," property="logisticsName" >
        LOGISTICS_NAME = #logisticsName:VARCHAR#
      </isNotNull>      
      <isNotNull prepend="," property="originalOrderSum" >
        ORIGINAL_ORDER_SUM = #originalOrderSum:DECIMAL#
      </isNotNull>  
            <isNotNull prepend="," property="province">
        PROVINCE = #province:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="city">
        CITY = #city:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="area">
        AREA = #area:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="zipcode">
        ZIPCODE = #zipcode:DECIMAL#
      </isNotNull>        
      <isNotNull prepend="," property="orderType">
        ORDER_TYPE = #orderType:DECIMAL#
      </isNotNull>  
      <isNotNull prepend="," property="orderOperationRemark" >
        ORDER_OPERATION_REMARK = #orderOperationRemark:VARCHAR#
      </isNotNull>    
      <isNotNull prepend="," property="commerceId" >
        COMMERCE_ID = #commerceId:VARCHAR#
      </isNotNull>    
      <isNotNull prepend="," property="prizeNumbers" >
        PRIZE_NUMBERS = #prizeNumbers:VARCHAR#
      </isNotNull>    
      <isNotNull prepend="," property="prescriptionAttachment" >
        PRESCRIPTION_ATTACHMENT = #prescriptionAttachment:VARCHAR#
      </isNotNull>    
      <isNotNull prepend="," property="checkFlag" >
        CHECK_FLAG = #checkFlag:DECIMAL#
      </isNotNull>    
      <isNotNull prepend="," property="medicFlag" >
        MEDIC_FLAG = #medicFlag:DECIMAL#
      </isNotNull>    
    </dynamic>
    where ORDER_CODE = #orderCode:VARCHAR#
  </update>
  <update id="changeOrderInfoSelective" parameterClass="java.util.Map">
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Mon Jul 29 11:23:58 CST 2013.
    -->
    update  ORDER_MAIN
    <dynamic prepend="set">
      <isNotNull prepend="," property="consigneeName">
        CONSIGNEE_NAME = #consigneeName:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="consigneeMobile">
        CONSIGNEE_MOBILE = #consigneeMobile:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="consigneeTel">
        CONSIGNEE_TEL = #consigneeTel:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="consigneeAddr">
        CONSIGNEE_ADDR = #consigneeAddr:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="deliveryDateType">
        DELIVERY_DATE_TYPE = #deliveryDateType:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="email">
        EMAIL = #email:VARCHAR#
      </isNotNull>                      
      <isEqual prepend="," property="hasInvoice"  compareValue="Y">
	        INVOICE_INFO_TYPE = '普通发票'
	      <isNotNull prepend="," property="invoiceInfoTitle" >
	        INVOICE_INFO_TITLE = #invoiceInfoTitle:VARCHAR#
	      </isNotNull>    
      </isEqual>
      <isEqual prepend="," property="hasInvoice"  compareValue="N">
	        INVOICE_INFO_TYPE = NULL,
	        INVOICE_INFO_TITLE = NULL
      </isEqual>
      <isNotNull prepend="," property="orderOperationRemark" >
        ORDER_OPERATION_REMARK = #orderOperationRemark:VARCHAR#
      </isNotNull>    
      <isNotNull prepend="," property="commerceId" >
        COMMERCE_ID = #commerceId:VARCHAR#
      </isNotNull>    
      <isNotNull prepend="," property="prizeNumbers" >
        PRIZE_NUMBERS = #prizeNumbers:VARCHAR#
      </isNotNull> 
      <isNotNull prepend="," property="fare">
        FARE = #fare:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="amountPayable">
        AMOUNT_PAYABLE = #amountPayable:DECIMAL#
      </isNotNull>
    </dynamic>
    where ORDER_CODE = #orderCode:VARCHAR#
  </update>
  <update id="ibatorgenerated_updateByPrimaryKey" parameterClass="com.pltfm.app.entities.OrderMain">
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Tue Nov 05 20:06:33 CST 2013.
    -->
    update  ORDER_MAIN
    set CUSTOMER_ACCOUNT = #customerAccount:VARCHAR#,
      CUSTOMER_NAME = #customerName:VARCHAR#,
      CUSTOMER_MOBILE = #customerMobile:VARCHAR#,
      ORDER_PURCHASER_NAME = #orderPurchaserName:VARCHAR#,
      ORDER_PURCHASER_MOBILE = #orderPurchaserMobile:VARCHAR#,
      ORDER_PURCHASER_TEL = #orderPurchaserTel:VARCHAR#,
      ORDER_PURCHASER_ADDR = #orderPurchaserAddr:VARCHAR#,
      ORDER_PURCHASER_TYPE = #orderPurchaserType:DECIMAL#,
      CONSIGNEE_NAME = #consigneeName:VARCHAR#,
      CONSIGNEE_MOBILE = #consigneeMobile:VARCHAR#,
      CONSIGNEE_TEL = #consigneeTel:VARCHAR#,
      CONSIGNEE_ADDR = #consigneeAddr:VARCHAR#,
      PAY_METHOD = #payMethod:DECIMAL#,
      FARE = #fare:DECIMAL#,
      DELIVERY_DATE_TYPE = #deliveryDateType:DECIMAL#,
      COMMODITY_SUM = #commoditySum:DECIMAL#,
      DISCOUNT_AMOUNT = #discountAmount:DECIMAL#,
      ACCOUNT_BALANCE = #accountBalance:DECIMAL#,
      AMOUNT_PAYABLE = #amountPayable:DECIMAL#,
      PAY_DATE = #payDate#,
      CREATE_DATE = #createDate#,
      AGENCY_NUMBER = #agencyNumber:VARCHAR#,
      SETTLEMENT_NO = #settlementNo:DECIMAL#,
      STOCK_OUT_ID = #stockOutId:DECIMAL#,
      DISTRIBUTION_ID = #distributionId:DECIMAL#,
      LOGISTICS_ORDER_NO = #logisticsOrderNo:VARCHAR#,
      ORDER_SOURCE = #orderSource:VARCHAR#,
      INVOICE_ID = #invoiceId:DECIMAL#,
      PARENT_ORDER_CODE = #parentOrderCode:VARCHAR#,
      SON_ORDER_CODE = #sonOrderCode:VARCHAR#,
      ORDER_DESCRIPTION = #orderDescription:VARCHAR#,
      ORDER_STATUS = #orderStatus:DECIMAL#,
      ORDER_CODE = #orderCode:VARCHAR#,
      CUSTOMER_ID = #customerId:DECIMAL#,
      ORDER_CHANNEL = #orderChannel:VARCHAR#,
      DISABLED = #disabled:DECIMAL#,
      CONFIRM_DELIVERY = #confirmDelivery:DECIMAL#,
      LOGISTICS_CODE = #logisticsCode:VARCHAR#,
      ADDRESS_ID = #addressId:DECIMAL#,
      EMAIL = #email:VARCHAR#,
      WEIGHT = #weight:DECIMAL#,
      ASSESS_STATUS = #assessStatus:DECIMAL#,
      FINISH_DATE = #finishDate#,
      INVOICE_INFO_TYPE = #invoiceInfoType:VARCHAR#,
      INVOICE_INFO_TITLE = #invoiceInfoTitle:VARCHAR#,
      INVOICE_INFO_CONTENT = #invoiceInfoContent:VARCHAR#,
      TOTAL_CREDIT = #totalCredit:DECIMAL#,
      LOGISTICS_NAME = #logisticsName:VARCHAR#,
      ORIGINAL_ORDER_SUM = #originalOrderSum:DECIMAL#,
      PROVINCE = #province:VARCHAR#,
      CITY = #city:VARCHAR#,
      AREA = #area:VARCHAR#,
      ZIPCODE = #zipcode:DECIMAL#,
      ORDER_TYPE = #orderType:DECIMAL#,
      ORDER_OPERATION_REMARK = #orderOperationRemark:VARCHAR#,
      COMMERCE_ID = #commerceId:VARCHAR#,
      PRIZE_NUMBERS = #prizeNumbers:VARCHAR#,
      PRESCRIPTION_ATTACHMENT = #prescriptionAttachment:VARCHAR#,
      CHECK_FLAG = #checkFlag:DECIMAL#,
      MEDIC_FLAG = #medicFlag:DECIMAL#
    where ORDER_ID = #orderId:DECIMAL#
  </update>
  <update id="ibatorgenerated_updateByKey" parameterClass="com.pltfm.app.entities.OrderMain">
  	 update  ORDER_MAIN
    set ORDER_STATUS = #orderStatus:DECIMAL#
    where ORDER_ID = #orderId:DECIMAL#
  </update>
  
  <!-- 渠道过滤 -->
  <sql id="channel_filter">
  	and OM.ORDER_CHANNEL in(select uc.CHANNEL_NAME from SYS_USER u,USER_CHANNEL uc where u.USER_ID=uc.USER_ID and uc.USER_ID=#sysuser.userId#)
  </sql>
  
  <!-- map方式查询订单列表 （不包含子单）-->
  <sql id="Map_Where_Clause_WithoutSplit">
		FROM
			ORDER_MAIN OM
			JOIN ORDER_ITEM OI ON OM.ORDER_CODE = OI.ORDER_CODE
			<!-- and OM.ORDER_CHANNEL in(select uc.CHANNEL_NAME from SYS_USER u,USER_CHANNEL uc where u.USER_ID=uc.USER_ID and uc.USER_ID=#sysuser.userId#) -->
			LEFT JOIN ORDER_HANDLE OH ON  OM.ORDER_CODE = OH.ORDER_CODE
			WHERE OM.PARENT_ORDER_CODE IS NULL
  		<dynamic>
  			<!-- 订单号 -->
			<isNotEmpty prepend="AND" property="orderCode">
				OM.ORDER_CODE = #orderCode# 
			</isNotEmpty>
			<!--  <isEmpty prepend="AND" property="orderCode">
				OM.ORDER_STATUS != 16
			</isEmpty>-->
			<!-- 订单状态  -->
			<isNotEmpty prepend="AND" property="status">
				OM.ORDER_STATUS = #status#
			</isNotEmpty>
			<isNotEmpty  prepend="AND" property="statusArr">
				OM.ORDER_STATUS in
				<iterate open="(" close=")" conjunction="," property="statusArr">  
 					<![CDATA[#statusArr[]#]]>
				</iterate> 
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="nstatus">
			<![CDATA[ OM.ORDER_STATUS not in ]]>
			    <iterate open="(" close=")" conjunction="," property="nstatus">  
 					<![CDATA[#nstatus[]#]]>
				</iterate>  
			</isNotEmpty>
			<!-- 支付时间  -->
			<isNotEmpty prepend="AND" property="payDateStart">
			<![CDATA[
				trunc(OM.PAY_DATE,'mi')>=to_date(#payDateStart#,'yyyy-MM-dd HH24:mi:ss')
				and trunc(OM.PAY_DATE,'mi')<=to_date(#payDateEnd#,'yyyy-MM-dd HH24:mi:ss')
			]]>
			</isNotEmpty>
			<isEmpty property="payDateStart">
			<!-- 支付时间范围 -->
			<isNotEmpty prepend="AND" property="payDateRange">
				<isEqual property="payDateRange" compareValue="today">
					TO_CHAR(OM.PAY_DATE, 'yyyyMMdd') = TO_CHAR(SYSDATE, 'yyyyMMdd')
				</isEqual>
				<isEqual property="payDateRange" compareValue="ysday">
					TO_CHAR(OM.PAY_DATE, 'yyyyMMdd') = TO_CHAR(SYSDATE-1, 'yyyyMMdd')
				</isEqual>
				<isEqual property="payDateRange" compareValue="tsweek">
					OM.PAY_DATE BETWEEN TRUNC(SYSDATE,'IW') AND TRUNC(SYSDATE,'IW') + 6
				</isEqual>
				<isEqual property="payDateRange" compareValue="lsweek">
					OM.PAY_DATE BETWEEN TRUNC(SYSDATE-7,'IW') AND TRUNC(SYSDATE-7,'IW') + 6 
				</isEqual>
				<isEqual property="payDateRange" compareValue="tsmonth">
					TO_CHAR(OM.PAY_DATE, 'yyyyMM') = TO_CHAR(SYSDATE, 'yyyyMM')
				</isEqual>
				<isEqual property="payDateRange" compareValue="lsmonth">
					TO_CHAR(ADD_MONTHS(OM.PAY_DATE,1), 'yyyyMM') = TO_CHAR(SYSDATE, 'yyyyMM')
				</isEqual>
			</isNotEmpty>
			</isEmpty>
			<!-- 下单时间  -->
			<isNotEmpty prepend="AND" property="createDateStart">
			<![CDATA[
				trunc(OM.CREATE_DATE,'mi')>=to_date(#createDateStart#,'yyyy-MM-dd HH24:mi:ss')
				and trunc(OM.CREATE_DATE,'mi')<=to_date(#createDateEnd#,'yyyy-MM-dd HH24:mi:ss')
			]]>
			</isNotEmpty>
			<isEmpty property="createDateStart">
			<!-- 下单时间范围 -->
			<isNotEmpty prepend="AND" property="createDateRange">
				<isEqual property="createDateRange" compareValue="today">
					TO_CHAR(OM.CREATE_DATE, 'yyyyMMdd') = TO_CHAR(SYSDATE, 'yyyyMMdd')
				</isEqual>
				<isEqual property="createDateRange" compareValue="ysday">
					TO_CHAR(OM.CREATE_DATE, 'yyyyMMdd') = TO_CHAR(SYSDATE-1, 'yyyyMMdd')
				</isEqual>
				<isEqual property="createDateRange" compareValue="tsweek">
					OM.CREATE_DATE BETWEEN TRUNC(SYSDATE,'IW') AND TRUNC(SYSDATE,'IW') + 6
				</isEqual>
				<isEqual property="createDateRange" compareValue="lsweek">
					OM.CREATE_DATE BETWEEN TRUNC(SYSDATE-7,'IW') AND TRUNC(SYSDATE-7,'IW') + 6 
				</isEqual>
				<isEqual property="createDateRange" compareValue="tsmonth">
					TO_CHAR(OM.CREATE_DATE, 'yyyyMM') = TO_CHAR(SYSDATE, 'yyyyMM')
				</isEqual>
				<isEqual property="createDateRange" compareValue="lsmonth">
					TO_CHAR(ADD_MONTHS(OM.CREATE_DATE,1), 'yyyyMM') = TO_CHAR(SYSDATE, 'yyyyMM')
				</isEqual>
			</isNotEmpty>
			</isEmpty>
			<!-- 渠道  -->
			<!-- <isNotEmpty prepend="AND" property="channel">
				OM.ORDER_CHANNEL=#channel# 
			</isNotEmpty> -->
			<!-- 商品名称  -->
			<isNotEmpty prepend="AND" property="commodityName">
				OI.COMMODITY_NAME=#commodityName# 
			</isNotEmpty>
			<!-- 商品编号  --> 
			<isNotEmpty prepend="AND" property="commodityCode">
				OI.COMMODITY_CODE=#commodityCode# 
			</isNotEmpty>
			<!-- 下单账号 -->
			<isNotEmpty prepend="AND" property="customerAccount">
				OM.CUSTOMER_ACCOUNT=#customerAccount#
			</isNotEmpty>
			<!-- 收货人 -->
			<isNotEmpty prepend="AND" property="consigneeName">
				OM.CONSIGNEE_NAME=#consigneeName#
			</isNotEmpty>
			<!-- 收货人电话 -->
			<isNotEmpty prepend="AND" property="consigneeMobile">
				OM.CONSIGNEE_MOBILE=#consigneeMobile#
			</isNotEmpty>
			<!-- 下单类型 -->
			<!-- <isNotEmpty prepend="AND" property="orderPurchaserType">
				<isEqual property="orderPurchaserType" compareValue="4">
            exists (select 1
          from   era_info ei
         where ei.n_login_id = om.customer_id)
            </isEqual>
		 <isNotEqual property="orderPurchaserType" compareValue="4">
			om.order_purchaser_type = #orderPurchaserType#
		 </isNotEqual>
			</isNotEmpty> -->
			<isNotEmpty prepend="AND" property="orderPurchaserType">
				OM.order_purchaser_type=#orderPurchaserType#
			</isNotEmpty>
			<!-- 客服账户 -->
			<isNotEmpty prepend="AND" property="agencyNumber">
				OM.AGENCY_NUMBER=#agencyNumber#
			</isNotEmpty>
			<!-- 出库单号 -->
			<isNotEmpty prepend="AND" property="stockOutID">
				OM.STOCK_OUT_ID=#stockOutID#
			</isNotEmpty>
			<!-- 结转单号 -->
			<isNotEmpty prepend="AND" property="settlementNo">
				OM.SETTLEMENT_NO=#settlementNo#
			</isNotEmpty>
			<!-- 配送单号 -->
			<isNotEmpty prepend="AND" property="distributionId">
				OM.DISTRIBUTION_ID=#distributionId#
			</isNotEmpty>
			<!-- 可见性 -->
			<isNotEmpty prepend="AND" property="disabled">
				OM.DISABLED = #disabled#
			</isNotEmpty>
			<!-- 是否已评价 -->
			<isEqual prepend="AND" property="assess" compareValue="true">
				OM.ASSESS_STATUS IN (2,3)
			</isEqual>
			<!-- 处理标记 -->
			<isNotEmpty  prepend="and" property="handle">
			<isEqual property="handle" compareValue="2">
				exists (select 1 from order_handle oh where om.order_code = oh.order_code and (
					oh.handle_state = #handle#
			</isEqual>
			<isEqual property="handle" compareValue="1">
				not exists (select 1 from order_handle oh where om.order_code = oh.order_code and (
					oh.handle_state = 2
			</isEqual>
			) )
		</isNotEmpty>
			<!-- 供应商 -->
			<isNotEmpty  prepend="AND" property="supplier">
				OI.SUPPLIER=#supplier#
			</isNotEmpty>
		</dynamic>
  </sql>
  
  <!-- map方式查询订单列表 -->
  <sql id="MAP_WHERE_CLAUSE_FOR_COUNT">
		from order_main om where 1=1 
		<!-- 订单状态  -->
		<isNotEmpty prepend="AND" property="status">
			om.order_status = #status#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="nstatus">
		<![CDATA[ om.order_status not in ]]>
		    <iterate open="(" close=")" conjunction="," property="nstatus">  
					<![CDATA[#nstatus[]#]]>
			</iterate>  
		</isNotEmpty>
		<isNotEmpty property="commodityName">
			and exists (select 1 from order_item oi where om.order_code = oi.order_code
				and oi.commodity_name = #commodityName#
			<isNotEmpty property="commodityCode">
			 	and oi.commodity_code = #commodityCode#
			</isNotEmpty>
			 )
		</isNotEmpty>
		<isEmpty property="commodityName">
			<isNotEmpty property="commodityCode">
			and exists (select 1 from order_item oi where om.order_code = oi.order_code
				and oi.commodity_code = #commodityCode# )
			</isNotEmpty>
		</isEmpty>
		<!-- 下单账号 -->
		<isNotEmpty prepend="and" property="customerAccount">
			om.customer_account=#customerAccount#
		</isNotEmpty>
		<!-- 收货人 -->
		<isNotEmpty prepend="and" property="consigneeName">
			om.consignee_name=#consigneeName#
		</isNotEmpty>
		<!-- 收货人电话 -->
		<isNotEmpty prepend="and" property="consigneeMobile">
			om.consignee_mobile=#consigneeMobile#
		</isNotEmpty>
		<!-- 下单类型 -->
		<!-- <isNotEmpty prepend="and" property="orderPurchaserType">
			<isEqual property="orderPurchaserType" compareValue="4">
            exists (select 1
          from   era_info ei
         where ei.n_login_id = om.customer_id)
            </isEqual>
		 <isNotEqual property="orderPurchaserType" compareValue="4">
			om.order_purchaser_type = #orderPurchaserType#
		 </isNotEqual>
		</isNotEmpty> -->
		<isNotEmpty prepend="and" property="orderPurchaserType">
			om.order_purchaser_type=#orderPurchaserType#
		</isNotEmpty>
		<!-- 客服账户 -->
		<isNotEmpty prepend="and" property="agencyNumber">
			om.agency_number=#agencyNumber#
		</isNotEmpty>
		<!-- 出库单号 -->
		<isNotEmpty prepend="and" property="stockOutID">
			om.stock_out_id=#stockOutID#
		</isNotEmpty>
		<!-- 结转单号 -->
		<isNotEmpty prepend="and" property="settlementNo">
			om.settlement_no=#settlementNo#
		</isNotEmpty>
		<!-- 配送单号 -->
		<isNotEmpty prepend="and" property="distributionId">
			om.distribution_id=#distributionId#
		</isNotEmpty>
		<!-- 可见性 -->
		<isNotEmpty prepend="and" property="disabled">
			om.disabled = #disabled#
		</isNotEmpty>
		<!-- 是否已评价 -->
		<isEqual prepend="and" property="assess" compareValue="true">
			om.assess_status IN (2,3)
		</isEqual>
		<!-- 处理标记 -->
	<isNotEmpty  prepend="and" property="handle">
			<isEqual property="handle" compareValue="2">
				exists (select 1 from order_handle oh where om.order_code = oh.order_code and (
					oh.handle_state = #handle#
			</isEqual>
			<isEqual property="handle" compareValue="1">
				not exists (select 1 from order_handle oh where om.order_code = oh.order_code and (
					oh.handle_state = 2
			</isEqual>
			) )
		</isNotEmpty>
		<!-- 支付时间  -->
		<isNotEmpty prepend="and" property="payDateStart">
		<![CDATA[
			trunc(om.pay_date,'mi')>=to_date(#payDateStart#,'yyyy-MM-dd HH24:mi:ss')
			and trunc(om.pay_date,'mi')<=to_date(#payDateEnd#,'yyyy-MM-dd HH24:mi:ss')
		]]>
		</isNotEmpty>
		<isEmpty property="payDateStart">
		<!-- 支付时间范围 -->
		<isNotEmpty prepend="and" property="payDateRange">
			<isEqual property="payDateRange" compareValue="today">
				to_char(om.pay_date, 'yyyyMMdd') = to_char(sysdate, 'yyyyMMdd')
			</isEqual>
			<isEqual property="payDateRange" compareValue="ysday">
				to_char(om.pay_date, 'yyyyMMdd') = to_char(sysdate-1, 'yyyyMMdd')
			</isEqual>
			<isEqual property="payDateRange" compareValue="tsweek">
				om.pay_date between trunc(sysdate,'IW') AND trunc(sysdate,'IW') + 6
			</isEqual>
			<isEqual property="payDateRange" compareValue="lsweek">
				om.pay_date between trunc(SYSDATE-7,'IW') AND trunc(sysdate-7,'IW') + 6 
			</isEqual>
			<isEqual property="payDateRange" compareValue="tsmonth">
				to_char(om.pay_date, 'yyyyMM') = to_char(sysdate, 'yyyyMM')
			</isEqual>
			<isEqual property="payDateRange" compareValue="lsmonth">
				to_char(add_months(om.pay_date,1), 'yyyyMM') = to_char(sysdate, 'yyyyMM')
			</isEqual>
		</isNotEmpty>
		</isEmpty>
		<!-- 下单时间  -->
		<isNotEmpty prepend="AND" property="createDateStart">
		<![CDATA[
			trunc(om.create_date,'mi')>=to_date(#createDateStart#,'yyyy-MM-dd HH24:mi:ss')
		]]>
			<isNotEmpty property="createDateStart">
		<![CDATA[
			and trunc(om.create_date,'mi')<=to_date(#createDateEnd#,'yyyy-MM-dd HH24:mi:ss')
		]]>
			</isNotEmpty>
		</isNotEmpty>
		<isEmpty property="createDateStart">
		<!-- 下单时间范围 -->
			<isNotEmpty prepend="AND" property="createDateRange">
				<isEqual property="createDateRange" compareValue="today">
					to_char(om.create_date, 'yyyyMMdd') = TO_CHAR(SYSDATE, 'yyyyMMdd')
				</isEqual>
				<isEqual property="createDateRange" compareValue="ysday">
					TO_CHAR(OM.CREATE_DATE, 'yyyyMMdd') = TO_CHAR(SYSDATE-1, 'yyyyMMdd')
				</isEqual>
				<isEqual property="createDateRange" compareValue="tsweek">
					OM.CREATE_DATE BETWEEN TRUNC(SYSDATE,'IW') AND TRUNC(SYSDATE,'IW') + 6
				</isEqual>
				<isEqual property="createDateRange" compareValue="lsweek">
					OM.CREATE_DATE BETWEEN TRUNC(SYSDATE-7,'IW') AND TRUNC(SYSDATE-7,'IW') + 6 
				</isEqual>
				<isEqual property="createDateRange" compareValue="tsmonth">
					TO_CHAR(OM.CREATE_DATE, 'yyyyMM') = TO_CHAR(SYSDATE, 'yyyyMM')
				</isEqual>
				<isEqual property="createDateRange" compareValue="lsmonth">
					TO_CHAR(ADD_MONTHS(OM.CREATE_DATE,1), 'yyyyMM') = TO_CHAR(SYSDATE, 'yyyyMM')
				</isEqual>
			</isNotEmpty>
		</isEmpty>
		<!-- 渠道  -->
		<!-- <isNotEmpty prepend="AND" property="channel">
			OM.ORDER_CHANNEL=#channel# 
		</isNotEmpty> -->
		<!-- 供应商 -->
		<isNotEmpty property="commerceId">
			and om.commerce_id=#commerceId# 
		</isNotEmpty>
		<!-- <isEmpty property="commerceId">
			and exists (select 1 from user_channel uc where om.order_channel=uc.channel_name and uc.user_id=#sysuser.userId#)
		</isEmpty> -->
		<!-- 订单号 -->
		<isNotEmpty prepend="AND" property="orderCode">
			OM.ORDER_CODE = #orderCode# 
		</isNotEmpty>
  </sql>
  
  <!-- map方式查询订单列表 -->
  <sql id="Map_Where_Clause">
		from order_main om where 1=1 
		<isEmpty prepend="AND" property="orderCode">
			OM.ORDER_STATUS != 16
		</isEmpty>
		<!-- 订单状态  -->
		<isNotEmpty prepend="AND" property="status">
			OM.ORDER_STATUS = #status#
		</isNotEmpty>
		<isNotEmpty  prepend="AND" property="statusArr">
			OM.ORDER_STATUS in
			<iterate open="(" close=")" conjunction="," property="statusArr">  
 				<![CDATA[#statusArr[]#]]>
			</iterate> 
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="nstatus">
		<![CDATA[ OM.ORDER_STATUS not in ]]>
		    <iterate open="(" close=")" conjunction="," property="nstatus">  
					<![CDATA[#nstatus[]#]]>
			</iterate>  
		</isNotEmpty>
		<isNotEmpty prepend="AND"  property="commodityName">
			exists (select 1 from order_item oi where om.order_code = oi.order_code
				and oi.commodity_name = #commodityName#
			<isNotEmpty prepend="AND"  property="commodityCode">
			 	oi.commodity_code = #commodityCode#
			</isNotEmpty>
			 )
		</isNotEmpty>
		<isEmpty property="commodityName">
			<isNotEmpty property="commodityCode">
			and exists (select 1 from order_item oi where om.order_code = oi.order_code
				and oi.commodity_code = #commodityCode# )
			</isNotEmpty>
		</isEmpty>			
		<!-- 下单账号 -->
		<isNotEmpty prepend="AND" property="customerAccount">
			OM.CUSTOMER_ACCOUNT=#customerAccount#
		</isNotEmpty>
		<!-- 收货人 -->
		<isNotEmpty prepend="AND" property="consigneeName">
			OM.CONSIGNEE_NAME=#consigneeName#
		</isNotEmpty>
		<!-- 收货人电话 -->
		<isNotEmpty prepend="AND" property="consigneeMobile">
			OM.CONSIGNEE_MOBILE=#consigneeMobile#
		</isNotEmpty>
		<!-- 下单类型 -->
		<!-- <isNotEmpty prepend="AND" property="orderPurchaserType">
			<isEqual property="orderPurchaserType" compareValue="4">
            exists (select 1
          from   era_info ei
         where ei.n_login_id = om.customer_id)
            </isEqual>
		 <isNotEqual property="orderPurchaserType" compareValue="4">
			om.order_purchaser_type = #orderPurchaserType#
		 </isNotEqual>
		</isNotEmpty> -->
		<isNotEmpty prepend="AND" property="orderPurchaserType">
			OM.order_purchaser_type=#orderPurchaserType#
		</isNotEmpty>
		<!-- 客服账户 -->
		<isNotEmpty prepend="AND" property="agencyNumber">
			OM.AGENCY_NUMBER=#agencyNumber#
		</isNotEmpty>
		<!-- 出库单号 -->
		<isNotEmpty prepend="AND" property="stockOutID">
			OM.STOCK_OUT_ID=#stockOutID#
		</isNotEmpty>
		<!-- 结转单号 -->
		<isNotEmpty prepend="AND" property="settlementNo">
			OM.SETTLEMENT_NO=#settlementNo#
		</isNotEmpty>
		<!-- 配送单号 -->
		<isNotEmpty prepend="AND" property="distributionId">
			OM.DISTRIBUTION_ID=#distributionId#
		</isNotEmpty>
		<!-- 可见性 -->
		<isNotEmpty prepend="AND" property="disabled">
			OM.DISABLED = #disabled#
		</isNotEmpty>
		<!-- 是否已评价 -->
		<isEqual prepend="AND" property="assess" compareValue="true">
			OM.ASSESS_STATUS IN (2,3)
		</isEqual>
		<!-- 处理标记 -->
		<isNotEmpty  prepend="and" property="handle">
			<isEqual property="handle" compareValue="2">
				exists (select 1 from order_handle oh where om.order_code = oh.order_code and (
					oh.handle_state = #handle#
			</isEqual>
			<isEqual property="handle" compareValue="1">
				not exists (select 1 from order_handle oh where om.order_code = oh.order_code and (
					oh.handle_state = 2
			</isEqual>
			) )
		</isNotEmpty>
		<!-- 支付时间  -->
		<isNotEmpty prepend="AND" property="payDateStart">
		<![CDATA[
			trunc(OM.PAY_DATE,'mi')>=to_date(#payDateStart#,'yyyy-MM-dd HH24:mi:ss')
			and trunc(OM.PAY_DATE,'mi')<=to_date(#payDateEnd#,'yyyy-MM-dd HH24:mi:ss')
		]]>
		</isNotEmpty>
		<isEmpty property="payDateStart">
		<!-- 支付时间范围 -->
		<isNotEmpty prepend="AND" property="payDateRange">
			<isEqual property="payDateRange" compareValue="today">
				TO_CHAR(OM.PAY_DATE, 'yyyyMMdd') = TO_CHAR(SYSDATE, 'yyyyMMdd')
			</isEqual>
			<isEqual property="payDateRange" compareValue="ysday">
				TO_CHAR(OM.PAY_DATE, 'yyyyMMdd') = TO_CHAR(SYSDATE-1, 'yyyyMMdd')
			</isEqual>
			<isEqual property="payDateRange" compareValue="tsweek">
				OM.PAY_DATE BETWEEN TRUNC(SYSDATE,'IW') AND TRUNC(SYSDATE,'IW') + 6
			</isEqual>
			<isEqual property="payDateRange" compareValue="lsweek">
				OM.PAY_DATE BETWEEN TRUNC(SYSDATE-7,'IW') AND TRUNC(SYSDATE-7,'IW') + 6 
			</isEqual>
			<isEqual property="payDateRange" compareValue="tsmonth">
				TO_CHAR(OM.PAY_DATE, 'yyyyMM') = TO_CHAR(SYSDATE, 'yyyyMM')
			</isEqual>
			<isEqual property="payDateRange" compareValue="lsmonth">
				TO_CHAR(ADD_MONTHS(OM.PAY_DATE,1), 'yyyyMM') = TO_CHAR(SYSDATE, 'yyyyMM')
			</isEqual>
		</isNotEmpty>
		</isEmpty>
		<!-- 下单时间  -->
		<isNotEmpty prepend="AND" property="createDateStart">
		<![CDATA[
			trunc(OM.CREATE_DATE,'mi')>=to_date(#createDateStart#,'yyyy-MM-dd HH24:mi:ss')
			and trunc(OM.CREATE_DATE,'mi')<=to_date(#createDateEnd#,'yyyy-MM-dd HH24:mi:ss')
		]]>
		</isNotEmpty>
		<isEmpty property="createDateStart">
		<!-- 下单时间范围 -->
			<isNotEmpty prepend="AND" property="createDateRange">
				<isEqual property="createDateRange" compareValue="today">
					TO_CHAR(OM.CREATE_DATE, 'yyyyMMdd') = TO_CHAR(SYSDATE, 'yyyyMMdd')
				</isEqual>
				<isEqual property="createDateRange" compareValue="ysday">
					TO_CHAR(OM.CREATE_DATE, 'yyyyMMdd') = TO_CHAR(SYSDATE-1, 'yyyyMMdd')
				</isEqual>
				<isEqual property="createDateRange" compareValue="tsweek">
					OM.CREATE_DATE BETWEEN TRUNC(SYSDATE,'IW') AND TRUNC(SYSDATE,'IW') + 6
				</isEqual>
				<isEqual property="createDateRange" compareValue="lsweek">
					OM.CREATE_DATE BETWEEN TRUNC(SYSDATE-7,'IW') AND TRUNC(SYSDATE-7,'IW') + 6 
				</isEqual>
				<isEqual property="createDateRange" compareValue="tsmonth">
					TO_CHAR(OM.CREATE_DATE, 'yyyyMM') = TO_CHAR(SYSDATE, 'yyyyMM')
				</isEqual>
				<isEqual property="createDateRange" compareValue="lsmonth">
					TO_CHAR(ADD_MONTHS(OM.CREATE_DATE,1), 'yyyyMM') = TO_CHAR(SYSDATE, 'yyyyMM')
				</isEqual>
			</isNotEmpty>
		</isEmpty>
		<!-- 渠道  -->
		<!-- <isNotEmpty prepend="AND" property="channel">
			OM.ORDER_CHANNEL=#channel# 
		</isNotEmpty> -->
		<!-- 供应商 -->
		<isNotEmpty prepend="AND" property="commerceId">
			om.commerce_id = #commerceId# 
		</isNotEmpty>
		<!-- <isEmpty prepend="AND"  property="commerceId">
			exists (select 1 from user_channel uc where om.order_channel=uc.channel_name and uc.user_id=#sysuser.userId#)
		</isEmpty> -->
		<!-- 订单号 -->
		<isNotEmpty prepend="AND" property="orderCode">
			OM.ORDER_CODE = #orderCode# 
		</isNotEmpty>
  </sql>  
 
  <select id="selectByMap"  parameterClass="java.util.Map"  resultMap="WithRoot_ResultMap">
		SELECT  TT.ORDER_ID, TT.CUSTOMER_ACCOUNT, TT.CUSTOMER_NAME, TT.CUSTOMER_MOBILE, TT.ORDER_PURCHASER_NAME, 
				TT.ORDER_PURCHASER_MOBILE, TT.ORDER_PURCHASER_TEL, TT.ORDER_PURCHASER_ADDR, TT.ORDER_PURCHASER_TYPE, 
				TT.CONSIGNEE_NAME, TT.CONSIGNEE_MOBILE, TT.CONSIGNEE_TEL, TT.CONSIGNEE_ADDR, TT.PAY_METHOD, TT.FARE, 
				TT.DELIVERY_DATE_TYPE, TT.COMMODITY_SUM, TT.DISCOUNT_AMOUNT, TT.ACCOUNT_BALANCE, TT.AMOUNT_PAYABLE, 
				TT.PAY_DATE, TT.CREATE_DATE, TT.AGENCY_NUMBER, TT.SETTLEMENT_NO, TT.STOCK_OUT_ID, TT.DISTRIBUTION_ID, 
				TT.LOGISTICS_ORDER_NO, TT.ORDER_SOURCE, TT.INVOICE_ID, TT.PARENT_ORDER_CODE, TT.SON_ORDER_CODE, 
				TT.ORDER_DESCRIPTION, TT.ORDER_STATUS, TT.ORDER_CODE, TT.CUSTOMER_ID, TT.ORDER_CHANNEL, TT.DISABLED, 
				TT.CONFIRM_DELIVERY, TT.LOGISTICS_CODE, TT.ADDRESS_ID, TT.EMAIL, TT.WEIGHT, TT.ASSESS_STATUS, TT.FINISH_DATE,
		        TT.INVOICE_INFO_TYPE,TT.INVOICE_INFO_TITLE,TT.INVOICE_INFO_CONTENT,TT.TOTAL_CREDIT,TT.LOGISTICS_NAME,TT.ORIGINAL_ORDER_SUM,
		        TT.PROVINCE,  TT.CITY,  TT.AREA,  TT.ZIPCODE, TT.ORDER_TYPE, TT.ORDER_OPERATION_REMARK,TT.COMMERCE_ID,TT.PRIZE_NUMBERS,
		        TT.PRESCRIPTION_ATTACHMENT,TT.CHECK_FLAG,TT.MEDIC_FLAG,TT.COMMERCE_NAME
		        <!-- 附加 -->
		        ,(SELECT D.ORDER_DICTIONARY_VALUE FROM ORDER_DICTIONARY D WHERE D.ORDER_DICTIONARY_TYPE = 'Pay_Method' AND D.ORDER_DICTIONARY_KEY = TT.PAY_METHOD) payMethodStr
		        ,(SELECT D.ORDER_DICTIONARY_VALUE FROM ORDER_DICTIONARY D WHERE D.ORDER_DICTIONARY_TYPE = 'Delivery_Date_Type' AND D.ORDER_DICTIONARY_KEY = TT.DELIVERY_DATE_TYPE) deliveryDateTypeStr
		        ,(SELECT D.ORDER_DICTIONARY_VALUE FROM ORDER_DICTIONARY D WHERE D.ORDER_DICTIONARY_TYPE = 'Order_Status' AND D.ORDER_DICTIONARY_KEY = TT.ORDER_STATUS) orderStatusStr
				,(
					CASE
					WHEN TT.PARENT_ORDER_CODE IS NULL THEN
						NULL
					ELSE
						(
							SELECT
								ORDER_CODE
							FROM
								ORDER_MAIN E
							WHERE
								CONNECT_BY_ISLEAF = 1 START WITH E .ORDER_CODE = TT.ORDER_CODE CONNECT BY E .ORDER_CODE = PRIOR E .PARENT_ORDER_CODE
						)
					END
				) ROOT_ORDER_CODE	
				,(SELECT HANDLE_STATE FROM ORDER_HANDLE WHERE ORDER_CODE = TT.ORDER_CODE) HANDLESTATE
				,(SELECT HANDLE_ACCOUNT FROM ORDER_HANDLE WHERE ORDER_CODE = TT.ORDER_CODE) HANDLEACCOUNT	        
		        <!--  -->
  		FROM (SELECT 	T.ORDER_ID, T.CUSTOMER_ACCOUNT, T.CUSTOMER_NAME, T.CUSTOMER_MOBILE, T.ORDER_PURCHASER_NAME, 
						T.ORDER_PURCHASER_MOBILE, T.ORDER_PURCHASER_TEL, T.ORDER_PURCHASER_ADDR, T.ORDER_PURCHASER_TYPE, 
						T.CONSIGNEE_NAME, T.CONSIGNEE_MOBILE, T.CONSIGNEE_TEL, T.CONSIGNEE_ADDR, T.PAY_METHOD, T.FARE, 
						T.DELIVERY_DATE_TYPE, T.COMMODITY_SUM, T.DISCOUNT_AMOUNT, T.ACCOUNT_BALANCE, T.AMOUNT_PAYABLE, 
						T.PAY_DATE, T.CREATE_DATE, T.AGENCY_NUMBER, T.SETTLEMENT_NO, T.STOCK_OUT_ID, T.DISTRIBUTION_ID, 
						T.LOGISTICS_ORDER_NO, T.ORDER_SOURCE, T.INVOICE_ID, T.PARENT_ORDER_CODE, T.SON_ORDER_CODE, 
						T.ORDER_DESCRIPTION, T.ORDER_STATUS, T.ORDER_CODE, T.CUSTOMER_ID, T.ORDER_CHANNEL, T.DISABLED, 
						T.CONFIRM_DELIVERY, T.LOGISTICS_CODE, T.ADDRESS_ID, T.EMAIL, T.WEIGHT, T.ASSESS_STATUS, T.FINISH_DATE,
       					T.INVOICE_INFO_TYPE,T.INVOICE_INFO_TITLE,T.INVOICE_INFO_CONTENT,T.TOTAL_CREDIT ,T.LOGISTICS_NAME,T.ORIGINAL_ORDER_SUM,
       					T.PROVINCE,T.CITY,T.AREA,T.ZIPCODE,T.ORDER_TYPE,T.ORDER_OPERATION_REMARK,T.COMMERCE_ID,T.PRIZE_NUMBERS,
       					T.PRESCRIPTION_ATTACHMENT,T.CHECK_FLAG,T.MEDIC_FLAG,T.COMMERCE_NAME,ROWNUM rn
        FROM(SELECT DISTINCT 	OM.ORDER_ID, OM.CUSTOMER_ACCOUNT, OM.CUSTOMER_NAME, OM.CUSTOMER_MOBILE, OM.ORDER_PURCHASER_NAME, 
								OM.ORDER_PURCHASER_MOBILE, OM.ORDER_PURCHASER_TEL, OM.ORDER_PURCHASER_ADDR, OM.ORDER_PURCHASER_TYPE, 
								OM.CONSIGNEE_NAME, OM.CONSIGNEE_MOBILE, OM.CONSIGNEE_TEL, OM.CONSIGNEE_ADDR, OM.PAY_METHOD, OM.FARE, 
								OM.DELIVERY_DATE_TYPE, OM.COMMODITY_SUM, OM.DISCOUNT_AMOUNT, OM.ACCOUNT_BALANCE, OM.AMOUNT_PAYABLE, 
								OM.PAY_DATE, OM.CREATE_DATE, OM.AGENCY_NUMBER, OM.SETTLEMENT_NO, OM.STOCK_OUT_ID, OM.DISTRIBUTION_ID, 
								OM.LOGISTICS_ORDER_NO, OM.ORDER_SOURCE, OM.INVOICE_ID, OM.PARENT_ORDER_CODE, OM.SON_ORDER_CODE, 
								OM.ORDER_DESCRIPTION, OM.ORDER_STATUS, OM.ORDER_CODE, OM.CUSTOMER_ID, OM.ORDER_CHANNEL, OM.DISABLED, 
								OM.CONFIRM_DELIVERY, OM.LOGISTICS_CODE, OM.ADDRESS_ID, OM.EMAIL, OM.WEIGHT, OM.ASSESS_STATUS, OM.FINISH_DATE,
  								OM.INVOICE_INFO_TYPE,OM.INVOICE_INFO_TITLE,OM.INVOICE_INFO_CONTENT,OM.TOTAL_CREDIT,LOGISTICS_NAME,ORIGINAL_ORDER_SUM,
       							OM.PROVINCE,OM.CITY,OM.AREA,OM.ZIPCODE,OM.ORDER_TYPE,OM.ORDER_OPERATION_REMARK,OM.COMMERCE_ID,OM.PRIZE_NUMBERS,
       							OM.PRESCRIPTION_ATTACHMENT,OM.CHECK_FLAG,OM.MEDIC_FLAG,OM.COMMERCE_NAME 
  		<include refid="Map_Where_Clause"/>
  		ORDER BY OM.CREATE_DATE DESC) T
        WHERE ROWNUM  &lt;= #end#) TT
		WHERE TT.rn  &gt;= #start#
  </select>
  
  <select id="selectLeafsByRootOrderCode" parameterClass="java.lang.String" resultMap="ibatorgenerated_ExtendsResultMap">
		SELECT
			E.ORDER_ID, E.CUSTOMER_ACCOUNT, E.CUSTOMER_NAME, E.CUSTOMER_MOBILE, E.ORDER_PURCHASER_NAME, 
			E.ORDER_PURCHASER_MOBILE, E.ORDER_PURCHASER_TEL, E.ORDER_PURCHASER_ADDR, E.ORDER_PURCHASER_TYPE, 
			E.CONSIGNEE_NAME, E.CONSIGNEE_MOBILE, E.CONSIGNEE_TEL, E.CONSIGNEE_ADDR, E.PAY_METHOD, E.FARE, 
			E.DELIVERY_DATE_TYPE, E.COMMODITY_SUM, E.DISCOUNT_AMOUNT, E.ACCOUNT_BALANCE, E.AMOUNT_PAYABLE, 
			E.PAY_DATE, E.CREATE_DATE, E.AGENCY_NUMBER, E.SETTLEMENT_NO, E.STOCK_OUT_ID, E.DISTRIBUTION_ID, 
			E.LOGISTICS_ORDER_NO, E.ORDER_SOURCE, E.INVOICE_ID, E.PARENT_ORDER_CODE, E.SON_ORDER_CODE, 
			E.ORDER_DESCRIPTION, E.ORDER_STATUS, E.ORDER_CODE, E.CUSTOMER_ID, E.ORDER_CHANNEL, E.DISABLED, 
			E.CONFIRM_DELIVERY, E.LOGISTICS_CODE, E.ADDRESS_ID, E.EMAIL, E.WEIGHT, E.ASSESS_STATUS, E.FINISH_DATE,
			E.INVOICE_INFO_TYPE,E.INVOICE_INFO_TITLE,E.INVOICE_INFO_CONTENT,E.TOTAL_CREDIT,E.LOGISTICS_NAME,E.ORIGINAL_ORDER_SUM,
			E.PROVINCE,E.CITY,E.AREA,E.ZIPCODE,E.ORDER_TYPE,E.ORDER_OPERATION_REMARK,E.COMMERCE_ID,E.PRIZE_NUMBERS,
			E.PRESCRIPTION_ATTACHMENT,E.CHECK_FLAG,E.MEDIC_FLAG,E.COMMERCE_NAME
		      <!-- 附加
-->
		      ,(SELECT D.ORDER_DICTIONARY_VALUE FROM ORDER_DICTIONARY D WHERE D.ORDER_DICTIONARY_TYPE = 'Pay_Method' AND D.ORDER_DICTIONARY_KEY = E.PAY_METHOD) payMethodStr
		      ,(SELECT D.ORDER_DICTIONARY_VALUE FROM ORDER_DICTIONARY D WHERE D.ORDER_DICTIONARY_TYPE = 'Delivery_Date_Type' AND D.ORDER_DICTIONARY_KEY = E.DELIVERY_DATE_TYPE) deliveryDateTypeStr
		      ,(SELECT D.ORDER_DICTIONARY_VALUE FROM ORDER_DICTIONARY D WHERE D.ORDER_DICTIONARY_TYPE = 'Order_Status' AND D.ORDER_DICTIONARY_KEY = E.ORDER_STATUS) orderStatusStr
		      ,(SELECT HANDLE_STATE FROM ORDER_HANDLE WHERE ORDER_CODE = E.ORDER_CODE) HANDLESTATE
	          ,(SELECT HANDLE_ACCOUNT FROM ORDER_HANDLE WHERE ORDER_CODE = E.ORDER_CODE) HANDLEACCOUNT	
		      <!--  -->
		FROM
			ORDER_MAIN E
		WHERE
			CONNECT_BY_ISLEAF = 1 START WITH E.ORDER_CODE = #value# CONNECT BY PRIOR E.ORDER_CODE =  E.PARENT_ORDER_CODE	
  </select>
  
  <select id="selectRootAndLeafsByOrderCode" parameterClass="java.lang.String" resultMap="ibatorgenerated_ExtendsOrderSource_ys">
		SELECT
			E.ORDER_ID, E.CUSTOMER_ACCOUNT, E.CUSTOMER_NAME, E.CUSTOMER_MOBILE, E.ORDER_PURCHASER_NAME, 
			E.ORDER_PURCHASER_MOBILE, E.ORDER_PURCHASER_TEL, E.ORDER_PURCHASER_ADDR, E.ORDER_PURCHASER_TYPE, 
			E.CONSIGNEE_NAME, E.CONSIGNEE_MOBILE, E.CONSIGNEE_TEL, E.CONSIGNEE_ADDR, E.PAY_METHOD, E.FARE, 
			E.DELIVERY_DATE_TYPE, E.COMMODITY_SUM, E.DISCOUNT_AMOUNT, E.ACCOUNT_BALANCE, E.AMOUNT_PAYABLE, 
			E.PAY_DATE, E.CREATE_DATE, E.AGENCY_NUMBER, E.SETTLEMENT_NO, E.STOCK_OUT_ID, E.DISTRIBUTION_ID, 
			E.LOGISTICS_ORDER_NO, E.ORDER_SOURCE, E.INVOICE_ID, E.PARENT_ORDER_CODE, E.SON_ORDER_CODE, 
			E.ORDER_DESCRIPTION, E.ORDER_STATUS, E.ORDER_CODE, E.CUSTOMER_ID, E.ORDER_CHANNEL, E.DISABLED, 
			E.CONFIRM_DELIVERY, E.LOGISTICS_CODE, E.ADDRESS_ID, E.EMAIL, E.WEIGHT, E.ASSESS_STATUS, E.FINISH_DATE,
			E.INVOICE_INFO_TYPE,E.INVOICE_INFO_TITLE,E.INVOICE_INFO_CONTENT,E.TOTAL_CREDIT,E.LOGISTICS_NAME,E.ORIGINAL_ORDER_SUM,
			E.PROVINCE,E.CITY,E.AREA,E.ZIPCODE,E.ORDER_TYPE,E.ORDER_OPERATION_REMARK,E.COMMERCE_ID,E.PRIZE_NUMBERS,
			E.PRESCRIPTION_ATTACHMENT,E.CHECK_FLAG,E.MEDIC_FLAG,E.COMMERCE_NAME,E.DEPOSIT_SUM,(E.AMOUNT_PAYABLE - E.DEPOSIT_SUM) FINALPAYMENT
			  <!-- 附加-->
			  ,(SELECT OPS.ORDER_MONEY FROM  ORDER_PAY_STATEMENT OPS WHERE OPS.ORDER_CODE = E.ORDER_CODE AND OPS.STATE = 1 AND OPS.YSFLAGE = 1) AS PAIDDEPOSIT
		      ,(SELECT OPS.ORDER_MONEY FROM  ORDER_PAY_STATEMENT OPS WHERE OPS.ORDER_CODE = E.ORDER_CODE AND OPS.STATE = 1 AND OPS.YSFLAGE = 2) AS NOFINALPAYMENT
		      ,(SELECT D.ORDER_DICTIONARY_VALUE FROM ORDER_DICTIONARY D WHERE D.ORDER_DICTIONARY_TYPE = 'Pay_Method' AND D.ORDER_DICTIONARY_KEY = E.PAY_METHOD) payMethodStr
		      ,(SELECT D.ORDER_DICTIONARY_VALUE FROM ORDER_DICTIONARY D WHERE D.ORDER_DICTIONARY_TYPE = 'Delivery_Date_Type' AND D.ORDER_DICTIONARY_KEY = E.DELIVERY_DATE_TYPE) deliveryDateTypeStr
		      ,(SELECT D.ORDER_DICTIONARY_VALUE FROM ORDER_DICTIONARY D WHERE D.ORDER_DICTIONARY_TYPE = 'Order_Status' AND D.ORDER_DICTIONARY_KEY = E.ORDER_STATUS) orderStatusStr
		      ,(SELECT D.ORDER_DICTIONARY_VALUE FROM ORDER_DICTIONARY D WHERE D.ORDER_DICTIONARY_TYPE = 'Order_Source' AND D.ORDER_DICTIONARY_KEY = e.ORDER_SOURCE) orderSourceStr
		      ,(SELECT HANDLE_STATE FROM ORDER_HANDLE WHERE ORDER_CODE = E.ORDER_CODE) HANDLESTATE
	          ,(SELECT HANDLE_ACCOUNT FROM ORDER_HANDLE WHERE ORDER_CODE = E.ORDER_CODE) HANDLEACCOUNT	
		      <!--  -->
		FROM
			ORDER_MAIN E
		WHERE
			LEVEL = 1 OR CONNECT_BY_ISLEAF = 1 START WITH E .ORDER_CODE = (
				SELECT
					ORDER_CODE
				FROM
					ORDER_MAIN E
				WHERE
					CONNECT_BY_ISLEAF = 1  START WITH E .ORDER_CODE = #value# CONNECT BY E .ORDER_CODE = PRIOR E .PARENT_ORDER_CODE 
			) CONNECT BY PRIOR E .ORDER_CODE = E .PARENT_ORDER_CODE
			
  </select>
  
   <select id="selectRootAndLeafsByOrderCodeASCSort" parameterClass="java.lang.String" resultMap="ibatorgenerated_ExtendsOrderSource_ys">
		SELECT
			E.ORDER_ID, E.CUSTOMER_ACCOUNT, E.CUSTOMER_NAME, E.CUSTOMER_MOBILE, E.ORDER_PURCHASER_NAME, 
			E.ORDER_PURCHASER_MOBILE, E.ORDER_PURCHASER_TEL, E.ORDER_PURCHASER_ADDR, E.ORDER_PURCHASER_TYPE, 
			E.CONSIGNEE_NAME, E.CONSIGNEE_MOBILE, E.CONSIGNEE_TEL, E.CONSIGNEE_ADDR, E.PAY_METHOD, E.FARE, 
			E.DELIVERY_DATE_TYPE, E.COMMODITY_SUM, E.DISCOUNT_AMOUNT, E.ACCOUNT_BALANCE, E.AMOUNT_PAYABLE, 
			E.PAY_DATE, E.CREATE_DATE, E.AGENCY_NUMBER, E.SETTLEMENT_NO, E.STOCK_OUT_ID, E.DISTRIBUTION_ID, 
			E.LOGISTICS_ORDER_NO, E.ORDER_SOURCE, E.INVOICE_ID, E.PARENT_ORDER_CODE, E.SON_ORDER_CODE, 
			E.ORDER_DESCRIPTION, E.ORDER_STATUS, E.ORDER_CODE, E.CUSTOMER_ID, E.ORDER_CHANNEL, E.DISABLED, 
			E.CONFIRM_DELIVERY, E.LOGISTICS_CODE, E.ADDRESS_ID, E.EMAIL, E.WEIGHT, E.ASSESS_STATUS, E.FINISH_DATE,
			E.INVOICE_INFO_TYPE,E.INVOICE_INFO_TITLE,E.INVOICE_INFO_CONTENT,E.TOTAL_CREDIT,E.LOGISTICS_NAME,E.ORIGINAL_ORDER_SUM,
			E.PROVINCE,E.CITY,E.AREA,E.ZIPCODE,E.ORDER_TYPE,E.ORDER_OPERATION_REMARK,E.COMMERCE_ID,E.PRIZE_NUMBERS,
			E.PRESCRIPTION_ATTACHMENT,E.CHECK_FLAG,E.MEDIC_FLAG,E.COMMERCE_NAME,E.DEPOSIT_SUM,(E.AMOUNT_PAYABLE - E.DEPOSIT_SUM) FINALPAYMENT
			  <!-- 附加-->
			  ,(SELECT OPS.ORDER_MONEY FROM  ORDER_PAY_STATEMENT OPS WHERE OPS.ORDER_CODE = E.ORDER_CODE AND OPS.STATE = 1 AND OPS.YSFLAGE = 1) AS PAIDDEPOSIT
		      ,(SELECT OPS.ORDER_MONEY FROM  ORDER_PAY_STATEMENT OPS WHERE OPS.ORDER_CODE = E.ORDER_CODE AND OPS.STATE = 1 AND OPS.YSFLAGE = 2) AS NOFINALPAYMENT
		      ,(SELECT D.ORDER_DICTIONARY_VALUE FROM ORDER_DICTIONARY D WHERE D.ORDER_DICTIONARY_TYPE = 'Pay_Method' AND D.ORDER_DICTIONARY_KEY = E.PAY_METHOD) payMethodStr
		      ,(SELECT D.ORDER_DICTIONARY_VALUE FROM ORDER_DICTIONARY D WHERE D.ORDER_DICTIONARY_TYPE = 'Delivery_Date_Type' AND D.ORDER_DICTIONARY_KEY = E.DELIVERY_DATE_TYPE) deliveryDateTypeStr
		      ,(SELECT D.ORDER_DICTIONARY_VALUE FROM ORDER_DICTIONARY D WHERE D.ORDER_DICTIONARY_TYPE = 'Order_Status' AND D.ORDER_DICTIONARY_KEY = E.ORDER_STATUS) orderStatusStr
		      ,(SELECT D.ORDER_DICTIONARY_VALUE FROM ORDER_DICTIONARY D WHERE D.ORDER_DICTIONARY_TYPE = 'Order_Source' AND D.ORDER_DICTIONARY_KEY = e.ORDER_SOURCE) orderSourceStr
		      ,(SELECT HANDLE_STATE FROM ORDER_HANDLE WHERE ORDER_CODE = E.ORDER_CODE) HANDLESTATE
	          ,(SELECT HANDLE_ACCOUNT FROM ORDER_HANDLE WHERE ORDER_CODE = E.ORDER_CODE) HANDLEACCOUNT	
		      <!--  -->
		FROM
			ORDER_MAIN E
		WHERE
			LEVEL = 1 OR CONNECT_BY_ISLEAF = 1 START WITH E .ORDER_CODE = (
				SELECT
					ORDER_CODE
				FROM
					ORDER_MAIN E
				WHERE
					CONNECT_BY_ISLEAF = 1  START WITH E .ORDER_CODE = #value# CONNECT BY E .ORDER_CODE = PRIOR E .PARENT_ORDER_CODE 
			) CONNECT BY PRIOR E .ORDER_CODE = E .PARENT_ORDER_CODE
  		    order by E.Create_Date			
  </select>
  
  <select id="selectRootOrderByCode" parameterClass="java.lang.String" resultMap="ibatorgenerated_ExtendsResultMapForAlter">
		SELECT
			E.ORDER_ID, E.CUSTOMER_ACCOUNT, E.CUSTOMER_NAME, E.CUSTOMER_MOBILE, E.ORDER_PURCHASER_NAME, 
			E.ORDER_PURCHASER_MOBILE, E.ORDER_PURCHASER_TEL, E.ORDER_PURCHASER_ADDR, E.ORDER_PURCHASER_TYPE, 
			E.CONSIGNEE_NAME, E.CONSIGNEE_MOBILE, E.CONSIGNEE_TEL, E.CONSIGNEE_ADDR, E.PAY_METHOD, E.FARE, 
			E.DELIVERY_DATE_TYPE, E.COMMODITY_SUM, E.DISCOUNT_AMOUNT, E.ACCOUNT_BALANCE, E.AMOUNT_PAYABLE, 
			E.PAY_DATE, E.CREATE_DATE, E.AGENCY_NUMBER, E.SETTLEMENT_NO, E.STOCK_OUT_ID, E.DISTRIBUTION_ID, 
			E.LOGISTICS_ORDER_NO, E.ORDER_SOURCE, E.INVOICE_ID, E.PARENT_ORDER_CODE, E.SON_ORDER_CODE, 
			E.ORDER_DESCRIPTION, E.ORDER_STATUS, E.ORDER_CODE, E.CUSTOMER_ID, E.ORDER_CHANNEL, E.DISABLED, 
			E.CONFIRM_DELIVERY, E.LOGISTICS_CODE, E.ADDRESS_ID, E.EMAIL, E.WEIGHT, E.ASSESS_STATUS, E.FINISH_DATE,
			E.INVOICE_INFO_TYPE,E.INVOICE_INFO_TITLE,E.INVOICE_INFO_CONTENT,E.TOTAL_CREDIT,E.LOGISTICS_NAME,E.ORIGINAL_ORDER_SUM,
			E.PROVINCE,E.CITY,E.AREA,E.ZIPCODE,E.ORDER_TYPE,E.ORDER_OPERATION_REMARK,E.COMMERCE_ID,E.PRIZE_NUMBERS,
			E.PRESCRIPTION_ATTACHMENT,E.CHECK_FLAG,E.MEDIC_FLAG,E.COMMERCE_NAME,E.DEPOSIT_SUM,(E.AMOUNT_PAYABLE - E.DEPOSIT_SUM) FINALPAYMENT
		      <!-- 附加
-->
		      ,(SELECT D.ORDER_DICTIONARY_VALUE FROM ORDER_DICTIONARY D WHERE D.ORDER_DICTIONARY_TYPE = 'Pay_Method' AND D.ORDER_DICTIONARY_KEY = E.PAY_METHOD) payMethodStr
		      ,(SELECT D.ORDER_DICTIONARY_VALUE FROM ORDER_DICTIONARY D WHERE D.ORDER_DICTIONARY_TYPE = 'Delivery_Date_Type' AND D.ORDER_DICTIONARY_KEY = E.DELIVERY_DATE_TYPE) deliveryDateTypeStr
		      ,(SELECT D.ORDER_DICTIONARY_VALUE FROM ORDER_DICTIONARY D WHERE D.ORDER_DICTIONARY_TYPE = 'Order_Status' AND D.ORDER_DICTIONARY_KEY = E.ORDER_STATUS) orderStatusStr
              ,(SELECT HANDLE_STATE FROM ORDER_HANDLE WHERE ORDER_CODE = E.ORDER_CODE) HANDLESTATE
	          ,(SELECT HANDLE_ACCOUNT FROM ORDER_HANDLE WHERE ORDER_CODE = E.ORDER_CODE) HANDLEACCOUNT	
		      <!--  -->
		FROM
			ORDER_MAIN E
		WHERE
		CONNECT_BY_ISLEAF = 1 
		START WITH E .ORDER_CODE = #value# CONNECT BY E .ORDER_CODE = PRIOR E .PARENT_ORDER_CODE
  </select>
  
  <select id="selectAssesssByMap"  parameterClass="java.util.Map"  resultMap="ibatorgenerated_ExtendsResultMap1">
		SELECT *
  		FROM (SELECT t.*, ROWNUM rn
        FROM(SELECT	OM.*
        <!-- 附加 -->
       <!--   ,(SELECT D.ORDER_DICTIONARY_VALUE FROM ORDER_DICTIONARY D WHERE D.ORDER_DICTIONARY_TYPE = 'Pay_Method' AND D.ORDER_DICTIONARY_KEY = OM.PAY_METHOD) payMethodStr
        ,(SELECT D.ORDER_DICTIONARY_VALUE FROM ORDER_DICTIONARY D WHERE D.ORDER_DICTIONARY_TYPE = 'Delivery_Date_Type' AND D.ORDER_DICTIONARY_KEY = OM.DELIVERY_DATE_TYPE) deliveryDateTypeStr
        ,(SELECT D.ORDER_DICTIONARY_VALUE FROM ORDER_DICTIONARY D WHERE D.ORDER_DICTIONARY_TYPE = 'Order_Status' AND D.ORDER_DICTIONARY_KEY = OM.ORDER_STATUS) orderStatusStr
        ,(SELECT COUNT(*) FROM ORDER_ALTER WHERE ORDER_ID = OM.ORDER_ID AND PROPOSE_STATUS NOT IN (-2,-1,7)) ISRETURNING-->
        ,(SELECT COUNT(*) FROM ORDER_ASSESS_INFO WHERE ORDER_ID=OM.ORDER_ID) ASSESSCOUNT
        ,(SELECT HANDLE_STATE FROM ORDER_HANDLE WHERE ORDER_CODE = OM.ORDER_CODE) HANDLESTATE
	    ,(SELECT HANDLE_ACCOUNT FROM ORDER_HANDLE WHERE ORDER_CODE = OM.ORDER_CODE) HANDLEACCOUNT	
        <!--  -->
  		<include refid="Map_Where_Clause"/>
  		ORDER BY OM.ORDER_ID DESC) T
        WHERE  T.ASSESSCOUNT &gt;=1 AND ROWNUM  &lt;= #end#)
		WHERE rn  &gt;= #start#
  </select>
  <select id="countMoneyByMap" parameterClass="java.util.Map" resultClass="java.math.BigDecimal" >
    select sum(nvl(omo.amount_payable, 0))
  		from (
  			select distinct om.order_code order_code
  	<include refid="MAP_WHERE_CLAUSE_FOR_COUNT"/>
  			and om.parent_order_code is null
 		 ) oc inner join order_main omo
    	on (omo.order_code = oc.order_code)
  </select>
  <select id="countActualByMap" parameterClass="java.util.Map" resultClass="java.math.BigDecimal" >
   select sum(nvl(op.order_money, 0))
  		from (
  			select distinct om.order_code order_code
  	<include refid="MAP_WHERE_CLAUSE_FOR_COUNT"/>
  			and om.parent_order_code is null
 		 ) oc inner join order_pay_statement op
    	on (op.order_code = oc.order_code)
		where  op.payment_way not in (- 1, 2)
		and  op.state = 1
  </select>
  <select id="countByMap"  parameterClass="java.util.Map"  resultClass="java.lang.Integer">
  		SELECT COUNT(*) FROM (
  		SELECT DISTINCT 
			 OM.ORDER_ID
    	<include refid="Map_Where_Clause"/>)
  </select>

   <!-- 修改订单状态 -->
   <update id="changeOrderStatus"  parameterClass="java.util.Map" >
   		UPDATE ORDER_MAIN SET ORDER_STATUS = #status# WHERE ORDER_CODE IN 
   		<isEqual  property="checkAll" compareValue="true">
   			(SELECT OM.ORDER_CODE
   			<include refid="Map_Where_Clause"/>)
   		</isEqual>
   		<isNotEqual property="checkAll" compareValue="true">
   			<iterate property="orderCodes" open="(" close=")" conjunction=","> 
				#orderCodes[]# 
		    </iterate>
   		</isNotEqual>
   </update>
   
   <select id="countSKU"  parameterClass="java.util.Map"  resultMap="skuMap">
   <isNotEmpty property="skuCodeList">
   		select rs1.skucode, nvl(rs2.skuCount, rs1.skucount) skuCount
		  from (select <iterate property="skuCodeList" conjunction=",">#skuCodeList[]#</iterate> skuCode, 0 skuCount FROM dual) rs1
		  left join (select oi.commodity_sku skuCode, count(1) skuCount
		               from order_item oi
		              where oi.commodity_sku in (<iterate property="skuCodeList">#skuCodeList[]#</iterate>)
		                and exists
		              (select 1
		                       from order_main om
		                      where om.order_code = oi.order_code
		                        and om.order_status > 1
		<isNotEmpty property="createBegin">					                        
		                        and om.create_date >= to_date(#createBegin#,'yyyy-MM-dd HH24:mi:ss')
		</isNotEmpty>                    
		<isNotEmpty property="createEnd">                
		               <![CDATA[and om.create_date <= to_date(#createEnd#,'yyyy-MM-dd HH24:mi:ss')]]>
		</isNotEmpty>						                                    
		              ) group by oi.commodity_sku) rs2
		    on rs2.skuCode = rs1.skuCode
   	</isNotEmpty>
	<isEmpty property="skuCodeList">
		select oi.commodity_sku skuCode, count(1) skuCount
		               from order_item oi
		              where exists
		              (select 1
		                       from order_main om
		                      where om.order_code = oi.order_code
		                        and om.order_status > 1
		<isNotEmpty property="createBegin">					                        
		                        and om.create_date >= to_date(#createBegin#,'yyyy-MM-dd HH24:mi:ss')
		</isNotEmpty>                    
		<isNotEmpty property="createEnd">                
		               <![CDATA[and om.create_date <= to_date(#createEnd#,'yyyy-MM-dd HH24:mi:ss')]]>
		</isNotEmpty>						                                    
		              ) group by oi.commodity_sku
	</isEmpty>		
   </select>
   
   <select id="getPersonalConsume" parameterClass="java.util.Map"  resultClass="java.math.BigDecimal">
		select sum(om.amount_payable) -
		       sum((select sum(abs(oaps.order_money))
		             from order_alter_pay_statement oaps
		            where exists (select 1
		                     from order_alter oa
		                    where oaps.order_alter_code = oa.order_alter_code
		                      and oa.order_code = om.order_code)))
		  from order_main om
   		<dynamic prepend="WHERE">
   			<isNotEmpty prepend="AND" property="startDate">
   				OM.FINISH_DATE &gt;= #startDate#
   			</isNotEmpty>
   			<isNotEmpty prepend="AND" property="endDate">
   				OM.FINISH_DATE &lt;= #endDate#
   			</isNotEmpty>
   			<isNotEmpty prepend="AND" property="account">
   				OM.CUSTOMER_ACCOUNT = #account#
   			</isNotEmpty>
   			<isNotEmpty prepend="AND" property="status">
   				OM.ORDER_STATUS = #status#
   			</isNotEmpty>
   		</dynamic>
   </select>
	
	<select id="isLastOrder" parameterClass="java.util.Map" resultClass="java.lang.Integer">
		SELECT COUNT(*) FROM ORDER_MAIN E
	 	WHERE E.ORDER_STATUS != 6
		 AND E.ORDER_CODE != #orderCode#
	 	 AND CONNECT_BY_ISLEAF = 1
			 START WITH E.ORDER_CODE = #parentOrderCode#
			CONNECT BY PRIOR E.ORDER_CODE = E.PARENT_ORDER_CODE
	</select>
	
	
	<!-- map方式查询订单列表 -->
  <sql id="Map_Where_Clause_FuzzyOrder">
		from order_main om where 1=1 
		<isEmpty prepend="AND" property="orderCode">
			OM.ORDER_STATUS != 16
		</isEmpty>
		<isNotEmpty prepend="AND" property="order_Type">
			OM.ORDER_TYPE = #order_Type#
		</isNotEmpty>
		<!-- 订单状态  -->
		<isNotEmpty prepend="AND" property="status">
			OM.ORDER_STATUS = #status#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="statusList">
			OM.ORDER_STATUS in 
			<iterate open="(" close=")" conjunction="," property="statusList">  
					<![CDATA[#statusList[]#]]>
			</iterate>
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="nstatus">
		<![CDATA[ OM.ORDER_STATUS not in ]]>
		    <iterate open="(" close=")" conjunction="," property="nstatus">  
					<![CDATA[#nstatus[]#]]>
			</iterate>  
		</isNotEmpty>
		<isNotEmpty prepend="AND"  property="commodityName">
			exists (select 1 from order_item oi where om.order_code = oi.order_code
				and instr(oi.commodity_name,trim(#commodityName#))>0
			<isNotEmpty prepend="AND"  property="commodityCode">
			 	oi.commodity_code = #commodityCode#
			</isNotEmpty>
			 )
		</isNotEmpty>
		<isEmpty property="commodityName">
			<isNotEmpty property="commodityCode">
			and exists (select 1 from order_item oi where om.order_code = oi.order_code
				and oi.commodity_code = #commodityCode# )
			</isNotEmpty>
		</isEmpty>			
		<!-- 下单账号 -->
		<isNotEmpty prepend="AND" property="customerAccount">
			INSTR(OM.CUSTOMER_ACCOUNT, TRIM(#customerAccount#))>0
		</isNotEmpty>
		<!-- 收货人 -->
		<isNotEmpty prepend="AND" property="consigneeName">
			INSTR(OM.CONSIGNEE_NAME, TRIM(#consigneeName#))>0
		</isNotEmpty>
		<!-- 收货人电话 -->
		<isNotEmpty prepend="AND" property="consigneeMobile">
			INSTR(OM.CONSIGNEE_MOBILE, TRIM(#consigneeMobile#))>0
		</isNotEmpty>
		<!-- 下单类型 -->
		<!-- <isNotEmpty prepend="AND" property="orderPurchaserType">
		<isEqual property="orderPurchaserType" compareValue="4">
            exists (select 1
          from   era_info ei
         where ei.n_login_id = om.customer_id)
            </isEqual>
		 <isNotEqual property="orderPurchaserType" compareValue="4">
			om.order_purchaser_type = #orderPurchaserType#
		 </isNotEqual>
		</isNotEmpty> -->
		<isNotEmpty prepend="AND" property="orderPurchaserType">
			om.order_purchaser_type = #orderPurchaserType#
		</isNotEmpty>
		<!-- 客服账户 -->
		<isNotEmpty prepend="AND" property="agencyNumber">
			INSTR(OM.AGENCY_NUMBER, TRIM(#agencyNumber#))>0
		</isNotEmpty>
		<!-- 出库单号 -->
		<isNotEmpty prepend="AND" property="stockOutID">
			INSTR(OM.STOCK_OUT_ID,TRIM(#stockOutID#))>0
		</isNotEmpty>
		<!-- 结转单号 -->
		<isNotEmpty prepend="AND" property="settlementNo">
			INSTR(OM.SETTLEMENT_NO,TRIM(#settlementNo#))>0
		</isNotEmpty>
		<!-- 配送单号 -->
		<isNotEmpty prepend="AND" property="distributionId">
			INSTR(OM.DISTRIBUTION_ID, TRIM(#distributionId#))>0
		</isNotEmpty>
		<!-- 可见性 -->
		<isNotEmpty prepend="AND" property="disabled">
			OM.DISABLED = #disabled#
		</isNotEmpty>
		<!-- 是否已评价 -->
		<isEqual prepend="AND" property="assess" compareValue="true">
			OM.ASSESS_STATUS IN (2,3)
		</isEqual>
		<!-- 订单来源 -->
		<isNotEmpty prepend="AND" property="orderSource">
			OM.ORDER_SOURCE = #orderSource#
		</isNotEmpty>
		<!-- 处理标记 -->
		<isNotEmpty  prepend="and" property="handle">
			<isEqual property="handle" compareValue="2">
				exists (select 1 from order_handle oh where om.order_code = oh.order_code and (
					oh.handle_state = #handle#
			</isEqual>
			<isEqual property="handle" compareValue="1">
				not exists (select 1 from order_handle oh where om.order_code = oh.order_code and (
					oh.handle_state = 2
			</isEqual>
			) )
		</isNotEmpty>
		<!-- 支付时间  -->
		<isNotEmpty prepend="AND" property="payDateStart">
		<![CDATA[
			trunc(OM.PAY_DATE,'mi')>=to_date(#payDateStart#,'yyyy-MM-dd HH24:mi:ss')
			and trunc(OM.PAY_DATE,'mi')<=to_date(#payDateEnd#,'yyyy-MM-dd HH24:mi:ss')
		]]>
		</isNotEmpty>
		<isEmpty property="payDateStart">
		<!-- 支付时间范围 -->
		<isNotEmpty prepend="AND" property="payDateRange">
			<isEqual property="payDateRange" compareValue="today">
				TO_CHAR(OM.PAY_DATE, 'yyyyMMdd') = TO_CHAR(SYSDATE, 'yyyyMMdd')
			</isEqual>
			<isEqual property="payDateRange" compareValue="ysday">
				TO_CHAR(OM.PAY_DATE, 'yyyyMMdd') = TO_CHAR(SYSDATE-1, 'yyyyMMdd')
			</isEqual>
			<isEqual property="payDateRange" compareValue="tsweek">
				OM.PAY_DATE BETWEEN TRUNC(SYSDATE,'IW') AND TRUNC(SYSDATE,'IW') + 6
			</isEqual>
			<isEqual property="payDateRange" compareValue="lsweek">
				OM.PAY_DATE BETWEEN TRUNC(SYSDATE-7,'IW') AND TRUNC(SYSDATE-7,'IW') + 6 
			</isEqual>
			<isEqual property="payDateRange" compareValue="tsmonth">
				TO_CHAR(OM.PAY_DATE, 'yyyyMM') = TO_CHAR(SYSDATE, 'yyyyMM')
			</isEqual>
			<isEqual property="payDateRange" compareValue="lsmonth">
				TO_CHAR(ADD_MONTHS(OM.PAY_DATE,1), 'yyyyMM') = TO_CHAR(SYSDATE, 'yyyyMM')
			</isEqual>
		</isNotEmpty>
		</isEmpty>
		<!-- 下单时间  -->
		<isNotEmpty prepend="AND" property="createDateStart">
		<![CDATA[
			trunc(OM.CREATE_DATE,'mi')>=to_date(#createDateStart#,'yyyy-MM-dd HH24:mi:ss')
			and trunc(OM.CREATE_DATE,'mi')<=to_date(#createDateEnd#,'yyyy-MM-dd HH24:mi:ss')
		]]>
		</isNotEmpty>
		<isEmpty property="createDateStart">
		<!-- 下单时间范围 -->
			<isNotEmpty prepend="AND" property="createDateRange">
				<isEqual property="createDateRange" compareValue="today">
					TO_CHAR(OM.CREATE_DATE, 'yyyyMMdd') = TO_CHAR(SYSDATE, 'yyyyMMdd')
				</isEqual>
				<isEqual property="createDateRange" compareValue="ysday">
					TO_CHAR(OM.CREATE_DATE, 'yyyyMMdd') = TO_CHAR(SYSDATE-1, 'yyyyMMdd')
				</isEqual>
				<isEqual property="createDateRange" compareValue="tsweek">
					OM.CREATE_DATE BETWEEN TRUNC(SYSDATE,'IW') AND TRUNC(SYSDATE,'IW') + 6
				</isEqual>
				<isEqual property="createDateRange" compareValue="lsweek">
					OM.CREATE_DATE BETWEEN TRUNC(SYSDATE-7,'IW') AND TRUNC(SYSDATE-7,'IW') + 6 
				</isEqual>
				<isEqual property="createDateRange" compareValue="tsmonth">
					TO_CHAR(OM.CREATE_DATE, 'yyyyMM') = TO_CHAR(SYSDATE, 'yyyyMM')
				</isEqual>
				<isEqual property="createDateRange" compareValue="lsmonth">
					TO_CHAR(ADD_MONTHS(OM.CREATE_DATE,1), 'yyyyMM') = TO_CHAR(SYSDATE, 'yyyyMM')
				</isEqual>
			</isNotEmpty>
		</isEmpty>
		<!-- 渠道  -->
	<!--删除渠道 	<isNotEmpty prepend="AND" property="channel">
			OM.ORDER_CHANNEL=#channel# 
		</isNotEmpty> -->
		<!-- 供应商 -->
		<isNotEmpty prepend="AND" property="commerceId">
		<isEqual property="commerceId" compareValue="1">
		 om.commerce_id is null
		 </isEqual>
		 <isEqual property="commerceId" compareValue="2">
		 om.commerce_id is not null
		 <!-- 所属商家名称 -->
		<isNotEmpty prepend="AND" property="commerceName">
			om.commerce_name = #commerceName# 
		</isNotEmpty>
		 </isEqual>
		</isNotEmpty>
		<!--删除 <isEmpty prepend="AND"  property="commerceId">
			exists (select 1 from user_channel uc where om.order_channel=uc.channel_name and uc.user_id=#sysuser.userId#)
		</isEmpty> -->
		<!-- 订单号 -->
		<isNotEmpty prepend="AND" property="orderCode">
			instr(OM.ORDER_CODE,trim(#orderCode#))>0 
		</isNotEmpty>
  </sql>
	<!--  模糊查询订单计数-->
	  <select id="countFuzzyOrderByMap"  parameterClass="java.util.Map"  resultClass="java.lang.Integer">
  		SELECT COUNT(*) FROM (
  		SELECT DISTINCT 
			 OM.ORDER_ID
    	<include refid="Map_Where_Clause_FuzzyOrder"/>)
      </select>
    
    <!-- 模糊查询订单 --> 
	<select id="selectFuzzyOrderByMap"  parameterClass="java.util.Map"  resultMap="WITHROOT_RESULTMAP_FOR_FUZZY_ys">
		SELECT  TT.ORDER_ID, TT.CUSTOMER_ACCOUNT, TT.CUSTOMER_NAME, TT.CUSTOMER_MOBILE, TT.ORDER_PURCHASER_NAME, 
				TT.ORDER_PURCHASER_MOBILE, TT.ORDER_PURCHASER_TEL, TT.ORDER_PURCHASER_ADDR, TT.ORDER_PURCHASER_TYPE, 
				TT.CONSIGNEE_NAME, TT.CONSIGNEE_MOBILE, TT.CONSIGNEE_TEL, TT.CONSIGNEE_ADDR, TT.PAY_METHOD, TT.FARE, 
				TT.DELIVERY_DATE_TYPE, TT.COMMODITY_SUM, TT.DISCOUNT_AMOUNT, TT.ACCOUNT_BALANCE, TT.AMOUNT_PAYABLE, 
				TT.PAY_DATE, TT.CREATE_DATE, TT.AGENCY_NUMBER, TT.SETTLEMENT_NO, TT.STOCK_OUT_ID, TT.DISTRIBUTION_ID, 
				TT.LOGISTICS_ORDER_NO, TT.ORDER_SOURCE, TT.INVOICE_ID, TT.PARENT_ORDER_CODE, TT.SON_ORDER_CODE, 
				TT.ORDER_DESCRIPTION, TT.ORDER_STATUS, TT.ORDER_CODE, TT.CUSTOMER_ID, TT.ORDER_CHANNEL, TT.DISABLED, 
				TT.CONFIRM_DELIVERY, TT.LOGISTICS_CODE, TT.ADDRESS_ID, TT.EMAIL, TT.WEIGHT, TT.ASSESS_STATUS, TT.FINISH_DATE,
		        TT.INVOICE_INFO_TYPE,TT.INVOICE_INFO_TITLE,TT.INVOICE_INFO_CONTENT,TT.TOTAL_CREDIT,TT.LOGISTICS_NAME,TT.ORIGINAL_ORDER_SUM,
		        TT.PROVINCE,  TT.CITY,  TT.AREA,  TT.ZIPCODE, TT.ORDER_TYPE, TT.ORDER_OPERATION_REMARK,TT.COMMERCE_ID,TT.PRIZE_NUMBERS,
		        TT.PRESCRIPTION_ATTACHMENT,TT.CHECK_FLAG,TT.MEDIC_FLAG,TT.COMMERCE_NAME,TT.DEPOSIT_SUM,TT.FINALPAYMENT
			   	,(SELECT OPS.ORDER_MONEY FROM  ORDER_PAY_STATEMENT OPS WHERE OPS.ORDER_CODE = TT.ORDER_CODE AND OPS.STATE = 1 AND OPS.YSFLAGE = 1) AS PAIDDEPOSIT
			   	,(SELECT OPS.ORDER_MONEY FROM  ORDER_PAY_STATEMENT OPS WHERE OPS.ORDER_CODE = TT.ORDER_CODE AND OPS.STATE = 1 AND OPS.YSFLAGE = 2) AS NOFINALPAYMENT
		        ,(SELECT P.FINALPAY_END_TIME
		            FROM  PROMOTION_PRESELL P
		           WHERE P.PRESELL_ID = (SELECT I.PRESELL_ID
		                                   FROM ORDER_ITEM I,ORDER_MAIN O
		                                  WHERE I.ORDER_CODE = O.ORDER_CODE
		                                    AND O.ORDER_CODE = TT.ORDER_CODE
		                                    AND ROWNUM = 1)) FINALPAY_END_TIME
		        ,(SELECT D.ORDER_DICTIONARY_VALUE FROM ORDER_DICTIONARY D WHERE D.ORDER_DICTIONARY_TYPE = 'Pay_Method' AND D.ORDER_DICTIONARY_KEY = TT.PAY_METHOD) payMethodStr
		        ,(SELECT D.ORDER_DICTIONARY_VALUE FROM ORDER_DICTIONARY D WHERE D.ORDER_DICTIONARY_TYPE = 'Delivery_Date_Type' AND D.ORDER_DICTIONARY_KEY = TT.DELIVERY_DATE_TYPE) deliveryDateTypeStr
		        ,(SELECT D.ORDER_DICTIONARY_VALUE FROM ORDER_DICTIONARY D WHERE D.ORDER_DICTIONARY_TYPE = 'Order_Status' AND D.ORDER_DICTIONARY_KEY = TT.ORDER_STATUS) orderStatusStr
		        ,(SELECT D.ORDER_DICTIONARY_VALUE FROM ORDER_DICTIONARY D WHERE D.ORDER_DICTIONARY_TYPE = 'Order_Source' AND D.ORDER_DICTIONARY_KEY = TT.ORDER_SOURCE) orderSourceStr
				,(
					CASE
					WHEN TT.PARENT_ORDER_CODE IS NULL THEN
						NULL
					ELSE
						(
							SELECT
								ORDER_CODE
							FROM
								ORDER_MAIN E
							WHERE
								CONNECT_BY_ISLEAF = 1 START WITH E .ORDER_CODE = TT.ORDER_CODE CONNECT BY E .ORDER_CODE = PRIOR E .PARENT_ORDER_CODE
						)
					END
				) ROOT_ORDER_CODE	
				,(SELECT HANDLE_STATE FROM ORDER_HANDLE WHERE ORDER_CODE = TT.ORDER_CODE) HANDLESTATE
				,(SELECT HANDLE_ACCOUNT FROM ORDER_HANDLE WHERE ORDER_CODE = TT.ORDER_CODE) HANDLEACCOUNT	        
  		FROM (SELECT 	T.ORDER_ID, T.CUSTOMER_ACCOUNT, T.CUSTOMER_NAME, T.CUSTOMER_MOBILE, T.ORDER_PURCHASER_NAME, 
						T.ORDER_PURCHASER_MOBILE, T.ORDER_PURCHASER_TEL, T.ORDER_PURCHASER_ADDR, T.ORDER_PURCHASER_TYPE, 
						T.CONSIGNEE_NAME, T.CONSIGNEE_MOBILE, T.CONSIGNEE_TEL, T.CONSIGNEE_ADDR, T.PAY_METHOD, T.FARE, 
						T.DELIVERY_DATE_TYPE, T.COMMODITY_SUM, T.DISCOUNT_AMOUNT, T.ACCOUNT_BALANCE, T.AMOUNT_PAYABLE, 
						T.PAY_DATE, T.CREATE_DATE, T.AGENCY_NUMBER, T.SETTLEMENT_NO, T.STOCK_OUT_ID, T.DISTRIBUTION_ID, 
						T.LOGISTICS_ORDER_NO, T.ORDER_SOURCE, T.INVOICE_ID, T.PARENT_ORDER_CODE, T.SON_ORDER_CODE, 
						T.ORDER_DESCRIPTION, T.ORDER_STATUS, T.ORDER_CODE, T.CUSTOMER_ID, T.ORDER_CHANNEL, T.DISABLED, 
						T.CONFIRM_DELIVERY, T.LOGISTICS_CODE, T.ADDRESS_ID, T.EMAIL, T.WEIGHT, T.ASSESS_STATUS, T.FINISH_DATE,
       					T.INVOICE_INFO_TYPE,T.INVOICE_INFO_TITLE,T.INVOICE_INFO_CONTENT,T.TOTAL_CREDIT ,T.LOGISTICS_NAME,T.ORIGINAL_ORDER_SUM,
       					T.PROVINCE,T.CITY,T.AREA,T.ZIPCODE,T.ORDER_TYPE,T.ORDER_OPERATION_REMARK,T.COMMERCE_ID,T.PRIZE_NUMBERS,
       					T.PRESCRIPTION_ATTACHMENT,T.CHECK_FLAG,T.MEDIC_FLAG,T.COMMERCE_NAME,T.DEPOSIT_SUM,T.FINALPAYMENT,ROWNUM rn
        FROM(SELECT DISTINCT 	OM.ORDER_ID, OM.CUSTOMER_ACCOUNT, OM.CUSTOMER_NAME, OM.CUSTOMER_MOBILE, OM.ORDER_PURCHASER_NAME, 
								OM.ORDER_PURCHASER_MOBILE, OM.ORDER_PURCHASER_TEL, OM.ORDER_PURCHASER_ADDR, OM.ORDER_PURCHASER_TYPE, 
								OM.CONSIGNEE_NAME, OM.CONSIGNEE_MOBILE, OM.CONSIGNEE_TEL, OM.CONSIGNEE_ADDR, OM.PAY_METHOD, OM.FARE, 
								OM.DELIVERY_DATE_TYPE, OM.COMMODITY_SUM, OM.DISCOUNT_AMOUNT, OM.ACCOUNT_BALANCE, OM.AMOUNT_PAYABLE, 
								OM.PAY_DATE, OM.CREATE_DATE, OM.AGENCY_NUMBER, OM.SETTLEMENT_NO, OM.STOCK_OUT_ID, OM.DISTRIBUTION_ID, 
								OM.LOGISTICS_ORDER_NO, OM.ORDER_SOURCE, OM.INVOICE_ID, OM.PARENT_ORDER_CODE, OM.SON_ORDER_CODE, 
								OM.ORDER_DESCRIPTION, OM.ORDER_STATUS, OM.ORDER_CODE, OM.CUSTOMER_ID, OM.ORDER_CHANNEL, OM.DISABLED, 
								OM.CONFIRM_DELIVERY, OM.LOGISTICS_CODE, OM.ADDRESS_ID, OM.EMAIL, OM.WEIGHT, OM.ASSESS_STATUS, OM.FINISH_DATE,
  								OM.INVOICE_INFO_TYPE,OM.INVOICE_INFO_TITLE,OM.INVOICE_INFO_CONTENT,OM.TOTAL_CREDIT,LOGISTICS_NAME,ORIGINAL_ORDER_SUM,
       							OM.PROVINCE,OM.CITY,OM.AREA,OM.ZIPCODE,OM.ORDER_TYPE,OM.ORDER_OPERATION_REMARK,OM.COMMERCE_ID,OM.PRIZE_NUMBERS,
       							OM.PRESCRIPTION_ATTACHMENT,OM.CHECK_FLAG,OM.MEDIC_FLAG,OM.COMMERCE_NAME,OM.DEPOSIT_SUM,(OM.AMOUNT_PAYABLE-OM.DEPOSIT_SUM) FINALPAYMENT
  		<include refid="Map_Where_Clause_FuzzyOrder"/>
  		<isNotEmpty property="fkChange">
  		ORDER BY OM.CREATE_DATE
  		</isNotEmpty>
  		<isEmpty property="fkChange">
  		ORDER BY OM.CREATE_DATE DESC
  		</isEmpty> ) T
        WHERE ROWNUM  &lt;= #end#) TT
		WHERE TT.rn  &gt;= #start#
  </select>
  
 
  <sql id="MAP_WHERE_CLAUSE_FUZZYORDER_FOR_COUNT">
		from order_main om where 1=1 
		<!--and om.parent_order_code is null
		 订单状态  -->
		  <isNotEmpty prepend="AND" property="status">
			om.order_status = #status#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="nstatus">
		<![CDATA[ om.order_status not in ]]>
		    <iterate open="(" close=")" conjunction="," property="nstatus">  
					<![CDATA[#nstatus[]#]]>
			</iterate>  
		</isNotEmpty>
		<isNotEmpty property="commodityName">
			and exists (select 1 from order_item oi where om.order_code = oi.order_code
				and instr(oi.commodity_name, trim(#commodityName#))>0
			<isNotEmpty property="commodityCode">
			 	and oi.commodity_code = #commodityCode#
			</isNotEmpty>
			 )
		</isNotEmpty>
		<isEmpty property="commodityName">
			<isNotEmpty property="commodityCode">
			and exists (select 1 from order_item oi where om.order_code = oi.order_code
				and oi.commodity_code = #commodityCode# )
			</isNotEmpty>
		</isEmpty>
		<!-- 下单账号 -->
		<isNotEmpty prepend="and" property="customerAccount">
			instr(om.customer_account, trim(#customerAccount#))>0
		</isNotEmpty>
		<!-- 收货人 -->
		<isNotEmpty prepend="and" property="consigneeName">
			instr(om.consignee_name, trim(#consigneeName#))>0
		</isNotEmpty>
		<!-- 收货人电话 -->
		<isNotEmpty prepend="and" property="consigneeMobile">
			instr(om.consignee_mobile,trim(#consigneeMobile#))>0
		</isNotEmpty>
		<!-- 下单类型 -->
		<!-- <isNotEmpty prepend="and" property="orderPurchaserType">
			<isEqual property="orderPurchaserType" compareValue="4">
            exists (select 1
          from   era_info ei
         where ei.n_login_id = om.customer_id)
            </isEqual>
		 <isNotEqual property="orderPurchaserType" compareValue="4">
			om.order_purchaser_type = #orderPurchaserType#
		 </isNotEqual>
		</isNotEmpty> -->
		<isNotEmpty prepend="and" property="orderPurchaserType">
			om.order_purchaser_type = #orderPurchaserType#
		</isNotEmpty>
		<!-- 客服账户 -->
		<isNotEmpty prepend="and" property="agencyNumber">
			instr(om.agency_number,trim(#agencyNumber#))>0
		</isNotEmpty>
		<!-- 出库单号 -->
		<isNotEmpty prepend="and" property="stockOutID">
			instr(om.stock_out_id,trim(#stockOutID#))>0
		</isNotEmpty>
		<!-- 结转单号 -->
		<isNotEmpty prepend="and" property="settlementNo">
			instr(om.settlement_no,trim(#settlementNo#))>0
		</isNotEmpty>
		<!-- 配送单号 -->
		<isNotEmpty prepend="and" property="distributionId">
			instr(om.distribution_id,trim(#distributionId#))>0
		</isNotEmpty>
		<!-- 可见性 -->
		<isNotEmpty prepend="and" property="disabled">
			om.disabled = #disabled#
		</isNotEmpty>
		<!-- 是否已评价 -->
		<isEqual prepend="and" property="assess" compareValue="true">
			om.assess_status IN (2,3)
		</isEqual>
		<!-- 订单来源 -->
		<isNotEmpty prepend="AND" property="orderSource">
			OM.ORDER_SOURCE = #orderSource#
		</isNotEmpty>
		<!-- 处理标记 -->
		<isNotEmpty  prepend="and" property="handle">
			<isEqual property="handle" compareValue="2">
				exists (select 1 from order_handle oh where om.order_code = oh.order_code and (
					oh.handle_state = #handle#
			</isEqual>
			<isEqual property="handle" compareValue="1">
				not exists (select 1 from order_handle oh where om.order_code = oh.order_code and (
					oh.handle_state = 2
			</isEqual>
			) )
		</isNotEmpty>
		<!-- 支付时间  -->
		<isNotEmpty prepend="and" property="payDateStart">
		<![CDATA[
			trunc(om.pay_date,'mi')>=to_date(#payDateStart#,'yyyy-MM-dd HH24:mi:ss')
			and trunc(om.pay_date,'mi')<=to_date(#payDateEnd#,'yyyy-MM-dd HH24:mi:ss')
		]]>
		</isNotEmpty>
		<isEmpty property="payDateStart">
		<!-- 支付时间范围 -->
		<isNotEmpty prepend="and" property="payDateRange">
			<isEqual property="payDateRange" compareValue="today">
				to_char(om.pay_date, 'yyyyMMdd') = to_char(sysdate, 'yyyyMMdd')
			</isEqual>
			<isEqual property="payDateRange" compareValue="ysday">
				to_char(om.pay_date, 'yyyyMMdd') = to_char(sysdate-1, 'yyyyMMdd')
			</isEqual>
			<isEqual property="payDateRange" compareValue="tsweek">
				om.pay_date between trunc(sysdate,'IW') AND trunc(sysdate,'IW') + 6
			</isEqual>
			<isEqual property="payDateRange" compareValue="lsweek">
				om.pay_date between trunc(SYSDATE-7,'IW') AND trunc(sysdate-7,'IW') + 6 
			</isEqual>
			<isEqual property="payDateRange" compareValue="tsmonth">
				to_char(om.pay_date, 'yyyyMM') = to_char(sysdate, 'yyyyMM')
			</isEqual>
			<isEqual property="payDateRange" compareValue="lsmonth">
				to_char(add_months(om.pay_date,1), 'yyyyMM') = to_char(sysdate, 'yyyyMM')
			</isEqual>
		</isNotEmpty>
		</isEmpty>
		<!-- 下单时间  -->
		<isNotEmpty prepend="AND" property="createDateStart">
		<![CDATA[
			trunc(om.create_date,'mi')>=to_date(#createDateStart#,'yyyy-MM-dd HH24:mi:ss')
			and trunc(om.create_date,'mi')<=to_date(#createDateEnd#,'yyyy-MM-dd HH24:mi:ss')
		]]>
		</isNotEmpty>
		<isEmpty property="createDateStart">
		<!-- 下单时间范围 -->
			<isNotEmpty prepend="AND" property="createDateRange">
				<isEqual property="createDateRange" compareValue="today">
					to_char(om.create_date, 'yyyyMMdd') = TO_CHAR(SYSDATE, 'yyyyMMdd')
				</isEqual>
				<isEqual property="createDateRange" compareValue="ysday">
					TO_CHAR(OM.CREATE_DATE, 'yyyyMMdd') = TO_CHAR(SYSDATE-1, 'yyyyMMdd')
				</isEqual>
				<isEqual property="createDateRange" compareValue="tsweek">
					OM.CREATE_DATE BETWEEN TRUNC(SYSDATE,'IW') AND TRUNC(SYSDATE,'IW') + 6
				</isEqual>
				<isEqual property="createDateRange" compareValue="lsweek">
					OM.CREATE_DATE BETWEEN TRUNC(SYSDATE-7,'IW') AND TRUNC(SYSDATE-7,'IW') + 6 
				</isEqual>
				<isEqual property="createDateRange" compareValue="tsmonth">
					TO_CHAR(OM.CREATE_DATE, 'yyyyMM') = TO_CHAR(SYSDATE, 'yyyyMM')
				</isEqual>
				<isEqual property="createDateRange" compareValue="lsmonth">
					TO_CHAR(ADD_MONTHS(OM.CREATE_DATE,1), 'yyyyMM') = TO_CHAR(SYSDATE, 'yyyyMM')
				</isEqual>
			</isNotEmpty>
		</isEmpty>
		<!-- 渠道  -->
		<!-- <isNotEmpty prepend="AND" property="channel">
			OM.ORDER_CHANNEL=#channel# 
		</isNotEmpty> -->
		<!-- 供应商 -->
		<isNotEmpty property="commerceId" prepend="AND">
		 <isEqual property="commerceId" compareValue="1">
		 om.commerce_id is null
		 </isEqual>
		 <isEqual property="commerceId" compareValue="2">
		 om.commerce_id is not null
		 </isEqual>	 
		</isNotEmpty>
		<!-- 所属商家 -->
		<isNotEmpty property="commerceName" prepend="AND">
			om.commerce_Name=#commerceName#
		</isNotEmpty>
		
		<!-- <isEmpty property="commerceId">
			and exists (select 1 from user_channel uc where om.order_channel=uc.channel_name and uc.user_id=#sysuser.userId#)
		</isEmpty> -->
		<!-- 订单号 -->
		<isNotEmpty prepend="AND " property="orderCode">
          instr(om.order_code ,trim(#orderCode#))>0
		</isNotEmpty>
  </sql>
  
  
  
   <select id="countFuzzyOrderActualByMap" parameterClass="java.util.Map" resultClass="java.math.BigDecimal" >
   select sum(nvl(op.order_money, 0))
  		from (
  			select distinct om.order_code order_code
  			from order_main om where 
    om.parent_order_code is null
   start with om.order_code in (
   select distinct om.order_code order_code
  	<include refid="MAP_WHERE_CLAUSE_FUZZYORDER_FOR_COUNT"/>
  	 ) 
  connect by prior om.parent_order_code = om.order_code
 		 ) oc inner join order_pay_statement op
    	on (op.order_code = oc.order_code)
		where  op.payment_way not in (- 1, 2)
		and  op.state = 1
  </select>
  
  <select id="countFuzzyOrderMoneyByMap" parameterClass="java.util.Map" resultClass="java.math.BigDecimal" >
    select sum(nvl(omo.amount_payable, 0))
  		from (
  			select distinct om.order_code order_code
  			from order_main om where 
    om.parent_order_code is null
   start with om.order_code in (
   select distinct om.order_code order_code
  	<include refid="MAP_WHERE_CLAUSE_FUZZYORDER_FOR_COUNT"/>
  			) 
  connect by prior om.parent_order_code = om.order_code
 		 ) oc inner join order_main omo
    	on (omo.order_code = oc.order_code)
  </select>
  
  	<sql id="SQL_AMOUNT_CONDITION">
		<!--订单状态  -->
		<isNotEmpty prepend="AND" property="status">
			om.order_status = #status#
		</isNotEmpty>
		<isNotEmpty prepend="and" property="orderStatus">
			 om.order_status in 
			<iterate open="(" close=")" conjunction="," property="orderStatus">
		    	#orderStatus[]#
			</iterate>
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="nstatus">
		<![CDATA[ om.order_status not in ]]>
		    <iterate open="(" close=")" conjunction="," property="nstatus">  
					<![CDATA[#nstatus[]#]]>
			</iterate>  
		</isNotEmpty>
		<isNotEmpty property="commodityName">
			and exists (select 1 from order_item oi where om.order_code = oi.order_code
				and instr(oi.commodity_name, trim(#commodityName#))>0
			<isNotEmpty property="commodityCode">
			 	and oi.commodity_code = #commodityCode#
			</isNotEmpty>
			 )
		</isNotEmpty>
		<isEmpty property="commodityName">
			<isNotEmpty property="commodityCode">
			and exists (select 1 from order_item oi where om.order_code = oi.order_code
				and oi.commodity_code = #commodityCode# )
			</isNotEmpty>
		</isEmpty>
		<!-- 下单账号 -->
		<isNotEmpty prepend="and" property="customerAccount">
			instr(om.customer_account, trim(#customerAccount#))>0
		</isNotEmpty>
		<!-- 收货人 -->
		<isNotEmpty prepend="and" property="consigneeName">
			instr(om.consignee_name, trim(#consigneeName#))>0
		</isNotEmpty>
		<!-- 收货人电话 -->
		<isNotEmpty prepend="and" property="consigneeMobile">
			instr(om.consignee_mobile,trim(#consigneeMobile#))>0
		</isNotEmpty>
		<!-- 下单类型 -->
		<!-- <isNotEmpty prepend="and" property="orderPurchaserType">
			<isEqual property="orderPurchaserType" compareValue="4">
            exists (select 1
          from   era_info ei
         where ei.n_login_id = om.customer_id)
            </isEqual>
		 <isNotEqual property="orderPurchaserType" compareValue="4">
			om.order_purchaser_type = #orderPurchaserType#
		 </isNotEqual>
		</isNotEmpty> -->
		<isNotEmpty prepend="and" property="orderPurchaserType">
			om.order_purchaser_type = #orderPurchaserType#
		</isNotEmpty>
		<!-- 客服账户 -->
		<isNotEmpty prepend="and" property="agencyNumber">
			instr(om.agency_number,trim(#agencyNumber#))>0
		</isNotEmpty>
		<!-- 出库单号 -->
		<isNotEmpty prepend="and" property="stockOutID">
			instr(om.stock_out_id,trim(#stockOutID#))>0
		</isNotEmpty>
		<!-- 结转单号 -->
		<isNotEmpty prepend="and" property="settlementNo">
			instr(om.settlement_no,trim(#settlementNo#))>0
		</isNotEmpty>
		<!-- 配送单号 -->
		<isNotEmpty prepend="and" property="distributionId">
			instr(om.distribution_id,trim(#distributionId#))>0
		</isNotEmpty>
		<!-- 可见性 -->
		<isNotEmpty prepend="and" property="disabled">
			om.disabled = #disabled#
		</isNotEmpty>
		<!-- 是否已评价 -->
		<isEqual prepend="and" property="assess" compareValue="true">
			om.assess_status IN (2,3)
		</isEqual>
		<!-- 订单来源 -->
		<isNotEmpty prepend="AND" property="orderSource">
			OM.ORDER_SOURCE = #orderSource#
		</isNotEmpty>
		<isNotEmpty  prepend="and" property="handle">
			<isEqual property="handle" compareValue="2">
				exists (select 1 from order_handle oh where om.order_code = oh.order_code and (
					oh.handle_state = #handle#
			</isEqual>
			<isEqual property="handle" compareValue="1">
				not exists (select 1 from order_handle oh where om.order_code = oh.order_code and (
					oh.handle_state = 2
			</isEqual>
			) )
		</isNotEmpty>
		<!-- 支付时间  -->
		<isNotEmpty prepend="and" property="payDateStart">
		<![CDATA[
			trunc(om.pay_date,'mi')>=to_date(#payDateStart#,'yyyy-MM-dd HH24:mi:ss')
			and trunc(om.pay_date,'mi')<=to_date(#payDateEnd#,'yyyy-MM-dd HH24:mi:ss')
		]]>
		</isNotEmpty>
		<isEmpty property="payDateStart">
		<!-- 支付时间范围 -->
		<isNotEmpty prepend="and" property="payDateRange">
			<isEqual property="payDateRange" compareValue="today">
				to_char(om.pay_date, 'yyyyMMdd') = to_char(sysdate, 'yyyyMMdd')
			</isEqual>
			<isEqual property="payDateRange" compareValue="ysday">
				to_char(om.pay_date, 'yyyyMMdd') = to_char(sysdate-1, 'yyyyMMdd')
			</isEqual>
			<isEqual property="payDateRange" compareValue="tsweek">
				om.pay_date between trunc(sysdate,'IW') AND trunc(sysdate,'IW') + 6
			</isEqual>
			<isEqual property="payDateRange" compareValue="lsweek">
				om.pay_date between trunc(SYSDATE-7,'IW') AND trunc(sysdate-7,'IW') + 6 
			</isEqual>
			<isEqual property="payDateRange" compareValue="tsmonth">
				to_char(om.pay_date, 'yyyyMM') = to_char(sysdate, 'yyyyMM')
			</isEqual>
			<isEqual property="payDateRange" compareValue="lsmonth">
				to_char(add_months(om.pay_date,1), 'yyyyMM') = to_char(sysdate, 'yyyyMM')
			</isEqual>
		</isNotEmpty>
		</isEmpty>
		<!-- 下单时间  -->
		<isNotEmpty prepend="AND" property="createDateStart">
		<![CDATA[
			trunc(om.create_date,'mi')>=to_date(#createDateStart#,'yyyy-MM-dd HH24:mi:ss')
			and trunc(om.create_date,'mi')<=to_date(#createDateEnd#,'yyyy-MM-dd HH24:mi:ss')
		]]>
		</isNotEmpty>
		<isEmpty property="createDateStart">
		<!-- 下单时间范围 -->
			<isNotEmpty prepend="AND" property="createDateRange">
				<isEqual property="createDateRange" compareValue="today">
					to_char(om.create_date, 'yyyyMMdd') = TO_CHAR(SYSDATE, 'yyyyMMdd')
				</isEqual>
				<isEqual property="createDateRange" compareValue="ysday">
					TO_CHAR(OM.CREATE_DATE, 'yyyyMMdd') = TO_CHAR(SYSDATE-1, 'yyyyMMdd')
				</isEqual>
				<isEqual property="createDateRange" compareValue="tsweek">
					OM.CREATE_DATE BETWEEN TRUNC(SYSDATE,'IW') AND TRUNC(SYSDATE,'IW') + 6
				</isEqual>
				<isEqual property="createDateRange" compareValue="lsweek">
					OM.CREATE_DATE BETWEEN TRUNC(SYSDATE-7,'IW') AND TRUNC(SYSDATE-7,'IW') + 6 
				</isEqual>
				<isEqual property="createDateRange" compareValue="tsmonth">
					TO_CHAR(OM.CREATE_DATE, 'yyyyMM') = TO_CHAR(SYSDATE, 'yyyyMM')
				</isEqual>
				<isEqual property="createDateRange" compareValue="lsmonth">
					TO_CHAR(ADD_MONTHS(OM.CREATE_DATE,1), 'yyyyMM') = TO_CHAR(SYSDATE, 'yyyyMM')
				</isEqual>
			</isNotEmpty>
		</isEmpty>
		<!-- 渠道  -->
		<!-- <isNotEmpty prepend="AND" property="channel">
			OM.ORDER_CHANNEL=#channel# 
		</isNotEmpty> -->
		<!-- 供应商 -->
		<isNotEmpty property="commerceId" prepend="AND">
		 <isEqual property="commerceId" compareValue="1">
		 om.commerce_id is null
		 </isEqual>
		 <isEqual property="commerceId" compareValue="2">
		 om.commerce_id is not null
		 </isEqual>	 
		</isNotEmpty>
		<!-- 所属商家 -->
		<isNotEmpty property="commerceName" prepend="AND">
			om.commerce_Name=#commerceName#
		</isNotEmpty>
		
		<!-- <isEmpty property="commerceId">
			and exists (select 1 from user_channel uc where om.order_channel=uc.channel_name and uc.user_id=#sysuser.userId#)
		</isEmpty> -->
		<!-- 订单号 -->
		<isNotEmpty prepend="AND " property="orderCode">
          instr(om.order_code ,trim(#orderCode#))>0
		</isNotEmpty>
		<!-- 订单类型-->
		<isNotEmpty prepend="AND " property="order_Type">
          om.order_type =#order_Type#
		</isNotEmpty>
  </sql>
  
  
    <select id="countFuzzyByMap" parameterClass="java.util.Map" resultClass="java.util.HashMap" >
		  select sum(t.orderMoney) orderMoney, sum(t.actualMoney) actualMoney 
			from (select sum(nvl(om.amount_payable,0)) orderMoney,0 as actualMoney
		   from order_main om
		  where om.parent_order_code is null
		    <include refid="SQL_AMOUNT_CONDITION"/>
		    union all
		    select 0 as orderMoney, sum(nvl(ops.order_money,0))actualMoney
		      from order_main om
		      left join order_pay_statement ops
		        on (ops.order_code = om.order_code and
		           ops.payment_way not in (-1, 2) and ops.state = 1)
		     where om.parent_order_code is null
		      <include refid="SQL_AMOUNT_CONDITION"/>)t
  </select>
  
  <select id="selectCommercialByMap" parameterClass="java.util.Map" resultMap="ibatorgenerated_MerchantResultMap">
  SELECT SI.SUPPLIER_ID AS MERCHANTID, CTBI.CORPORATE_NAME AS MERCHANTNAME 
  FROM   COMMERCIAL_TENANT_BASIC_INFO CTBI
  INNER JOIN  SUPPLIERS_INFO SI
  ON (CTBI.N_COMMERCIAL_TENANT_ID = SI.MERCHANT_ID)
  
  </select>
  
  
    <!-- map方式查询订单列表 -->
  <sql id="OrderData_Map_Where_Clause">
		from order_main om where 1=1 
		<isEmpty prepend="AND" property="orderCode">
			OM.ORDER_STATUS != 16
		</isEmpty>
		<!-- 订单状态  -->
		<isNotEmpty prepend="AND" property="status">
			OM.ORDER_STATUS = #status#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="nstatus">
		<![CDATA[ OM.ORDER_STATUS not in ]]>
		    <iterate open="(" close=")" conjunction="," property="nstatus">  
					<![CDATA[#nstatus[]#]]>
			</iterate>  
		</isNotEmpty>
					
		<!-- 下单账号 -->
		<isNotEmpty prepend="AND" property="customerAccount">
			OM.CUSTOMER_ACCOUNT=#customerAccount#
		</isNotEmpty>
		<!-- 渠道 -->
		<!-- <isNotEmpty prepend="AND" property="channel">
				OM.ORDER_CHANNEL=#channel# 
		</isNotEmpty> -->
		<!-- 收货人 -->
		<isNotEmpty prepend="AND" property="consigneeName">
			OM.CONSIGNEE_NAME=#consigneeName#
		</isNotEmpty>
		<!-- 收货人电话 -->
		<isNotEmpty prepend="AND" property="consigneeMobile">
			OM.CONSIGNEE_MOBILE=#consigneeMobile#
		</isNotEmpty>
		<!-- 订单号 -->
		<isNotEmpty prepend="AND" property="orderCode">
			OM.ORDER_CODE = #orderCode# 
		</isNotEmpty>
  </sql> 
  
  <select id="selectOrderDataByMap"  parameterClass="java.util.Map"  resultMap="WithRoot_ResultMap">
		SELECT  TT.ORDER_ID, TT.CUSTOMER_ACCOUNT, TT.CUSTOMER_NAME, TT.CUSTOMER_MOBILE, TT.ORDER_PURCHASER_NAME, 
				TT.ORDER_PURCHASER_MOBILE, TT.ORDER_PURCHASER_TEL, TT.ORDER_PURCHASER_ADDR, TT.ORDER_PURCHASER_TYPE, 
				TT.CONSIGNEE_NAME, TT.CONSIGNEE_MOBILE, TT.CONSIGNEE_TEL, TT.CONSIGNEE_ADDR, TT.PAY_METHOD, TT.FARE, 
				TT.DELIVERY_DATE_TYPE, TT.COMMODITY_SUM, TT.DISCOUNT_AMOUNT, TT.ACCOUNT_BALANCE, TT.AMOUNT_PAYABLE, 
				TT.PAY_DATE, TT.CREATE_DATE, TT.AGENCY_NUMBER, TT.SETTLEMENT_NO, TT.STOCK_OUT_ID, TT.DISTRIBUTION_ID, 
				TT.LOGISTICS_ORDER_NO, TT.ORDER_SOURCE, TT.INVOICE_ID, TT.PARENT_ORDER_CODE, TT.SON_ORDER_CODE, 
				TT.ORDER_DESCRIPTION, TT.ORDER_STATUS, TT.ORDER_CODE, TT.CUSTOMER_ID, TT.ORDER_CHANNEL, TT.DISABLED, 
				TT.CONFIRM_DELIVERY, TT.LOGISTICS_CODE, TT.ADDRESS_ID, TT.EMAIL, TT.WEIGHT, TT.ASSESS_STATUS, TT.FINISH_DATE,
		        TT.INVOICE_INFO_TYPE,TT.INVOICE_INFO_TITLE,TT.INVOICE_INFO_CONTENT,TT.TOTAL_CREDIT,TT.LOGISTICS_NAME,TT.ORIGINAL_ORDER_SUM,
		        TT.PROVINCE,  TT.CITY,  TT.AREA,  TT.ZIPCODE, TT.ORDER_TYPE, TT.ORDER_OPERATION_REMARK,TT.COMMERCE_ID,TT.PRIZE_NUMBERS,
		        TT.PRESCRIPTION_ATTACHMENT,TT.CHECK_FLAG,TT.MEDIC_FLAG,TT.COMMERCE_NAME
		        <!-- 附加 -->
		        ,(SELECT D.ORDER_DICTIONARY_VALUE FROM ORDER_DICTIONARY D WHERE D.ORDER_DICTIONARY_TYPE = 'Pay_Method' AND D.ORDER_DICTIONARY_KEY = TT.PAY_METHOD) payMethodStr
		        ,(SELECT D.ORDER_DICTIONARY_VALUE FROM ORDER_DICTIONARY D WHERE D.ORDER_DICTIONARY_TYPE = 'Delivery_Date_Type' AND D.ORDER_DICTIONARY_KEY = TT.DELIVERY_DATE_TYPE) deliveryDateTypeStr
		        ,(SELECT D.ORDER_DICTIONARY_VALUE FROM ORDER_DICTIONARY D WHERE D.ORDER_DICTIONARY_TYPE = 'Order_Status' AND D.ORDER_DICTIONARY_KEY = TT.ORDER_STATUS) orderStatusStr
				,(
					CASE
					WHEN TT.PARENT_ORDER_CODE IS NULL THEN
						NULL
					ELSE
						(
							SELECT
								ORDER_CODE
							FROM
								ORDER_MAIN E
							WHERE
								CONNECT_BY_ISLEAF = 1 START WITH E .ORDER_CODE = TT.ORDER_CODE CONNECT BY E .ORDER_CODE = PRIOR E .PARENT_ORDER_CODE
						)
					END
				) ROOT_ORDER_CODE	
				,(SELECT HANDLE_STATE FROM ORDER_HANDLE WHERE ORDER_CODE = TT.ORDER_CODE) HANDLESTATE
				,(SELECT HANDLE_ACCOUNT FROM ORDER_HANDLE WHERE ORDER_CODE = TT.ORDER_CODE) HANDLEACCOUNT	        
		        <!--  -->
  		FROM (SELECT 	T.ORDER_ID, T.CUSTOMER_ACCOUNT, T.CUSTOMER_NAME, T.CUSTOMER_MOBILE, T.ORDER_PURCHASER_NAME, 
						T.ORDER_PURCHASER_MOBILE, T.ORDER_PURCHASER_TEL, T.ORDER_PURCHASER_ADDR, T.ORDER_PURCHASER_TYPE, 
						T.CONSIGNEE_NAME, T.CONSIGNEE_MOBILE, T.CONSIGNEE_TEL, T.CONSIGNEE_ADDR, T.PAY_METHOD, T.FARE, 
						T.DELIVERY_DATE_TYPE, T.COMMODITY_SUM, T.DISCOUNT_AMOUNT, T.ACCOUNT_BALANCE, T.AMOUNT_PAYABLE, 
						T.PAY_DATE, T.CREATE_DATE, T.AGENCY_NUMBER, T.SETTLEMENT_NO, T.STOCK_OUT_ID, T.DISTRIBUTION_ID, 
						T.LOGISTICS_ORDER_NO, T.ORDER_SOURCE, T.INVOICE_ID, T.PARENT_ORDER_CODE, T.SON_ORDER_CODE, 
						T.ORDER_DESCRIPTION, T.ORDER_STATUS, T.ORDER_CODE, T.CUSTOMER_ID, T.ORDER_CHANNEL, T.DISABLED, 
						T.CONFIRM_DELIVERY, T.LOGISTICS_CODE, T.ADDRESS_ID, T.EMAIL, T.WEIGHT, T.ASSESS_STATUS, T.FINISH_DATE,
       					T.INVOICE_INFO_TYPE,T.INVOICE_INFO_TITLE,T.INVOICE_INFO_CONTENT,T.TOTAL_CREDIT ,T.LOGISTICS_NAME,T.ORIGINAL_ORDER_SUM,
       					T.PROVINCE,T.CITY,T.AREA,T.ZIPCODE,T.ORDER_TYPE,T.ORDER_OPERATION_REMARK,T.COMMERCE_ID,T.PRIZE_NUMBERS,
       					T.PRESCRIPTION_ATTACHMENT,T.CHECK_FLAG,T.MEDIC_FLAG,T.COMMERCE_NAME, ROWNUM rn
        FROM(SELECT DISTINCT 	OM.ORDER_ID, OM.CUSTOMER_ACCOUNT, OM.CUSTOMER_NAME, OM.CUSTOMER_MOBILE, OM.ORDER_PURCHASER_NAME, 
								OM.ORDER_PURCHASER_MOBILE, OM.ORDER_PURCHASER_TEL, OM.ORDER_PURCHASER_ADDR, OM.ORDER_PURCHASER_TYPE, 
								OM.CONSIGNEE_NAME, OM.CONSIGNEE_MOBILE, OM.CONSIGNEE_TEL, OM.CONSIGNEE_ADDR, OM.PAY_METHOD, OM.FARE, 
								OM.DELIVERY_DATE_TYPE, OM.COMMODITY_SUM, OM.DISCOUNT_AMOUNT, OM.ACCOUNT_BALANCE, OM.AMOUNT_PAYABLE, 
								OM.PAY_DATE, OM.CREATE_DATE, OM.AGENCY_NUMBER, OM.SETTLEMENT_NO, OM.STOCK_OUT_ID, OM.DISTRIBUTION_ID, 
								OM.LOGISTICS_ORDER_NO, OM.ORDER_SOURCE, OM.INVOICE_ID, OM.PARENT_ORDER_CODE, OM.SON_ORDER_CODE, 
								OM.ORDER_DESCRIPTION, OM.ORDER_STATUS, OM.ORDER_CODE, OM.CUSTOMER_ID, OM.ORDER_CHANNEL, OM.DISABLED, 
								OM.CONFIRM_DELIVERY, OM.LOGISTICS_CODE, OM.ADDRESS_ID, OM.EMAIL, OM.WEIGHT, OM.ASSESS_STATUS, OM.FINISH_DATE,
  								OM.INVOICE_INFO_TYPE,OM.INVOICE_INFO_TITLE,OM.INVOICE_INFO_CONTENT,OM.TOTAL_CREDIT,LOGISTICS_NAME,ORIGINAL_ORDER_SUM,
       							OM.PROVINCE,OM.CITY,OM.AREA,OM.ZIPCODE,OM.ORDER_TYPE,OM.ORDER_OPERATION_REMARK,OM.COMMERCE_ID,OM.PRIZE_NUMBERS,
       							OM.PRESCRIPTION_ATTACHMENT,OM.CHECK_FLAG,OM.MEDIC_FLAG,OM.COMMERCE_NAME
  		<include refid="OrderData_Map_Where_Clause"/>
  		ORDER BY OM.CREATE_DATE DESC) T
        WHERE 
        <isNotEmpty prepend=" " property="end">
			ROWNUM  &lt;= #end#
		</isNotEmpty>
		<isEmpty prepend=" " property="end">
			ROWNUM  &lt;= 10
		</isEmpty>
        ) TT
		WHERE 
		<isNotEmpty prepend=" " property="start">
			TT.rn  &gt;= #start#
		</isNotEmpty>
		<isEmpty prepend=" " property="start">
			TT.rn  &gt;= 1
		</isEmpty>
		
  </select>
  
  
  <sql id="MAP_WHERE_CLAUSE_FUZZYORDER_FOR_COUNT2">
		from order_main om where 1=1 
		<!-- and om.parent_order_code is null-->
		<!-- 订单状态  -->
		<isNotEmpty prepend="AND" property="status">
			om.order_status = #status#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="nstatus">
		<![CDATA[ om.order_status not in ]]>
		    <iterate open="(" close=")" conjunction="," property="nstatus">  
					<![CDATA[#nstatus[]#]]>
			</iterate>  
		</isNotEmpty>
		<isNotEmpty property="commodityName">
			and exists (select 1 from order_item oi where om.order_code = oi.order_code
				and instr(oi.commodity_name, trim(#commodityName#))>0
			<isNotEmpty property="commodityCode">
			 	and oi.commodity_code = #commodityCode#
			</isNotEmpty>
			 )
		</isNotEmpty>
		<isEmpty property="commodityName">
			<isNotEmpty property="commodityCode">
			and exists (select 1 from order_item oi where om.order_code = oi.order_code
				and oi.commodity_code = #commodityCode# )
			</isNotEmpty>
		</isEmpty>
		<!-- 下单账号 -->
		<isNotEmpty prepend="and" property="customerAccount">
			instr(om.customer_account, trim(#customerAccount#))>0
		</isNotEmpty>
		<!-- 收货人 -->
		<isNotEmpty prepend="and" property="consigneeName">
			instr(om.consignee_name, trim(#consigneeName#))>0
		</isNotEmpty>
		<!-- 收货人电话 -->
		<isNotEmpty prepend="and" property="consigneeMobile">
			instr(om.consignee_mobile,trim(#consigneeMobile#))>0
		</isNotEmpty>
		<!-- 下单类型 -->
		<!-- <isNotEmpty prepend="and" property="orderPurchaserType">
			<isEqual property="orderPurchaserType" compareValue="4">
            exists (select 1
          from   era_info ei
         where ei.n_login_id = om.customer_id)
            </isEqual>
		 <isNotEqual property="orderPurchaserType" compareValue="4">
			om.order_purchaser_type = #orderPurchaserType#
		 </isNotEqual>
		</isNotEmpty> -->
		<isNotEmpty prepend="and" property="orderPurchaserType">
			om.order_purchaser_type = #orderPurchaserType#
		</isNotEmpty>
		<!-- 客服账户 -->
		<isNotEmpty prepend="and" property="agencyNumber">
			instr(om.agency_number,trim(#agencyNumber#))>0
		</isNotEmpty>
		<!-- 出库单号 -->
		<isNotEmpty prepend="and" property="stockOutID">
			instr(om.stock_out_id,trim(#stockOutID#))>0
		</isNotEmpty>
		<!-- 结转单号 -->
		<isNotEmpty prepend="and" property="settlementNo">
			instr(om.settlement_no,trim(#settlementNo#))>0
		</isNotEmpty>
		<!-- 配送单号 -->
		<isNotEmpty prepend="and" property="distributionId">
			instr(om.distribution_id,trim(#distributionId#))>0
		</isNotEmpty>
		<!-- 可见性 -->
		<isNotEmpty prepend="and" property="disabled">
			om.disabled = #disabled#
		</isNotEmpty>
		<!-- 是否已评价 -->
		<isEqual prepend="and" property="assess" compareValue="true">
			om.assess_status IN (2,3)
		</isEqual>
		<!-- 订单来源 -->
		<isNotEmpty prepend="AND" property="orderSource">
			OM.ORDER_SOURCE = #orderSource#
		</isNotEmpty>
		<!-- 处理标记 -->
		<isNotEmpty  prepend="and" property="handle">
			<isEqual property="handle" compareValue="2">
				exists (select 1 from order_handle oh where om.order_code = oh.order_code and (
					oh.handle_state = #handle#
			</isEqual>
			<isEqual property="handle" compareValue="1">
				not exists (select 1 from order_handle oh where om.order_code = oh.order_code and (
					oh.handle_state = 2
			</isEqual>
			) )
		</isNotEmpty>
		<!-- 支付时间  -->
		<isNotEmpty prepend="and" property="payDateStart">
		<![CDATA[
			trunc(om.pay_date,'mi')>=to_date(#payDateStart#,'yyyy-MM-dd HH24:mi:ss')
			and trunc(om.pay_date,'mi')<=to_date(#payDateEnd#,'yyyy-MM-dd HH24:mi:ss')
		]]>
		</isNotEmpty>
		
		<!-- 下单时间  -->
		<isNotEmpty prepend="AND" property="createDateStart">
		<![CDATA[
			trunc(om.create_date,'mi')>=to_date(#createDateStart#,'yyyy-MM-dd HH24:mi:ss')
			and trunc(om.create_date,'mi')<=to_date(#createDateEnd#,'yyyy-MM-dd HH24:mi:ss')
		]]>
		</isNotEmpty>
		
		<!-- 渠道  -->
		<!-- <isNotEmpty prepend="AND" property="channel">
			OM.ORDER_CHANNEL=#channel# 
		</isNotEmpty> -->
		<!-- 供应商 -->
		<isNotEmpty property="commerceId" prepend="AND">
		 <isEqual property="commerceId" compareValue="1">
		 om.commerce_id is null
		 </isEqual>
		 <isEqual property="commerceId" compareValue="2">
		 om.commerce_id is not null
		 </isEqual>	 
		</isNotEmpty>
		<!-- 所属商家 -->
		<isNotEmpty property="commerceName" prepend="AND">
			om.commerce_Name=#commerceName#
		</isNotEmpty>
		<!-- <isEmpty property="commerceId">
			and exists (select 1 from user_channel uc where om.order_channel=uc.channel_name)
		</isEmpty> -->
		<!-- 订单号 -->
		<isNotEmpty prepend="AND" property="orderCode">
        instr(om.order_code ,trim(#orderCode#))>0
		</isNotEmpty>
  </sql>
  
   <select id="countFuzzyOrderMoneyByMap2" parameterClass="java.util.Map" resultClass="java.math.BigDecimal" >
    select sum(nvl(omo.amount_payable, 0))
  		from (
  			select distinct om.order_code order_code
  	<include refid="MAP_WHERE_CLAUSE_FUZZYORDER_FOR_COUNT2"/>
  			and om.parent_order_code is null
 		 ) oc inner join order_main omo
    	on (omo.order_code = oc.order_code)
  </select>
  
   <select id="countFuzzyOrderActualByMap2" parameterClass="java.util.Map" resultClass="java.math.BigDecimal" >
   select sum(nvl(op.order_money, 0))
  		from (
  			select distinct om.order_code order_code
  	<include refid="MAP_WHERE_CLAUSE_FUZZYORDER_FOR_COUNT2"/>
  			and om.parent_order_code is null
 		 ) oc inner join order_pay_statement op
    	on (op.order_code = oc.order_code)
		where  op.payment_way not in (- 1, 2)
		and  op.state = 1
  </select>
  
  	<!-- 批量根据订单号查询订单信息 -->
  	<select id="SQL_QUERY_ORDER_MAIN_BY_ORDER_CODES" parameterClass="java.util.List" resultClass="com.pltfm.app.entities.OrderMain">
  	<![CDATA[
  		select om.order_code       orderCode,
		       om.consignee_addr   consigneeAddr,
		       om.consignee_name   consigneeName,
		       om.consignee_mobile consigneeMobile,
		       om.create_date      createDate,
		       om.pay_date         payDate
		  from order_main om
		 where om.order_code in 
  	]]>
  		<iterate open="(" close=")" conjunction=","> #[]# </iterate>
  	</select>
  	
  	<!-- 跟进订单号查询该订单用户购买次数 -->
  	<select id="SQL_QUERY_USER_BUY_NUM_BY_ORDERCODE" parameterClass="java.lang.String" resultClass="java.lang.String">
  	<![CDATA[
  		select max(om.customer_id) || '_' || count(1)
		  from order_main om
		 where om.order_type <> 2
		   and om.pay_date is not null
		   and exists (select 1
		          from order_main omi
		         where om.customer_id = omi.customer_id
		           and omi.order_code = #orderCode:VARCHAR#)
  	]]>
  	</select>
  	
  	
  	  <update id="changeOrderFee" parameterClass="java.util.Map">
    update  ORDER_MAIN
    <dynamic prepend="set">
      
      <isNotNull prepend="," property="fare">
        FARE = #fare:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="amountPayable">
        AMOUNT_PAYABLE = #amountPayable:DECIMAL#
      </isNotNull>
    </dynamic>
    where ORDER_CODE = #orderCode:VARCHAR#
  </update>
  	
  	<!-- 添加订单扩展信息 -->
	<insert id="SQL_INSERT_ORDER_MAIN_EXT_INFO" parameterClass="com.pltfm.app.entities.OrderMainExt">
		<selectKey resultClass="java.lang.Long" keyProperty="orderExtId" >
      		select SEQ_ORDER_MAIN_EXT_ID.NEXTVAL from dual
    	</selectKey>
    	insert into order_main_ext (order_ext_id,order_code
    	<isNotEmpty prepend="," property="delayReceipt" >
        	delay_receipt
      	</isNotEmpty>
          ,organ_code
          ,organ_des
          ,prom_id
		<isNotEmpty prepend="," property="orderOutSource" >
          order_out_source
		</isNotEmpty>
		<isNotEmpty prepend="," property="orderCommission" >          
          order_commission
       	</isNotEmpty>
      	)
      	values
    	(
    		#orderExtId:DECIMAL#,#orderCode:VARCHAR#
    	<isNotEmpty prepend="," property="delayReceipt" >
        	#delayReceipt:DECIMAL#
      	</isNotEmpty>
         	,#organCode:VARCHAR#
         	,#organDes:VARCHAR#
         	,#promId:DECIMAL#
       	<isNotEmpty prepend="," property="orderOutSource" >
          #orderOutSource:VARCHAR#
		</isNotEmpty>
		<isNotEmpty prepend="," property="orderCommission" >          
          #orderCommission:DECIMAL#
       	</isNotEmpty>
    	)
	</insert>
	
	<!-- 修改订单扩展信息 -->
	<update id="SQL_UPDATE_ORDER_MAIN_EXT_INFO" parameterClass="com.pltfm.app.entities.OrderMainExt">
		update order_main_ext ome set
		<dynamic>
			<isNotNull prepend="," property="delayReceipt" >
        		ome.delay_receipt=nvl(ome.delay_receipt,0)+#delayReceipt:DECIMAL#
        	</isNotNull>
		</dynamic>        	
		 where ome.order_code=#orderCode:VARCHAR#
	</update>
	
	
	<!-- 批量根据订单号查询订单信息结转用 -->
   	<select id="SQL_QUERY_ORDER_BY_ORDER_CODES_FOR_EXCUTE" parameterClass="java.util.List"  resultClass="com.pltfm.app.entities.OrderMain">
	<![CDATA[	
		select om.order_id orderId,
		       om.customer_account customerAccount,
		       om.customer_name customerName,
		       om.customer_mobile customerMobile,
		       om.order_purchaser_name orderPurchaserName,
		       om.order_purchaser_mobile,
		       om.order_purchaser_tel orderPurchaserMobile,
		       om.order_purchaser_addr orderPurchaserAddr,
		       om.order_purchaser_type orderPurchaserType,
		       om.consignee_name consigneeName,
		       om.consignee_mobile consigneeMobile,
		       om.consignee_tel consigneeTel,
		       om.consignee_addr consigneeAddr,
		       om.pay_method payMethod,
		       om.fare fare,
		       om.delivery_date_type deliveryDateType,
		       om.commodity_sum commoditySum,
		       om.discount_amount discountAmount,
		       om.account_balance accountBalance,
		       om.amount_payable amountPayable,
		       om.pay_date payDate,
		       om.create_date createDate,
		       om.agency_number agencyNumber,
		       om.settlement_no settlementNo,
		       om.stock_out_id stockOutId,
		       om.distribution_id distributionId,
		       om.logistics_order_no logisticsOrderNo,
		       om.order_source orderSource,
		       om.invoice_id invoiceId,
		       om.parent_order_code parentOrderCode,
		       om.son_order_code sonOrderCode,
		       om.order_description orderDescription,
		       om.order_status orderStatus,
		       om.order_code orderCode,
		       om.customer_id customerId,
		       om.order_channel orderChannel,
		       om.disabled disabled,
		       om.confirm_delivery confirmDelivery,
		       om.logistics_code logisticsCode,
		       om.address_id addressId,
		       om.email email,
		       om.weight weight,
		       om.assess_status assessStatus,
		       om.finish_date finishDate,
		       om.invoice_info_type invoiceInfoType,
		       om.invoice_info_title invoiceInfoTitle,
		       om.invoice_info_content invoiceInfoContent,
		       om.total_credit totalCredit,
		       om.logistics_name logisticsName,
		       om.original_order_sum originalOrderSum,
		       om.province province,
		       om.city city,
		       om.area area,
		       om.zipcode zipcode,
		       om.order_type orderType,
		       om.order_operation_remark orderOperationRemark,
		       om.commerce_id commerceId,
		       om.prize_numbers prizeNumbers,
		       om.prescription_attachment prescriptionAttachment,
		       om.check_flag checkFlag,
		       om.medic_flag medicFlag,
		       decode(om.invoice_info_type, null, 'N', 'Y') hasInvoice,
		       (select nvl(sum(ops.order_money), 0)
		          from order_pay_statement ops
		         where ops.payment_way <> 2
		           and ops.state = 1
		           and ops.order_code = om.order_code) invoiceMoney
		  from order_main om
		 where om.order_code in 
	]]>
		<iterate open="(" close=")" conjunction=","> #[]# </iterate>		 
		 order by om.pay_date
  	</select>
  	
  	<!-- 查询用户信息 -->
  	<select id="SQL_QUERY_USER_INFO" parameterClass="java.lang.Long" resultClass="com.pltfm.app.dataobject.UserInfoDO">
		select ai.n_login_id    loginId,
		       ai.mobile        mobile,
		       ai.email         email,
		       ai.account_login loginAccount
		  from   account_info ai
		 where ai.n_login_id = #uid:DECIMAL#
  	</select> 
  	
  	
  		<!-- 查询父订单-->
  	<select id="getParentCode" parameterClass="java.util.Map" resultClass="com.pltfm.app.entities.OrderMain">
		select om.parent_order_code  parentOrderCode,
               oitm.commodity_sku  commoditySku  
             from order_main om , 
                 order_item  oitm 
  where om.Order_Code=oitm.order_code
        and  oitm.order_code=#orderCode#
  </select>
  	
  	<!--获取商家信息-->
  	<select id="SQL_QUERY_COMMERCE_INFO" parameterClass="java.lang.Long" resultClass="java.util.HashMap">
		select sm.linkman_mobile phone,
		       sm.contact_info   mobile,
		       sm.service_qq     serviceNum,
		       sm.service_type   serviceType
		  from  shop_main sm
		 where sm.supplier_id = #commerceId:DECIMAL#
  	</select>
  	
  	<!-- 修改父订单的完成时间 -->
  	<update id="SQL_UPDATE_PARENT_FINISH_DATE" parameterClass="com.pltfm.app.entities.OrderMain" >
  		update order_main om
		   set om.finish_date = sysdate
		 where 0 = (select count(1) - nvl(sum(decode(omi.order_status, 6, 1)), 0)
		              from order_main omi
		             where omi.parent_order_code = #orderCode:VARCHAR#)
		   and om.order_code = #orderCode:VARCHAR#
  	</update>
<!-- 查询供应商所有订单列表信息(提供供应商导出用)-->
  		<!-- ibatorgenerated_BaseResultMap qrySellerExportOrder-->
  	 <select id="SQL_QUERY_ORDER_MAIN_EXPORT_INFO"  parameterClass="java.util.Map" resultMap="qrySellerExportOrder">
		with pp as
     (select p.order_code,
             p.order_item_id,
             m.promotion_name,
             decode(m.promotion_type,
                    8,'打折' || m.promotion_data || '折',
                    10, '特价',
                    6,'满减',
                    5,'加价购',
                    4,'送券',
                    3,'满赠') as promotion_type
        from order_preferential p,  promotion m
       where p.ORDER_PREFERENTIAL_CODE = m.promotion_id),
        oo as
         (select distinct p1.order_code, m1.promotion_name
            from order_preferential p1,  promotion m1
           where p1.ORDER_PREFERENTIAL_CODE = m1.promotion_id
             and p1.order_item_id is null)
      select
      		 order_main.ORDER_ID,
      		 order_main.ORDER_CODE,
             order_item.COMMODITY_TITLE,
             order_item.COMMODITY_SKU,
             order_item.COMMODITY_SKU_DESCRIPTION,
             order_item.COMMODITY_UNIT_PRICE,
             order_item.COMMODITY_NUMBER,
             order_main.CUSTOMER_ACCOUNT,
             order_main.CONSIGNEE_NAME,
             nvl(order_main.CONSIGNEE_MOBILE, order_main.CONSIGNEE_TEL) as CONSIGNEE_MOBILE,
             order_main.CONSIGNEE_ADDR,
             order_main.CREATE_DATE,
             order_main.FINISH_DATE,
             order_main.ORDER_STATUS,
             order_main.LOGISTICS_NAME,
             order_main.LOGISTICS_ORDER_NO,
             order_item.COMMISSION_RATE,
             order_item.COMMODITY_UNIT_INCOMING * order_item.COMMODITY_NUMBER * order_item.COMMISSION_RATE as COMMISSION, 
             pp.promotion_type, 
             (select listagg(oo.promotion_name, '，') within group(order by promotion_name)
                from oo
               where oo.order_code = order_main.order_code) as PROMOTION_NAME,
             order_main.FARE, 
             order_main.AMOUNT_PAYABLE,
             order_main.ORDER_PV,
            (1 - nvl(order_item.COMMISSION_RATE,0)) *order_item.COMMODITY_UNIT_INCOMING * order_item.COMMODITY_NUMBER - order_item.COMMODITY_PV*order_item.COMMODITY_NUMBER  as COMMODITY_PAYMENT,
            (select ps.seller_sku_code from  product_sku ps where ps.product_sku_code = order_item.commodity_sku) SELLER_SKU_CODE,
            order_main.Order_Description, 
            order_main.Order_Operation_Remark    
        from order_main, order_item, pp
       where order_main.order_code = order_item.order_code(+)
         and order_item.order_item_id = pp.order_item_id(+)
         <!-- 订单编号 -->
         <isNotEmpty prepend="AND" property="orderCode">
         	 order_main.ORDER_CODE like '%'||#orderCode#||'%'
         </isNotEmpty>
         <!-- 买家账号 -->
         <isNotEmpty prepend="AND" property="customerAccount">
         	 order_main.CUSTOMER_ACCOUNT like '%'||#customerAccount#||'%'
         </isNotEmpty>
         <!-- 收货人姓名 -->
          <isNotEmpty prepend="AND" property="consigneeName">
         	 order_main.CONSIGNEE_NAME like '%'||#consigneeName#||'%'
         </isNotEmpty>
         <!-- 收货人电话 -->
		<isNotEmpty prepend="AND (" property="consigneeMobile">
         	 order_main.CONSIGNEE_MOBILE like '%'||#consigneeMobile#||'%'
        </isNotEmpty>
        
        <isNotEmpty prepend=" OR " property="consigneeMobile">
         	  <![CDATA[
           order_main.CONSIGNEE_TEL like '%'||#consigneeMobile#||'%' )
        	]]>
        </isNotEmpty>        
         <!-- 下单时间 -->
         <isNotEmpty prepend="AND" property="orderBeginDate">
	     	<![CDATA[
	                 order_main.CREATE_DATE >= to_date(#orderBeginDate#,'yyyy-MM-dd HH24:mi:ss')       
	      		]]>
     	 </isNotEmpty>
     	 <isNotEmpty prepend="AND" property="orderEndDate">
	     	<![CDATA[
	                  order_main.CREATE_DATE <=  to_date(#orderEndDate#,'yyyy-MM-dd HH24:mi:ss')
	      		]]>
     	 </isNotEmpty>
         <!-- 完成时间 -->
          <isNotEmpty prepend="AND" property="finishBeginDate">
	     	<![CDATA[
	                 order_main.FINISH_DATE >= to_date(#finishBeginDate#,'yyyy-MM-dd HH24:mi:ss')    
	      		]]>
     	 </isNotEmpty>
     	  <isNotEmpty prepend="AND" property="finishEndDate">
	     	<![CDATA[
	                 order_main.FINISH_DATE <= to_date(#finishEndDate#,'yyyy-MM-dd HH24:mi:ss')       
	      		]]>
     	 </isNotEmpty>
         <!-- 订单状态 -->
          <isNotEmpty prepend="AND" property="orderStatus">
         	 order_main.ORDER_STATUS = #orderStatus#
          </isNotEmpty>
            <!-- 订单状态 -->
          <isNotEmpty prepend="AND" property="commerceId">
         	 order_main.COMMERCE_ID = #commerceId#
          </isNotEmpty>
    	
    	 <isNotEmpty property="assess">
          <isEqual prepend="AND"  property="assess" compareValue="true">
		  	 order_main.ASSESS_STATUS in (2,3)
		  </isEqual>
          </isNotEmpty>
		order by order_main.create_date desc
  	</select>
  	
  	<!-- 批量更新订单状态 -->
  	<update id="SQL_BATCH_UPDATE_ORDER_STATUS" parameterClass="java.util.Map">
  		update order_main om
		   set  
		<isNotEmpty property="payDate">
		   om.pay_date = to_date(#payDate#,'yyyy-MM-dd HH24:mi:ss'),
		</isNotEmpty>
		<isNotEmpty property="finishDate">		   
		    om.finish_date = to_date(#finishDate#,'yyyy-MM-dd HH24:mi:ss'),
		</isNotEmpty>    
		<isNotEmpty property="settlementNo">		   
		    om.settlement_no=#settlementNo:DECIMAL#,
		</isNotEmpty>    
		    om.order_status = #orderStatus:DECIMAL#
		 where om.order_code in 
		<iterate property="orderCodes" open="(" close=")" conjunction=","> #orderCodes[]# </iterate>		 
  	</update>
  	
  	
  	
  	  <sql id="MAP_WHERE_CLAUSE_OUT">
		from order_main om , (select osei.order_code
           from  ORDER_OUT_SIDE_EXT_INFO osei
          WHERE osei.source= #source# )order_out
          where 
          
          order_out.order_code=om.order_code
          
		<!--and om.parent_order_code is null
		 订单状态  -->
		  <isNotEmpty prepend="AND" property="status">
			om.order_status = #status#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="nstatus">
		<![CDATA[ om.order_status not in ]]>
		    <iterate open="(" close=")" conjunction="," property="nstatus">  
					<![CDATA[#nstatus[]#]]>
			</iterate>  
		</isNotEmpty>
		<isNotEmpty property="commodityName">
			and exists (select 1 from order_item oi where om.order_code = oi.order_code
				and instr(oi.commodity_name, trim(#commodityName#))>0
			<isNotEmpty property="commodityCode">
			 	and oi.commodity_code = #commodityCode#
			</isNotEmpty>
			 )
		</isNotEmpty>
		<isEmpty property="commodityName">
			<isNotEmpty property="commodityCode">
			and exists (select 1 from order_item oi where om.order_code = oi.order_code
				and oi.commodity_code = #commodityCode# )
			</isNotEmpty>
		</isEmpty>
		<!-- 下单账号 -->
		<isNotEmpty prepend="and" property="customerAccount">
			instr(om.customer_account, trim(#customerAccount#))>0
		</isNotEmpty>
		<!-- 收货人 -->
		<isNotEmpty prepend="and" property="consigneeName">
			instr(om.consignee_name, trim(#consigneeName#))>0
		</isNotEmpty>
		<!-- 收货人电话 -->
		<isNotEmpty prepend="and" property="consigneeMobile">
			instr(om.consignee_mobile,trim(#consigneeMobile#))>0
		</isNotEmpty>
		<!-- 下单类型 -->
		<!-- <isNotEmpty prepend="and" property="orderPurchaserType">
			<isEqual property="orderPurchaserType" compareValue="4">
            exists (select 1
          from   era_info ei
         where ei.n_login_id = om.customer_id)
            </isEqual>
		 <isNotEqual property="orderPurchaserType" compareValue="4">
			om.order_purchaser_type = #orderPurchaserType#
		 </isNotEqual>
		</isNotEmpty> -->
		<isNotEmpty prepend="and" property="orderPurchaserType">
			om.order_purchaser_type = #orderPurchaserType#
		</isNotEmpty>
		<!-- 客服账户 -->
		<isNotEmpty prepend="and" property="agencyNumber">
			instr(om.agency_number,trim(#agencyNumber#))>0
		</isNotEmpty>
		<!-- 出库单号 -->
		<isNotEmpty prepend="and" property="stockOutID">
			instr(om.stock_out_id,trim(#stockOutID#))>0
		</isNotEmpty>
		<!-- 结转单号 -->
		<isNotEmpty prepend="and" property="settlementNo">
			instr(om.settlement_no,trim(#settlementNo#))>0
		</isNotEmpty>
		<!-- 配送单号 -->
		<isNotEmpty prepend="and" property="distributionId">
			instr(om.distribution_id,trim(#distributionId#))>0
		</isNotEmpty>
		<!-- 可见性 -->
		<isNotEmpty prepend="and" property="disabled">
			om.disabled = #disabled#
		</isNotEmpty>
		<!-- 是否已评价 -->
		<isEqual prepend="and" property="assess" compareValue="true">
			om.assess_status IN (2,3)
		</isEqual>
		<!-- 订单来源 -->
		<isNotEmpty prepend="AND" property="orderSource">
			OM.ORDER_SOURCE = #orderSource#
		</isNotEmpty>
		<!-- 处理标记 -->
		<isNotEmpty  prepend="and" property="handle">
			<isEqual property="handle" compareValue="2">
				exists (select 1 from order_handle oh where om.order_code = oh.order_code and (
					oh.handle_state = #handle#
			</isEqual>
			<isEqual property="handle" compareValue="1">
				not exists (select 1 from order_handle oh where om.order_code = oh.order_code and (
					oh.handle_state = 2
			</isEqual>
			) )
		</isNotEmpty>
		<!-- 支付时间  -->
		<isNotEmpty prepend="and" property="payDateStart">
		<![CDATA[
			trunc(om.pay_date,'mi')>=to_date(#payDateStart#,'yyyy-MM-dd HH24:mi:ss')
			and trunc(om.pay_date,'mi')<=to_date(#payDateEnd#,'yyyy-MM-dd HH24:mi:ss')
		]]>
		</isNotEmpty>
		<isEmpty property="payDateStart">
		<!-- 支付时间范围 -->
		<isNotEmpty prepend="and" property="payDateRange">
			<isEqual property="payDateRange" compareValue="today">
				to_char(om.pay_date, 'yyyyMMdd') = to_char(sysdate, 'yyyyMMdd')
			</isEqual>
			<isEqual property="payDateRange" compareValue="ysday">
				to_char(om.pay_date, 'yyyyMMdd') = to_char(sysdate-1, 'yyyyMMdd')
			</isEqual>
			<isEqual property="payDateRange" compareValue="tsweek">
				om.pay_date between trunc(sysdate,'IW') AND trunc(sysdate,'IW') + 6
			</isEqual>
			<isEqual property="payDateRange" compareValue="lsweek">
				om.pay_date between trunc(SYSDATE-7,'IW') AND trunc(sysdate-7,'IW') + 6 
			</isEqual>
			<isEqual property="payDateRange" compareValue="tsmonth">
				to_char(om.pay_date, 'yyyyMM') = to_char(sysdate, 'yyyyMM')
			</isEqual>
			<isEqual property="payDateRange" compareValue="lsmonth">
				to_char(add_months(om.pay_date,1), 'yyyyMM') = to_char(sysdate, 'yyyyMM')
			</isEqual>
		</isNotEmpty>
		</isEmpty>
		<!-- 下单时间  -->
		<isNotEmpty prepend="AND" property="createDateStart">
		<![CDATA[
			trunc(om.create_date,'mi')>=to_date(#createDateStart#,'yyyy-MM-dd HH24:mi:ss')
			and trunc(om.create_date,'mi')<=to_date(#createDateEnd#,'yyyy-MM-dd HH24:mi:ss')
		]]>
		</isNotEmpty>
		<isEmpty property="createDateStart">
		<!-- 下单时间范围 -->
			<isNotEmpty prepend="AND" property="createDateRange">
				<isEqual property="createDateRange" compareValue="today">
					to_char(om.create_date, 'yyyyMMdd') = TO_CHAR(SYSDATE, 'yyyyMMdd')
				</isEqual>
				<isEqual property="createDateRange" compareValue="ysday">
					TO_CHAR(OM.CREATE_DATE, 'yyyyMMdd') = TO_CHAR(SYSDATE-1, 'yyyyMMdd')
				</isEqual>
				<isEqual property="createDateRange" compareValue="tsweek">
					OM.CREATE_DATE BETWEEN TRUNC(SYSDATE,'IW') AND TRUNC(SYSDATE,'IW') + 6
				</isEqual>
				<isEqual property="createDateRange" compareValue="lsweek">
					OM.CREATE_DATE BETWEEN TRUNC(SYSDATE-7,'IW') AND TRUNC(SYSDATE-7,'IW') + 6 
				</isEqual>
				<isEqual property="createDateRange" compareValue="tsmonth">
					TO_CHAR(OM.CREATE_DATE, 'yyyyMM') = TO_CHAR(SYSDATE, 'yyyyMM')
				</isEqual>
				<isEqual property="createDateRange" compareValue="lsmonth">
					TO_CHAR(ADD_MONTHS(OM.CREATE_DATE,1), 'yyyyMM') = TO_CHAR(SYSDATE, 'yyyyMM')
				</isEqual>
			</isNotEmpty>
		</isEmpty>
		<!-- 渠道  -->
		<!-- <isNotEmpty prepend="AND" property="channel">
			OM.ORDER_CHANNEL=#channel# 
		</isNotEmpty> -->
		<!-- 供应商 -->
		<isNotEmpty property="commerceId" prepend="AND">
		 <isEqual property="commerceId" compareValue="1">
		 om.commerce_id is null
		 </isEqual>
		 <isEqual property="commerceId" compareValue="2">
		 om.commerce_id is not null
		 </isEqual>	 
		</isNotEmpty>
		<!-- 所属商家 -->
		<isNotEmpty property="commerceName" prepend="AND">
			om.commerce_Name=#commerceName#
		</isNotEmpty>
		
		<!-- <isEmpty property="commerceId">
			and exists (select 1 from user_channel uc where om.order_channel=uc.channel_name and uc.user_id=#sysuser.userId#)
		</isEmpty> -->
		<!-- 订单号 -->
		<isNotEmpty prepend="AND " property="orderCode">
          instr(om.order_code ,trim(#orderCode#))>0
		</isNotEmpty>
  </sql>
  	
  	
  	
  	
  	
  	
  	  <select id="countOutFuzzyOrderActualByMap" parameterClass="java.util.Map" resultClass="java.math.BigDecimal" >
   select sum(nvl(op.order_money, 0))
  		from (
  			select distinct om.order_code order_code
  			from order_main om where 
    om.parent_order_code is null
   start with om.order_code in (
   select distinct om.order_code order_code
  	<include refid="MAP_WHERE_CLAUSE_OUT"/>
  	 ) 
  connect by prior om.parent_order_code = om.order_code
 		 ) oc inner join order_pay_statement op
    	on (op.order_code = oc.order_code)
		where  op.payment_way not in (- 1, 2)
		and  op.state = 1
  </select>
  
  	  
  	
  	
  	 <select id="countOutFuzzyOrderMoneyByMap" parameterClass="java.util.Map" resultClass="java.math.BigDecimal" >
    select sum(nvl(omo.amount_payable, 0))
  		from (
  			select distinct om.order_code order_code
  			from order_main om where 
    om.parent_order_code is null
   start with om.order_code in (
   select distinct om.order_code order_code
  	<include refid="MAP_WHERE_CLAUSE_OUT"/>
  			) 
  connect by prior om.parent_order_code = om.order_code
 		 ) oc inner join order_main omo
    	on (omo.order_code = oc.order_code)
  </select>
  
  	<select id="countOutFuzzyOrderRebateMoneyByMap" parameterClass="java.util.Map" resultClass="java.math.BigDecimal" >
    select sum(nvl(omo.ORDER_COMMISSION, 0))
  		from (
  			select distinct om.order_code order_code
  			from order_main om where 
    om.parent_order_code is null
   start with om.order_code in (
   select distinct om.order_code order_code
  	<include refid="MAP_WHERE_CLAUSE_OUT"/>
  			) 
  connect by prior om.parent_order_code = om.order_code
 		 ) oc inner join order_main_ext omo
    	on (omo.order_code = oc.order_code)
  </select>
  	
	
 <sql id="Map_Where_Clause_Out_FuzzyOrder">
		from order_main om , order_main_ext ext where 
		exists
		 (select 1
           from  ORDER_OUT_SIDE_EXT_INFO osei
          WHERE osei.source= #source# and  osei.order_code=om.order_code ) 
          and  ext.order_code=om.order_code
		
		<!-- 订单类型 -->
		<isNotEmpty prepend="AND" property="commerceType">
			<isEqual property="commerceType" compareValue="owner">
				OM.commerce_id is null
			</isEqual>
			<isEqual property="commerceType" compareValue="other">
				OM.commerce_id is not null
			</isEqual>
		</isNotEmpty>
		<!-- 订单状态  -->
		<isNotEmpty prepend="AND" property="status">
			OM.ORDER_STATUS = #status#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="nstatus">
		<![CDATA[ OM.ORDER_STATUS not in ]]>
		    <iterate open="(" close=")" conjunction="," property="nstatus">  
					<![CDATA[#nstatus[]#]]>
			</iterate>  
		</isNotEmpty>
		<isNotEmpty prepend="AND"  property="commodityName">
			exists (select 1 from order_item oi where om.order_code = oi.order_code
				and instr(oi.commodity_name,trim(#commodityName#))>0
			<isNotEmpty prepend="AND"  property="commodityCode">
			 	oi.commodity_code = #commodityCode#
			</isNotEmpty>
			 )
		</isNotEmpty>
		<isEmpty property="commodityName">
			<isNotEmpty property="commodityCode">
			and exists (select 1 from order_item oi where om.order_code = oi.order_code
				and oi.commodity_code = #commodityCode# )
			</isNotEmpty>
		</isEmpty>			
		<!-- 下单账号 -->
		<isNotEmpty prepend="AND" property="customerAccount">
			INSTR(OM.CUSTOMER_ACCOUNT, TRIM(#customerAccount#))>0
		</isNotEmpty>
		<!-- 收货人 -->
		<isNotEmpty prepend="AND" property="consigneeName">
			INSTR(OM.CONSIGNEE_NAME, TRIM(#consigneeName#))>0
		</isNotEmpty>
		<!-- 收货人电话 -->
		<isNotEmpty prepend="AND" property="consigneeMobile">
			INSTR(OM.CONSIGNEE_MOBILE, TRIM(#consigneeMobile#))>0
		</isNotEmpty>
		<!-- 下单类型 -->
		<!-- <isNotEmpty prepend="AND" property="orderPurchaserType">
		<isEqual property="orderPurchaserType" compareValue="4">
            exists (select 1
          from   era_info ei
         where ei.n_login_id = om.customer_id)
            </isEqual>
		 <isNotEqual property="orderPurchaserType" compareValue="4">
			om.order_purchaser_type = #orderPurchaserType#
		 </isNotEqual>
		</isNotEmpty> -->
		<isNotEmpty prepend="AND" property="orderPurchaserType">
			om.order_purchaser_type = #orderPurchaserType#
		</isNotEmpty>
		<!-- 订单来源 -->
		<isNotEmpty prepend="AND" property="orderSource">
			OM.ORDER_SOURCE = #orderSource#
		</isNotEmpty><!-- 支付时间  -->
		<isNotEmpty prepend="AND" property="payDateStart">
		<![CDATA[
			trunc(OM.PAY_DATE,'mi')>=to_date(#payDateStart#,'yyyy-MM-dd HH24:mi:ss')
			and trunc(OM.PAY_DATE,'mi')<=to_date(#payDateEnd#,'yyyy-MM-dd HH24:mi:ss')
		]]>
		</isNotEmpty>
		<isEmpty property="payDateStart">
		<!-- 支付时间范围 -->
		<isNotEmpty prepend="AND" property="payDateRange">
			<isEqual property="payDateRange" compareValue="today">
				TO_CHAR(OM.PAY_DATE, 'yyyyMMdd') = TO_CHAR(SYSDATE, 'yyyyMMdd')
			</isEqual>
			<isEqual property="payDateRange" compareValue="ysday">
				TO_CHAR(OM.PAY_DATE, 'yyyyMMdd') = TO_CHAR(SYSDATE-1, 'yyyyMMdd')
			</isEqual>
			<isEqual property="payDateRange" compareValue="tsweek">
				OM.PAY_DATE BETWEEN TRUNC(SYSDATE,'IW') AND TRUNC(SYSDATE,'IW') + 6
			</isEqual>
			<isEqual property="payDateRange" compareValue="lsweek">
				OM.PAY_DATE BETWEEN TRUNC(SYSDATE-7,'IW') AND TRUNC(SYSDATE-7,'IW') + 6 
			</isEqual>
			<isEqual property="payDateRange" compareValue="tsmonth">
				TO_CHAR(OM.PAY_DATE, 'yyyyMM') = TO_CHAR(SYSDATE, 'yyyyMM')
			</isEqual>
			<isEqual property="payDateRange" compareValue="lsmonth">
				TO_CHAR(ADD_MONTHS(OM.PAY_DATE,1), 'yyyyMM') = TO_CHAR(SYSDATE, 'yyyyMM')
			</isEqual>
		</isNotEmpty>
		</isEmpty>
		<!-- 下单时间  -->
		<isNotEmpty prepend="AND" property="createDateStart">
		<![CDATA[
			trunc(OM.CREATE_DATE,'mi')>=to_date(#createDateStart#,'yyyy-MM-dd HH24:mi:ss')
			and trunc(OM.CREATE_DATE,'mi')<=to_date(#createDateEnd#,'yyyy-MM-dd HH24:mi:ss')
		]]>
		</isNotEmpty>
		<isEmpty property="createDateStart">
		<!-- 下单时间范围 -->
			<isNotEmpty prepend="AND" property="createDateRange">
				<isEqual property="createDateRange" compareValue="today">
					TO_CHAR(OM.CREATE_DATE, 'yyyyMMdd') = TO_CHAR(SYSDATE, 'yyyyMMdd')
				</isEqual>
				<isEqual property="createDateRange" compareValue="ysday">
					TO_CHAR(OM.CREATE_DATE, 'yyyyMMdd') = TO_CHAR(SYSDATE-1, 'yyyyMMdd')
				</isEqual>
				<isEqual property="createDateRange" compareValue="tsweek">
					OM.CREATE_DATE BETWEEN TRUNC(SYSDATE,'IW') AND TRUNC(SYSDATE,'IW') + 6
				</isEqual>
				<isEqual property="createDateRange" compareValue="lsweek">
					OM.CREATE_DATE BETWEEN TRUNC(SYSDATE-7,'IW') AND TRUNC(SYSDATE-7,'IW') + 6 
				</isEqual>
				<isEqual property="createDateRange" compareValue="tsmonth">
					TO_CHAR(OM.CREATE_DATE, 'yyyyMM') = TO_CHAR(SYSDATE, 'yyyyMM')
				</isEqual>
				<isEqual property="createDateRange" compareValue="lsmonth">
					TO_CHAR(ADD_MONTHS(OM.CREATE_DATE,1), 'yyyyMM') = TO_CHAR(SYSDATE, 'yyyyMM')
				</isEqual>
			</isNotEmpty>
		</isEmpty>
		<!-- 渠道  -->
		<!-- <isNotEmpty prepend="AND" property="channel">
			OM.ORDER_CHANNEL=#channel# 
		</isNotEmpty> -->
		<!-- 供应商 -->
		<isNotEmpty prepend="AND" property="commerceId">
		<isEqual property="commerceId" compareValue="1">
		 om.commerce_id is null
		 </isEqual>
		 <isEqual property="commerceId" compareValue="2">
		 om.commerce_id is not null
		 <!-- 所属商家名称 -->
		<isNotEmpty prepend="AND" property="commerceName">
			om.commerce_name = #commerceName# 
		</isNotEmpty>
		 </isEqual>
		</isNotEmpty>
		<!-- <isEmpty prepend="AND"  property="commerceId">
			exists (select 1 from user_channel uc where om.order_channel=uc.channel_name and uc.user_id=#sysuser.userId#)
		</isEmpty> -->
		<!-- 订单号 -->
		<isNotEmpty prepend="AND" property="orderCode">
			instr(OM.ORDER_CODE,trim(#orderCode#))>0 
		</isNotEmpty>
  </sql>	
  
  	
  	<!--  模糊查询订单计数-->
	  <select id="countOutFuzzyOrderByMap"  parameterClass="java.util.Map"  resultClass="java.lang.Integer">
  		SELECT COUNT(*) FROM (
  		SELECT DISTINCT 
			 OM.ORDER_ID
    	<include refid="Map_Where_Clause_Out_FuzzyOrder"/>)
      </select>
    
  	
  	<select id="selectOutFuzzyOrderByMap"  parameterClass="java.util.Map"  resultMap="WITHROOT_RESULTMAP_FOR_OUT_FUZZY">
	SELECT
	   TT.ORDER_ID, 
	   TT.ORDER_SOURCE,
       TT.CUSTOMER_ACCOUNT,
       TT.CUSTOMER_NAME,
       TT.CUSTOMER_MOBILE,
       TT.COMMERCE_ID,
       TT.ORDER_STATUS,
       TT.CREATE_DATE,

       TT.PAY_DATE,

       TT.Amount_Payable,
        TT.CONSIGNEE_NAME,
       TT.ORDER_COMMISSION,
       (SELECT D.ORDER_DICTIONARY_VALUE
          FROM ORDER_DICTIONARY D
         WHERE D.ORDER_DICTIONARY_TYPE = 'Order_Status'
           AND D.ORDER_DICTIONARY_KEY = TT.ORDER_STATUS) orderStatusStr,
       (SELECT D.ORDER_DICTIONARY_VALUE
          FROM ORDER_DICTIONARY D
         WHERE D.ORDER_DICTIONARY_TYPE = 'Order_Source'
           AND D.ORDER_DICTIONARY_KEY = TT.ORDER_SOURCE) orderSourceStr,
       TT.ORDER_CODE
  FROM (SELECT T.ORDER_ID,
  			   T.ORDER_CODE,
               T.ORDER_SOURCE,
               T.CUSTOMER_ACCOUNT,
               T.CUSTOMER_NAME,
               T.CUSTOMER_MOBILE,
               T.COMMERCE_ID,
               T.ORDER_STATUS,
               T.CREATE_DATE,
  
               T.PAY_DATE,
       
               T.Amount_Payable,
                T.CONSIGNEE_NAME,
           T.PARENT_ORDER_CODE,
               T.ORDER_COMMISSION,
               ROWNUM rn
          FROM (SELECT OM.ORDER_ID,
          			   OM.ORDER_CODE,
                       OM.ORDER_SOURCE,
                       OM.CUSTOMER_ACCOUNT,
                       OM.CUSTOMER_NAME,
                       OM.CUSTOMER_MOBILE,
                       OM.COMMERCE_ID,
                       OM.ORDER_STATUS,
                       OM.CREATE_DATE,
                    
                       OM.PAY_DATE,
                       OM.Amount_Payable,
                   
                       OM.CONSIGNEE_NAME,
                       OM.PARENT_ORDER_CODE,
                       EXT.ORDER_COMMISSION
  		<include refid="Map_Where_Clause_Out_FuzzyOrder"/>
  		<isNotEmpty property="fkChange">
  		ORDER BY OM.CREATE_DATE
  		</isNotEmpty>
  		<isEmpty property="fkChange">
  		ORDER BY OM.CREATE_DATE DESC
  		</isEmpty>  ) T
        WHERE ROWNUM  &lt;= #end#) TT
		WHERE TT.rn  &gt;= #start#
  </select>
  	
  <!-- 更具订单编号集合查询订单列表 -->
  	<select id="queryOrdersByCodes" parameterClass="java.util.Map" resultMap="ibatorgenerated_ExtendsBaseResultMap">
    select T.ORDER_ID, T.CUSTOMER_ACCOUNT, T.CUSTOMER_NAME, T.CUSTOMER_MOBILE, T.ORDER_PURCHASER_NAME,
      T.ORDER_PURCHASER_MOBILE, T.ORDER_PURCHASER_TEL, T.ORDER_PURCHASER_ADDR, T.ORDER_PURCHASER_TYPE,
      T.CONSIGNEE_NAME, T.CONSIGNEE_MOBILE, T.CONSIGNEE_TEL, T.CONSIGNEE_ADDR, T.PAY_METHOD, T.FARE,nvl(T.ORDER_DISCOUNT,0) ORDER_DISCOUNT,
      T.DELIVERY_DATE_TYPE, T.COMMODITY_SUM, T.DISCOUNT_AMOUNT, T.ACCOUNT_BALANCE, T.AMOUNT_PAYABLE, T.PAY_DATE,
      T.CREATE_DATE, T.AGENCY_NUMBER, T.SETTLEMENT_NO, T.STOCK_OUT_ID, T.DISTRIBUTION_ID, T.LOGISTICS_ORDER_NO,
      T.ORDER_SOURCE, T.INVOICE_ID, T.PARENT_ORDER_CODE, T.SON_ORDER_CODE, T.ORDER_DESCRIPTION,T.ORDER_STATUS, T.ORDER_CODE,
      T.CUSTOMER_ID,T.ORDER_CHANNEL,T.DISABLED,T.CONFIRM_DELIVERY,T.LOGISTICS_CODE,T.ADDRESS_ID,T.EMAIL, T.WEIGHT, T.ASSESS_STATUS, T.FINISH_DATE,
      T.INVOICE_INFO_TYPE,T.INVOICE_INFO_TITLE,T.INVOICE_INFO_CONTENT,T.TOTAL_CREDIT,T.LOGISTICS_NAME,T.ORIGINAL_ORDER_SUM, T.PROVINCE, T.CITY, T.AREA,
      T.ZIPCODE,T.ORDER_TYPE,T.ORDER_OPERATION_REMARK,COMMERCE_ID,PRIZE_NUMBERS,PRESCRIPTION_ATTACHMENT,
      CHECK_FLAG,MEDIC_FLAG
      ,(SELECT D.ORDER_DICTIONARY_VALUE FROM ORDER_DICTIONARY D WHERE D.ORDER_DICTIONARY_TYPE = 'Pay_Method' AND D.ORDER_DICTIONARY_KEY = T.PAY_METHOD) payMethodStr
      ,(SELECT D.ORDER_DICTIONARY_VALUE FROM ORDER_DICTIONARY D WHERE D.ORDER_DICTIONARY_TYPE = 'Delivery_Date_Type' AND D.ORDER_DICTIONARY_KEY = T.DELIVERY_DATE_TYPE) deliveryDateTypeStr
      ,(SELECT D.ORDER_DICTIONARY_VALUE FROM ORDER_DICTIONARY D WHERE D.ORDER_DICTIONARY_TYPE = 'Order_Status' AND D.ORDER_DICTIONARY_KEY = T.ORDER_STATUS) orderStatusStr
      ,(SELECT HANDLE_STATE FROM ORDER_HANDLE WHERE ORDER_CODE = T.ORDER_CODE) HANDLESTATE
	  ,(SELECT HANDLE_ACCOUNT FROM ORDER_HANDLE WHERE ORDER_CODE = T.ORDER_CODE) HANDLEACCOUNT	 
	  ,T.COMMERCE_NAME,T.ESTIMATE_CONTENT estimateContent
    from  ORDER_MAIN T
    where ORDER_CODE in
    <iterate property="orderCodes" open="(" close=")" conjunction=",">
    #orderCodes[]#
    </iterate>
  </select> 
  
  <!-- 风控改变列表顺序-订单编号集合查询订单列表 -->
  	<select id="queryOrdersByCodesASCSort" parameterClass="java.util.Map" resultMap="ibatorgenerated_ExtendsBaseResultMap">
    select T.ORDER_ID, T.CUSTOMER_ACCOUNT, T.CUSTOMER_NAME, T.CUSTOMER_MOBILE, T.ORDER_PURCHASER_NAME,
      T.ORDER_PURCHASER_MOBILE, T.ORDER_PURCHASER_TEL, T.ORDER_PURCHASER_ADDR, T.ORDER_PURCHASER_TYPE,
      T.CONSIGNEE_NAME, T.CONSIGNEE_MOBILE, T.CONSIGNEE_TEL, T.CONSIGNEE_ADDR, T.PAY_METHOD, T.FARE,nvl(T.ORDER_DISCOUNT,0) ORDER_DISCOUNT,
      T.DELIVERY_DATE_TYPE, T.COMMODITY_SUM, T.DISCOUNT_AMOUNT, T.ACCOUNT_BALANCE, T.AMOUNT_PAYABLE, T.PAY_DATE,
      T.CREATE_DATE, T.AGENCY_NUMBER, T.SETTLEMENT_NO, T.STOCK_OUT_ID, T.DISTRIBUTION_ID, T.LOGISTICS_ORDER_NO,
      T.ORDER_SOURCE, T.INVOICE_ID, T.PARENT_ORDER_CODE, T.SON_ORDER_CODE, T.ORDER_DESCRIPTION,T.ORDER_STATUS, T.ORDER_CODE,
      T.CUSTOMER_ID,T.ORDER_CHANNEL,T.DISABLED,T.CONFIRM_DELIVERY,T.LOGISTICS_CODE,T.ADDRESS_ID,T.EMAIL, T.WEIGHT, T.ASSESS_STATUS, T.FINISH_DATE,
      T.INVOICE_INFO_TYPE,T.INVOICE_INFO_TITLE,T.INVOICE_INFO_CONTENT,T.TOTAL_CREDIT,T.LOGISTICS_NAME,T.ORIGINAL_ORDER_SUM, T.PROVINCE, T.CITY, T.AREA,
      T.ZIPCODE,T.ORDER_TYPE,T.ORDER_OPERATION_REMARK,COMMERCE_ID,PRIZE_NUMBERS,PRESCRIPTION_ATTACHMENT,
      CHECK_FLAG,MEDIC_FLAG
      ,(SELECT D.ORDER_DICTIONARY_VALUE FROM ORDER_DICTIONARY D WHERE D.ORDER_DICTIONARY_TYPE = 'Pay_Method' AND D.ORDER_DICTIONARY_KEY = T.PAY_METHOD) payMethodStr
      ,(SELECT D.ORDER_DICTIONARY_VALUE FROM ORDER_DICTIONARY D WHERE D.ORDER_DICTIONARY_TYPE = 'Delivery_Date_Type' AND D.ORDER_DICTIONARY_KEY = T.DELIVERY_DATE_TYPE) deliveryDateTypeStr
      ,(SELECT D.ORDER_DICTIONARY_VALUE FROM ORDER_DICTIONARY D WHERE D.ORDER_DICTIONARY_TYPE = 'Order_Status' AND D.ORDER_DICTIONARY_KEY = T.ORDER_STATUS) orderStatusStr
      ,(SELECT HANDLE_STATE FROM ORDER_HANDLE WHERE ORDER_CODE = T.ORDER_CODE) HANDLESTATE
	  ,(SELECT HANDLE_ACCOUNT FROM ORDER_HANDLE WHERE ORDER_CODE = T.ORDER_CODE) HANDLEACCOUNT	 
	  ,T.COMMERCE_NAME,T.ESTIMATE_CONTENT estimateContent
    from  ORDER_MAIN T
    where ORDER_CODE in
    <iterate property="orderCodes" open="(" close=")" conjunction=",">
    #orderCodes[]#
    </iterate>
    order by t.create_date
  </select> 
  
  <!-- 判断账户account信息是否存在 -->
  <select id="checkAccount" parameterClass="java.lang.String" resultClass="java.lang.Long">
  	select 1 from   account_info ai where ai.account_login = #account#
  </select>
  
  <select id="getAccount" parameterClass="java.lang.Long" resultClass="java.lang.String">
  	select ai.account_login from   account_info ai where ai.n_login_id  = #nloginId:DECIMAL#
  </select>
  
  <select id="getSkuIdList" parameterClass="java.util.Map" resultClass="java.lang.String">
  	 SELECT ps.product_sku_id FROM
	(SELECT DISTINCT product_sku_id,ROWNUM rn FROM  product_sku 
 	<![CDATA[WHERE ROWNUM <= #end#  ORDER BY product_sku_id ) ps
 	WHERE ps.rn >= #start# ]]>
  </select>
  
  <select id="getSkuIdTotal" resultClass="java.lang.Long">
  	SELECT COUNT(DISTINCT product_sku_id) FROM  product_sku
  </select>
  
  <select id="skuIdAndCount" parameterClass="java.util.List"  resultMap="skuIdMap" >

 select rs1.skuId||'' skuId, nvl(rs2.skuCount, rs1.skucount)||'' skuCount
		  from (SELECT ps.product_sku_id skuId,0 skuCount FROM  product_sku ps
         where ps.product_sku_id in <iterate open="(" close=")" conjunction=","> #[]# </iterate>) rs1
		  left join (select oi.skuid skuId, sum(oi.commodity_number) skuCount
		               from order_item oi
		              where oi.skuid in <iterate open="(" close=")" conjunction=","> #[]# </iterate>
		                and exists
		              (select 1
		                       from order_main om
		                      where om.order_code = oi.order_code
		                        and om.order_status > 1
		               
		               <![CDATA[and to_char(om.create_date,'yyyy-MM-dd HH24:mi:ss') <= to_char(sysdate -1,'yyyy-MM-dd')||' 23:59:59']]>
								                                    
		              ) group by oi.skuid) rs2
		    on rs2.skuId = rs1.skuId 

   </select>
  <!-- 砍价sql begin -->
  
  <!-- order_Main -->
  <insert id="copyToOrdermain" parameterClass="java.lang.String">
  	insert into   order_main(ORDER_ID,CUSTOMER_ACCOUNT,CUSTOMER_NAME,CUSTOMER_MOBILE,ORDER_PURCHASER_NAME,ORDER_PURCHASER_MOBILE,ORDER_PURCHASER_TEL,ORDER_PURCHASER_ADDR,ORDER_PURCHASER_TYPE,CONSIGNEE_NAME,
	CONSIGNEE_MOBILE,CONSIGNEE_TEL,CONSIGNEE_ADDR,PAY_METHOD,FARE,DELIVERY_DATE_TYPE,COMMODITY_SUM,DISCOUNT_AMOUNT,ACCOUNT_BALANCE,AMOUNT_PAYABLE,PAY_DATE,CREATE_DATE,AGENCY_NUMBER,SETTLEMENT_NO,STOCK_OUT_ID,DISTRIBUTION_ID,
	LOGISTICS_ORDER_NO,ORDER_SOURCE,INVOICE_ID,PARENT_ORDER_CODE,SON_ORDER_CODE,ORDER_DESCRIPTION,ORDER_STATUS,ORDER_CODE,CUSTOMER_ID,ORDER_CHANNEL,DISABLED,CONFIRM_DELIVERY,LOGISTICS_CODE,ADDRESS_ID,EMAIL,WEIGHT,ASSESS_STATUS,
	FINISH_DATE,INVOICE_INFO_TYPE,INVOICE_INFO_TITLE,INVOICE_INFO_CONTENT,TOTAL_CREDIT,LOGISTICS_NAME,ORIGINAL_ORDER_SUM,PROVINCE,CITY,AREA,ZIPCODE,ORDER_TYPE,ORDER_OPERATION_REMARK,COMMERCE_ID,PRIZE_NUMBERS,CHECK_FLAG,MEDIC_FLAG,
	PRESCRIPTION_ATTACHMENT,COMMERCE_NAME,ORDER_PV,ORDER_DISCOUNT)  
	SELECT seq_order_main.nextval order_id,
	CUSTOMER_ACCOUNT,CUSTOMER_NAME,CUSTOMER_MOBILE,ORDER_PURCHASER_NAME,ORDER_PURCHASER_MOBILE,ORDER_PURCHASER_TEL,ORDER_PURCHASER_ADDR,ORDER_PURCHASER_TYPE,CONSIGNEE_NAME,
	CONSIGNEE_MOBILE,CONSIGNEE_TEL,CONSIGNEE_ADDR,PAY_METHOD,FARE,DELIVERY_DATE_TYPE,COMMODITY_SUM,DISCOUNT_AMOUNT,ACCOUNT_BALANCE,AMOUNT_PAYABLE,PAY_DATE,CREATE_DATE,AGENCY_NUMBER,SETTLEMENT_NO,STOCK_OUT_ID,DISTRIBUTION_ID,
	LOGISTICS_ORDER_NO,ORDER_SOURCE,INVOICE_ID,PARENT_ORDER_CODE,SON_ORDER_CODE,ORDER_DESCRIPTION,22,ORDER_CODE,CUSTOMER_ID,ORDER_CHANNEL,DISABLED,CONFIRM_DELIVERY,LOGISTICS_CODE,ADDRESS_ID,EMAIL,WEIGHT,ASSESS_STATUS,
	FINISH_DATE,INVOICE_INFO_TYPE,INVOICE_INFO_TITLE,INVOICE_INFO_CONTENT,TOTAL_CREDIT,LOGISTICS_NAME,ORIGINAL_ORDER_SUM,PROVINCE,CITY,AREA,ZIPCODE,ORDER_TYPE,ORDER_OPERATION_REMARK,COMMERCE_ID,PRIZE_NUMBERS,CHECK_FLAG,MEDIC_FLAG,
	PRESCRIPTION_ATTACHMENT,COMMERCE_NAME,ORDER_PV,ORDER_DISCOUNT FROM  BARGAIN_ORDER_MAIN bom 
	where bom.order_code = #order_code#
	<selectKey resultClass="java.lang.Long">
      select count(order_code) from  order_main where order_code = #order_code#
    </selectKey>
  </insert>
  
  <!-- order_item -->
  <insert id="copyToOrderitem" parameterClass="java.lang.String">
    INSERT INTO  order_item(ORDER_ITEM_ID,ORDER_CODE,COMMODITY_NAME,COMMODITY_CODE,COMMODITY_SKU,COMMODITY_BATCH_NUMBER,COMMODITY_CALLED_PRICE,COMMODITY_UNIT_PRICE,COMMODITY_NUMBER,COMMODITY_SUM,COMMODITY_CALLED_SUM,
	COMMODITY_DESCRIPTION,WAREHOUSE_ID,CREDITS,IMAGE_URL,COMMODITY_UNIT_WEIGHT,SUIT_ID,COMMODITY_TYPE,COMMODITY_SKU_DESCRIPTION,COMMODITY_TITLE,SUPPLIER,COMMODITY_CHANNEL,COMMODITY_COST_PRICE,COMMODITY_BRAND,COMMODITY_UNIT_INCOMING,
	COMMISSION_RATE,SUPPLIER_TYPE,EXT_ATTR_TYPE,SETTLEMENT_LOAN,COST_INCOME_RATIO,ERP_PRO_CODE,ERP_SYS_CODE,COMMODITY_PV,COST_INCOME_MONEY,SKUID) 
	SELECT SEQ_ORDER_ITEM.NEXTVAL ORDER_ITEM_ID,
	ORDER_CODE,COMMODITY_NAME,COMMODITY_CODE,COMMODITY_SKU,COMMODITY_BATCH_NUMBER,COMMODITY_CALLED_PRICE,COMMODITY_UNIT_PRICE,COMMODITY_NUMBER,COMMODITY_SUM,COMMODITY_CALLED_SUM,
	COMMODITY_DESCRIPTION,WAREHOUSE_ID,CREDITS,IMAGE_URL,COMMODITY_UNIT_WEIGHT,SUIT_ID,COMMODITY_TYPE,COMMODITY_SKU_DESCRIPTION,COMMODITY_TITLE,SUPPLIER,COMMODITY_CHANNEL,COMMODITY_COST_PRICE,COMMODITY_BRAND,COMMODITY_UNIT_INCOMING,
	COMMISSION_RATE,SUPPLIER_TYPE,EXT_ATTR_TYPE,SETTLEMENT_LOAN,COST_INCOME_RATIO,ERP_PRO_CODE,ERP_SYS_CODE,COMMODITY_PV,COST_INCOME_MONEY,SKUID 
	FROM  BARGAIN_ORDER_ITEM boi 
	where boi.order_code = #order_code#
	<selectKey resultClass="java.lang.Long">
      select count(order_code) from  order_item where order_code = #order_code#
    </selectKey>
  </insert>
  
 <!-- order_pay_statement -->
 <insert id="copyToOrderpaystatment" parameterClass="java.lang.String">
 	INSERT INTO  order_pay_statement(PAY_STATEMENT_NO,PAYMENT_WAY,STATE,ACCOUNT,ORDER_CODE,ORDER_MONEY,CREATE_DATE,END_DATE,OUTSIDE_PAY_STATEMENT_NO,
	FLAG,PREFERENTIAL_NO,PREFERENTIAL_NAME,BANK_CODE,BANK_NAME,PLATFORM_CODE,PLATFORM_NAME,PREFERENTIAL_GRANT_ID)
	SELECT SEQ_ORDER_PAY_STATEMENT.NEXTVAL PAY_STATEMENT_NO,PAYMENT_WAY,STATE,ACCOUNT,ORDER_CODE,ORDER_MONEY,CREATE_DATE,END_DATE,OUTSIDE_PAY_STATEMENT_NO,
	FLAG,PREFERENTIAL_NO,PREFERENTIAL_NAME,BANK_CODE,BANK_NAME,PLATFORM_CODE,PLATFORM_NAME,PREFERENTIAL_GRANT_ID
	FROM  BARGAIN_ORDER_PAY_STATEMENT aops 
	WHERE aops.order_code = #order_code#
	<selectKey resultClass="java.lang.Long">
      select count(order_code) from  order_pay_statement where order_code = #order_code#
    </selectKey>
 </insert>
 
 <!-- order_operate_statement -->
 <insert id="copyToOrderOperate" parameterClass="java.lang.String">
	INSERT INTO  order_operate_statement(STATEMENT_ID,ORDER_CODE,NOW_ORDER_STATUS,NOW_OPERATOR,NOW_OPERATE_DATE,NOW_OPERATE_TYPE,NOW_ORDER_SUM,OPERATE_INFO)
	SELECT （select nvl(max(STATEMENT_ID),0) from  order_operate_statement ) + rownum STATEMENT_ID,ORDER_CODE,1,CUSTOMER_ACCOUNT,CREATE_DATE,1,AMOUNT_PAYABLE,'生成订单' 
	FROM  order_main WHERE order_code = #order_code#
	UNION ALL
	SELECT（select nvl(max(STATEMENT_ID),0) from  order_operate_statement ) + rownum+1 STATEMENT_ID,ORDER_CODE,6,CUSTOMER_ACCOUNT,CREATE_DATE,9,AMOUNT_PAYABLE,'订单完成' 
	FROM  order_main WHERE order_code = #order_code#  
	<selectKey resultClass="java.lang.Long">
      select count(order_code) from  order_operate_statement where order_code = #order_code#
    </selectKey>
 </insert> 
 
 <!-- order_operate_statement -->
 <insert id="copyToOrderOperate1" parameterClass="java.lang.String">
	INSERT INTO  order_operate_statement(STATEMENT_ID,ORDER_CODE,NOW_ORDER_STATUS,NOW_OPERATOR,NOW_OPERATE_DATE,NOW_OPERATE_TYPE,NOW_ORDER_SUM,OPERATE_INFO)
	SELECT SEQ_ORDER_OPERATE_STATEMENT.NEXTVAL STATEMENT_ID,ORDER_CODE,1,CUSTOMER_ACCOUNT,CREATE_DATE,1,AMOUNT_PAYABLE,'生成订单' 
	FROM  BARGAIN_ORDER_MAIN WHERE order_code = #order_code#
	<selectKey resultClass="java.lang.Long">
      select count(order_code) from  order_operate_statement where order_code = #order_code#
    </selectKey>
 </insert> 
 
  <!-- order_operate_statement -->
 <insert id="copyToOrderOperate2" parameterClass="java.lang.String">
	INSERT INTO  order_operate_statement(STATEMENT_ID,ORDER_CODE,NOW_ORDER_STATUS,NOW_OPERATOR,NOW_OPERATE_DATE,NOW_OPERATE_TYPE,NOW_ORDER_SUM,OPERATE_INFO)
	SELECT SEQ_ORDER_OPERATE_STATEMENT.NEXTVAL STATEMENT_ID,ORDER_CODE,2,CUSTOMER_ACCOUNT,sysdate,2,AMOUNT_PAYABLE,'订单支付' 
	FROM  BARGAIN_ORDER_MAIN WHERE order_code = #order_code#  
	<selectKey resultClass="java.lang.Long">
      select count(order_code) from  order_operate_statement where order_code = #order_code#
    </selectKey>
 </insert>
  
  <!--查询砍价订单虚拟表 -->
  <select id="getOrderInfoForKJ" parameterClass="java.lang.String" resultMap="ibatorgenerated_BaseResultMap">
      SELECT * FROM  BARGAIN_ORDER_MAIN where order_code = #orderCode#
  </select>
  <!-- 砍价sql end -->
  
  	<resultMap class="java.util.HashMap" id="RISK_MAP">
  		<result property="orderMoney" column="orderMoney"  jdbcType="DECIMAL" />
  		<result property="realMoney" column="realMoney"  jdbcType="DECIMAL" />
  		<result property="orderPv" column="orderPv"  jdbcType="DECIMAL" />
  		<result property="commission" column="commission"  jdbcType="DECIMAL" />
  		<result property="payDate" column="payDate" jdbcType="VARCHAR"/>
  		<result property="thdpay" column="thdpay"  jdbcType="DECIMAL" />
  		<result property="supplierType" column="supplierType"  jdbcType="DECIMAL" />
  		<result property="customerAccount" column="customerAccount"  jdbcType="VARCHAR" />
  		<result property="consigneeMobile" column="consigneeMobile"  jdbcType="VARCHAR" />
  		<result property="customerId" column="customerId"  jdbcType="DECIMAL" />
  		<result property="sameCustomerIdInfo" column="sameCustomerIdInfo"  jdbcType="VARCHAR" />
  		<result property="sameConsigneeMobileInfo" column="sameConsigneeMobileInfo"  jdbcType="VARCHAR" />
  		<result property="sameCustomerIdInfo" column="sameCustomerIdInfo"  jdbcType="VARCHAR" />
  		<result property="commerceInfo" column="commerceInfo"  jdbcType="VARCHAR" />
  	</resultMap>
  	<!-- 查询订单风控结果条件 -->
  	<select id="SQL_QUERY_ORDER_RISK_RESULT_CONDITION" parameterClass="java.util.Map" resultMap="RISK_MAP">
  	<![CDATA[
	  	select nvl(om.amount_payable,0) orderMoney,
	  		   nvl(om.order_pv,0) orderPv,
		       to_char(om.pay_date, 'yyyy-MM-dd HH24:mi:ss') payDate,
		       om.customer_account customerAccount,
		       om.customer_id customerId,
		       om.consignee_mobile consigneeMobile,
		       nvl((select sum(ops.order_money)
		             from order_pay_statement ops
		            where ops.flag = 1
		              and ops.state = 1
		              and ops.payment_way = 4
		              and ops.order_code = om.order_code),
		           0) thdpay,
		       (select 
		       		ROUND(sum(nvl(odi.commission_rate,0)*odi.commodity_unit_incoming*odi.commodity_number),2)
		       	from 
		       		order_item odi 
		       	where 
		       		odi.order_code = om.order_code) commission,
		       (select 
		       		supplier_type 
		       	from 
		       		order_item oi 
		       	where 
		       		oi.order_code = om.order_code
		       		and rownum = 1) supplierType,
		       (select sum(case when omi.pay_date >= (om.pay_date - 1) then 1 else 0 end) || ',' ||
		               to_char(max(omi.pay_date), 'yyyy-MM-dd HH24:mi:ss') || ',' ||
		               max(omi.order_code) keep(dense_rank last order by pay_date)
		          from order_main omi
		         where omi.order_status >= 2
		           and omi.order_code <> om.order_code
		           and omi.consignee_mobile = om.consignee_mobile) sameConsigneeMobileInfo,
		       (select count(1)||''
		          from order_main omi
		         where omi.order_status >= 2
		           and omi.pay_date >= (om.pay_date - 1)
		           and omi.order_code <> om.order_code
		           and omi.customer_id = om.customer_id) sameCustomerIdInfo,
		       (nvl(om.amount_payable,0) - nvl((select 
		       		ops.order_money 
		       	from 
		       		order_pay_statement ops 
		       	where 
		       		ops.payment_way = 2 and ops.order_code = om.order_code and rownum = 1),0)) realMoney,
	]]>	           
	<isNotEmpty property="commerceId">
	<![CDATA[
	       (select om.commerce_id || ',' || count(1) || ',' ||
               nvl(sum(omi.amount_payable),0)
		          from order_main omi
		         where omi.order_status >=2 and omi.pay_date >= trunc(om.pay_date - 1) and
		               omi.pay_date < = trunc(om.pay_date)
		           and omi.commerce_id = om.commerce_id) ||
		       (select ',' || count(1) || ',' || nvl(sum(omi.amount_payable),0)
		          from order_main omi
		         where omi.order_status >=2 and omi.pay_date > trunc(om.pay_date)
		           and omi.commerce_id = om.commerce_id) commerceInfo
	]]>		           
	</isNotEmpty>
	<isEmpty property="commerceId">
		'' commerceInfo
	</isEmpty> 
	  from order_main om
	 where om.order_status=20 and om.order_code = #orderCode:VARCHAR#
	</select>
	
	<!-- 超时赔付审核通过后更改订单状态 -->
	<update id="SQL_UPDATE_ORDER_MAIN_YS" parameterClass="String">
		update order_main om
		   set om.order_status = 6,om.finish_date = sysdate
		 where om.order_code = #orderCode:VARCHAR#
	</update>
	
	<!-- 待风控评估 -->
	<update id="SQL_ORDER_RISK_CHECK_UPDATE_ORDER_RISK_APPRAISE" parameterClass="String">
		update order_main om
		   set om.order_status = 21
		 where om.order_status = 20
		   and om.order_code = #orderCode:VARCHAR#
	</update>
	<!-- 风控通过 -->
	<update id="SQL_ORDER_RISK_CHECK_UPDATE_ORDER_PASS" parameterClass="java.util.Map">
		update order_main om
		   set om.order_status = 22
		<isNotEmpty property="estimateContent">		   
		   ,om.estimate_content=#estimateContent:VARCHAR#
		</isNotEmpty>		   
		 where (om.order_status = 21 or om.order_status = 20)
		   and om.order_code = #orderCode:VARCHAR#
	</update>
	<!-- 风控不通过 -->
	<update id="SQL_ORDER_RISK_CHECK_UPDATE_ORDER_UNPASS" parameterClass="java.util.Map">
		update order_main om
		   set om.order_status = -3,om.estimate_content=#estimateContent:VARCHAR#
		 where om.order_status in (21,22)
		   and om.order_code = #orderCode:VARCHAR#
	</update>
	<!--取消订单-->
	<update id="SQL_UPDATE_CANCEL_ORDER" parameterClass="String">
	<![CDATA[
		update order_main om
		   set om.order_status = -1
		 where om.order_status <> -1
		   and om.order_code = #orderCode:VARCHAR#
	]]>		   
	</update>
	
	<select id="queryOrderInfoSync2Base" parameterClass="java.util.List" resultMap="syncOrderInfoResultMap" >
       select
       	   (select  l.card_num from   login_info l where l.login_account = o.customer_account) card_num, 
           o.order_code,
           o.order_status,
           o.consignee_name,
           o.consignee_addr,
           o.consignee_tel,
           o.consignee_mobile,
           o.email,
           o.pay_method,
           o.fare,
           o.order_description,
           o.create_date,
           o.pay_date,
           o.original_order_sum,
           o.amount_payable,
           i.commodity_sku,
           i.commodity_title,
           i.COMMODITY_SKU_DESCRIPTION,
           i.commodity_number,
           i.commodity_unit_price,
           i.commodity_unit_incoming,
           i.commodity_sum
        from order_main o,order_item i where o.order_code = i.order_code and o.order_code in 
        <iterate conjunction="," open="(" close=")">
	  		#orderCodes[]#
		</iterate>
  	</select>
  	<select id="OrderPayInformForPressell" resultMap="ORDER_PAY_INFORM_FOR_PRESSELL">
  		SELECT 
		       OM.ORDER_CODE,
		       OI.ORDER_ITEM_ID,
		       OM.INFORMPAY_TEL,
		       OPS.END_DATE DEPOSIT_PAY_FINISH_TIME,   
		       PP.FINALPAY_END_TIME,
		       OI.COMMODITY_SKU PRODUCT_SKU_CODE,
		       OM.ORDER_STATUS,
		       OM.AMOUNT_PAYABLE
		  FROM  ORDER_MAIN OM
		  INNER JOIN  ORDER_ITEM OI ON OI.ORDER_CODE = OM.ORDER_CODE
		  INNER JOIN  PROMOTION_PRESELL PP ON PP.PRESELL_ID = OI.PRESELL_ID
		  INNER JOIN  ORDER_MAIN_EXT OE ON OE.ORDER_CODE = OM.ORDER_CODE AND OE.MESSAGE_SEND_FLAG=0
		  INNER JOIN  ORDER_PAY_STATEMENT OPS ON OPS.ORDER_CODE=OM.ORDER_CODE AND OPS.STATE=1 AND OPS.YSFLAGE=1
		 WHERE OM.ORDER_STATUS = 23 AND PP.FINALPAY_START_TIME &lt;= SYSDATE
  	</select>
  	<update id="updateOrderMainExtMessageSendFlag" parameterClass="com.pltfm.app.vobject.OrderPayInformForPressellVo">				   
		UPDATE  ORDER_MAIN_EXT OE SET OE.MESSAGE_SEND_FLAG=#messageSendFlag# WHERE OE.ORDER_CODE=#orderCode:VARCHAR#
	</update>
	
	<select id="CancelOrderForPressell" resultClass="java.lang.String">
  	  SELECT /*+ leading(PP)*/
      om.ORDER_CODE
      FROM  ORDER_MAIN om
      INNER JOIN  ORDER_ITEM OI ON OI.ORDER_CODE = OM.ORDER_CODE
      INNER JOIN  PROMOTION_PRESELL PP ON PP.PRESELL_ID = OI.PRESELL_ID
     WHERE om.ORDER_STATUS = 1 
     AND  om.order_type = 7
   <![CDATA[  AND  PP.DEPOSIT_END_TIME <= sysdate ]]>
     AND not exists(select 1 from  order_pay_statement ops where ops.order_code = om.order_code and ops.state = 1)
  	</select>
  	
  	<!-- 查用户的类型  -->
	<select id="QUERY_LOGIN_INFO_TYPE"  parameterClass="java.lang.String" resultClass="Long">
		SELECT N_CUSTOMER_TYPE_ID FROM   LOGIN_INFO WHERE LOGIN_ACCOUNT=#login_account:VARCHAR# and n_status=1
	</select>
	
	<!--  收退款记录数 -->
	  <select id="orderPayInfoListCount"  parameterClass="java.util.Map"  resultClass="java.lang.Integer">
  		select count(t.orderCode)
from (
  select ops.platform_code platformCode,ops.flag flag,
          om.order_code orderCode,ops.outside_pay_statement_no outsidePayStatementNo,om.customer_account customerAccount,
          ops.order_money orderMoney,to_char(ops.end_date,'yyyy-mm-dd hh24:mi:ss') operateDate 
  from order_pay_statement ops ,order_main om 
          where om.parent_order_code is null
                and ops.order_code = om.order_code
                and ops.payment_way = 4
                and ops.state = 1
                <isNotEmpty prepend="and" property="platformCode">
                 ops.platform_code = #platformCode#
                </isNotEmpty>
                 <isNotEmpty prepend="and" property="flags">
               		 ops.flag in 
                 <iterate conjunction="," open="(" close=")" property="flags">
			  		#flags[]#
				</iterate>
				</isNotEmpty>
                <isNotEmpty prepend="and" property="orderCode">
                 ops.order_code = #orderCode#
                </isNotEmpty>
                <isNotEmpty prepend="and" property="outsidePayStatementNo">
                 ops.outside_pay_statement_no = #outsidePayStatementNo#
                </isNotEmpty>
                <isNotEmpty prepend="and" property="customerAccount">
                 om.customer_account = #customerAccount#
                </isNotEmpty>
                <isEmpty property="time">
                <isNotEmpty prepend="and" property="dateStart">
                <![CDATA[
			     ops.end_date >= to_date(#dateStart#, 'yyyy-mm-dd hh24:mi:ss') and
			     ops.end_date <= to_date(#dateEnd#, 'yyyy-mm-dd hh24:mi:ss')
			     ]]>
			        </isNotEmpty>
        		</isEmpty>
        		<isNotEmpty prepend="and" property="time">
        			to_char(ops.end_date,'yyyy-mm-dd hh24:mi:ss') = #time#
        		</isNotEmpty>
        <isNotEmpty></isNotEmpty>
union all

     select 
       ( select opst.platform_code from order_pay_statement opst where opst.order_code =(
           select nvl(omt.parent_order_code,omt.order_code) from order_main omt where omt.order_code = om.order_code) 
        and opst.payment_way = 4 and opst.state = 1 and rownum = 1   
        ) platformCode,
         2 as flag,om.order_code orderCode,oaps.outside_pay_statement_no outsidePayStatementNo,om.customer_account customerAccount,
        oaps.order_money orderMoney,to_char(oaps.end_date,'yyyy-mm-dd hh24:mi:ss') operateDate
       from order_alter_pay_statement oaps 
       left join order_alter oa on(oa.order_alter_code = oaps.order_alter_code)
       left join order_main om on( om.order_code = oa.order_code)
       where oaps.state = 1
             and oaps.outside_pay_statement_no is not null
        <isNotEmpty prepend="and" property="flags">
             oaps.flag in 
          <iterate conjunction="," open="(" close=")" property="flags">
				#flags[]#
		  </iterate>
        </isNotEmpty>
       <isNotEmpty prepend="and" property="orderCode">
        oa.order_code = #orderCode#
       </isNotEmpty>
       <isNotEmpty prepend="and" property="outsidePayStatementNo">
        oaps.outside_pay_statement_no = #outsidePayStatementNo#
       </isNotEmpty>
       <isNotEmpty prepend="and" property="customerAccount">
        om.customer_account = #customerAccount#
       </isNotEmpty>
       <isEmpty property="time">
       <isNotEmpty prepend="and" property="dateStart">
        <![CDATA[
        oaps.end_date >= to_date(#dateStart#, 'yyyy-mm-dd hh24:mi:ss') and
        oaps.end_date <= to_date(#dateEnd#, 'yyyy-mm-dd hh24:mi:ss')
        ]]>
       </isNotEmpty>
       </isEmpty>
       <isNotEmpty prepend="and" property="time">
        		to_char(oaps.end_date,'yyyy-mm-dd hh24:mi:ss') = #time#
       </isNotEmpty>
 union all
      select t3.* from (
	   select to_char(bat.tras_object) platformCode,
	   3 as flag,bat.account_number orderCode,bat.other_order outsidePayStatementNo,
	   ai.account_login customerAccount, bat.amount orderMoney,
	   to_char(bat.create_date,'yyyy-mm-dd hh24:mi:ss') operateDate from bnes_acct_transaction bat 
	   left join account_info ai on(ai.n_account_id = bat.account_id)  where bat.status = 1 and bat.type = 1  )t3
	   where 1=1
	    <isNotEmpty prepend="and" property="platformCode">
                 t3.platformCode = #platformCode#
                </isNotEmpty>
				 <isNotEmpty prepend="and" property="flags">
               		 t3.flag in 
                 <iterate conjunction="," open="(" close=")" property="flags">
			  		#flags[]#
				</iterate>
				</isNotEmpty>
                <isNotEmpty prepend="and" property="orderCode">
                 t3.orderCode = #orderCode#
                </isNotEmpty>
                <isNotEmpty prepend="and" property="outsidePayStatementNo">
                 t3.outsidePayStatementNo = #outsidePayStatementNo#
                </isNotEmpty>
                <isNotEmpty prepend="and" property="customerAccount">
                 t3.customerAccount = #customerAccount#
                </isNotEmpty>
                <isEmpty property="time">
				   <isNotEmpty prepend="and" property="dateStart">
				    <![CDATA[
				    to_date(t3.operateDate, 'yyyy-mm-dd hh24:mi:ss') >= to_date(#dateStart#, 'yyyy-mm-dd hh24:mi:ss') and
			        to_date(t3.operateDate, 'yyyy-mm-dd hh24:mi:ss') <= to_date(#dateEnd#, 'yyyy-mm-dd hh24:mi:ss')
			        ]]>
			        </isNotEmpty>
		        </isEmpty>
		         <isNotEmpty prepend="and" property="time">
		        		t3.operateDate = #time#
		       </isNotEmpty>
    )t   where 1=1
     <isNotEmpty prepend="and" property="platformCode">
      t.platformCode = #platformCode#
      </isNotEmpty>
      </select>
      
   
  
      <!--  收退款记录-->
	  <select id="queryOrderPayInfoList"  parameterClass="java.util.Map"  resultMap="orderPayInfoRe">
	  select * from (
  		select t.*,ROWNUM rn
from (
  select ops.platform_code platformCode,ops.flag flag,
          om.order_code orderCode,ops.outside_pay_statement_no outsidePayStatementNo,om.customer_account customerAccount,
          ops.order_money orderMoney,to_char(ops.end_date,'yyyy-mm-dd hh24:mi:ss') operateDate 
  from order_pay_statement ops ,order_main om 
          where om.parent_order_code is null
                and ops.order_code = om.order_code
                and ops.payment_way = 4
                and ops.state = 1
                <isNotEmpty prepend="and" property="platformCode">
                 ops.platform_code = #platformCode#
                </isNotEmpty>
                <isNotEmpty prepend="and" property="flags">
                ops.flag in 
                 <iterate conjunction="," open="(" close=")" property="flags">
			  		#flags[]#
				</iterate>
                </isNotEmpty>
                <isNotEmpty prepend="and" property="orderCode">
                 ops.order_code = #orderCode#
                </isNotEmpty>
                <isNotEmpty prepend="and" property="outsidePayStatementNo">
                 ops.outside_pay_statement_no = #outsidePayStatementNo#
                </isNotEmpty>
                <isNotEmpty prepend="and" property="customerAccount">
                 om.customer_account = #customerAccount#
                </isNotEmpty >
                <isEmpty property="time">
	                <isNotEmpty prepend="and" property="dateStart">
	                 <![CDATA[
	             ops.end_date >= to_date(#dateStart#, 'yyyy-mm-dd hh24:mi:ss') and
			     ops.end_date <= to_date(#dateEnd#, 'yyyy-mm-dd hh24:mi:ss')
			     ]]>
       			 	</isNotEmpty>
       		 </isEmpty>
	        <isNotEmpty prepend="and" property="time">
	        		to_char(ops.end_date,'yyyy-mm-dd hh24:mi:ss') = #time#
	        </isNotEmpty>
union all

     select 
       ( select opst.platform_code from order_pay_statement opst where opst.order_code =(
           select nvl(omt.parent_order_code,omt.order_code) from order_main omt where omt.order_code = om.order_code) 
        and opst.payment_way = 4 and opst.state = 1 and rownum = 1   
        ) platformCode,
         2 as flag,om.order_code orderCode,oaps.outside_pay_statement_no outsidePayStatementNo,om.customer_account customerAccount,
        oaps.order_money orderMoney,to_char(oaps.end_date,'yyyy-mm-dd hh24:mi:ss') operateDate
       from order_alter_pay_statement oaps 
       left join order_alter oa on(oa.order_alter_code = oaps.order_alter_code)
       left join order_main om on( om.order_code = oa.order_code)
       where oaps.state = 1
             and oaps.outside_pay_statement_no is not null
       <!-- <isNotEmpty prepend="and" property="flag">
        oaps.flag = #flag#
       </isNotEmpty> -->
        <isNotEmpty prepend="and" property="flags">
             oaps.flag in 
          <iterate conjunction="," open="(" close=")" property="flags">
				#flags[]#
		  </iterate>
         </isNotEmpty>
       <isNotEmpty prepend="and" property="orderCode">
        oa.order_code = #orderCode#
       </isNotEmpty>
       <isNotEmpty prepend="and" property="outsidePayStatementNo">
        oaps.outside_pay_statement_no = #outsidePayStatementNo#
       </isNotEmpty>
       <isNotEmpty prepend="and" property="customerAccount">
        om.customer_account = #customerAccount#
       </isNotEmpty>
       <isEmpty property="time">
	       <isNotEmpty prepend="and" property="dateStart">
	        <![CDATA[
	        oaps.end_date >= to_date(#dateStart#, 'yyyy-mm-dd hh24:mi:ss') and
        	oaps.end_date <= to_date(#dateEnd#, 'yyyy-mm-dd hh24:mi:ss')
        	]]>
	       </isNotEmpty>
       </isEmpty>
       <isNotEmpty prepend="and" property="time">
	       to_char(oaps.end_date,'yyyy-mm-dd hh24:mi:ss') = #time#
	   </isNotEmpty>
union all
	   select t3.* from (
	   select to_char(bat.tras_object) platformCode,
	   3 as flag,bat.account_number orderCode,bat.other_order outsidePayStatementNo,
	   ai.account_login customerAccount, bat.amount orderMoney,
	   to_char(bat.create_date,'yyyy-mm-dd hh24:mi:ss') operateDate from bnes_acct_transaction bat 
	   left join account_info ai on(ai.n_account_id = bat.account_id)  where bat.status = 1 and bat.type = 1  )t3
	   where 1=1
	    <isNotEmpty prepend="and" property="platformCode">
                 t3.platformCode = #platformCode#
                </isNotEmpty>
				 <isNotEmpty prepend="and" property="flags">
               		 t3.flag in 
                 <iterate conjunction="," open="(" close=")" property="flags">
			  		#flags[]#
				</iterate>
				</isNotEmpty>
                <isNotEmpty prepend="and" property="orderCode">
                 t3.orderCode = #orderCode#
                </isNotEmpty>
                <isNotEmpty prepend="and" property="outsidePayStatementNo">
                 t3.outsidePayStatementNo = #outsidePayStatementNo#
                </isNotEmpty>
                <isNotEmpty prepend="and" property="customerAccount">
                 t3.customerAccount = #customerAccount#
                </isNotEmpty>
                <isEmpty property="time">
				   <isNotEmpty prepend="and" property="dateStart">
				    <![CDATA[
					to_date(t3.operateDate, 'yyyy-mm-dd hh24:mi:ss') >= to_date(#dateStart#, 'yyyy-mm-dd hh24:mi:ss') and
			        to_date(t3.operateDate, 'yyyy-mm-dd hh24:mi:ss') <= to_date(#dateEnd#, 'yyyy-mm-dd hh24:mi:ss')
			        ]]>
			        </isNotEmpty>
		        </isEmpty>
		        <isNotEmpty prepend="and" property="time">
			       t3.operateDate = #time#
			   </isNotEmpty>
    )t   where ROWNUM &lt;= #end#
     <isNotEmpty prepend="and" property="platformCode">
      t.platformCode = #platformCode#
      </isNotEmpty>
      )tt where TT.rn  &gt;= #start#
      order by to_date(tt.operateDate, 'yyyy-mm-dd hh24:mi:ss') desc
      </select>
      
      
       <!--  收退款导出记录 -->
	  <select id="queryOrderPayInfoForExport"  parameterClass="java.util.Map"  resultClass="java.util.HashMap">
	  
  	select t.*
	from (
 		  select ops.platform_name platformName,ops.platform_code platformCode,decode(ops.flag,3,'余额充值','订单交易') payType,
          om.order_code orderCode,ops.outside_pay_statement_no outsidePayStatementNo,om.customer_account customerAccount,
          decode(ops.flag,2,'退款','收款') flag,
          ops.order_money orderMoney,to_char(ops.end_date,'yyyy-mm-dd hh24:mi:ss') operateDate  
  		 from order_pay_statement ops ,order_main om 
          where om.parent_order_code is null
                and ops.order_code = om.order_code
                and ops.payment_way = 4
                and ops.state = 1
                <isNotEmpty prepend="and" property="platformCode">
                 ops.platform_code = #platformCode#
                </isNotEmpty>
                <isNotEmpty prepend="and" property="flags">
                ops.flag in 
                 <iterate conjunction="," open="(" close=")" property="flags">
			  		#flags[]#
				</iterate>
                </isNotEmpty>
                <isNotEmpty prepend="and" property="orderCode">
                 ops.order_code = #orderCode#
                </isNotEmpty>
                <isNotEmpty prepend="and" property="outsidePayStatementNo">
                 ops.outside_pay_statement_no = #outsidePayStatementNo#
                </isNotEmpty>
                <isNotEmpty prepend="and" property="customerAccount">
                 om.customer_account = #customerAccount#
                </isNotEmpty>
                <isEmpty property="time">
	                <isNotEmpty prepend="and" property="dateStart">
	                <![CDATA[
			       	ops.end_date >= to_date(#dateStart#, 'yyyy-mm-dd hh24:mi:ss') and
			       	ops.end_date <= to_date(#dateEnd#, 'yyyy-mm-dd hh24:mi:ss')
			       	 ]]>
			        </isNotEmpty>
		        </isEmpty>
		         <isNotEmpty prepend="and" property="time">
			       to_char(ops.end_date,'yyyy-mm-dd hh24:mi:ss') = #time#
			   </isNotEmpty>
union all

      select 
       ( select opst.platform_name from order_pay_statement opst where opst.order_code =(
           select nvl(omt.parent_order_code,omt.order_code) from order_main omt where omt.order_code = om.order_code) 
        and opst.payment_way = 4 and opst.state = 1 and rownum = 1   
        ) platformName,
        ( select opst.platform_code from order_pay_statement opst where opst.order_code =(
           select nvl(omt.parent_order_code,omt.order_code) from order_main omt where omt.order_code = om.order_code) 
        and opst.payment_way = 4 and opst.state = 1 and rownum = 1   
        ) platformCode,
         '订单交易' as payType,om.order_code orderCode,oaps.outside_pay_statement_no outsidePayStatementNo,om.customer_account customerAccount,
         '退款' as flag,
        oaps.order_money orderMoney,to_char(oaps.end_date,'yyyy-mm-dd hh24:mi:ss') operateDate
       from order_alter_pay_statement oaps 
       left join order_alter oa on(oa.order_alter_code = oaps.order_alter_code)
       left join order_main om on( om.order_code = oa.order_code)
       where oaps.state = 1
             and oaps.outside_pay_statement_no is not null
        <isNotEmpty prepend="and" property="flags">
             oaps.flag in 
          <iterate conjunction="," open="(" close=")" property="flags">
				#flags[]#
		  </iterate>
         </isNotEmpty>
       <isNotEmpty prepend="and" property="orderCode">
        oa.order_code = #orderCode#
       </isNotEmpty>
       <isNotEmpty prepend="and" property="outsidePayStatementNo">
        oaps.outside_pay_statement_no = #outsidePayStatementNo#
       </isNotEmpty>
       <isNotEmpty prepend="and" property="customerAccount">
        om.customer_account = #customerAccount#
       </isNotEmpty>
       <isEmpty property="time">
	       <isNotEmpty prepend="and" property="dateStart">
	       <![CDATA[
	        oaps.end_date >= to_date(#dateStart#, 'yyyy-mm-dd hh24:mi:ss') and
	        oaps.end_date <= to_date(#dateEnd#, 'yyyy-mm-dd hh24:mi:ss')
	        ]]>
	       </isNotEmpty>
       </isEmpty>
        <isNotEmpty prepend="and" property="time">
			 to_char(oaps.end_date,'yyyy-mm-dd hh24:mi:ss') = #time#
		</isNotEmpty>
			   
     union all  
            select t3.* from (
	    select '支付宝' platformName,'3' platformCode,
      '订单交易' as payType,bat.account_number orderCode,bat.other_order outsidePayStatementNo,
     ai.account_login customerAccount,'退款' as flag, bat.amount orderMoney,
     to_char(bat.create_date,'yyyy-mm-dd hh24:mi:ss') operateDate from bnes_acct_transaction bat 
	   left join account_info ai on(ai.n_account_id = bat.account_id)  where bat.status = 1 and bat.type = 1)t3
	   where 1=1
	    <isNotEmpty prepend="and" property="platformCode">
                 t3.platformCode = #platformCode#
                </isNotEmpty>
				 <isNotEmpty prepend="and" property="flags">
               		 t3.flag in 
                 <iterate conjunction="," open="(" close=")" property="flags">
			  		#flags[]#
				</iterate>
				</isNotEmpty>
                <isNotEmpty prepend="and" property="orderCode">
                 t3.orderCode = #orderCode#
                </isNotEmpty>
                <isNotEmpty prepend="and" property="outsidePayStatementNo">
                 t3.outsidePayStatementNo = #outsidePayStatementNo#
                </isNotEmpty>
                <isNotEmpty prepend="and" property="customerAccount">
                 t3.customerAccount = #customerAccount#
                </isNotEmpty>
                <isEmpty property="time">
				   <isNotEmpty prepend="and" property="dateStart">
				   <![CDATA[
			         to_date(t3.operateDate, 'yyyy-mm-dd hh24:mi:ss') >= to_date(#dateStart#, 'yyyy-mm-dd hh24:mi:ss') and
			         to_date(t3.operateDate, 'yyyy-mm-dd hh24:mi:ss') <=to_date(#dateEnd#, 'yyyy-mm-dd hh24:mi:ss')
			        ]]>
			        </isNotEmpty>
		        </isEmpty>
        <isNotEmpty prepend="and" property="time">
			 t3.operateDate = #time#
		</isNotEmpty>
    )t   where 1=1
     <isNotEmpty prepend="and" property="platformCode">
      t.platformCode = #platformCode#
      </isNotEmpty>
     order by to_date(t.operateDate, 'yyyy-mm-dd hh24:mi:ss') desc
      </select>
      
      
       <!--  统计收退款金额  -->
	  <select id="CountOrderPayMoney"  parameterClass="java.util.Map"  resultMap="orderPayMoneyMap">
	  
  	select sum(t.payMoney) pay,sum(t.returnMoney) return
	from (
 		  select 
          <!-- sum(ops.order_money) payMoney,0 returnMoney  -->
          ops.order_money payMoney,0 returnMoney,
          ops.platform_code platformCode 
  		 from order_pay_statement ops ,order_main om 
          where om.parent_order_code is null
                and ops.order_code = om.order_code
                and ops.payment_way = 4
                and ops.state = 1
                and ops.flag = 1
                <isNotEmpty prepend="and" property="platformCode">
                 ops.platform_code = #platformCode#
                </isNotEmpty>
                <isNotEmpty prepend="and" property="flags">
                ops.flag in 
                 <iterate conjunction="," open="(" close=")" property="flags">
			  		#flags[]#
				</iterate>
                </isNotEmpty>
                <isNotEmpty prepend="and" property="orderCode">
                 ops.order_code = #orderCode#
                </isNotEmpty>
                <isNotEmpty prepend="and" property="outsidePayStatementNo">
                 ops.outside_pay_statement_no = #outsidePayStatementNo#
                </isNotEmpty>
                <isNotEmpty prepend="and" property="customerAccount">
                 om.customer_account = #customerAccount#
                </isNotEmpty>
                <isEmpty property="time">
	                <isNotEmpty prepend="and" property="dateStart">
	                <![CDATA[
			       	 ops.end_date >= to_date(#dateStart#, 'yyyy-mm-dd hh24:mi:ss') and
			       	 ops.end_date <= to_date(#dateEnd#, 'yyyy-mm-dd hh24:mi:ss')
			       	 ]]>
			        </isNotEmpty>
		        </isEmpty>
		         <isNotEmpty prepend="and" property="time">
			       to_char(ops.end_date,'yyyy-mm-dd hh24:mi:ss') = #time#
			   </isNotEmpty>
			   
union all
  select 
          0 payMoney, abs(ops.order_money) returnMoney,
          ops.platform_code platformCode 
  		 from order_pay_statement ops ,order_main om 
          where om.parent_order_code is null
                and ops.order_code = om.order_code
                and ops.payment_way = 4
                and ops.state = 1
                and ops.flag = 2
                <isNotEmpty prepend="and" property="platformCode">
                 ops.platform_code = #platformCode#
                </isNotEmpty>
                <isNotEmpty prepend="and" property="flags">
                ops.flag in 
                 <iterate conjunction="," open="(" close=")" property="flags">
			  		#flags[]#
				</iterate>
                </isNotEmpty>
                <isNotEmpty prepend="and" property="orderCode">
                 ops.order_code = #orderCode#
                </isNotEmpty>
                <isNotEmpty prepend="and" property="outsidePayStatementNo">
                 ops.outside_pay_statement_no = #outsidePayStatementNo#
                </isNotEmpty>
                <isNotEmpty prepend="and" property="customerAccount">
                 om.customer_account = #customerAccount#
                </isNotEmpty>
                <isEmpty property="time">
	                <isNotEmpty prepend="and" property="dateStart">
	                 <![CDATA[
			       	 ops.end_date >= to_date(#dateStart#, 'yyyy-mm-dd hh24:mi:ss') and
			       	 ops.end_date <= to_date(#dateEnd#, 'yyyy-mm-dd hh24:mi:ss')
			       	 ]]>
			        </isNotEmpty>
		        </isEmpty>
		         <isNotEmpty prepend="and" property="time">
			       to_char(ops.end_date,'yyyy-mm-dd hh24:mi:ss') = #time#
			   </isNotEmpty>			   
union all

      select  0 payMoney,abs(oaps.order_money) returnMoney,
       ( select opst.platform_code from order_pay_statement opst where opst.order_code =(
           select nvl(omt.parent_order_code,omt.order_code) from order_main omt where omt.order_code = om.order_code) 
        and opst.payment_way = 4 and opst.state = 1 and rownum = 1   
        ) platformCode
       from order_alter_pay_statement oaps 
       left join order_alter oa on(oa.order_alter_code = oaps.order_alter_code)
       left join order_main om on( om.order_code = oa.order_code)
       where oaps.state = 1
             and oaps.outside_pay_statement_no is not null
        <isNotEmpty prepend="and" property="flags">
             oaps.flag in 
          <iterate conjunction="," open="(" close=")" property="flags">
				#flags[]#
		  </iterate>
         </isNotEmpty>
       <isNotEmpty prepend="and" property="orderCode">
        oa.order_code = #orderCode#
       </isNotEmpty>
       <isNotEmpty prepend="and" property="outsidePayStatementNo">
        oaps.outside_pay_statement_no = #outsidePayStatementNo#
       </isNotEmpty>
       <isNotEmpty prepend="and" property="customerAccount">
        om.customer_account = #customerAccount#
       </isNotEmpty>
       <isEmpty property="time">
	       <isNotEmpty prepend="and" property="dateStart">
	       <![CDATA[
	        oaps.end_date >= to_date(#dateStart#, 'yyyy-mm-dd hh24:mi:ss') and
	        oaps.end_date <= to_date(#dateEnd#, 'yyyy-mm-dd hh24:mi:ss')
	        ]]>
	       </isNotEmpty>
       </isEmpty>
        <isNotEmpty prepend="and" property="time">
			 to_char(oaps.end_date,'yyyy-mm-dd hh24:mi:ss') = #time#
		</isNotEmpty>
			   
     union all
          
            select t3.orderMoney payMoney,0 returnMoney,t3.platformCode from (
		    select '3' platformCode,
		   3 as flag,bat.account_number orderCode,bat.other_order outsidePayStatementNo,
		   ai.account_login customerAccount, bat.amount orderMoney,
		   to_char(bat.create_date,'yyyy-mm-dd hh24:mi:ss') operateDate from bnes_acct_transaction bat 
		   left join account_info ai on(ai.n_account_id = bat.account_id)  where bat.status = 1 and bat.type = 1)t3
		   where 1=1
	    <isNotEmpty prepend="and" property="platformCode">
                 t3.platformCode = #platformCode#
                </isNotEmpty>
				 <isNotEmpty prepend="and" property="flags">
               		 t3.flag in 
                 <iterate conjunction="," open="(" close=")" property="flags">
			  		#flags[]#
				</iterate>
				</isNotEmpty>
                <isNotEmpty prepend="and" property="orderCode">
                 t3.orderCode = #orderCode#
                </isNotEmpty>
                <isNotEmpty prepend="and" property="outsidePayStatementNo">
                 t3.outsidePayStatementNo = #outsidePayStatementNo#
                </isNotEmpty>
                <isNotEmpty prepend="and" property="customerAccount">
                 t3.customerAccount = #customerAccount#
                </isNotEmpty>
                <isEmpty property="time">
				   <isNotEmpty prepend="and" property="dateStart">
				   <![CDATA[
			        to_date(t3.operateDate, 'yyyy-mm-dd hh24:mi:ss') >= to_date(#dateStart#, 'yyyy-mm-dd hh24:mi:ss') and
			        to_date(t3.operateDate, 'yyyy-mm-dd hh24:mi:ss') <= to_date(#dateEnd#, 'yyyy-mm-dd hh24:mi:ss')
			        ]]>
			        </isNotEmpty>
		        </isEmpty>
        <isNotEmpty prepend="and" property="time">
			 t3.operateDate = #time#
		</isNotEmpty>
		
    )t   where 1=1
     <isNotEmpty prepend="and" property="platformCode">
      t.platformCode = #platformCode#
      </isNotEmpty>
     
      </select>
      
</sqlMap>