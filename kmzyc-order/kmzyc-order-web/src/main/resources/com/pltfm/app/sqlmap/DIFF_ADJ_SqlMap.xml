<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="DIFF_ADJ" >
  <resultMap id="ibatorgenerated_BaseResultMap" class="com.pltfm.app.entities.DiffAdj" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Wed Apr 15 10:27:20 CST 2015.
    -->
    <result column="DIFF_ADJ_ID" property="diffAdjId" jdbcType="DECIMAL" />
    <result column="SELLER_ID" property="sellerId" jdbcType="DECIMAL" />
    <result column="CURR_SETTMENT_NO" property="currSettmentNo" jdbcType="VARCHAR" />
    <result column="ADJ_MONEY" property="adjMoney" jdbcType="DECIMAL" />
    <result column="ADJ_TITLE" property="adjTitle" jdbcType="VARCHAR" />
    <result column="ADJ_DETAIL" property="adjDetail" jdbcType="VARCHAR" />
    <result column="OPERATER_ID" property="operaterId" jdbcType="DECIMAL" />
    <result column="ADJ_TIME" property="adjTime" jdbcType="TIMESTAMP" />
    <result column="SETTMENT_STATUS" property="settmentStatus" jdbcType="DECIMAL" />
    <result column="CALC_SETTMENT_NO" property="calcSettmentNo" jdbcType="VARCHAR" />
    <result column="SETTMENT_DATE" property="settmentDate" jdbcType="DATE" />
    <result column="IS_DELETE" property="isDelete" jdbcType="DECIMAL" />
  </resultMap>
  
  
   <resultMap id="diff_adj_BaseResultMap" class="com.pltfm.app.entities.DiffAdj" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Wed Apr 15 10:27:20 CST 2015.
    -->
    <result column="DIFF_ADJ_ID" property="diffAdjId" jdbcType="DECIMAL" />
    <result column="SELLER_ID" property="sellerId" jdbcType="DECIMAL" />
    <result column="CURR_SETTMENT_NO" property="currSettmentNo" jdbcType="VARCHAR" />
    <result column="ADJ_MONEY" property="adjMoney" jdbcType="DECIMAL" />
    <result column="ADJ_TITLE" property="adjTitle" jdbcType="VARCHAR" />
    <result column="ADJ_DETAIL" property="adjDetail" jdbcType="VARCHAR" />
    <result column="OPERATER_ID" property="operaterId" jdbcType="DECIMAL" />
    <result column="ADJ_TIME" property="adjTime" jdbcType="TIMESTAMP" />
    <result column="SETTMENT_STATUS" property="settmentStatus" jdbcType="DECIMAL" />
    <result column="CALC_SETTMENT_NO" property="calcSettmentNo" jdbcType="VARCHAR" />
    <result column="SETTMENT_DATE" property="settmentDate" jdbcType="DATE" />
    
      <result column="user_name" property="userName" jdbcType="VARCHAR" />
       <result column="SETTLEMENT_PERIOD" property="currSettmentPeriod" jdbcType="VARCHAR" />
      
  </resultMap>
  
  
  
  <sql id="ibatorgenerated_Example_Where_Clause" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Wed Apr 15 10:27:20 CST 2015.
    -->
    <iterate property="oredCriteria" conjunction="or" prepend="where" removeFirstPrepend="iterate" >
      <isEqual property="oredCriteria[].valid" compareValue="true" >
        (
        <iterate prepend="and" property="oredCriteria[].criteriaWithoutValue" conjunction="and" >
          $oredCriteria[].criteriaWithoutValue[]$
        </iterate>
        <iterate prepend="and" property="oredCriteria[].criteriaWithSingleValue" conjunction="and" >
          $oredCriteria[].criteriaWithSingleValue[].condition$
            #oredCriteria[].criteriaWithSingleValue[].value#
        </iterate>
        <iterate prepend="and" property="oredCriteria[].criteriaWithListValue" conjunction="and" >
          $oredCriteria[].criteriaWithListValue[].condition$
          <iterate property="oredCriteria[].criteriaWithListValue[].values" open="(" close=")" conjunction="," >
            #oredCriteria[].criteriaWithListValue[].values[]#
          </iterate>
        </iterate>
        <iterate prepend="and" property="oredCriteria[].criteriaWithBetweenValue" conjunction="and" >
          $oredCriteria[].criteriaWithBetweenValue[].condition$
          #oredCriteria[].criteriaWithBetweenValue[].values[0]# and
          #oredCriteria[].criteriaWithBetweenValue[].values[1]#
        </iterate>
        )
      </isEqual>
    </iterate>
  </sql>
  <select id="ibatorgenerated_selectByExample" resultMap="ibatorgenerated_BaseResultMap" parameterClass="com.pltfm.app.entities.DiffAdjExample" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Wed Apr 15 10:27:20 CST 2015.
    -->
    select DIFF_ADJ_ID, SELLER_ID, CURR_SETTMENT_NO, ADJ_MONEY, ADJ_TITLE, ADJ_DETAIL, OPERATER_ID,
      ADJ_TIME, SETTMENT_STATUS, CALC_SETTMENT_NO, SETTMENT_DATE,IS_DELETE
    from DIFF_ADJ
    <isParameterPresent >
      <include refid="DIFF_ADJ.ibatorgenerated_Example_Where_Clause" />
      <isNotNull property="orderByClause" >
        order by $orderByClause$
      </isNotNull>
    </isParameterPresent>
  </select>
  
  <select id="queryDiffAdjForSellerSettlement" resultMap="ibatorgenerated_BaseResultMap" parameterClass="java.util.Map" >
    select DA.DIFF_ADJ_ID, DA.SELLER_ID, DA.CURR_SETTMENT_NO, DA.ADJ_MONEY, DA.ADJ_TITLE, DA.ADJ_DETAIL, DA.OPERATER_ID,
      DA.ADJ_TIME, DA.SETTMENT_STATUS, DA.CALC_SETTMENT_NO, DA.SETTMENT_DATE,DA.IS_DELETE
    from  DIFF_ADJ DA LEFT JOIN  SELLER_SETTLEMENT SS ON DA.CURR_SETTMENT_NO=SS.SETTLEMENT_NO
    WHERE DA.CALC_SETTMENT_NO is null
    <isNotEmpty property="sellerId">
    	and DA.SELLER_ID = #sellerId:DECIMAL#
    </isNotEmpty>
    <isNotEmpty property="settlementStatus">
    	and SS.SETTLEMENT_STATUS = #settlementStatus:DECIMAL#
    </isNotEmpty>
    <isNotEmpty property="daSettmentStatus">
    	and DA.SETTMENT_STATUS = #daSettmentStatus:DECIMAL#
    </isNotEmpty>
    <isNotEmpty property="adjTime">
    	and ADJ_TIME &lt; #adjTime:TIMESTAMP#
    </isNotEmpty>
    
  </select>
  
  <select id="ibatorgenerated_selectByPrimaryKey" resultMap="ibatorgenerated_BaseResultMap" parameterClass="com.pltfm.app.entities.DiffAdj" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Wed Apr 15 10:27:20 CST 2015.
    -->
    select DIFF_ADJ_ID, SELLER_ID, CURR_SETTMENT_NO, ADJ_MONEY, ADJ_TITLE, ADJ_DETAIL, OPERATER_ID,
      ADJ_TIME, SETTMENT_STATUS, CALC_SETTMENT_NO, SETTMENT_DATE,IS_DELETE
    from DIFF_ADJ
    where DIFF_ADJ_ID = #diffAdjId:DECIMAL#
  </select>
  <delete id="ibatorgenerated_deleteByPrimaryKey" parameterClass="com.pltfm.app.entities.DiffAdj" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Wed Apr 15 10:27:20 CST 2015.
    -->
    delete from DIFF_ADJ
    where DIFF_ADJ_ID = #diffAdjId:DECIMAL#
  </delete>
  <delete id="ibatorgenerated_deleteByExample" parameterClass="com.pltfm.app.entities.DiffAdjExample" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Wed Apr 15 10:27:20 CST 2015.
    -->
    delete from DIFF_ADJ
    <include refid="DIFF_ADJ.ibatorgenerated_Example_Where_Clause" />
  </delete>
  <insert id="ibatorgenerated_insert" parameterClass="com.pltfm.app.entities.DiffAdj" >
  
     <selectKey resultClass="java.lang.Long" keyProperty="diffAdjId" >
      SELECT SEQ_DIFF_ADJ_ID.NEXTVAL FROM DUAL
    </selectKey>
    
    insert into DIFF_ADJ (Diff_adj_ID,SELLER_ID, CURR_SETTMENT_NO, ADJ_MONEY, ADJ_TITLE, ADJ_DETAIL,
      OPERATER_ID, ADJ_TIME, SETTMENT_STATUS, CALC_SETTMENT_NO, SETTMENT_DATE)
    values (#diffAdjId:DECIMAL#,#sellerId:DECIMAL#, #currSettmentNo:VARCHAR#, #adjMoney:DECIMAL#, #adjTitle:VARCHAR#,
      #adjDetail:VARCHAR#, #operaterId:DECIMAL#, #adjTime:TIMESTAMP#, #settmentStatus:DECIMAL#,
      #calcSettmentNo:VARCHAR#, #settmentDate:TIMESTAMP#)
  
  </insert>
    
  <insert id="ibatorgenerated_insertSelective" parameterClass="com.pltfm.app.entities.DiffAdj" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Wed Apr 15 10:27:20 CST 2015.
    -->
    <selectKey resultClass="java.lang.Long" keyProperty="diffAdjId" >
      SELECT SEQ_DIFF_ADJ_ID.NEXTVAL FROM DUAL
    </selectKey>
    insert into DIFF_ADJ
    <dynamic prepend="(" >
      <isNotNull prepend="," property="diffAdjId" >
        DIFF_ADJ_ID
      </isNotNull>
      <isNotNull prepend="," property="sellerId" >
        SELLER_ID
      </isNotNull>
      <isNotNull prepend="," property="currSettmentNo" >
        CURR_SETTMENT_NO
      </isNotNull>
      <isNotNull prepend="," property="adjMoney" >
        ADJ_MONEY
      </isNotNull>
      <isNotNull prepend="," property="adjTitle" >
        ADJ_TITLE
      </isNotNull>
      <isNotNull prepend="," property="adjDetail" >
        ADJ_DETAIL
      </isNotNull>
      <isNotNull prepend="," property="operaterId" >
        OPERATER_ID
      </isNotNull>
      <isNotNull prepend="," property="adjTime" >
        ADJ_TIME
      </isNotNull>
      <isNotNull prepend="," property="settmentStatus" >
        SETTMENT_STATUS
      </isNotNull>
      <isNotNull prepend="," property="calcSettmentNo" >
        CALC_SETTMENT_NO
      </isNotNull>
      <isNotNull prepend="," property="settmentDate" >
        SETTMENT_DATE
      </isNotNull>
      <isNotNull prepend="," property="isDelete" >
        IS_DELETE
      </isNotNull>
      )
    </dynamic>
    values
    <dynamic prepend="(" >
      <isNotNull prepend="," property="diffAdjId" >
        #diffAdjId:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="sellerId" >
        #sellerId:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="currSettmentNo" >
        #currSettmentNo:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="adjMoney" >
        #adjMoney:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="adjTitle" >
        #adjTitle:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="adjDetail" >
        #adjDetail:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="operaterId" >
        #operaterId:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="adjTime" >
        #adjTime:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="settmentStatus" >
        #settmentStatus:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="calcSettmentNo" >
        #calcSettmentNo:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="settmentDate" >
        #settmentDate:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="isDelete" >
        #isDelete:DECIMAL#
      </isNotNull>
      )
    </dynamic>    
  </insert>
  <select id="ibatorgenerated_countByExample" parameterClass="com.pltfm.app.entities.DiffAdjExample" resultClass="java.lang.Integer" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Wed Apr 15 10:27:20 CST 2015.
    -->
    select count(*) from DIFF_ADJ
    <include refid="DIFF_ADJ.ibatorgenerated_Example_Where_Clause" />
  </select>
  <update id="ibatorgenerated_updateByExampleSelective" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Wed Apr 15 10:27:20 CST 2015.
    -->
    update DIFF_ADJ
    <dynamic prepend="set" >
      <isNotNull prepend="," property="record.diffAdjId" >
        DIFF_ADJ_ID = #record.diffAdjId:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="record.sellerId" >
        SELLER_ID = #record.sellerId:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="record.currSettmentNo" >
        CURR_SETTMENT_NO = #record.currSettmentNo:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.adjMoney" >
        ADJ_MONEY = #record.adjMoney:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="record.adjTitle" >
        ADJ_TITLE = #record.adjTitle:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.adjDetail" >
        ADJ_DETAIL = #record.adjDetail:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.operaterId" >
        OPERATER_ID = #record.operaterId:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="record.adjTime" >
        ADJ_TIME = #record.adjTime:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="record.settmentStatus" >
        SETTMENT_STATUS = #record.settmentStatus:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="record.calcSettmentNo" >
        CALC_SETTMENT_NO = #record.calcSettmentNo:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.settmentDate" >
        SETTMENT_DATE = #record.settmentDate:TIMESTAMP#
      </isNotNull>
    </dynamic>
    <isParameterPresent >
      <include refid="DIFF_ADJ.ibatorgenerated_Example_Where_Clause" />
    </isParameterPresent>
  </update>
  <update id="ibatorgenerated_updateByExample" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Wed Apr 15 10:27:20 CST 2015.
    -->
    update DIFF_ADJ
    set DIFF_ADJ_ID = #record.diffAdjId:DECIMAL#,
      SELLER_ID = #record.sellerId:DECIMAL#,
      CURR_SETTMENT_NO = #record.currSettmentNo:VARCHAR#,
      ADJ_MONEY = #record.adjMoney:DECIMAL#,
      ADJ_TITLE = #record.adjTitle:VARCHAR#,
      ADJ_DETAIL = #record.adjDetail:VARCHAR#,
      OPERATER_ID = #record.operaterId:DECIMAL#,
      ADJ_TIME = #record.adjTime:TIMESTAMP#,
      SETTMENT_STATUS = #record.settmentStatus:DECIMAL#,
      CALC_SETTMENT_NO = #record.calcSettmentNo:VARCHAR#,
      SETTMENT_DATE = #record.settmentDate:TIMESTAMP#
    <isParameterPresent >
      <include refid="DIFF_ADJ.ibatorgenerated_Example_Where_Clause" />
    </isParameterPresent>
  </update>
  <update id="ibatorgenerated_updateByPrimaryKeySelective" parameterClass="com.pltfm.app.entities.DiffAdj" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Wed Apr 15 10:27:20 CST 2015.
    -->
    update DIFF_ADJ
    <dynamic prepend="set" >
      <isNotNull prepend="," property="sellerId" >
        SELLER_ID = #sellerId:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="currSettmentNo" >
        CURR_SETTMENT_NO = #currSettmentNo:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="adjMoney" >
        ADJ_MONEY = #adjMoney:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="adjTitle" >
        ADJ_TITLE = #adjTitle:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="adjDetail" >
        ADJ_DETAIL = #adjDetail:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="operaterId" >
        OPERATER_ID = #operaterId:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="adjTime" >
        ADJ_TIME = #adjTime:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="settmentStatus" >
        SETTMENT_STATUS = #settmentStatus:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="calcSettmentNo" >
        CALC_SETTMENT_NO = #calcSettmentNo:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="settmentDate" >
        SETTMENT_DATE = #settmentDate:TIMESTAMP#
      </isNotNull>
    </dynamic>
    where DIFF_ADJ_ID = #diffAdjId:DECIMAL#
  </update>
  <update id="ibatorgenerated_updateByPrimaryKey" parameterClass="com.pltfm.app.entities.DiffAdj" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Wed Apr 15 10:27:20 CST 2015.
    -->
    update DIFF_ADJ
    set SELLER_ID = #sellerId:DECIMAL#,
      CURR_SETTMENT_NO = #currSettmentNo:VARCHAR#,
      ADJ_MONEY = #adjMoney:DECIMAL#,
      ADJ_TITLE = #adjTitle:VARCHAR#,
      ADJ_DETAIL = #adjDetail:VARCHAR#,
      OPERATER_ID = #operaterId:DECIMAL#,
      ADJ_TIME = #adjTime:TIMESTAMP#,
      SETTMENT_STATUS = #settmentStatus:DECIMAL#,
      CALC_SETTMENT_NO = #calcSettmentNo:VARCHAR#,
      SETTMENT_DATE = #settmentDate:TIMESTAMP#
    where DIFF_ADJ_ID = #diffAdjId:DECIMAL#
  </update>
  <!-- 取用户名 -->
  <select id="getUserName" resultClass="String" parameterClass="com.pltfm.app.entities.DiffAdj" >
  		select s.user_name from   sys_user s where  s.user_id = #operaterId#
    </select>
  
  
   <!--查询列表 -->
  <select id="selectDiffAdjList" resultMap="diff_adj_BaseResultMap" parameterClass="com.pltfm.app.entities.DiffAdjCriteria" >
  
   select DIFF_ADJ_ID, SELLER_ID, CURR_SETTMENT_NO, ADJ_MONEY, ADJ_TITLE, ADJ_DETAIL, OPERATER_ID,
      ADJ_TIME, SETTMENT_STATUS, CALC_SETTMENT_NO, SETTMENT_DATE,user_name, SETTLEMENT_PERIOD,rownum rn
    from (
	   select DIFF_ADJ_ID, SELLER_ID, CURR_SETTMENT_NO, ADJ_MONEY, ADJ_TITLE, ADJ_DETAIL, OPERATER_ID,
	      ADJ_TIME, SETTMENT_STATUS, CALC_SETTMENT_NO, SETTMENT_DATE,user_name,SETTLEMENT_PERIOD, rownum rn
	    from (
			  	select t.DIFF_ADJ_ID,  t.SELLER_ID,  t.CURR_SETTMENT_NO,  t.ADJ_MONEY,  t.ADJ_TITLE,  t.ADJ_DETAIL,  t.OPERATER_ID,
			       t.ADJ_TIME,  t.SETTMENT_STATUS,  t.CALC_SETTMENT_NO,  t.SETTMENT_DATE,s.user_name, p.SETTLEMENT_PERIOD
			    from DIFF_ADJ t 
			    left join
			       sys_user s 
			  	 on  s.user_id =  t.operater_id
			  	 left join
			  	 SELLER_SETTLEMENT p
			  	 on p.SETTLEMENT_NO = t.CURR_SETTMENT_NO
			   where 1=1 
			   <!-- 
			   		结算单状态为已结算			   		
			    -->
			     and p.SETTLEMENT_STATUS=6
			   <isNotEmpty property="calcSettmentNo" >
		        	 and t.calc_settment_no = #calcSettmentNo# 
		      </isNotEmpty>
		      <isNotEmpty property="currSettmentNo" >
		        	and  t.CURR_SETTMENT_NO =  #currSettmentNo#
		      </isNotEmpty>
		      <isNotNull property="endDate" >
		        	and t.adj_time &lt; #endDate#
		      </isNotNull>
		       
		       <isNotNull property="startDate" >
	     		 	and t.adj_time &gt;= #startDate#	
		      </isNotNull>
		      
				<isNotEmpty property="userName" >
		        	 and s.user_name like '%'||#userName#||'%' 
		      </isNotEmpty>
	          <isNotNull property="hurlIds" >
		            and t.DIFF_ADJ_ID in
		        	<iterate open="(" close=")" conjunction="," property="hurlIds">
		        		#hurlIds[]#
		        	</iterate>
		      </isNotNull>
		      <isNotEmpty property="adjDetail" >
		        	 and (t.ADJ_DETAIL like '%'||#adjDetail#||'%' or t.ADJ_TITLE like '%'||#adjDetail#||'%') 
		      </isNotEmpty>
		      
		      order by t.DIFF_ADJ_ID desc
	   <![CDATA[ 	  )a where ROWNUM  <= #endIndex#
		)  b where rn > #startIndex#]]>
    </select>
  
  
    <!--查询列表 -->
  <select id="selectDiffAdjSize" resultClass="Integer" parameterClass="com.pltfm.app.entities.DiffAdjCriteria" >
	  		 select count(1)
	    from DIFF_ADJ t 
	    left join
	       sys_user s 
	  	 on  s.user_id =  t.operater_id
	   where 1=1 
			   <isNotEmpty property="calcSettmentNo" >
		        	 and t.calc_settment_no = #calcSettmentNo# 
		      </isNotEmpty>
		      <isNotEmpty property="currSettmentNo" >
		        	and  t.CURR_SETTMENT_NO =  #currSettmentNo#
		      </isNotEmpty>
		<isNotEmpty property="userName" >
	        	 and s.user_name like '%'||#userName#||'%' 
	      </isNotEmpty>
	      <isNotEmpty property="adjDetail" >
	        	 and t.ADJ_DETAIL like '%'||#adjDetail#||'%'  or t.ADJ_TITLE like '%'||#adjDetail#||'%' 
	      </isNotEmpty>
	      
	      <isNotNull property="endDate" >
	        	and t.adj_time &lt; #endDate#
	      </isNotNull>
	      <isNotNull property="startDate" >
	        	and t.adj_time &gt;= #startDate#
	      </isNotNull>
	      <isNotNull property="hurlIds" >
	            and t.DIFF_ADJ_ID in
	        	<iterate open="(" close=")" conjunction="," property="hurlIds">
	        		#hurlIds[]#
	        	</iterate>
	      </isNotNull>
	       <!-- <isNotNull property="startDate" >
	        	and t.SETTMENT_DATE >= #startDate#
	      </isNotNull>
	       <isNotNull property="endDate" >
	     		 <![CDATA[ 	and t.SETTMENT_DATE < #endDate#	]]>
	      </isNotNull> -->
	   
    </select>
  <!-- 将差异调整金额计算至客户账号 -->
<!--   <update id="ibatorgenerated_updateDiffAndAccountAmount" parameterClass="com.pltfm.app.entities.DiffAdj" >
  		UPDATE   ACCOUNT_INFO AI
          SET AI.N_ACCOUNT_AMOUNT = AI.N_ACCOUNT_AMOUNT +
                                    (SELECT DA.ADJ_MONEY
                                       FROM DIFF_ADJ DA
                                      WHERE DA.DIFF_ADJ_ID = #diffAdjId#)
        WHERE AI.N_LOGIN_ID =
              (SELECT CT.N_LOGIN_ID
                 FROM   COMMERCIAL_TENANT_BASIC_INFO CT
                WHERE CT.N_COMMERCIAL_TENANT_ID = #currSettmentNo#)
  </update>
   -->
    
  <resultMap class="java.util.HashMap" id="DiffAdjSumResult">
  	<result column="SUM_ADJ" property="sumAdj" jdbcType="DECIMAL" />
  </resultMap>
  
  <sql id="diffAdjCriteria">
  		<isNotEmpty property="calcSettmentNo" open="(" close=")" prepend="AND">
  			DA.CALC_SETTMENT_NO=#calcSettmentNo:VARCHAR#
  		</isNotEmpty>
  		<isNotEmpty property="userName" open="(" close=")" prepend="AND">
  			s.user_name like '%'||#userName:VARCHAR#||'%' 
  		</isNotEmpty>
  		<isNotEmpty property="adjDetail" open="(" close=")" prepend="AND">
  			DA.ADJ_DETAIL like '%'||#adjDetail#||'%' or DA.ADJ_TITLE like '%'||#adjDetail#||'%' 
  		</isNotEmpty>
  		<isNotEmpty property="startDate" open="(" close=")" prepend="AND">
  			DA.SETTMENT_DATE &gt; #startDate#
  		</isNotEmpty>
  		<isNotEmpty property="endDate" open="(" close=")" prepend="AND">
  			DA.SETTMENT_DATE &lt;= #endDate#
  		</isNotEmpty>
  </sql>
   
  <select id="selectSumDiff" parameterClass="com.pltfm.app.entities.DiffAdjCriteria" resultMap="DiffAdjSumResult">
  	SELECT SUM(DA.ADJ_MONEY) SUM_ADJ FROM DIFF_ADJ DA
  	left join
	       sys_user s 
	  	 on  s.user_id =  DA.operater_id
  	 WHERE DA.CALC_SETTMENT_NO=#calcSettmentNo# 
  	 <include refid="DIFF_ADJ.diffAdjCriteria"/>
  </select>
  
   <!--查询列表 -->
  <select id="queryExportDiffAdjInfo" resultClass="java.util.HashMap" parameterClass="java.util.Map" >
  
   select DIFF_ADJ_ID, SELLER_ID, CURR_SETTMENT_NO, ADJ_MONEY, ADJ_TITLE, ADJ_DETAIL, OPERATER_ID,
      to_char(ADJ_TIME,'yyyy-mm-dd hh24:mi:ss') ADJ_TIME, SETTMENT_STATUS, CALC_SETTMENT_NO, to_char(SETTMENT_DATE,'yyyy-mm-dd hh24:mi:ss') SETTMENT_DATE,user_name, SETTLEMENT_PERIOD,rownum rn
    from (
	   select DIFF_ADJ_ID, SELLER_ID, CURR_SETTMENT_NO, ADJ_MONEY, ADJ_TITLE, ADJ_DETAIL, OPERATER_ID,
	      ADJ_TIME, SETTMENT_STATUS, CALC_SETTMENT_NO, SETTMENT_DATE,user_name,SETTLEMENT_PERIOD, rownum rn
	    from (
			  	select t.DIFF_ADJ_ID,  t.SELLER_ID,  t.CURR_SETTMENT_NO,  t.ADJ_MONEY,  t.ADJ_TITLE,  t.ADJ_DETAIL,  t.OPERATER_ID,
			       t.ADJ_TIME,  t.SETTMENT_STATUS,  t.CALC_SETTMENT_NO,  t.SETTMENT_DATE,s.user_name, p.SETTLEMENT_PERIOD
			    from DIFF_ADJ t 
			    left join
			       sys_user s 
			  	 on  s.user_id =  t.operater_id
			  	 left join
			  	 SELLER_SETTLEMENT p
			  	 on p.SETTLEMENT_NO = t.CURR_SETTMENT_NO
			   where 
			   <!-- 
			   		结算单状态为已结算
			    -->
			     p.SETTLEMENT_STATUS=6
		         and t.CALC_SETTMENT_NO = #settlementNo# 
		     	 order by t.DIFF_ADJ_ID desc,t.SETTMENT_DATE desc
	 	    )a 
		)  b 
    </select>
    
</sqlMap>