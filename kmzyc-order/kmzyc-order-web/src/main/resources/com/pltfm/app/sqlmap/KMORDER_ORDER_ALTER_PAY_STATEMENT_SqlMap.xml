<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="KMORDER_ORDER_ALTER_PAY_STATEMENT">
  <resultMap class="com.pltfm.app.entities.OrderAlterPayStatement" id="ibatorgenerated_BaseResultMap">
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Thu Sep 05 17:33:01 CST 2013.
    -->
    <result column="PAY_STATEMENT_NO" jdbcType="DECIMAL" property="payStatementNo" />
    <result column="PAYMENT_WAY" jdbcType="DECIMAL" property="paymentWay" />
    <result column="STATE" jdbcType="DECIMAL" property="state" />
    <result column="ACCOUNT" jdbcType="VARCHAR" property="account" />
    <result column="ORDER_ALTER_CODE" jdbcType="VARCHAR" property="orderAlterCode" />
    <result column="ORDER_MONEY" jdbcType="DECIMAL" property="orderMoney" />
    <result column="CREATE_DATE" jdbcType="date" property="createDate" />
    <result column="END_DATE" jdbcType="date" property="endDate" />
    <result column="OUTSIDE_PAY_STATEMENT_NO" jdbcType="VARCHAR" property="outsidePayStatementNo" />
    <result column="FLAG" jdbcType="DECIMAL" property="flag" />
    <result column="PREFERENTIAL_NO" jdbcType="DECIMAL" property="preferentialNo" />
    <result column="PREFERENTIAL_NAME" jdbcType="VARCHAR" property="preferentialName" />
  </resultMap>
  <resultMap class="com.pltfm.app.vobject.OrderAlterPayStatementVo" id="ibatorgenerated_ExtendsResultMap"
  		  extends="ibatorgenerated_BaseResultMap">
  	<!-- 附加 -->
    <result column="PAYMETHODSTR" jdbcType="VARCHAR" property="paymentWayStr" />
    <result column="STATESTR" jdbcType="VARCHAR" property="stateStr" />
    <result column="FLAGSTR" jdbcType="VARCHAR" property="flagStr" />
    <result column="PLATFORMNAME" jdbcType="VARCHAR" property="platFormName" />
    <!--  -->
  </resultMap>
  
    <resultMap class="com.pltfm.app.vobject.OrderAlterPayStatementVo" id="ibatorgenerated_ExtendsResultMap2"
  		  extends="ibatorgenerated_ExtendsResultMap">
  	<!-- 预售添加 -->
    <result column="YSFLAG" jdbcType="VARCHAR" property="ysFlag" />
    <!--  -->
  </resultMap>
  
  <sql id="ibatorgenerated_Example_Where_Clause">
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Thu Sep 05 17:33:01 CST 2013.
    -->
    <iterate conjunction="or" prepend="where" property="oredCriteria" removeFirstPrepend="iterate">
      <isEqual compareValue="true" property="oredCriteria[].valid">
        (
        <iterate conjunction="and" prepend="and" property="oredCriteria[].criteriaWithoutValue">
          $oredCriteria[].criteriaWithoutValue[]$
        </iterate>
        <iterate conjunction="and" prepend="and" property="oredCriteria[].criteriaWithSingleValue">
          $oredCriteria[].criteriaWithSingleValue[].condition$
            #oredCriteria[].criteriaWithSingleValue[].value#
        </iterate>
        <iterate conjunction="and" prepend="and" property="oredCriteria[].criteriaWithListValue">
          $oredCriteria[].criteriaWithListValue[].condition$
          <iterate close=")" conjunction="," open="(" property="oredCriteria[].criteriaWithListValue[].values">
            #oredCriteria[].criteriaWithListValue[].values[]#
          </iterate>
        </iterate>
        <iterate conjunction="and" prepend="and" property="oredCriteria[].criteriaWithBetweenValue">
          $oredCriteria[].criteriaWithBetweenValue[].condition$
          #oredCriteria[].criteriaWithBetweenValue[].values[0]# and
          #oredCriteria[].criteriaWithBetweenValue[].values[1]#
        </iterate>
        )
      </isEqual>
    </iterate>
  </sql>
  <sql id="Additional_Where_Clause" >
	  FROM ORDER_ALTER_PAY_STATEMENT T
	 WHERE T.ORDER_ALTER_CODE = #value#
	   AND T.STATE = 4
	   AND NOT EXISTS (SELECT *
	          FROM ORDER_ALTER_PAY_STATEMENT
	         WHERE ORDER_ALTER_CODE = T.ORDER_ALTER_CODE
	           AND PAYMENT_WAY = T.PAYMENT_WAY
	           AND FLAG = T.FLAG
	           AND STATE IN (1, 2))
  </sql>
  
  <select id="SQL_QUERY_ORDER_ALTER_PAY_STATEMENT_YS" resultMap="ibatorgenerated_ExtendsResultMap2" parameterClass="java.util.Map" >
  select T.PAY_STATEMENT_NO, T.PAYMENT_WAY, T.STATE, T.ACCOUNT, T.ORDER_ALTER_CODE, T.ORDER_MONEY,
      T.CREATE_DATE, T.END_DATE, T.OUTSIDE_PAY_STATEMENT_NO, T.FLAG, T.PREFERENTIAL_NO, T.PREFERENTIAL_NAME,T.YSFLAG
            <!-- 附加 -->
      ,(SELECT D.ORDER_DICTIONARY_VALUE FROM ORDER_DICTIONARY D WHERE D.ORDER_DICTIONARY_TYPE = 'Pay_Method' AND D.ORDER_DICTIONARY_KEY = T.PAYMENT_WAY) payMethodStr
      ,(SELECT D.ORDER_DICTIONARY_VALUE FROM ORDER_DICTIONARY D WHERE D.ORDER_DICTIONARY_TYPE = 'Order_Return_Method' AND D.ORDER_DICTIONARY_KEY = T.PAYMENT_WAY) platFormName
      ,(SELECT D.ORDER_DICTIONARY_VALUE FROM ORDER_DICTIONARY D WHERE D.ORDER_DICTIONARY_TYPE = 'Order_Pay_State' AND D.ORDER_DICTIONARY_KEY = T.STATE) stateStr
      ,(SELECT D.ORDER_DICTIONARY_VALUE FROM ORDER_DICTIONARY D WHERE D.ORDER_DICTIONARY_TYPE = 'Order_Pay_Flag' AND D.ORDER_DICTIONARY_KEY = T.FLAG) flagStr
      <!--  -->
    from  ORDER_ALTER_PAY_STATEMENT T,order_alter P
    where T.order_alter_code = P.order_alter_code    
    and P.order_code = #orderCode#
	and T.payment_way in (9,12)
	<isNotEmpty prepend="AND" property="state">
				T.state = #state#
	</isNotEmpty>
	<isNotEmpty prepend="AND" property="flag">
				T.flag = #flag#
	</isNotEmpty>
	<isNotEmpty prepend="AND" property="ysFlag">
				T.ysflag = #ysFlag#
	</isNotEmpty>  
	<isNotEmpty prepend="AND" property="orderAlterCode">
				T.Order_Alter_Code = #orderAlterCode#
	</isNotEmpty>  
  </select>
  
  <select id="SQL_QUERY_ORDER_ALTER_PAY_STATEMENT" resultMap="ibatorgenerated_ExtendsResultMap2" parameterClass="java.util.Map" >
  select T.PAY_STATEMENT_NO, T.PAYMENT_WAY, T.STATE, T.ACCOUNT, T.ORDER_ALTER_CODE, T.ORDER_MONEY,
      T.CREATE_DATE, T.END_DATE, T.OUTSIDE_PAY_STATEMENT_NO, T.FLAG, T.PREFERENTIAL_NO, T.PREFERENTIAL_NAME,T.YSFLAG
            <!-- 附加 -->
      ,(SELECT D.ORDER_DICTIONARY_VALUE FROM ORDER_DICTIONARY D WHERE D.ORDER_DICTIONARY_TYPE = 'Pay_Method' AND D.ORDER_DICTIONARY_KEY = T.PAYMENT_WAY) payMethodStr
      ,(SELECT D.ORDER_DICTIONARY_VALUE FROM ORDER_DICTIONARY D WHERE D.ORDER_DICTIONARY_TYPE = 'Order_Return_Method' AND D.ORDER_DICTIONARY_KEY = T.PAYMENT_WAY) platFormName
      ,(SELECT D.ORDER_DICTIONARY_VALUE FROM ORDER_DICTIONARY D WHERE D.ORDER_DICTIONARY_TYPE = 'Order_Pay_State' AND D.ORDER_DICTIONARY_KEY = T.STATE) stateStr
      ,(SELECT D.ORDER_DICTIONARY_VALUE FROM ORDER_DICTIONARY D WHERE D.ORDER_DICTIONARY_TYPE = 'Order_Pay_Flag' AND D.ORDER_DICTIONARY_KEY = T.FLAG) flagStr
      <!--  -->
    from  ORDER_ALTER_PAY_STATEMENT T,order_alter P
    where T.order_alter_code = P.order_alter_code    
    and P.order_code = #orderCode#
	<isNotEmpty prepend="AND" property="paymentWay">
				T.payment_way = #paymentWay#
	</isNotEmpty>
	<isNotEmpty prepend="AND" property="state">
				T.state = #state#
	</isNotEmpty>
	<isNotEmpty prepend="AND" property="flag">
				T.flag = #flag#
	</isNotEmpty>
	<isNotEmpty prepend="AND" property="ysFlag">
				T.ysflag = #ysFlag#
	</isNotEmpty>
	<isNotEmpty prepend="AND" property="orderAlterCode">
				T.Order_Alter_Code = #orderAlterCode#
	</isNotEmpty>    
  </select>
  
  <select id="SQL_QUERY_ORDER_ALTER_PAY_STATEMENT2" resultMap="ibatorgenerated_ExtendsResultMap2" parameterClass="java.util.Map" >
  select T.PAY_STATEMENT_NO, T.PAYMENT_WAY, T.STATE, T.ACCOUNT, T.ORDER_ALTER_CODE, T.ORDER_MONEY,
      T.CREATE_DATE, T.END_DATE, T.OUTSIDE_PAY_STATEMENT_NO, T.FLAG, T.PREFERENTIAL_NO, T.PREFERENTIAL_NAME,T.YSFLAG
            <!-- 附加 -->
      ,(SELECT D.ORDER_DICTIONARY_VALUE FROM ORDER_DICTIONARY D WHERE D.ORDER_DICTIONARY_TYPE = 'Pay_Method' AND D.ORDER_DICTIONARY_KEY = T.PAYMENT_WAY) payMethodStr
      ,(SELECT D.ORDER_DICTIONARY_VALUE FROM ORDER_DICTIONARY D WHERE D.ORDER_DICTIONARY_TYPE = 'Order_Return_Method' AND D.ORDER_DICTIONARY_KEY = T.PAYMENT_WAY) platFormName
      ,(SELECT D.ORDER_DICTIONARY_VALUE FROM ORDER_DICTIONARY D WHERE D.ORDER_DICTIONARY_TYPE = 'Order_Pay_State' AND D.ORDER_DICTIONARY_KEY = T.STATE) stateStr
      ,(SELECT D.ORDER_DICTIONARY_VALUE FROM ORDER_DICTIONARY D WHERE D.ORDER_DICTIONARY_TYPE = 'Order_Pay_Flag' AND D.ORDER_DICTIONARY_KEY = T.FLAG) flagStr
      <!--  -->
    from  ORDER_ALTER_PAY_STATEMENT T
    where T.order_alter_code = #orderAlterCode#
    and T.STATE = #state#
    and T.FLAG = #flag#
    and T.YSFLAG = #ysFlag#      
  </select>
  
  <select id="ibatorgenerated_selectByExample" parameterClass="com.pltfm.app.entities.OrderAlterPayStatementExample" resultMap="ibatorgenerated_ExtendsResultMap">
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Thu Sep 05 17:33:01 CST 2013.
    -->
    select PAY_STATEMENT_NO, PAYMENT_WAY, STATE, ACCOUNT, ORDER_ALTER_CODE, ORDER_MONEY,
      CREATE_DATE, END_DATE, OUTSIDE_PAY_STATEMENT_NO, FLAG, PREFERENTIAL_NO, PREFERENTIAL_NAME
            <!-- 附加 -->
      ,(SELECT D.ORDER_DICTIONARY_VALUE FROM ORDER_DICTIONARY D WHERE D.ORDER_DICTIONARY_TYPE = 'Pay_Method' AND D.ORDER_DICTIONARY_KEY = T.PAYMENT_WAY) payMethodStr
      ,(SELECT D.ORDER_DICTIONARY_VALUE FROM ORDER_DICTIONARY D WHERE D.ORDER_DICTIONARY_TYPE = 'Order_Return_Method' AND D.ORDER_DICTIONARY_KEY = T.PAYMENT_WAY) platFormName
      ,(SELECT D.ORDER_DICTIONARY_VALUE FROM ORDER_DICTIONARY D WHERE D.ORDER_DICTIONARY_TYPE = 'Order_Pay_State' AND D.ORDER_DICTIONARY_KEY = T.STATE) stateStr
      ,(SELECT D.ORDER_DICTIONARY_VALUE FROM ORDER_DICTIONARY D WHERE D.ORDER_DICTIONARY_TYPE = 'Order_Pay_Flag' AND D.ORDER_DICTIONARY_KEY = T.FLAG) flagStr
      <!--  -->
    from  ORDER_ALTER_PAY_STATEMENT T
    <isParameterPresent>
      <include refid="KMORDER_ORDER_ALTER_PAY_STATEMENT.ibatorgenerated_Example_Where_Clause" />
      <isNotNull property="orderByClause">
        order by $orderByClause$
      </isNotNull>
    </isParameterPresent>
  </select>
  <select id="ibatorgenerated_selectByPrimaryKey" parameterClass="com.pltfm.app.entities.OrderAlterPayStatement" resultMap="ibatorgenerated_BaseResultMap">
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Thu Sep 05 17:33:01 CST 2013.
    -->
    select PAY_STATEMENT_NO, PAYMENT_WAY, STATE, ACCOUNT, ORDER_ALTER_CODE, ORDER_MONEY,
      CREATE_DATE, END_DATE, OUTSIDE_PAY_STATEMENT_NO, FLAG, PREFERENTIAL_NO, PREFERENTIAL_NAME
    from  ORDER_ALTER_PAY_STATEMENT
    where PAY_STATEMENT_NO = #payStatementNo:DECIMAL#
  </select>
  <delete id="ibatorgenerated_deleteByPrimaryKey" parameterClass="com.pltfm.app.entities.OrderAlterPayStatement">
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Thu Sep 05 17:33:01 CST 2013.
    -->
    delete from  ORDER_ALTER_PAY_STATEMENT
    where PAY_STATEMENT_NO = #payStatementNo:DECIMAL#
  </delete>
  <delete id="ibatorgenerated_deleteByExample" parameterClass="com.pltfm.app.entities.OrderAlterPayStatementExample">
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Thu Sep 05 17:33:01 CST 2013.
    -->
    delete from  ORDER_ALTER_PAY_STATEMENT
    <include refid="KMORDER_ORDER_ALTER_PAY_STATEMENT.ibatorgenerated_Example_Where_Clause" />
  </delete>
  <insert id="ibatorgenerated_insert" parameterClass="com.pltfm.app.entities.OrderAlterPayStatement">
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Thu Sep 05 17:33:01 CST 2013.
    -->
    <selectKey keyProperty="payStatementNo" resultClass="java.lang.Long">
      select SEQ_ALTER_PAY_STATEMENT.NEXTVAL from dual
    </selectKey>
    insert into  ORDER_ALTER_PAY_STATEMENT
    <dynamic prepend="(">
      <isNotNull prepend="," property="payStatementNo">
        PAY_STATEMENT_NO
      </isNotNull>
      <isNotNull prepend="," property="paymentWay">
        PAYMENT_WAY
      </isNotNull>
      <isNotNull prepend="," property="state">
        STATE
      </isNotNull>
      <isNotNull prepend="," property="account">
        ACCOUNT
      </isNotNull>
      <isNotNull prepend="," property="orderAlterCode">
        ORDER_ALTER_CODE
      </isNotNull>
      <isNotNull prepend="," property="orderMoney">
        ORDER_MONEY
      </isNotNull>
      <isNotNull prepend="," property="createDate">
        CREATE_DATE
      </isNotNull>
      <isNotNull prepend="," property="endDate">
        END_DATE
      </isNotNull>
      <isNotNull prepend="," property="outsidePayStatementNo">
        OUTSIDE_PAY_STATEMENT_NO
      </isNotNull>
      <isNotNull prepend="," property="flag">
        FLAG
      </isNotNull>
      <isNotNull prepend="," property="preferentialNo">
        PREFERENTIAL_NO
      </isNotNull>
      <isNotNull prepend="," property="preferentialName">
        PREFERENTIAL_NAME
      </isNotNull>
       <isNotNull prepend="," property="ysFlag">
        YSFLAG
      </isNotNull>
      )
    </dynamic>
    values
    <dynamic prepend="(">
      <isNotNull prepend="," property="payStatementNo">
        #payStatementNo:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="paymentWay">
        #paymentWay:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="state">
        #state:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="account">
        #account:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="orderAlterCode">
        #orderAlterCode:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="orderMoney">
        #orderMoney:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="createDate">
        #createDate#
      </isNotNull>
      <isNotNull prepend="," property="endDate">
        #endDate#
      </isNotNull>
      <isNotNull prepend="," property="outsidePayStatementNo">
        #outsidePayStatementNo:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="flag">
        #flag:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="preferentialNo">
        #preferentialNo:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="preferentialName">
        #preferentialName:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="ysFlag">
        #ysFlag:VARCHAR#
      </isNotNull>
      )
      </dynamic>
  </insert>
  <insert id="ibatorgenerated_insertSelective" parameterClass="com.pltfm.app.entities.OrderAlterPayStatement">
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Thu Sep 05 17:33:01 CST 2013.
    -->
    <selectKey keyProperty="payStatementNo" resultClass="java.lang.Long">
      select SEQ_ALTER_PAY_STATEMENT.NEXTVAL from dual
    </selectKey>
    insert into  ORDER_ALTER_PAY_STATEMENT
    <dynamic prepend="(">
      <isNotNull prepend="," property="payStatementNo">
        PAY_STATEMENT_NO
      </isNotNull>
      <isNotNull prepend="," property="paymentWay">
        PAYMENT_WAY
      </isNotNull>
      <isNotNull prepend="," property="state">
        STATE
      </isNotNull>
      <isNotNull prepend="," property="account">
        ACCOUNT
      </isNotNull>
      <isNotNull prepend="," property="orderAlterCode">
        ORDER_ALTER_CODE
      </isNotNull>
      <isNotNull prepend="," property="orderMoney">
        ORDER_MONEY
      </isNotNull>
      <isNotNull prepend="," property="createDate">
        CREATE_DATE
      </isNotNull>
      <isNotNull prepend="," property="endDate">
        END_DATE
      </isNotNull>
      <isNotNull prepend="," property="outsidePayStatementNo">
        OUTSIDE_PAY_STATEMENT_NO
      </isNotNull>
      <isNotNull prepend="," property="flag">
        FLAG
      </isNotNull>
      <isNotNull prepend="," property="preferentialNo">
        PREFERENTIAL_NO
      </isNotNull>
      <isNotNull prepend="," property="preferentialName">
        PREFERENTIAL_NAME
      </isNotNull>
      )
    </dynamic>
    values
    <dynamic prepend="(">
      <isNotNull prepend="," property="payStatementNo">
        #payStatementNo:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="paymentWay">
        #paymentWay:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="state">
        #state:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="account">
        #account:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="orderAlterCode">
        #orderAlterCode:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="orderMoney">
        #orderMoney:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="createDate">
        #createDate#
      </isNotNull>
      <isNotNull prepend="," property="endDate">
        #endDate#
      </isNotNull>
      <isNotNull prepend="," property="outsidePayStatementNo">
        #outsidePayStatementNo:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="flag">
        #flag:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="preferentialNo">
        #preferentialNo:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="preferentialName">
        #preferentialName:VARCHAR#
      </isNotNull>
      )
    </dynamic>
  </insert>
  <select id="ibatorgenerated_countByExample" parameterClass="com.pltfm.app.entities.OrderAlterPayStatementExample" resultClass="java.lang.Integer">
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Thu Sep 05 17:33:01 CST 2013.
    -->
    select count(*) from  ORDER_ALTER_PAY_STATEMENT
    <include refid="KMORDER_ORDER_ALTER_PAY_STATEMENT.ibatorgenerated_Example_Where_Clause" />
  </select>
  <update id="ibatorgenerated_updateByExampleSelective">
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Thu Sep 05 17:33:01 CST 2013.
    -->
    update  ORDER_ALTER_PAY_STATEMENT
    <dynamic prepend="set">
      <isNotNull prepend="," property="record.payStatementNo">
        PAY_STATEMENT_NO = #record.payStatementNo:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="record.paymentWay">
        PAYMENT_WAY = #record.paymentWay:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="record.state">
        STATE = #record.state:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="record.account">
        ACCOUNT = #record.account:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.orderAlterCode">
        ORDER_ALTER_CODE = #record.orderAlterCode:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.orderMoney">
        ORDER_MONEY = #record.orderMoney:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="record.createDate">
        CREATE_DATE = #record.createDate#
      </isNotNull>
      <isNotNull prepend="," property="record.endDate">
        END_DATE = #record.endDate#
      </isNotNull>
      <isNotNull prepend="," property="record.outsidePayStatementNo">
        OUTSIDE_PAY_STATEMENT_NO = #record.outsidePayStatementNo:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.flag">
        FLAG = #record.flag:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="record.preferentialNo">
        PREFERENTIAL_NO = #record.preferentialNo:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="record.preferentialName">
        PREFERENTIAL_NAME = #record.preferentialName:VARCHAR#
      </isNotNull>
    </dynamic>
    <isParameterPresent>
      <include refid="KMORDER_ORDER_ALTER_PAY_STATEMENT.ibatorgenerated_Example_Where_Clause" />
    </isParameterPresent>
  </update>
  <update id="ibatorgenerated_updateByExample">
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Thu Sep 05 17:33:01 CST 2013.
    -->
    update  ORDER_ALTER_PAY_STATEMENT
    set PAY_STATEMENT_NO = #record.payStatementNo:DECIMAL#,
      PAYMENT_WAY = #record.paymentWay:DECIMAL#,
      STATE = #record.state:DECIMAL#,
      ACCOUNT = #record.account:VARCHAR#,
      ORDER_ALTER_CODE = #record.orderAlterCode:VARCHAR#,
      ORDER_MONEY = #record.orderMoney:DECIMAL#,
      CREATE_DATE = #record.createDate#,
      END_DATE = #record.endDate#,
      OUTSIDE_PAY_STATEMENT_NO = #record.outsidePayStatementNo:VARCHAR#,
      FLAG = #record.flag:DECIMAL#,
      PREFERENTIAL_NO = #record.preferentialNo:DECIMAL#,
      PREFERENTIAL_NAME = #record.preferentialName:VARCHAR#
    <isParameterPresent>
      <include refid="KMORDER_ORDER_ALTER_PAY_STATEMENT.ibatorgenerated_Example_Where_Clause" />
    </isParameterPresent>
  </update>
  <update id="ibatorgenerated_updateByPrimaryKeySelective" parameterClass="com.pltfm.app.entities.OrderAlterPayStatement">
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Thu Sep 05 17:33:01 CST 2013.
    -->
    update  ORDER_ALTER_PAY_STATEMENT
    <dynamic prepend="set">
      <isNotNull prepend="," property="paymentWay">
        PAYMENT_WAY = #paymentWay:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="state">
        STATE = #state:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="account">
        ACCOUNT = #account:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="orderAlterCode">
        ORDER_ALTER_CODE = #orderAlterCode:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="orderMoney">
        ORDER_MONEY = #orderMoney:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="createDate">
        CREATE_DATE = #createDate#
      </isNotNull>
      <isNotNull prepend="," property="endDate">
        END_DATE = #endDate#
      </isNotNull>
      <isNotNull prepend="," property="outsidePayStatementNo">
        OUTSIDE_PAY_STATEMENT_NO = #outsidePayStatementNo:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="flag">
        FLAG = #flag:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="preferentialNo">
        PREFERENTIAL_NO = #preferentialNo:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="preferentialName">
        PREFERENTIAL_NAME = #preferentialName:VARCHAR#
      </isNotNull>
    </dynamic>
    where PAY_STATEMENT_NO = #payStatementNo:DECIMAL#
  </update>
  <update id="ibatorgenerated_updateByPrimaryKey" parameterClass="com.pltfm.app.entities.OrderAlterPayStatement">
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Thu Sep 05 17:33:01 CST 2013.
    -->
    update  ORDER_ALTER_PAY_STATEMENT
    set PAYMENT_WAY = #paymentWay:DECIMAL#,
      STATE = #state:DECIMAL#,
      ACCOUNT = #account:VARCHAR#,
      ORDER_ALTER_CODE = #orderAlterCode:VARCHAR#,
      ORDER_MONEY = #orderMoney:DECIMAL#,
      CREATE_DATE = #createDate#,
      END_DATE = #endDate#,
      OUTSIDE_PAY_STATEMENT_NO = #outsidePayStatementNo:VARCHAR#,
      FLAG = #flag:DECIMAL#,
      PREFERENTIAL_NO = #preferentialNo:DECIMAL#,
      PREFERENTIAL_NAME = #preferentialName:VARCHAR#
    where PAY_STATEMENT_NO = #payStatementNo:DECIMAL#
  </update>
    <!-- 各种方式已退还付金额 -->
  <select id="getOrderPay" resultClass="java.math.BigDecimal" parameterClass="java.util.Map" >
  		SELECT SUM(ORDER_MONEY) FROM ORDER_ALTER_PAY_STATEMENT WHERE
  				STATE = 1 
		<isNotEmpty property="payWay">
			AND PAYMENT_WAY = #payWay#
		</isNotEmpty>  				
		<isNotEmpty property="orderAlterId">
			AND ORDER_ALTER_CODE = #orderAlterId#
		</isNotEmpty>
  </select>
    <!-- 检查是否需要补单 -->
  <select id="checkIsAdditional" resultClass="java.lang.Integer" parameterClass="java.lang.String" >
		SELECT COUNT(T.PAY_STATEMENT_NO)
		<include refid="KMORDER_ORDER_ALTER_PAY_STATEMENT.Additional_Where_Clause" />
  </select>
  <!-- 查询需要补单列表 -->
  <select id="getAdditionalList" resultMap="ibatorgenerated_BaseResultMap" parameterClass="java.lang.String" >
		SELECT T.*
		<include refid="KMORDER_ORDER_ALTER_PAY_STATEMENT.Additional_Where_Clause" />
  </select>
  
  <select id="getAlreadyRefundMoneyByPayMethod"  resultClass="java.math.BigDecimal" parameterClass="java.util.Map">
  		select abs(sum(a.order_money))
	  from order_alter_pay_statement a, order_alter b
	 where a.order_alter_code = b.order_alter_code
	 	<isNotEmpty property="payway">
	   	and a.payment_way=#payway#
	   </isNotEmpty>
	   <isNotEmpty property="orderCode">
	  	 and b.order_code = #orderCode#
	   </isNotEmpty>
  </select>
  
  	<select id="getNeedToRefundMoney" resultClass="java.math.BigDecimal" parameterClass="java.util.Map">
  		with pm as
		 (select om.order_code order_code
		    from order_main om
		   where om.parent_order_code is null
		   start with om.order_code = #orderCode#
		  connect by prior om.parent_order_code = om.order_code)
  		select nvl(reservepaidmoney.order_money, 0) -
		       nvl(reserverefundmoney.money, 0) - nvl(readyRefund.Money, 0)
		  from (select sum(abs(oaps.order_money)) money
		          from order_alter_pay_statement oaps
		         where oaps.state = 1
		         <isEmpty property="refundWay" >
		           		and oaps.payment_way = #paymentWay#
		 		</isEmpty>
				<isNotEmpty>
		           		and oaps.payment_way = #refundWay#
		 		</isNotEmpty>
		           and exists
		         (select 1
		                  from order_alter oa
		                 where oaps.order_alter_code = oa.order_alter_code
		                   and (oa.order_code = #orderCode# or exists
		                        (select 1
		                           from order_main om
		                          where oa.order_code = om.order_code
		                            and om.parent_order_code =
		                                (select nvl(omi.parent_order_code,
		                                            omi.order_code)
		                                   from order_main omi
		                                  where omi.order_code = #orderCode#))))) reserverefundmoney,
		       (select ops.order_money
		          from order_pay_statement ops
		         where ops.state = 1
		         <isEqual property="platFormCode" compareValue="3">
			            	 and payment_way = 4 and PLATFORM_CODE= '3'
			  	</isEqual>
				<isNotEqual property="platFormCode" compareValue="3">
			            	 and payment_way = #paymentWay#
				</isNotEqual>  
		           and exists
		           (select 1 from order_main m
		                 where ops.order_code =
		                       nvl(m.parent_order_code, m.order_code)
		                   and m.order_code = #orderCode#)) reservepaidmoney,
		         (select sum(abs(rr.refurn_money)) Money from refund_request rr
				 where rr.status = 0
				   and exists
				 (select 1
				          from order_pay_statement ops
				         inner join pm
				            on (ops.order_code = pm.order_code)
				         where rr.out_batch_no = ops.outside_pay_statement_no)) readyRefund
  </select>
  
   <!-- 康美通历史支付金额 -->
  <select id="getOrderPayByOrderCode" resultClass="java.math.BigDecimal" parameterClass="java.lang.String" >
       select NVL(SUM(ABS(oaps.order_money)),0) from  order_alter_pay_statement oaps where oaps.order_alter_code in
       (
          select oa.order_alter_code from  order_alter oa where oa.order_code = #orderCode# or  oa.order_code in
          (
             select om.order_code from  order_main om where om.parent_order_code = #orderCode#
          )
       )
     and oaps.payment_way = 0 and oaps.state = 1  
  </select>
</sqlMap>