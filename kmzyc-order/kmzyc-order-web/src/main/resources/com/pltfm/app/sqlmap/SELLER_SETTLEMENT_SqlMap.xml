<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="SELLER_SETTLEMENT" >
  <resultMap id="ibatorgenerated_BaseResultMap" class="com.pltfm.app.entities.SellerSettlement" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Wed Apr 15 10:27:20 CST 2015.
    -->
    <result column="SETTLEMENT_ID" property="settlementId" jdbcType="DECIMAL" />
    <result column="SETTLEMENT_NO" property="settlementNo" jdbcType="VARCHAR" />
    <result column="SELLER_ID" property="sellerId" jdbcType="DECIMAL" />
    <result column="SETTLEMENT_PERIOD" property="settlementPeriod" jdbcType="VARCHAR" />
    <result column="SETTLEMENT_CREATE_TIME" property="settlementCreateTime" jdbcType="TIMESTAMP" />
    <result column="RECEIVE_SUM" property="receiveSum" jdbcType="DECIMAL" />
    <result column="COMMISSION_SUM" property="commissionSum" jdbcType="DECIMAL" />
    <result column="FARE_SUM" property="fareSum" jdbcType="DECIMAL" />
    <result column="REFUND_FARE_SUM" property="returnFareSum" jdbcType="DECIMAL" />
    <result column="REFUND_SUM" property="refundSum" jdbcType="DECIMAL" />
    <result column="REFUND_COM_SUM" property="refundComSum" jdbcType="DECIMAL" />
    <result column="DIFF_ADJ_SUM" property="diffAdjSum" jdbcType="DECIMAL" />
    <result column="CURR_SETTLE_ACCOUNTS" property="currSettleAccounts" jdbcType="DECIMAL" />
    <result column="SETTLEMENT_STATUS" property="settlementStatus" jdbcType="DECIMAL" />
    <result column="SELLER_CONFIRMATION" property="sellerConfirmation" jdbcType="VARCHAR" />
    <result column="SERLLER_CONFIRM_TIME" property="serllerConfirmTime" jdbcType="TIMESTAMP" />
    <result column="OPERATE_CONFIRMATION" property="operateConfirmation" jdbcType="VARCHAR" />
    <result column="OPERATE_CONFIRM_TIME" property="operateConfirmTime" jdbcType="TIMESTAMP" />
    <result column="FINANCIAL_CONFIRMATION" property="financialConfirmation" jdbcType="VARCHAR" />
    <result column="FINANCIAL_CONFIRM_TIME" property="financialConfirmTime" jdbcType="TIMESTAMP" />
    <result column="SETTLEMENT_FINISH_TIME" property="settlementFinishTime" jdbcType="TIMESTAMP" />
  </resultMap>
   <resultMap id="Seller_BaseResultMap" class="com.pltfm.app.entities.SellerSettlement" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Wed Apr 15 10:27:20 CST 2015.
    -->
    <result column="SETTLEMENT_ID" property="settlementId" jdbcType="DECIMAL" />
    <result column="SETTLEMENT_NO" property="settlementNo" jdbcType="VARCHAR" />
    <result column="SELLER_ID" property="sellerId" jdbcType="DECIMAL" />
    <result column="SETTLEMENT_PERIOD" property="settlementPeriod" jdbcType="VARCHAR" />
    <result column="SETTLEMENT_CREATE_TIME" property="settlementCreateTime" jdbcType="TIMESTAMP" />
    <result column="RECEIVE_SUM" property="receiveSum" jdbcType="DECIMAL" />
    <result column="COMMISSION_SUM" property="commissionSum" jdbcType="DECIMAL" />
    <result column="FARE_SUM" property="fareSum" jdbcType="DECIMAL" />
    <result column="REFUND_FARE_SUM" property="returnFareSum" jdbcType="DECIMAL" />
    <result column="REFUND_SUM" property="refundSum" jdbcType="DECIMAL" />
    <result column="REFUND_COM_SUM" property="refundComSum" jdbcType="DECIMAL" />
    <result column="DIFF_ADJ_SUM" property="diffAdjSum" jdbcType="DECIMAL" />
    <result column="CURR_SETTLE_ACCOUNTS" property="currSettleAccounts" jdbcType="DECIMAL" />
    <result column="SETTLEMENT_STATUS" property="settlementStatus" jdbcType="DECIMAL" />
    <result column="SELLER_CONFIRMATION" property="sellerConfirmation" jdbcType="VARCHAR" />
    <result column="SERLLER_CONFIRM_TIME" property="serllerConfirmTime" jdbcType="TIMESTAMP" />
    <result column="OPERATE_CONFIRMATION" property="operateConfirmation" jdbcType="VARCHAR" />
    <result column="OPERATE_CONFIRM_TIME" property="operateConfirmTime" jdbcType="TIMESTAMP" />
    <result column="FINANCIAL_CONFIRMATION" property="financialConfirmation" jdbcType="VARCHAR" />
    <result column="FINANCIAL_CONFIRM_TIME" property="financialConfirmTime" jdbcType="TIMESTAMP" />
    <result column="SETTLEMENT_FINISH_TIME" property="settlementFinishTime" jdbcType="TIMESTAMP" />
    <result column="Corporate_Name" property="sellerName" jdbcType="VARCHAR" />
     <result column="ADDPV_SUM" property="addpvsum" jdbcType="DECIMAL" />
      <result column="RETURNPV_SUM" property="returnpvsum" jdbcType="DECIMAL" />
     
  </resultMap>

  <sql id="ibatorgenerated_Example_Where_Clause" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Wed Apr 15 10:27:20 CST 2015.
    -->
    <iterate property="oredCriteria" conjunction="or" prepend="where" removeFirstPrepend="iterate" >
      <isEqual property="oredCriteria[].valid" compareValue="true" >
        (
        <iterate prepend="and" property="oredCriteria[].criteriaWithoutValue" conjunction="and" >
          $oredCriteria[].criteriaWithoutValue[]$
        </iterate>
        <iterate prepend="and" property="oredCriteria[].criteriaWithSingleValue" conjunction="and" >
          $oredCriteria[].criteriaWithSingleValue[].condition$
            #oredCriteria[].criteriaWithSingleValue[].value#
        </iterate>
        <iterate prepend="and" property="oredCriteria[].criteriaWithListValue" conjunction="and" >
          $oredCriteria[].criteriaWithListValue[].condition$
          <iterate property="oredCriteria[].criteriaWithListValue[].values" open="(" close=")" conjunction="," >
            #oredCriteria[].criteriaWithListValue[].values[]#
          </iterate>
        </iterate>
        <iterate prepend="and" property="oredCriteria[].criteriaWithBetweenValue" conjunction="and" >
          $oredCriteria[].criteriaWithBetweenValue[].condition$
          #oredCriteria[].criteriaWithBetweenValue[].values[0]# and
          #oredCriteria[].criteriaWithBetweenValue[].values[1]#
        </iterate>
        )
      </isEqual>
    </iterate>
  </sql>
  <select id="ibatorgenerated_selectByExample" resultMap="ibatorgenerated_BaseResultMap" parameterClass="com.pltfm.app.entities.SellerSettlementExample" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Wed Apr 15 10:27:20 CST 2015.
    -->
    select SETTLEMENT_ID, SETTLEMENT_NO, SELLER_ID, SETTLEMENT_PERIOD, SETTLEMENT_CREATE_TIME,
      RECEIVE_SUM, COMMISSION_SUM, FARE_SUM, REFUND_FARE_SUM, REFUND_SUM, REFUND_COM_SUM, DIFF_ADJ_SUM,
      CURR_SETTLE_ACCOUNTS, SETTLEMENT_STATUS, SELLER_CONFIRMATION, SERLLER_CONFIRM_TIME,
      OPERATE_CONFIRMATION, OPERATE_CONFIRM_TIME, FINANCIAL_CONFIRMATION, FINANCIAL_CONFIRM_TIME,
      SETTLEMENT_FINISH_TIME
    from SELLER_SETTLEMENT
    <isParameterPresent >
      <include refid="SELLER_SETTLEMENT.ibatorgenerated_Example_Where_Clause" />
      <isNotNull property="orderByClause" >
        order by $orderByClause$
      </isNotNull>
    </isParameterPresent>
  </select>
  <select id="ibatorgenerated_selectByPrimaryKey" resultMap="ibatorgenerated_BaseResultMap" parameterClass="com.pltfm.app.entities.SellerSettlement" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Wed Apr 15 10:27:20 CST 2015.
    -->
    select SETTLEMENT_ID, SETTLEMENT_NO, SELLER_ID, SETTLEMENT_PERIOD, SETTLEMENT_CREATE_TIME,
      RECEIVE_SUM, COMMISSION_SUM, FARE_SUM, REFUND_FARE_SUM, REFUND_SUM, REFUND_COM_SUM, DIFF_ADJ_SUM,
      CURR_SETTLE_ACCOUNTS, SETTLEMENT_STATUS, SELLER_CONFIRMATION, SERLLER_CONFIRM_TIME,
      OPERATE_CONFIRMATION, OPERATE_CONFIRM_TIME, FINANCIAL_CONFIRMATION, FINANCIAL_CONFIRM_TIME,
      SETTLEMENT_FINISH_TIME
    from SELLER_SETTLEMENT
    where SETTLEMENT_ID = #settlementId:DECIMAL#
  </select>
  <delete id="ibatorgenerated_deleteByPrimaryKey" parameterClass="com.pltfm.app.entities.SellerSettlement" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Wed Apr 15 10:27:20 CST 2015.
    -->
    delete from SELLER_SETTLEMENT
    where SETTLEMENT_ID = #settlementId:DECIMAL#
  </delete>
  <delete id="ibatorgenerated_deleteByExample" parameterClass="com.pltfm.app.entities.SellerSettlementExample" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Wed Apr 15 10:27:20 CST 2015.
    -->
    delete from SELLER_SETTLEMENT
    <include refid="SELLER_SETTLEMENT.ibatorgenerated_Example_Where_Clause" />
  </delete>
  <insert id="ibatorgenerated_insert" parameterClass="com.pltfm.app.entities.SellerSettlement" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Wed Apr 15 10:27:20 CST 2015.
    -->
    <selectKey resultClass="java.lang.Long" keyProperty="settlementId" >
      SELECT SEQ_SELLER_SETTLEMENT_ID.NEXTVAL FROM DUAL
    </selectKey>
    insert into SELLER_SETTLEMENT (SETTLEMENT_ID,SETTLEMENT_NO, SELLER_ID, SETTLEMENT_PERIOD,
      SETTLEMENT_CREATE_TIME, RECEIVE_SUM, COMMISSION_SUM, FARE_SUM, REFUND_FARE_SUM, REFUND_SUM, REFUND_COM_SUM,
      DIFF_ADJ_SUM, CURR_SETTLE_ACCOUNTS, SETTLEMENT_STATUS, SELLER_CONFIRMATION,
      SERLLER_CONFIRM_TIME, OPERATE_CONFIRMATION, OPERATE_CONFIRM_TIME, FINANCIAL_CONFIRMATION,
      FINANCIAL_CONFIRM_TIME, SETTLEMENT_FINISH_TIME,ADDPV_SUM,RETURNPV_SUM)
      <!-- 指定结算单号生成模式  -->
    values (#settlementId:DECIMAL#,replace(lpad(SEQ_SETTLEMENT_NO.nextval,12),' ','0'), 
      #sellerId:DECIMAL#, #settlementPeriod:VARCHAR#,
      #settlementCreateTime:TIMESTAMP#, #receiveSum:DECIMAL#, #commissionSum:DECIMAL#, #fareSum:DECIMAL#,
      #returnFareSum:DECIMAL#,#refundSum:DECIMAL#, #refundComSum:DECIMAL#, #diffAdjSum:DECIMAL#,
      #currSettleAccounts:DECIMAL#, #settlementStatus:DECIMAL#, #sellerConfirmation:VARCHAR#,
      #serllerConfirmTime:TIMESTAMP#, #operateConfirmation:VARCHAR#, #operateConfirmTime:TIMESTAMP#,
      #financialConfirmation:VARCHAR#, #financialConfirmTime:TIMESTAMP#, #settlementFinishTime:TIMESTAMP#,
      #addpvsum:DECIMAL#, #returnpvsum:DECIMAL#)
  </insert>
  <insert id="ibatorgenerated_insertSelective" parameterClass="com.pltfm.app.entities.SellerSettlement" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Wed Apr 15 10:27:20 CST 2015.
    -->
    insert into SELLER_SETTLEMENT
    <dynamic prepend="(" >
      <isNotNull prepend="," property="settlementId" >
        SETTLEMENT_ID
      </isNotNull>
      <isNotNull prepend="," property="settlementNo" >
        SETTLEMENT_NO
      </isNotNull>
      <isNotNull prepend="," property="sellerId" >
        SELLER_ID
      </isNotNull>
      <isNotNull prepend="," property="settlementPeriod" >
        SETTLEMENT_PERIOD
      </isNotNull>
      <isNotNull prepend="," property="settlementCreateTime" >
        SETTLEMENT_CREATE_TIME
      </isNotNull>
      <isNotNull prepend="," property="receiveSum" >
        RECEIVE_SUM
      </isNotNull>
      <isNotNull prepend="," property="commissionSum" >
        COMMISSION_SUM
      </isNotNull>
      <isNotNull prepend="," property="fareSum" >
        FARE_SUM
      </isNotNull>
      <isNotNull prepend="," property="returnFareSum" >
        REFUND_FARE_SUM
      </isNotNull>
      <isNotNull prepend="," property="refundSum" >
        REFUND_SUM
      </isNotNull>
      <isNotNull prepend="," property="refundComSum" >
        REFUND_COM_SUM
      </isNotNull>
      <isNotNull prepend="," property="diffAdjSum" >
        DIFF_ADJ_SUM
      </isNotNull>
      <isNotNull prepend="," property="currSettleAccounts" >
        CURR_SETTLE_ACCOUNTS
      </isNotNull>
      <isNotNull prepend="," property="settlementStatus" >
        SETTLEMENT_STATUS
      </isNotNull>
      <isNotNull prepend="," property="sellerConfirmation" >
        SELLER_CONFIRMATION
      </isNotNull>
      <isNotNull prepend="," property="serllerConfirmTime" >
        SERLLER_CONFIRM_TIME
      </isNotNull>
      <isNotNull prepend="," property="operateConfirmation" >
        OPERATE_CONFIRMATION
      </isNotNull>
      <isNotNull prepend="," property="operateConfirmTime" >
        OPERATE_CONFIRM_TIME
      </isNotNull>
      <isNotNull prepend="," property="financialConfirmation" >
        FINANCIAL_CONFIRMATION
      </isNotNull>
      <isNotNull prepend="," property="financialConfirmTime" >
        FINANCIAL_CONFIRM_TIME
      </isNotNull>
      <isNotNull prepend="," property="settlementFinishTime" >
        SETTLEMENT_FINISH_TIME
      </isNotNull>
      <isNotNull prepend="," property="addpvsum" >
        ADDPV_SUM
      </isNotNull>
      <isNotNull prepend="," property="returnpvsum" >
        RETURNPV_SUM
      </isNotNull>
      )
    </dynamic>
    values
    <dynamic prepend="(" >
      <isNotNull prepend="," property="settlementId" >
        #settlementId:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="settlementNo" >
        #settlementNo:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="sellerId" >
        #sellerId:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="settlementPeriod" >
        #settlementPeriod:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="settlementCreateTime" >
        #settlementCreateTime:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="receiveSum" >
        #receiveSum:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="commissionSum" >
        #commissionSum:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="fareSum" >
        #fareSum:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="returnFareSum" >
        #returnFareSum:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="refundSum" >
        #refundSum:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="refundComSum" >
        #refundComSum:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="diffAdjSum" >
        #diffAdjSum:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="currSettleAccounts" >
        #currSettleAccounts:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="settlementStatus" >
        #settlementStatus:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="sellerConfirmation" >
        #sellerConfirmation:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="serllerConfirmTime" >
        #serllerConfirmTime:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="operateConfirmation" >
        #operateConfirmation:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="operateConfirmTime" >
        #operateConfirmTime:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="financialConfirmation" >
        #financialConfirmation:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="financialConfirmTime" >
        #financialConfirmTime:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="settlementFinishTime" >
        #settlementFinishTime:TIMESTAMP#
      </isNotNull>
       <isNotNull prepend="," property="addpvsum" >
        #addpvsum:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="returnpvsum" >
        #returnpvsum:DECIMAL#
      </isNotNull>
      )
    </dynamic>
    <selectKey resultClass="java.lang.Long" keyProperty="settlementId" >
      SELECT SEQ_SELLER_SETTLEMENT_ID.NEXTVAL FROM DUAL
    </selectKey>
  </insert>
  <select id="ibatorgenerated_countByExample" parameterClass="com.pltfm.app.entities.SellerSettlementExample" resultClass="java.lang.Integer" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Wed Apr 15 10:27:20 CST 2015.
    -->
    select count(*) from SELLER_SETTLEMENT
    <include refid="SELLER_SETTLEMENT.ibatorgenerated_Example_Where_Clause" />
  </select>
  <update id="ibatorgenerated_updateByExampleSelective" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Wed Apr 15 10:27:20 CST 2015.
    -->
    update SELLER_SETTLEMENT
    <dynamic prepend="set" >
    <!--   <isNotNull prepend="," property="record.settlementId" >
        SETTLEMENT_ID = #record.settlementId:DECIMAL#
      </isNotNull> -->
      <isNotNull prepend="," property="record.settlementNo" >
        SETTLEMENT_NO = #record.settlementNo:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.sellerId" >
        SELLER_ID = #record.sellerId:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="record.settlementPeriod" >
        SETTLEMENT_PERIOD = #record.settlementPeriod:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.settlementCreateTime" >
        SETTLEMENT_CREATE_TIME = #record.settlementCreateTime:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="record.receiveSum" >
        RECEIVE_SUM = #record.receiveSum:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="record.commissionSum" >
        COMMISSION_SUM = #record.commissionSum:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="record.fareSum" >
        FARE_SUM = #record.fareSum:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="record.returnFareSum" >
        REFUND_FARE_SUM = #record.returnFareSum:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="record.refundSum" >
        REFUND_SUM = #record.refundSum:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="record.refundComSum" >
        REFUND_COM_SUM = #record.refundComSum:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="record.diffAdjSum" >
        DIFF_ADJ_SUM = #record.diffAdjSum:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="record.currSettleAccounts" >
        CURR_SETTLE_ACCOUNTS = #record.currSettleAccounts:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="record.settlementStatus" >
        SETTLEMENT_STATUS = #record.settlementStatus:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="record.sellerConfirmation" >
        SELLER_CONFIRMATION = #record.sellerConfirmation:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.serllerConfirmTime" >
        SERLLER_CONFIRM_TIME = #record.serllerConfirmTime:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="record.operateConfirmation" >
        OPERATE_CONFIRMATION = #record.operateConfirmation:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.operateConfirmTime" >
        OPERATE_CONFIRM_TIME = #record.operateConfirmTime:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="record.financialConfirmation" >
        FINANCIAL_CONFIRMATION = #record.financialConfirmation:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.financialConfirmTime" >
        FINANCIAL_CONFIRM_TIME = #record.financialConfirmTime:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="record.settlementFinishTime" >
        SETTLEMENT_FINISH_TIME = #record.settlementFinishTime:TIMESTAMP#
      </isNotNull>
    </dynamic>
    <isParameterPresent >
      <include refid="SELLER_SETTLEMENT.ibatorgenerated_Example_Where_Clause" />
    </isParameterPresent>
  </update>
  <update id="ibatorgenerated_updateByExample" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Wed Apr 15 10:27:20 CST 2015.
    -->
    update SELLER_SETTLEMENT
    set SETTLEMENT_ID = #record.settlementId:DECIMAL#,
      SETTLEMENT_NO = #record.settlementNo:VARCHAR#,
      SELLER_ID = #record.sellerId:DECIMAL#,
      SETTLEMENT_PERIOD = #record.settlementPeriod:VARCHAR#,
      SETTLEMENT_CREATE_TIME = #record.settlementCreateTime:TIMESTAMP#,
      RECEIVE_SUM = #record.receiveSum:DECIMAL#,
      COMMISSION_SUM = #record.commissionSum:DECIMAL#,
      FARE_SUM = #record.fareSum:DECIMAL#,
      REFUND_FARE_SUM = #record.returnFareSum:DECIMAL#,
      REFUND_SUM = #record.refundSum:DECIMAL#,
      REFUND_COM_SUM = #record.refundComSum:DECIMAL#,
      DIFF_ADJ_SUM = #record.diffAdjSum:DECIMAL#,
      CURR_SETTLE_ACCOUNTS = #record.currSettleAccounts:DECIMAL#,
      SETTLEMENT_STATUS = #record.settlementStatus:DECIMAL#,
      SELLER_CONFIRMATION = #record.sellerConfirmation:VARCHAR#,
      SERLLER_CONFIRM_TIME = #record.serllerConfirmTime:TIMESTAMP#,
      OPERATE_CONFIRMATION = #record.operateConfirmation:VARCHAR#,
      OPERATE_CONFIRM_TIME = #record.operateConfirmTime:TIMESTAMP#,
      FINANCIAL_CONFIRMATION = #record.financialConfirmation:VARCHAR#,
      FINANCIAL_CONFIRM_TIME = #record.financialConfirmTime:TIMESTAMP#,
      SETTLEMENT_FINISH_TIME = #record.settlementFinishTime:TIMESTAMP#
    <isParameterPresent >
      <include refid="SELLER_SETTLEMENT.ibatorgenerated_Example_Where_Clause" />
    </isParameterPresent>
  </update>
  <update id="ibatorgenerated_updateByPrimaryKeySelective" parameterClass="com.pltfm.app.entities.SellerSettlement" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Wed Apr 15 10:27:20 CST 2015.
    -->
    update SELLER_SETTLEMENT
    <dynamic prepend="set" >
      <isNotNull prepend="," property="settlementNo" >
        SETTLEMENT_NO = #settlementNo:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="sellerId" >
        SELLER_ID = #sellerId:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="settlementPeriod" >
        SETTLEMENT_PERIOD = #settlementPeriod:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="settlementCreateTime" >
        SETTLEMENT_CREATE_TIME = #settlementCreateTime:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="receiveSum" >
        RECEIVE_SUM = #receiveSum:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="commissionSum" >
        COMMISSION_SUM = #commissionSum:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="fareSum" >
        FARE_SUM = #fareSum:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="returnFareSum" >
        REFUND_FARE_SUM = #returnFareSum:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="refundSum" >
        REFUND_SUM = #refundSum:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="refundComSum" >
        REFUND_COM_SUM = #refundComSum:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="diffAdjSum" >
        DIFF_ADJ_SUM = #diffAdjSum:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="currSettleAccounts" >
        CURR_SETTLE_ACCOUNTS = #currSettleAccounts:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="settlementStatus" >
        SETTLEMENT_STATUS = #settlementStatus:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="sellerConfirmation" >
        SELLER_CONFIRMATION = #sellerConfirmation:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="serllerConfirmTime" >
        SERLLER_CONFIRM_TIME = #serllerConfirmTime:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="operateConfirmation" >
        OPERATE_CONFIRMATION = #operateConfirmation:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="operateConfirmTime" >
        OPERATE_CONFIRM_TIME = #operateConfirmTime:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="financialConfirmation" >
        FINANCIAL_CONFIRMATION = #financialConfirmation:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="financialConfirmTime" >
        FINANCIAL_CONFIRM_TIME = #financialConfirmTime:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="settlementFinishTime" >
        SETTLEMENT_FINISH_TIME = #settlementFinishTime:TIMESTAMP#
      </isNotNull>
    </dynamic>
    where SETTLEMENT_ID = #settlementId:DECIMAL#
  </update>
  <update id="ibatorgenerated_updateByPrimaryKey" parameterClass="com.pltfm.app.entities.SellerSettlement" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Wed Apr 15 10:27:20 CST 2015.
    -->
    update SELLER_SETTLEMENT
    set SETTLEMENT_NO = #settlementNo:VARCHAR#,
      SELLER_ID = #sellerId:DECIMAL#,
      SETTLEMENT_PERIOD = #settlementPeriod:VARCHAR#,
      SETTLEMENT_CREATE_TIME = #settlementCreateTime:TIMESTAMP#,
      RECEIVE_SUM = #receiveSum:DECIMAL#,
      COMMISSION_SUM = #commissionSum:DECIMAL#,
      FARE_SUM = #fareSum:DECIMAL#,
      REFUND_FARE_SUM = #returnFareSum:DECIMAL#,
      REFUND_SUM = #refundSum:DECIMAL#,
      REFUND_COM_SUM = #refundComSum:DECIMAL#,
      DIFF_ADJ_SUM = #diffAdjSum:DECIMAL#,
      CURR_SETTLE_ACCOUNTS = #currSettleAccounts:DECIMAL#,
      SETTLEMENT_STATUS = #settlementStatus:DECIMAL#,
      SELLER_CONFIRMATION = #sellerConfirmation:VARCHAR#,
      SERLLER_CONFIRM_TIME = #serllerConfirmTime:TIMESTAMP#,
      OPERATE_CONFIRMATION = #operateConfirmation:VARCHAR#,
      OPERATE_CONFIRM_TIME = #operateConfirmTime:TIMESTAMP#,
      FINANCIAL_CONFIRMATION = #financialConfirmation:VARCHAR#,
      FINANCIAL_CONFIRM_TIME = #financialConfirmTime:TIMESTAMP#,
      SETTLEMENT_FINISH_TIME = #settlementFinishTime:TIMESTAMP#
    where SETTLEMENT_ID = #settlementId:DECIMAL#
  </update>
  <!-- 修改运营确认 -->
  <update id="ibatorgenerated_updateOperate"  parameterClass="com.pltfm.app.entities.SellerSettlement">
    update SELLER_SETTLEMENT
    set 
     <isGreaterThan property="settlementStatus" compareValue="0" >
     	 SETTLEMENT_STATUS = #settlementStatus#,
      </isGreaterThan>
      OPERATE_CONFIRMATION = #operateConfirmation#,
      OPERATE_CONFIRM_TIME = #operateConfirmTime#
      where SETTLEMENT_NO = #settlementNo#
  </update>
   <!-- 修改商家确认 -->
  <update id="ibatorgenerated_updateSellerConfirmation" parameterClass="com.pltfm.app.entities.SellerSettlement">
    update SELLER_SETTLEMENT
    set 
     SETTLEMENT_STATUS = 2,
    	SELLER_CONFIRMATION = #sellerConfirmation:VARCHAR#,
      SERLLER_CONFIRM_TIME = #serllerConfirmTime:TIMESTAMP#
      where SETTLEMENT_NO = #settlementNo#
      and
       SELLER_ID = #sellerId:DECIMAL#
  </update>
  
    <!-- 修改财务确认 -->
  <update id="ibatorgenerated_updateFinancialConfirmation" parameterClass="com.pltfm.app.entities.SellerSettlement">
    update SELLER_SETTLEMENT
    set 
     SETTLEMENT_STATUS = #settlementStatus#,
     FINANCIAL_CONFIRMATION = #financialConfirmation:VARCHAR#,
      FINANCIAL_CONFIRM_TIME = #financialConfirmTime:TIMESTAMP#
      where SETTLEMENT_NO = #settlementNo#
     
  </update>
  
   <!--
      	查询结算单列表
    -->
   <select id="selectSettlementList" resultMap="Seller_BaseResultMap" parameterClass="com.pltfm.app.entities.SellerSettlementCriteria" >
   
   
		select b.* from(
			select a.*,rownum rn from(
				       select s.SETTLEMENT_ID, s.SETTLEMENT_NO, s.SELLER_ID, s.SETTLEMENT_PERIOD, s.SETTLEMENT_CREATE_TIME,
				      s.RECEIVE_SUM, s.COMMISSION_SUM, s.FARE_SUM, s.REFUND_FARE_SUM, s.REFUND_SUM, s.REFUND_COM_SUM, s.DIFF_ADJ_SUM,
				      s.CURR_SETTLE_ACCOUNTS, s.SETTLEMENT_STATUS, s.SELLER_CONFIRMATION, s.SERLLER_CONFIRM_TIME,
				      s.OPERATE_CONFIRMATION, s.OPERATE_CONFIRM_TIME, s.FINANCIAL_CONFIRMATION, s.FINANCIAL_CONFIRM_TIME,
				      s.SETTLEMENT_FINISH_TIME,s.ADDPV_SUM,s.RETURNPV_SUM,t.Corporate_Name
				    from SELLER_SETTLEMENT s
				       LEFT JOIN
				      COMMERCIAL_TENANT_BASIC_INFO t
				    on s.seller_id = t.n_commercial_tenant_id
				    where 1=1
				    
				     <isNotEmpty property="settlementNo" >
				   		 	 and  s.SETTLEMENT_NO = #settlementNo#	
				      </isNotEmpty>
				      <isNotEmpty property="sellerName" >
				        	 and t.Corporate_Name like '%'||#sellerName#||'%' 
				      </isNotEmpty>
				      <!--  <isNotNull property="startDate" >
				        	and s.SETTLEMENT_CREATE_TIME >= #startDate#
				      </isNotNull>
				       <isNotNull property="endDate" >
				     		 <![CDATA[ 	and s.SETTLEMENT_CREATE_TIME < #endDate#	]]>
				      </isNotNull> -->
		      			 <isNotEmpty property="sellerId" >
							     and s.seller_id = #sellerId#
						</isNotEmpty> 
					    <isNotEmpty property="settlementStatus" >
					    
					     and s.SETTLEMENT_STATUS = #settlementStatus#    
					    
					     </isNotEmpty>
					    <isNotEmpty property="loginId" >
				        	 and t.N_LOGIN_ID = #loginId#
				      </isNotEmpty>
				      <isNotEmpty property="minMoney">
				      		and (s.CURR_SETTLE_ACCOUNTS+s.DIFF_ADJ_SUM) &gt;= #minMoney#
				      </isNotEmpty> 
				      <isNotEmpty property="maxMoney">
				      		and (s.CURR_SETTLE_ACCOUNTS+s.DIFF_ADJ_SUM) &lt;= #maxMoney#
				      </isNotEmpty>
				    <isNotEmpty property="inPeriods">
							and s.settlement_period in
						<iterate property="inPeriods" open="(" close=")" conjunction="," >
				            #inPeriods[]#
			           </iterate>
					</isNotEmpty>
					<isNotEmpty property="statuses">
							and s.SETTLEMENT_STATUS in
						<iterate property="statuses" open="(" close=")" conjunction="," >
				            #statuses[]#
			           </iterate>
					</isNotEmpty>     
					     
					     
				    order by SETTLEMENT_ID desc
		   <![CDATA[		    
			  )a where ROWNUM  <= #endIndex#
		)  b where rn > #startIndex#
		]]>
    
  	</select>
		  <select id="selectSettlementListSize" resultClass="java.lang.Integer" parameterClass="com.pltfm.app.entities.SellerSettlementCriteria" >
			select count(*)
			from SELLER_SETTLEMENT s
			LEFT JOIN
			  COMMERCIAL_TENANT_BASIC_INFO t
			on s.seller_id = t.n_commercial_tenant_id
			where 1=1
		
			<isNotEmpty property="settlementNo">
				and s.SETTLEMENT_NO = #settlementNo#
			</isNotEmpty>
			<isNotEmpty property="sellerName">
				and t.Corporate_Name like '%'||#sellerName#||'%'
			</isNotEmpty>
			<!-- <isNotNull property="startDate">
				and s.SETTLEMENT_CREATE_TIME >= #startDate#
			</isNotNull>
			<isNotNull property="endDate">
				 <![CDATA[ 	and s.SETTLEMENT_CREATE_TIME < #endDate#	]]>
			</isNotNull>
 -->			<isNotEmpty property="settlementStatus">
				and s.SETTLEMENT_STATUS = #settlementStatus#
			</isNotEmpty>
			 <isNotEmpty property="loginId" >
				     and t.N_LOGIN_ID = #loginId#
			</isNotEmpty>
			 <isNotEmpty property="minMoney">
		      		and (s.CURR_SETTLE_ACCOUNTS+s.DIFF_ADJ_SUM) &gt;= #minMoney#
		     </isNotEmpty> 
		     <isNotEmpty property="maxMoney">
		      		and (s.CURR_SETTLE_ACCOUNTS+s.DIFF_ADJ_SUM) &lt;= #maxMoney#
		     </isNotEmpty> 
			 <isNotEmpty property="sellerId" >
				     and s.seller_id = #sellerId#
			</isNotEmpty> 
			<isNotEmpty property="inPeriods">
					and s.settlement_period in
				<iterate property="inPeriods" open="(" close=")" conjunction="," >
		            #inPeriods[]#
	           </iterate>
			</isNotEmpty>
			<isNotEmpty property="statuses">
					and s.SETTLEMENT_STATUS in
				<iterate property="statuses" open="(" close=")" conjunction="," >
		            #statuses[]#
	           </iterate>
			</isNotEmpty>
			
  </select>
  
  <!-- 结算 详情 -->
   <select id="getSettlementByNo" resultMap="Seller_BaseResultMap" parameterClass="com.pltfm.app.entities.SellerSettlementCriteria" >
			 select s.SETTLEMENT_ID, s.SETTLEMENT_NO, s.SELLER_ID, s.SETTLEMENT_PERIOD, s.SETTLEMENT_CREATE_TIME,
				      s.RECEIVE_SUM, s.COMMISSION_SUM, s.FARE_SUM, s.REFUND_FARE_SUM, s.REFUND_SUM, s.REFUND_COM_SUM, s.DIFF_ADJ_SUM,
				      s.CURR_SETTLE_ACCOUNTS, s.SETTLEMENT_STATUS, s.SELLER_CONFIRMATION, s.SERLLER_CONFIRM_TIME,
				      s.OPERATE_CONFIRMATION, s.OPERATE_CONFIRM_TIME, s.FINANCIAL_CONFIRMATION, s.FINANCIAL_CONFIRM_TIME,
				      s.SETTLEMENT_FINISH_TIME,s.ADDPV_SUM,s.RETURNPV_SUM,t.Corporate_Name 
				    from SELLER_SETTLEMENT s
				       LEFT JOIN
				      COMMERCIAL_TENANT_BASIC_INFO t
				    on s.seller_id = t.n_commercial_tenant_id
				    where  s.SETTLEMENT_NO = #settlementNo#
  </select>
  <!-- 结算  店铺名 -->
	<select id="getSellerShopName" resultClass="String" parameterClass="com.pltfm.app.entities.SellerSettlementCriteria" >
			select nvl(sm.shop_name,
				(select ctbi.corporate_name 	from   commercial_tenant_basic_info ctbi where ctbi.n_commercial_tenant_id = si.merchant_id))
				from   suppliers_info si 
        left join (select smi.supplier_id, smi.shop_name from  shop_main smi 	where smi.audit_status = 2) sm
				on (sm.supplier_id = si.supplier_id)
				where 	  si.merchant_id = #sellerId#
  </select>
  
  	
	 <!-- 结算单所需数据查询 start -->

	<resultMap class="java.util.HashMap" id="settle_map">
		<result property="ttsshz" column="ttsshz" jdbcType="DECIMAL"/>
		<result property="ttyjhz" column="ttyjhz" jdbcType="DECIMAL"/>
		<result property="returnmoney" column="returnmoney" jdbcType="DECIMAL"/>
		<result property="fare" column="fare" jdbcType="DECIMAL"/>
		<result property="returnFareSum" column="refundfaresum" jdbcType="DECIMAL"/>
		<result property="returncommission" column="returncommission" jdbcType="DECIMAL"/>
		<result property="addpvsum" column="addpvsum" jdbcType="DECIMAL"/>
		<result property="returnpvsum" column="returnpvsum" jdbcType="DECIMAL"/>
	</resultMap>
	<resultMap class="java.util.HashMap" id="settle_map_alter">
		<result property="tkjehz" column="tkjehz" jdbcType="DECIMAL"/>
		<result property="tkyjhz" column="tkyjhz" jdbcType="DECIMAL"/>
	</resultMap>

	<sql id="settle_data">
		<isNotEmpty property="sellerId">
			and si.merchant_id = #sellerId#
		</isNotEmpty>
		<isNotEmpty property="finishDate">
			and om.finish_date between
			<iterate property="finishDate" conjunction="and">
				#finishDate[]#
			</iterate>
		</isNotEmpty>
	</sql>
	<sql id="settle_no">
		<isNotEmpty property="sellerId">
			AND SM.SELLER_ID = #sellerId#
		</isNotEmpty>
		<isNotEmpty property="smPeriod">
			AND SM.SETTLEMENT_PERIOD = #smPeriod#
		</isNotEmpty>
	</sql>

	<!-- 妥投、退款汇总、超时未支付尾款查询 -->
	<!-- 结合版 -->
	<select id="ibatorgenerated_selectByMapForSettle" resultMap="settle_map"
		parameterClass="java.util.Map">
		select SUM(ttsshz) ttsshz,
	       SUM(ttyjhz) ttyjhz,
	       SUM(returnmoney) returnmoney,
	       SUM(refund_fare_sum) refundfaresum,
	       SUM(fare) fare,
	       SUM(returncommission) returncommission,
	       SUM(addpv)  addpvsum,
           SUM(returnpv) returnpvsum
 		 from (
 		 SELECT
               sum((select sum(oi.COMMODITY_UNIT_INCOMING * oi.commodity_number) from  order_item oi where OI.ORDER_CODE = OM.ORDER_CODE  ))  ttsshz,
			   sum((select sum(round(oi.commission_rate * oi.commodity_unit_incoming *oi.commodity_number,2)) from  order_item oi where OI.ORDER_CODE = OM.ORDER_CODE))  ttyjhz,
               0 returnmoney,
               0 refund_fare_sum,
               sum(nvl(om.fare,0)) fare,
               0 returncommission,
               sum(nvl(om.order_pv,0)) addpv,
               0 returnpv
          FROM  ORDER_MAIN OM
          JOIN  suppliers_info si ON si.supplier_id=om.commerce_id         
         WHERE OM.ORDER_STATUS = 6
        <isParameterPresent>
			<include refid="SELLER_SETTLEMENT.settle_data" />
		</isParameterPresent>
		
		union
		SELECT
           sum(oi.DEPOSIT * oi.commodity_number)  ttsshz,
           sum(round(oi.commission_rate * oi.DEPOSIT *oi.commodity_number,2))  ttyjhz,          
           0 returnmoney,
           0 refund_fare_sum,
           0 fare,
           0 returncommission,
           sum(nvl(om.order_pv,0)) addpv,
           0 returnpv
        FROM  ORDER_MAIN OM
          inner JOIN  suppliers_info si ON si.supplier_id=om.commerce_id
          inner join  order_item oi on oi.order_code=om.order_code
          inner join  promotion_presell pp on oi.presell_id=pp.presell_id         
         WHERE OM.ORDER_STATUS = 23 AND si.merchant_id=#sellerId#
         and pp.finalpay_end_time between         
			<iterate property="finishDate" conjunction="and">
				#finishDate[]#
			</iterate>
		
		
        union
          SELECT 0 ttsshz,
               0 ttyjhz,
               SUM(abs(nvl(oa.ruturn_money,0))) returnmoney,
               SUM(abs(nvl(oa.return_fare,0))) refund_fare_sum,
               0 fare,
               sum(round(oi.commission_rate * oa.ruturn_money,2)) returncommission,
               0 addpv,
               sum(round(oi.Commodity_Pv * oa.alter_num,2)) returnpv
          FROM ORDER_MAIN OM
          JOIN  suppliers_info si ON si.supplier_id=om.commerce_id
          <!-- JOIN   COMMERCIAL_TENANT_BASIC_INFO t ON t.n_commercial_tenant_id=si.merchant_id -->
           JOIN order_item oi ON OI.ORDER_CODE = OM.ORDER_CODE
          JOIN order_alter oa
            ON oi.order_item_id=oa.order_item_id 
         WHERE  OA.PROPOSE_STATUS=7         
          <!-- AND NOT EXISTS(SELECT 1 FROM  SPREAD_EFFECT SE WHERE SE.ORDER_ITEM_ID=oi.ORDER_ITEM_ID) -->
         AND EXISTS(SELECT 1 FROM  ORDER_ALTER_PAY_STATEMENT OAPS 
	       WHERE OAPS.ORDER_ALTER_CODE=OA.ORDER_ALTER_CODE
	       AND OAPS.FLAG=2)
	       and si.merchant_id=#sellerId#
	       AND OA.FINISH_DATE  between
			<iterate property="finishDate" conjunction="and">
				#finishDate[]#
			</iterate>
       		)           
	</select>
	<!-- 插入妥投商品明细表所需数据 -->
	<insert id="ibatorgenerated_insertSettleDataDetail" parameterClass="java.util.Map">
		INSERT INTO HURL_PRODUCT(SETTLEMENT_HURL_ID,SETTLEMENT_NO,ORDER_CODE,SKU_NO,PRODUCT_TILE,IN_SUIT,COMMODITY_NUMBER,RECEIVE_SUB,COMMISSION_RATE,COMMISSION,SETTLEMENT_TIME,SETTLE_ACCOUNTS,COMMODITY_PV_SUM)
		 SELECT SEQ_HURL_PRODUCT_ID.NEXTVAL, 
		 #settlementNo#,
		 OI.ORDER_CODE,
         OI.COMMODITY_SKU,
         OI.COMMODITY_TITLE || OI.COMMODITY_SKU_DESCRIPTION,
         decode(OI.SUIT_ID, null, 0, 1),  
         OI.COMMODITY_NUMBER,
         OI.COMMODITY_UNIT_INCOMING * OI.COMMODITY_NUMBER,
         OI.COMMISSION_RATE,
         ROUND(NVL(oi.commission_rate * oi.commodity_unit_incoming *
             oi.commodity_number,
             0),2),
         OM.FINISH_DATE,
         OI.COMMODITY_UNIT_INCOMING * OI.COMMODITY_NUMBER - ROUND(NVL(oi.commission_rate * oi.commodity_unit_incoming *
             oi.commodity_number,0),2)-ROUND(NVL(OI.COMMODITY_PV*OI.COMMODITY_NUMBER,0),2),
         ROUND(NVL(OI.COMMODITY_PV*OI.COMMODITY_NUMBER,0),2)   
	    FROM order_item oi
	    JOIN ORDER_MAIN OM ON OI.ORDER_CODE = OM.ORDER_CODE
	    JOIN  suppliers_info si ON si.supplier_id=om.commerce_id        
	   WHERE OM.ORDER_STATUS = 6		
		<!--  JOIN   COMMERCIAL_TENANT_BASIC_INFO t ON t.n_commercial_tenant_id=si.merchant_id -->
		<!-- 排除创8的单:当某单既包含微商，又包含非微商单时，运费全计供应商承担 
	 	AND NOT EXISTS (SELECT 1 FROM  SPREAD_EFFECT SE WHERE SE.ORDER_ITEM_ID=OI.ORDER_ITEM_ID)-->
		<isParameterPresent>
			<include refid="SELLER_SETTLEMENT.settle_data" />
		</isParameterPresent>		
	</insert>
	<!-- 插入妥投商品明细表所需数据(预售超时未支付尾款) -->
	<insert id="ibatorgenerated_insertSettleDataDetailForPresell" parameterClass="java.util.Map">
		INSERT INTO HURL_PRODUCT(SETTLEMENT_HURL_ID,SETTLEMENT_NO,ORDER_CODE,SKU_NO,PRODUCT_TILE,IN_SUIT,COMMODITY_NUMBER,RECEIVE_SUB,COMMISSION_RATE,COMMISSION,SETTLEMENT_TIME,SETTLE_ACCOUNTS,COMMODITY_PV_SUM)
		 SELECT SEQ_HURL_PRODUCT_ID.NEXTVAL, 
		 #settlementNo#,
		 OI.ORDER_CODE,
         OI.COMMODITY_SKU,
         OI.COMMODITY_TITLE || OI.COMMODITY_SKU_DESCRIPTION,
         decode(OI.SUIT_ID, null, 0, 1),  
         OI.COMMODITY_NUMBER,
         OI.Deposit * OI.COMMODITY_NUMBER,
         OI.COMMISSION_RATE,
         ROUND(NVL(oi.commission_rate * oi.deposit *oi.commodity_number,0),2),
         OM.FINISH_DATE,
         OI.Deposit * OI.COMMODITY_NUMBER - ROUND(NVL(oi.commission_rate * oi.deposit * oi.commodity_number,0),2)- ROUND(NVL(OI.COMMODITY_PV*OI.COMMODITY_NUMBER,0),2),
         ROUND(NVL(OI.COMMODITY_PV*OI.COMMODITY_NUMBER,0),2)        
	    FROM order_item oi
	    JOIN ORDER_MAIN OM ON OI.ORDER_CODE = OM.ORDER_CODE
	    JOIN  suppliers_info si ON si.supplier_id=om.commerce_id   
      inner join  promotion_presell pp on oi.presell_id=pp.presell_id   
	   WHERE OM.ORDER_STATUS = 23	and pp.finalpay_end_time between	       
			<iterate property="finishDate" conjunction="and">
				#finishDate[]#
			</iterate>	   
		 and si.merchant_id=#sellerId#
			
	</insert>
	<!-- 插入妥投商品运费明细表所需数据 -->
	<insert id="ibatorgenerated_insertSettleFareDetail"
		parameterClass="java.util.Map">
		INSERT INTO
		HURL_FARE(SETTLEMENT_FARE_ID,ORDER_CODE,SETTLEMENT_NO,CONSIGNEE_NAME,CONSIGNEE_MOBILE,CONSIGNEE_ADDR,FARE,SETTLEMENT_TIME)
		SELECT
		SEQ_HURL_FARE_ID.Nextval,
		OM.ORDER_CODE,
		#settlementNo#,
		OM.CONSIGNEE_NAME, 
       OM.CONSIGNEE_MOBILE, 
       OM.CONSIGNEE_ADDR, 
       NVL(OM.FARE,0), 
       OM.FINISH_DATE 
		FROM ORDER_MAIN OM
		JOIN  suppliers_info si ON si.supplier_id=om.commerce_id
        JOIN   COMMERCIAL_TENANT_BASIC_INFO t ON t.n_commercial_tenant_id=si.merchant_id
		WHERE OM.ORDER_STATUS=6
		<![CDATA[
			AND NVL(OM.FARE,0)<>0
		]]>
		<!-- 排除创8的单:当某单既包含微商，又包含非微商单时，运费全计供应商承担 
	 	AND NOT EXISTS (SELECT 1 FROM  SPREAD_EFFECT SE WHERE SE.ORDER_CODE=OM.ORDER_CODE
			AND (SELECT COUNT(1) FROM  SPREAD_EFFECT WHERE ORDER_CODE=OM.ORDER_CODE)=
			(SELECT COUNT(1) FROM  ORDER_ITEM OI WHERE OI.ORDER_CODE=OM.ORDER_CODE)
		)-->
		<isParameterPresent>
			<include refid="SELLER_SETTLEMENT.settle_data" />
		</isParameterPresent>
	</insert>
	<!-- 插入退款商品明细表所需数据 -->
	<insert id="ibatorgenerated_insertSettleRefundDetail"
		parameterClass="java.util.Map">
		INSERT INTO
		SETTLEMENT_REFUND(SETTLEMENT_REFUND_ID,SETTLEMENT_NO,ORDER_CODE,ORDER_ALTER_CODE,SERVICE_TYPE,SKU_NO,PRODUCT_TITLE,DEAL_NUMBER,REFUND_MONEY
		,COMMISSION_RATE,COMMISSION,SETTLE_ACCOUNTS,SETTLEMENT_TIME,REFUND_FARE,REFUND_COMMODITY_PV_SUM)
		SELECT SEQ_SETTLEMENT_REFUND_ID.Nextval, 
			 #settlementNo#,
	         OM.ORDER_CODE,
	         OA.ORDER_ALTER_CODE,
	         OA.ALTER_TYPE,
	         OI.COMMODITY_SKU,
	         OI.COMMODITY_TITLE || OI.COMMODITY_SKU_DESCRIPTION,
	         OA.ALTER_NUM,
	         abs(oa.ruturn_money),
	         OI.COMMISSION_RATE,
	         ROUND(NVL(oi.commission_rate * abs(oa.ruturn_money),
	             0),2),
	         abs(oa.ruturn_money) - ROUND(NVL(oi.commission_rate * abs(oa.ruturn_money),0),2) - ROUND(NVL(OI.COMMODITY_PV*OA.ALTER_NUM,0),2),
	         OA.FINISH_DATE,
	         OA.RETURN_FARE,
	         ROUND(NVL(OI.COMMODITY_PV*OA.ALTER_NUM,0),2)  
	    FROM order_item oi
	    JOIN order_alter oa ON oi.order_item_id=oa.order_item_id 
	    JOIN ORDER_MAIN OM ON OI.ORDER_CODE = OM.ORDER_CODE
	    JOIN  suppliers_info si ON si.supplier_id=om.commerce_id
	    <!-- JOIN   COMMERCIAL_TENANT_BASIC_INFO t ON t.n_commercial_tenant_id=si.merchant_id -->
	   WHERE OA.PROPOSE_STATUS=7	
	   	<!-- 排除创8单 
	   	AND NOT EXISTS(SELECT 1 FROM  SPREAD_EFFECT SE WHERE SE.ORDER_ITEM_ID=OI.ORDER_ITEM_ID)-->
	   	AND EXISTS(SELECT 1 FROM  ORDER_ALTER_PAY_STATEMENT OAPS 
		       WHERE OAPS.ORDER_ALTER_CODE=OA.ORDER_ALTER_CODE
		       AND OAPS.FLAG=2
	       		)
		and si.merchant_id=#sellerId#
		AND OA.FINISH_DATE  between
			<iterate property="finishDate" conjunction="and">
				#finishDate[]#
			</iterate>
	</insert>
	<!-- 插入退款商品明细表所需数据，预售超时未发货赔付 
	<insert id="ibatorgenerated_insertSettleRefundDetailForPresell"
	parameterClass="java.util.Map">
	INSERT INTO
	SETTLEMENT_REFUND(SETTLEMENT_REFUND_ID,SETTLEMENT_NO,ORDER_CODE,ORDER_ALTER_CODE,SERVICE_TYPE,SKU_NO,PRODUCT_TITLE,DEAL_NUMBER,REFUND_MONEY
	,COMMISSION_RATE,COMMISSION,SETTLE_ACCOUNTS,SETTLEMENT_TIME,REFUND_FARE)
	SELECT SEQ_SETTLEMENT_REFUND_ID.Nextval, 
	 	 #settlementNo#,
         OM.ORDER_CODE,
         OA.ORDER_ALTER_CODE,
         OA.ALTER_TYPE,
         OI.COMMODITY_SKU,
         OI.COMMODITY_TITLE || OI.COMMODITY_SKU_DESCRIPTION,
         OA.ALTER_NUM,
         abs(oa.DEPOSIT+oa.FINALMONEY),
         OI.COMMISSION_RATE,
         ROUND(NVL(oi.commission_rate * abs(oa.DEPOSIT+oa.FINALMONEY),
             0),2),
         abs(oa.DEPOSIT+oa.FINALMONEY) - ROUND(NVL(oi.commission_rate * abs(oa.DEPOSIT+oa.FINALMONEY),0),2),
         OA.FINISH_DATE,
         OA.RETURN_FARE
    FROM order_item oi
    JOIN order_alter oa ON oi.order_item_id=oa.order_item_id 
    JOIN ORDER_MAIN OM ON OI.ORDER_CODE = OM.ORDER_CODE
    JOIN  suppliers_info si ON si.supplier_id=om.commerce_id    
   WHERE OA.PROPOSE_STATUS=7
   	AND OM.ORDER_TYPE = 7
   	AND OA.ALTER_TYPE = 4   	
	and si.merchant_id=#sellerId#
	AND OA.FINISH_DATE  between
		<iterate property="finishDate" conjunction="and">
			#finishDate[]#
		</iterate>

</insert>
-->

	<!-- 结算单所需数据查询 end -->
  
  <!-- 查询到期未结算的商家ID -->
   	<resultMap class="java.util.HashMap" id="settle_commercial_map">
		<result property="COMMERCIALID" column="MERCHANT_ID" />
	</resultMap>
	<select id="ibatorgenerated_selectSellersNeedSettle" resultMap="settle_commercial_map"
		parameterClass="java.util.Map" >
		SELECT SI.MERCHANT_ID FROM  SUPPLIERS_INFO SI
		WHERE NOT EXISTS(SELECT 1 FROM  SELLER_SETTLEMENT ST WHERE
		ST.SELLER_ID=SI.MERCHANT_ID
		AND ST.SETTLEMENT_PERIOD= #settlePeriod#
		)
		AND SI.SUPPLIER_TYPE=2
		AND SI.STATUS =3
		<!-- SELECT SI.SUPPLIER_ID COMMERCIALID FROM
		 SUPPLIERS_INFO SI WHERE NOT
		EXISTS(SELECT 1 FROM  SELLER_SETTLEMENT ST WHERE
		ST.SELLER_ID=SI.SUPPLIER_ID AND ST.SETTLEMENT_PERIOD= #settlePeriod#) -->
	</select>
	
	<!--模糊查询 商家名称  -->
	<select id="selectSupplierListByName" resultClass="com.pltfm.app.entities.SellerSettlement" parameterClass="String">
		select T.N_COMMERCIAL_TENANT_ID as sellerId,t.Corporate_Name as sellerName
		 from 
			  COMMERCIAL_TENANT_BASIC_INFO t
			where
			     t.corporate_name like '%'||#supplierName#||'%' 
	</select>
  <!--模糊查询商户 年度内存在的结算单  -->
	<select id="selectSupplierByLikePeriod" resultClass="String" parameterClass="com.pltfm.app.entities.SellerSettlement">
				SELECT t.settlement_period as settlePeriod 
				FROM  SELLER_SETTLEMENT t
				WHERE t.seller_id=#sellerId#
				AND t.SETTLEMENT_PERIOD like '%'||#settlementPeriod#||'%' 
	</select>
	
	
	  <!--查询所有商户列表 -->
	<select id="selectAllSupplier" resultClass="com.pltfm.app.entities.SellerSettlement">
		SELECT  CTBI.CORPORATE_NAME AS sellerName ,CTBI.N_COMMERCIAL_TENANT_ID as sellerId
  		FROM   COMMERCIAL_TENANT_BASIC_INFO CTBI
  		JOIN  SUPPLIERS_INFO SI ON SI.MERCHANT_ID=CTBI.N_COMMERCIAL_TENANT_ID
  		WHERE 1=1
  			AND SI.SUPPLIER_TYPE=2
			AND SI.STATUS =3
	</select>
	
	<update id="finacialAmountSettle" parameterClass="com.pltfm.app.entities.SellerSettlement">
		update   account_info ai
   		set ai.n_account_amount = ai.n_account_amount +
                             (SELECT ss.curr_settle_accounts
                                FROM  seller_settlement ss
                                join   COMMERCIAL_TENANT_BASIC_INFO CTBI on ctbi.n_commercial_tenant_id =
                                                                                 ss.seller_id
                               where ss.seller_id = #sellerId# 
                                 and ss.settlement_period = #settlementPeriod#)
		 where ai.n_login_id =
		       (select ct.n_login_id
		          from   COMMERCIAL_TENANT_BASIC_INFO ct
		         where ct.N_COMMERCIAL_TENANT_ID=#sellerId# )
	</update>
	
	<select id="selectSumAdjForSettle" parameterClass="java.util.Map" resultClass="java.math.BigDecimal">
		select sum(da.adj_money)
                   from diff_adj da
                  join seller_settlement ss on da.curr_settment_no=ss.settlement_no
                  where da.seller_id = #sellerId#
                  and da.settment_status=0
                  and ss.settlement_status=6
                  and da.adj_time &lt; #diffDate# 
	</select>
	
	<select id="selectMobileByLoginId" parameterClass="com.pltfm.app.entities.SellerSettlement" resultClass="java.lang.String">
		select LI.mobile loginAcount
		  from   login_info li
		where li.N_LOGIN_ID = (select T.N_LOGIN_ID from   COMMERCIAL_TENANT_BASIC_INFO t WHERE T.N_COMMERCIAL_TENANT_ID=#sellerId#)
	</select>
	
	<select id="queryLoginIdByCommercialId" parameterClass="java.lang.String" resultClass="java.lang.Long">
		select CTBI.N_LOGIN_ID loginId
		  from   COMMERCIAL_TENANT_BASIC_INFO CTBI
		WHERE CTBI.N_COMMERCIAL_TENANT_ID=#sellerId#
	</select>
	
	<select id="queryCompensateForPressell" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		SELECT				
		       	SUM(abs(oa.COMPENSATE)) COMPENSATE,
		        COUNT(1) COUNTORDERNUMBER
			FROM  order_alter oa 
			    JOIN ORDER_MAIN OM ON OA.ORDER_CODE = OM.ORDER_CODE
			    JOIN  suppliers_info si ON si.supplier_id=om.commerce_id
			WHERE OA.PROPOSE_STATUS=7
			   	AND OM.ORDER_TYPE = 7
			   	AND OA.ALTER_TYPE = 4   	
				and si.merchant_id=#sellerId#
				AND OA.FINISH_DATE  between
				<iterate property="finishDate" conjunction="and">
					#finishDate[]#
				</iterate>
	</select>
	
	
	
    <!-- 查询结算单导出数据 -->  
   <select id="selectSettlementListForExport" resultClass="java.util.HashMap" parameterClass="com.pltfm.app.entities.SellerSettlementCriteria" >
		
		   select  s.SETTLEMENT_NO settlementNo,t.Corporate_Name sellerName,s.SETTLEMENT_PERIOD settlementPeriod, s.SETTLEMENT_CREATE_TIME settlementCreateTime,
          (nvl(s.RECEIVE_SUM,0) - nvl(s.REFUND_SUM,0)) settleMoney, s.FARE_SUM fareSum,
          (nvl(s.REFUND_COM_SUM,0) - nvl(s.COMMISSION_SUM,0))commission,
           (nvl(s.RETURNPV_SUM,0) - nvl(s.ADDPV_SUM,0))pvsum,
           nvl( s.DIFF_ADJ_SUM,0) diffAdjSum,
           (nvl(s.CURR_SETTLE_ACCOUNTS,0) + nvl(s.DIFF_ADJ_SUM,0)) SettleAccount,
           decode( s.SETTLEMENT_STATUS,1,'未确认',2,'商家已确认',3,'运营已确认',4,'财务审核通过',5,'财务审核拒绝',6,'已结出') settlementStatus
		    from SELLER_SETTLEMENT s
		       LEFT JOIN
		      COMMERCIAL_TENANT_BASIC_INFO t
		    on s.seller_id = t.n_commercial_tenant_id
		    where 1=1
		    
		     <isNotEmpty property="settlementNo" >
		   		 	 and  s.SETTLEMENT_NO = #settlementNo#	
		      </isNotEmpty>
		      <isNotEmpty property="sellerName" >
		        	 and t.Corporate_Name like '%'||#sellerName#||'%' 
		      </isNotEmpty>
		
     			 <isNotEmpty property="sellerId" >
				     and s.seller_id = #sellerId#
			</isNotEmpty> 
		    <isNotEmpty property="settlementStatus" >
		    
		     and s.SETTLEMENT_STATUS = #settlementStatus#    
		    
		     </isNotEmpty>
		    <isNotEmpty property="loginId" >
	        	 and t.N_LOGIN_ID = #loginId#
		      </isNotEmpty>
		      <isNotEmpty property="minMoney">
		      		and (s.CURR_SETTLE_ACCOUNTS+s.DIFF_ADJ_SUM) &gt;= #minMoney#
		      </isNotEmpty> 
		      <isNotEmpty property="maxMoney">
		      		and (s.CURR_SETTLE_ACCOUNTS+s.DIFF_ADJ_SUM) &lt;= #maxMoney#
		      </isNotEmpty>
		    <isNotEmpty property="inPeriods">
					and s.settlement_period in
				<iterate property="inPeriods" open="(" close=")" conjunction="," >
		            #inPeriods[]#
	           </iterate>
			</isNotEmpty>
			<isNotEmpty property="statuses">
					and s.SETTLEMENT_STATUS in
				<iterate property="statuses" open="(" close=")" conjunction="," >
		            #statuses[]#
	           </iterate>
			</isNotEmpty>     
					     
					     
				    order by SETTLEMENT_ID desc
	
    
  	</select>
  
</sqlMap>